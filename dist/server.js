!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=12)}([function(e,t){e.exports=require("@coast-team/mute-crypto-helper")},function(e,t){e.exports=require("rxjs")},function(e,t){e.exports=require("rxjs/operators")},function(e,t){e.exports=require("uws")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(21);t.createLogger=function(e,n){const i={name:"mute-bot-storage"};switch(""!==e&&(i.streams=[{type:"rotating-file",period:"1d",count:3,path:`${e}/${i.name}.log`}]),t.log=r.createLogger(i),n){case"none":t.log.level(r.FATAL+1);break;case"trace":t.log.level(r.TRACE);break;case"debug":t.log.level(r.DEBUG);break;case"info":t.log.level(r.INFO);break;case"warn":t.log.level(r.WARN);break;case"error":t.log.level(r.ERROR);break;case"fatal":t.log.level(r.FATAL);break;default:t.log.level(r.INFO)}}},function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("text-encoding")},function(e,t,n){"use strict";n.r(t),n.d(t,"Bot",function(){return Lt}),n.d(t,"LogLevel",function(){return m}),n.d(t,"setLogLevel",function(){return j}),n.d(t,"Topology",function(){return G}),n.d(t,"SignalingState",function(){return He}),n.d(t,"WebGroupState",function(){return ft}),n.d(t,"WebGroup",function(){return Nt});var r=n(5),i=n(6),o=n(3),s=n(1),a=n(2),c=n(10),u={};u.WebSocket=o,u.TextEncoder=i.TextEncoder,u.TextDecoder=i.TextDecoder,u.cryptoNode=r;
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var l=function(e,t){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function h(e,t){function n(){this.constructor=e}l(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var p=function(){return(p=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function f(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}c((r=r.apply(e,t||[])).next())})}function d(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function y(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}function b(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function g(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(b(arguments[t]));return e}var m,v="background-color: #FFCA28; padding: 0 3px",w="background-color: #b3ba2e; padding: 0 3px",S="background-color: #CE93D8; padding: 0 3px",O="background-color: #90CAF9; padding: 0 3px",I="background-color: #26A69A; padding: 0 3px",_="background-color: #66BB6A; padding: 0 3px",x="background-color: #F57C00; padding: 0 3px",E="background-color: #9FA8DA; padding: 0 2px",k="background-color: #EF9A9A; padding: 0 2px",T="background-color: #FF5252; padding: 0 2px",C={webgroup:function(){},signalingState:function(){},webGroupState:function(){},webrtc:function(){},channel:function(){},topology:function(){},signaling:function(){},channelBuilder:function(){},debug:function(){},warn:function(){}};!function(e){e[e.DEBUG=0]="DEBUG",e[e.WEB_GROUP=1]="WEB_GROUP",e[e.WEBRTC=2]="WEBRTC",e[e.CHANNEL=3]="CHANNEL",e[e.TOPOLOGY=4]="TOPOLOGY",e[e.SIGNALING=5]="SIGNALING",e[e.CHANNEL_BUILDER=6]="CHANNEL_BUILDER"}(m||(m={}));var M=[];function j(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];(M=e).includes(m.WEB_GROUP)?(C.webgroup=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];0===t.length?console.info("%cNETFLUX WebGroup%c: "+e,v,""):console.info.apply(console,g(["%cNETFLUX WebGroup%c: "+e,v,""],t))},C.signalingState=function(e,t){console.info("%cNETFLUX "+t+" WebGroup%c: Signaling: %c"+e+"%c",v,"",E,"")},C.webGroupState=function(e,t){console.info("%cNETFLUX "+t+" WebGroup%c: WebGroup: %c"+e+"%c",v,"",k,"")}):(C.webgroup=function(){},C.signalingState=function(){},C.webGroupState=function(){}),M.includes(m.WEBRTC)?C.webrtc=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];0===t.length?console.info("%cNETFLUX WebRTC%c: "+e,S,""):console.info.apply(console,g(["%cNETFLUX WebRTC%c: "+e,S,""],t))}:C.webrtc=function(){},M.includes(m.CHANNEL)?C.channel=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];0===t.length?console.info("%cNETFLUX Channel%c: "+e,O,""):console.info.apply(console,g(["%cNETFLUX Channel%c: "+e,O,""],t))}:C.channel=function(){},M.includes(m.TOPOLOGY)?C.topology=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];0===t.length?console.info("%cNETFLUX Topology%c: "+e,I,""):console.info.apply(console,g(["%cNETFLUX Topology%c: "+e,I,""],t))}:C.topology=function(){},M.includes(m.SIGNALING)?C.signaling=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];0===t.length?console.info("%cNETFLUX Signaling%c: "+e,_,""):console.info.apply(console,g(["%cNETFLUX Signaling%c: "+e,_,""],t))}:C.signaling=function(){},M.includes(m.CHANNEL_BUILDER)?C.channelBuilder=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];0===t.length?console.info("%cNETFLUX ChannelBuilder%c: "+e,x,""):console.info.apply(console,g(["%cNETFLUX ChannelBuilder%c: "+e,x,""],t))}:C.channelBuilder=function(){},M.includes(m.DEBUG)?C.debug=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];0===t.length?console.info("%cNETFLUX Debug%c: "+e,w,""):console.info.apply(console,g(["%cNETFLUX Debug%c: "+e,w,""],t))}:C.debug=function(){},C.warn=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];0===t.length?console.info("%cNETFLUX WARNING%c: "+e,T,""):console.info.apply(console,g(["%cNETFLUX WARNING%c: "+e,T,""],t))}}var N=2147483648,P="undefined"!=typeof window;function A(){return!P||navigator.onLine}function R(){return!P||"visible"===document.visibilityState}function L(e){if(!new RegExp(/^(wss|ws):\/\/((([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])|(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9]))(:[0-9]{1,5})?(\/.*)?$/,"i").test(e))throw new Error("Invalid URL: "+e)}function B(e){void 0===e&&(e=[]);var t=F()[0];return t<N&&(t+=N),e.includes(t)?B(e):t}var D=512;function U(e){return e.split("/")[2]}function F(e){var t;if(void 0===e&&(e=1),P)t=new Uint32Array(e),u.crypto.getRandomValues(t);else{t=[];for(var n=u.cryptoNode.randomBytes(4*e),r=0;r<n.length;r+=4)t[t.length]=n.readUInt32BE(r,!0)}return t}function z(){return!!u.WebSocket}var G,$,q=function(){function e(e,t){this.serviceId=e,this.proto=t}return e.prototype.useWebChannelStream=function(e){var t=this;return{id:e.STREAM_ID,message:e.messageFromStream.pipe(Object(a.filter)(function(e){return e.serviceId===t.serviceId}),Object(a.map)(function(e){var n=e.channel,r=e.senderId,i=e.recipientId,o=e.content;return{channel:n,senderId:r,recipientId:i,msg:t.decode(o)}}),Object(a.filter)(function(e){var t=e.msg;return t&&t.type})),send:function(n,r){e.sendOverStream({senderId:e.myId,recipientId:r,serviceId:t.serviceId,content:n instanceof Uint8Array?n:t.encode(n)})}}},e.prototype.useSignalingStream=function(e){var t=this;return{id:e.STREAM_ID,message:e.messageFromStream.pipe(Object(a.filter)(function(e){return e.serviceId===t.serviceId}),Object(a.map)(function(e){var n=e.senderId,r=e.recipientId,i=e.content;return{senderId:n,recipientId:r,msg:t.decode(i)}}),Object(a.filter)(function(e){var t=e.msg;return t&&t.type})),send:function(n,r,i){e.sendOverStream({senderId:i,recipientId:r,serviceId:t.serviceId,content:n instanceof Uint8Array?n:t.encode(n)})}}},e.prototype.useAllStreams=function(e,t){var n=this.useWebChannelStream(e),r=this.useSignalingStream(t);return{message:Object(s.merge)(n.message.pipe(Object(a.map)(function(e){var t=e.senderId,r=e.recipientId,i=e.msg;return{streamId:n.id,senderId:t,recipientId:r,msg:i}})),r.message.pipe(Object(a.map)(function(e){var t=e.senderId,n=e.recipientId,i=e.msg;return{streamId:r.id,senderId:t,recipientId:n,msg:i}}))),sendOver:function(e,t,i,o){e===n.id?n.send(t,i):r.send(t,i,o)}}},e.prototype.encode=function(e){return this.proto.encode(this.proto.create(e)).finish()},e.prototype.decode=function(e){try{return this.proto.decode(e)}catch(e){C.warn("Decode service message error: ",e)}return{type:void 0}},e}();!function(e){e[e.FULL_MESH=0]="FULL_MESH"}(G||(G={})),function(e){e[e.CONSTRUCTING=0]="CONSTRUCTING",e[e.CONSTRUCTED=1]="CONSTRUCTED",e[e.IDLE=2]="IDLE"}($||($={}));var W=function(e){function t(t,n,r){var i=e.call(this,n,r)||this;return i.wc=t,i.wcStream=e.prototype.useWebChannelStream.call(i,t),i.stateSubject=new s.Subject,i._state=$.IDLE,i}return h(t,e),Object.defineProperty(t.prototype,"onState",{get:function(){return this.stateSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),t.prototype.setJoinedState=function(){this.setState($.CONSTRUCTED)},t.prototype.setState=function(e){this.state!==e&&(C.topology("Topology state = "+$[e]),this._state=e,this.stateSubject.next(e))},t}(q),V="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function H(e,t){return e(t={exports:{}},t.exports),t.exports}var K=function(e,t){var n=new Array(arguments.length-1),r=0,i=2,o=!0;for(;i<arguments.length;)n[r++]=arguments[i++];return new Promise(function(i,s){n[r]=function(e){if(o)if(o=!1,e)s(e);else{for(var t=new Array(arguments.length-1),n=0;n<t.length;)t[n++]=arguments[n];i.apply(null,t)}};try{e.apply(t||null,n)}catch(e){o&&(o=!1,s(e))}})};var J=H(function(e,t){var n=t;n.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;--t%4>1&&"="===e.charAt(t);)++n;return Math.ceil(3*e.length)/4-n};for(var r=new Array(64),i=new Array(123),o=0;o<64;)i[r[o]=o<26?o+65:o<52?o+71:o<62?o-4:o-59|43]=o++;n.encode=function(e,t,n){for(var i,o=null,s=[],a=0,c=0;t<n;){var u=e[t++];switch(c){case 0:s[a++]=r[u>>2],i=(3&u)<<4,c=1;break;case 1:s[a++]=r[i|u>>4],i=(15&u)<<2,c=2;break;case 2:s[a++]=r[i|u>>6],s[a++]=r[63&u],c=0}a>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,s)),a=0)}return c&&(s[a++]=r[i],s[a++]=61,1===c&&(s[a++]=61)),o?(a&&o.push(String.fromCharCode.apply(String,s.slice(0,a))),o.join("")):String.fromCharCode.apply(String,s.slice(0,a))};n.decode=function(e,t,n){for(var r,o=n,s=0,a=0;a<e.length;){var c=e.charCodeAt(a++);if(61===c&&s>1)break;if(void 0===(c=i[c]))throw Error("invalid encoding");switch(s){case 0:r=c,s=1;break;case 1:t[n++]=r<<2|(48&c)>>4,r=c,s=2;break;case 2:t[n++]=(15&r)<<4|(60&c)>>2,r=c,s=3;break;case 3:t[n++]=(3&r)<<6|c,s=0}}if(1===s)throw Error("invalid encoding");return n-o},n.test=function(e){return/^(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/.test(e)}}),X=Z;function Z(){this._listeners={}}Z.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this},Z.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var n=this._listeners[e],r=0;r<n.length;)n[r].fn===t?n.splice(r,1):++r;return this},Z.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],r=1;r<arguments.length;)n.push(arguments[r++]);for(r=0;r<t.length;)t[r].fn.apply(t[r++].ctx,n)}return this};var Y=Q(Q);function Q(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),n=new Uint8Array(t.buffer),r=128===n[3];function i(e,r,i){t[0]=e,r[i]=n[0],r[i+1]=n[1],r[i+2]=n[2],r[i+3]=n[3]}function o(e,r,i){t[0]=e,r[i]=n[3],r[i+1]=n[2],r[i+2]=n[1],r[i+3]=n[0]}function s(e,r){return n[0]=e[r],n[1]=e[r+1],n[2]=e[r+2],n[3]=e[r+3],t[0]}function a(e,r){return n[3]=e[r],n[2]=e[r+1],n[1]=e[r+2],n[0]=e[r+3],t[0]}e.writeFloatLE=r?i:o,e.writeFloatBE=r?o:i,e.readFloatLE=r?s:a,e.readFloatBE=r?a:s}():function(){function t(e,t,n,r){var i=t<0?1:0;if(i&&(t=-t),0===t)e(1/t>0?0:2147483648,n,r);else if(isNaN(t))e(2143289344,n,r);else if(t>3.4028234663852886e38)e((i<<31|2139095040)>>>0,n,r);else if(t<1.1754943508222875e-38)e((i<<31|Math.round(t/1.401298464324817e-45))>>>0,n,r);else{var o=Math.floor(Math.log(t)/Math.LN2);e((i<<31|o+127<<23|8388607&Math.round(t*Math.pow(2,-o)*8388608))>>>0,n,r)}}function n(e,t,n){var r=e(t,n),i=2*(r>>31)+1,o=r>>>23&255,s=8388607&r;return 255===o?s?NaN:i*(1/0):0===o?1.401298464324817e-45*i*s:i*Math.pow(2,o-150)*(s+8388608)}e.writeFloatLE=t.bind(null,ee),e.writeFloatBE=t.bind(null,te),e.readFloatLE=n.bind(null,ne),e.readFloatBE=n.bind(null,re)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),n=new Uint8Array(t.buffer),r=128===n[7];function i(e,r,i){t[0]=e,r[i]=n[0],r[i+1]=n[1],r[i+2]=n[2],r[i+3]=n[3],r[i+4]=n[4],r[i+5]=n[5],r[i+6]=n[6],r[i+7]=n[7]}function o(e,r,i){t[0]=e,r[i]=n[7],r[i+1]=n[6],r[i+2]=n[5],r[i+3]=n[4],r[i+4]=n[3],r[i+5]=n[2],r[i+6]=n[1],r[i+7]=n[0]}function s(e,r){return n[0]=e[r],n[1]=e[r+1],n[2]=e[r+2],n[3]=e[r+3],n[4]=e[r+4],n[5]=e[r+5],n[6]=e[r+6],n[7]=e[r+7],t[0]}function a(e,r){return n[7]=e[r],n[6]=e[r+1],n[5]=e[r+2],n[4]=e[r+3],n[3]=e[r+4],n[2]=e[r+5],n[1]=e[r+6],n[0]=e[r+7],t[0]}e.writeDoubleLE=r?i:o,e.writeDoubleBE=r?o:i,e.readDoubleLE=r?s:a,e.readDoubleBE=r?a:s}():function(){function t(e,t,n,r,i,o){var s=r<0?1:0;if(s&&(r=-r),0===r)e(0,i,o+t),e(1/r>0?0:2147483648,i,o+n);else if(isNaN(r))e(0,i,o+t),e(2146959360,i,o+n);else if(r>1.7976931348623157e308)e(0,i,o+t),e((s<<31|2146435072)>>>0,i,o+n);else{var a;if(r<2.2250738585072014e-308)e((a=r/5e-324)>>>0,i,o+t),e((s<<31|a/4294967296)>>>0,i,o+n);else{var c=Math.floor(Math.log(r)/Math.LN2);1024===c&&(c=1023),e(4503599627370496*(a=r*Math.pow(2,-c))>>>0,i,o+t),e((s<<31|c+1023<<20|1048576*a&1048575)>>>0,i,o+n)}}}function n(e,t,n,r,i){var o=e(r,i+t),s=e(r,i+n),a=2*(s>>31)+1,c=s>>>20&2047,u=4294967296*(1048575&s)+o;return 2047===c?u?NaN:a*(1/0):0===c?5e-324*a*u:a*Math.pow(2,c-1075)*(u+4503599627370496)}e.writeDoubleLE=t.bind(null,ee,0,4),e.writeDoubleBE=t.bind(null,te,4,0),e.readDoubleLE=n.bind(null,ne,0,4),e.readDoubleBE=n.bind(null,re,4,0)}(),e}function ee(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function te(e,t,n){t[n]=e>>>24,t[n+1]=e>>>16&255,t[n+2]=e>>>8&255,t[n+3]=255&e}function ne(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function re(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}var ie=function(e){return null};var oe=H(function(e,t){var n=t;n.length=function(e){for(var t=0,n=0,r=0;r<e.length;++r)(n=e.charCodeAt(r))<128?t+=1:n<2048?t+=2:55296==(64512&n)&&56320==(64512&e.charCodeAt(r+1))?(++r,t+=4):t+=3;return t},n.read=function(e,t,n){if(n-t<1)return"";for(var r,i=null,o=[],s=0;t<n;)(r=e[t++])<128?o[s++]=r:r>191&&r<224?o[s++]=(31&r)<<6|63&e[t++]:r>239&&r<365?(r=((7&r)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,o[s++]=55296+(r>>10),o[s++]=56320+(1023&r)):o[s++]=(15&r)<<12|(63&e[t++])<<6|63&e[t++],s>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),s=0);return i?(s&&i.push(String.fromCharCode.apply(String,o.slice(0,s))),i.join("")):String.fromCharCode.apply(String,o.slice(0,s))},n.write=function(e,t,n){for(var r,i,o=n,s=0;s<e.length;++s)(r=e.charCodeAt(s))<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):55296==(64512&r)&&56320==(64512&(i=e.charCodeAt(s+1)))?(r=65536+((1023&r)<<10)+(1023&i),++s,t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128);return n-o}}),se=function(e,t,n){var r=n||8192,i=r>>>1,o=null,s=r;return function(n){if(n<1||n>i)return e(n);s+n>r&&(o=e(r),s=0);var a=t.call(o,s,s+=n);return 7&s&&(s=1+(7|s)),a}};var ae=ce;function ce(e,t){this.lo=e>>>0,this.hi=t>>>0}var ue=ce.zero=new ce(0,0);ue.toNumber=function(){return 0},ue.zzEncode=ue.zzDecode=function(){return this},ue.length=function(){return 1};var le=ce.zeroHash="\0\0\0\0\0\0\0\0";ce.fromNumber=function(e){if(0===e)return ue;var t=e<0;t&&(e=-e);var n=e>>>0,r=(e-n)/4294967296>>>0;return t&&(r=~r>>>0,n=~n>>>0,++n>4294967295&&(n=0,++r>4294967295&&(r=0))),new ce(n,r)},ce.from=function(e){if("number"==typeof e)return ce.fromNumber(e);if(fe.isString(e)){if(!fe.Long)return ce.fromNumber(parseInt(e,10));e=fe.Long.fromString(e)}return e.low||e.high?new ce(e.low>>>0,e.high>>>0):ue},ce.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+4294967296*n)}return this.lo+4294967296*this.hi},ce.prototype.toLong=function(e){return fe.Long?new fe.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var he=String.prototype.charCodeAt;ce.fromHash=function(e){return e===le?ue:new ce((he.call(e,0)|he.call(e,1)<<8|he.call(e,2)<<16|he.call(e,3)<<24)>>>0,(he.call(e,4)|he.call(e,5)<<8|he.call(e,6)<<16|he.call(e,7)<<24)>>>0)},ce.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},ce.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},ce.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},ce.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10};var pe,fe=H(function(e,t){var n=t;function r(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;++i)void 0!==e[r[i]]&&n||(e[r[i]]=t[r[i]]);return e}function i(e){function t(e,n){if(!(this instanceof t))return new t(e,n);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&r(this,n)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}n.asPromise=K,n.base64=J,n.EventEmitter=X,n.float=Y,n.inquire=ie,n.utf8=oe,n.pool=se,n.LongBits=ae,n.global="undefined"!=typeof window&&window||void 0!==V&&V||"undefined"!=typeof self&&self||V,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isNode=Boolean(n.global.process&&n.global.process.versions&&n.global.process.versions.node),n.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},n.isString=function(e){return"string"==typeof e||e instanceof String},n.isObject=function(e){return e&&"object"==typeof e},n.isset=n.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!=typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},n.Buffer=function(){try{var e=n.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(e){return"number"==typeof e?n.Buffer?n._Buffer_allocUnsafe(e):new n.Array(e):n.Buffer?n._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},n.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(e){return e?n.LongBits.from(e).toHash():n.LongBits.zeroHash},n.longFromHash=function(e,t){var r=n.LongBits.fromHash(e);return n.Long?n.Long.fromBits(r.lo,r.hi,t):r.toNumber(Boolean(t))},n.merge=r,n.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},n.newError=i,n.ProtocolError=i("ProtocolError"),n.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;n>-1;--n)if(1===t[e[n]]&&void 0!==this[e[n]]&&null!==this[e[n]])return e[n]}},n.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){var e=n.Buffer;e?(n._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},n._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):n._Buffer_from=n._Buffer_allocUnsafe=null}}),de=Se,ye=fe.LongBits,be=fe.base64,ge=fe.utf8;function me(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function ve(){}function we(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function Se(){this.len=0,this.head=new me(ve,0,0),this.tail=this.head,this.states=null}function Oe(e,t,n){t[n]=255&e}function Ie(e,t){this.len=e,this.next=void 0,this.val=t}function _e(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[n++]=127&e.lo|128,e.lo=e.lo>>>7;t[n++]=e.lo}function xe(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}Se.create=fe.Buffer?function(){return(Se.create=function(){return new pe})()}:function(){return new Se},Se.alloc=function(e){return new fe.Array(e)},fe.Array!==Array&&(Se.alloc=fe.pool(Se.alloc,fe.Array.prototype.subarray)),Se.prototype._push=function(e,t,n){return this.tail=this.tail.next=new me(e,t,n),this.len+=t,this},Ie.prototype=Object.create(me.prototype),Ie.prototype.fn=function(e,t,n){for(;e>127;)t[n++]=127&e|128,e>>>=7;t[n]=e},Se.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new Ie((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},Se.prototype.int32=function(e){return e<0?this._push(_e,10,ye.fromNumber(e)):this.uint32(e)},Se.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},Se.prototype.uint64=function(e){var t=ye.from(e);return this._push(_e,t.length(),t)},Se.prototype.int64=Se.prototype.uint64,Se.prototype.sint64=function(e){var t=ye.from(e).zzEncode();return this._push(_e,t.length(),t)},Se.prototype.bool=function(e){return this._push(Oe,1,e?1:0)},Se.prototype.fixed32=function(e){return this._push(xe,4,e>>>0)},Se.prototype.sfixed32=Se.prototype.fixed32,Se.prototype.fixed64=function(e){var t=ye.from(e);return this._push(xe,4,t.lo)._push(xe,4,t.hi)},Se.prototype.sfixed64=Se.prototype.fixed64,Se.prototype.float=function(e){return this._push(fe.float.writeFloatLE,4,e)},Se.prototype.double=function(e){return this._push(fe.float.writeDoubleLE,8,e)};var Ee=fe.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var r=0;r<e.length;++r)t[n+r]=e[r]};Se.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(Oe,1,0);if(fe.isString(e)){var n=Se.alloc(t=be.length(e));be.decode(e,n,0),e=n}return this.uint32(t)._push(Ee,t,e)},Se.prototype.string=function(e){var t=ge.length(e);return t?this.uint32(t)._push(ge.write,t,e):this._push(Oe,1,0)},Se.prototype.fork=function(){return this.states=new we(this),this.head=this.tail=new me(ve,0,0),this.len=0,this},Se.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new me(ve,0,0),this.len=0),this},Se.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},Se.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},Se._configure=function(e){pe=e};var ke=Ce;(Ce.prototype=Object.create(de.prototype)).constructor=Ce;var Te=fe.Buffer;function Ce(){de.call(this)}Ce.alloc=function(e){return(Ce.alloc=fe._Buffer_allocUnsafe)(e)};var Me=Te&&Te.prototype instanceof Uint8Array&&"set"===Te.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var r=0;r<e.length;)t[n++]=e[r++]};function je(e,t,n){e.length<40?fe.utf8.write(e,t,n):t.utf8Write(e,n)}Ce.prototype.bytes=function(e){fe.isString(e)&&(e=fe._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(Me,t,e),this},Ce.prototype.string=function(e){var t=Te.byteLength(e);return this.uint32(t),t&&this._push(je,t,e),this};var Ne,Pe=Be,Ae=fe.LongBits,Re=fe.utf8;function Le(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function Be(e){this.buf=e,this.pos=0,this.len=e.length}var De,Ue="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Be(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Be(e);throw Error("illegal buffer")};function Fe(){var e=new Ae(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw Le(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw Le(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function ze(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function Ge(){if(this.pos+8>this.len)throw Le(this,8);return new Ae(ze(this.buf,this.pos+=4),ze(this.buf,this.pos+=4))}Be.create=fe.Buffer?function(e){return(Be.create=function(e){return fe.Buffer.isBuffer(e)?new Ne(e):Ue(e)})(e)}:Ue,Be.prototype._slice=fe.Array.prototype.subarray||fe.Array.prototype.slice,Be.prototype.uint32=(De=4294967295,function(){if(De=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return De;if(De=(De|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return De;if(De=(De|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return De;if(De=(De|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return De;if(De=(De|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return De;if((this.pos+=5)>this.len)throw this.pos=this.len,Le(this,10);return De}),Be.prototype.int32=function(){return 0|this.uint32()},Be.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},Be.prototype.bool=function(){return 0!==this.uint32()},Be.prototype.fixed32=function(){if(this.pos+4>this.len)throw Le(this,4);return ze(this.buf,this.pos+=4)},Be.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Le(this,4);return 0|ze(this.buf,this.pos+=4)},Be.prototype.float=function(){if(this.pos+4>this.len)throw Le(this,4);var e=fe.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},Be.prototype.double=function(){if(this.pos+8>this.len)throw Le(this,4);var e=fe.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},Be.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw Le(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)},Be.prototype.string=function(){var e=this.bytes();return Re.read(e,0,e.length)},Be.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw Le(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw Le(this)}while(128&this.buf[this.pos++]);return this},Be.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},Be._configure=function(e){Ne=e;var t=fe.Long?"toLong":"toNumber";fe.merge(Be.prototype,{int64:function(){return Fe.call(this)[t](!1)},uint64:function(){return Fe.call(this)[t](!0)},sint64:function(){return Fe.call(this).zzDecode()[t](!1)},fixed64:function(){return Ge.call(this)[t](!0)},sfixed64:function(){return Ge.call(this)[t](!1)}})};var $e=qe;function qe(e){Pe.call(this,e)}(qe.prototype=Object.create(Pe.prototype)).constructor=qe,fe.Buffer&&(qe.prototype._slice=fe.Buffer.prototype.slice),qe.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len))};var We=Ve;function Ve(e,t,n){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");fe.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(n)}(Ve.prototype=Object.create(fe.EventEmitter.prototype)).constructor=Ve,Ve.prototype.rpcCall=function e(t,n,r,i,o){if(!i)throw TypeError("request must be specified");var s=this;if(!o)return fe.asPromise(e,s,t,n,r,i);if(s.rpcImpl)try{return s.rpcImpl(t,n[s.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(e,n){if(e)return s.emit("error",e,t),o(e);if(null!==n){if(!(n instanceof r))try{n=r[s.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return s.emit("error",e,t),o(e)}return s.emit("data",n,t),o(null,n)}s.end(!0)})}catch(e){return s.emit("error",e,t),void setTimeout(function(){o(e)},0)}else setTimeout(function(){o(Error("already ended"))},0)},Ve.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};var He,Ke=H(function(e,t){t.Service=We}),Je={},Xe=H(function(e,t){var n=t;function r(){n.Reader._configure(n.BufferReader),n.util._configure()}n.build="minimal",n.Writer=de,n.BufferWriter=ke,n.Reader=Pe,n.BufferReader=$e,n.util=fe,n.rpc=Ke,n.roots=Je,n.configure=r,n.Writer._configure(n.BufferWriter),r()}),Ze=Xe.Reader,Ye=Xe.Writer,Qe=Xe.util,et=Xe.roots,tt=Ze,nt=Ye,rt=Qe,it=et.default||(et.default={}),ot=it.Message=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.senderId=0,e.prototype.recipientId=0,e.prototype.serviceId=0,e.prototype.content=rt.newBuffer([]),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=nt.create()),null!=e.senderId&&e.hasOwnProperty("senderId")&&t.uint32(8).uint32(e.senderId),null!=e.recipientId&&e.hasOwnProperty("recipientId")&&t.uint32(16).uint32(e.recipientId),null!=e.serviceId&&e.hasOwnProperty("serviceId")&&t.uint32(24).uint32(e.serviceId),null!=e.content&&e.hasOwnProperty("content")&&t.uint32(34).bytes(e.content),t},e.decode=function(e,t){e instanceof tt||(e=tt.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new it.Message;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.senderId=e.uint32();break;case 2:r.recipientId=e.uint32();break;case 3:r.serviceId=e.uint32();break;case 4:r.content=e.bytes();break;default:e.skipType(7&i)}}return r},e}(),st=it.userMessage=function(){var e={};return e.Message=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t,n,r;return e.prototype.length=0,e.prototype.type=0,e.prototype.full=rt.newBuffer([]),e.prototype.chunk=null,Object.defineProperty(e.prototype,"contentType",{get:rt.oneOfGetter(t=["full","chunk"]),set:rt.oneOfSetter(t)}),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=nt.create()),null!=e.length&&e.hasOwnProperty("length")&&t.uint32(8).uint32(e.length),null!=e.type&&e.hasOwnProperty("type")&&t.uint32(16).int32(e.type),null!=e.full&&e.hasOwnProperty("full")&&t.uint32(26).bytes(e.full),null!=e.chunk&&e.hasOwnProperty("chunk")&&it.userMessage.Message.Chunk.encode(e.chunk,t.uint32(34).fork()).ldelim(),t},e.decode=function(e,t){e instanceof tt||(e=tt.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new it.userMessage.Message;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.length=e.uint32();break;case 2:r.type=e.int32();break;case 3:r.full=e.bytes();break;case 4:r.chunk=it.userMessage.Message.Chunk.decode(e,e.uint32());break;default:e.skipType(7&i)}}return r},e.Chunk=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.id=0,e.prototype.nb=0,e.prototype.content=rt.newBuffer([]),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=nt.create()),null!=e.id&&e.hasOwnProperty("id")&&t.uint32(8).uint32(e.id),null!=e.nb&&e.hasOwnProperty("nb")&&t.uint32(16).uint32(e.nb),null!=e.content&&e.hasOwnProperty("content")&&t.uint32(34).bytes(e.content),t},e.decode=function(e,t){e instanceof tt||(e=tt.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new it.userMessage.Message.Chunk;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.id=e.uint32();break;case 2:r.nb=e.uint32();break;case 4:r.content=e.bytes();break;default:e.skipType(7&i)}}return r},e}(),e.Type=(n={},(r=Object.create(n))[n[0]="STRING"]=0,r[n[1]="U_INT_8_ARRAY"]=1,r),e}(),e}(),at=it.channelBuilder=function(){var e={};return e.Message=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t;return e.prototype.negotiation=null,e.prototype.connectionRequest=rt.newBuffer([]),e.prototype.connectionResponse=!1,Object.defineProperty(e.prototype,"type",{get:rt.oneOfGetter(t=["negotiation","connectionRequest","connectionResponse"]),set:rt.oneOfSetter(t)}),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=nt.create()),null!=e.negotiation&&e.hasOwnProperty("negotiation")&&it.channelBuilder.Negotiation.encode(e.negotiation,t.uint32(10).fork()).ldelim(),null!=e.connectionRequest&&e.hasOwnProperty("connectionRequest")&&t.uint32(18).bytes(e.connectionRequest),null!=e.connectionResponse&&e.hasOwnProperty("connectionResponse")&&t.uint32(24).bool(e.connectionResponse),t},e.decode=function(e,t){e instanceof tt||(e=tt.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new it.channelBuilder.Message;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.negotiation=it.channelBuilder.Negotiation.decode(e,e.uint32());break;case 2:r.connectionRequest=e.bytes();break;case 3:r.connectionResponse=e.bool();break;default:e.skipType(7&i)}}return r},e}(),e.Negotiation=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.initiator=null,e.prototype.passive=null,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=nt.create()),null!=e.initiator&&e.hasOwnProperty("initiator")&&it.channelBuilder.Info.encode(e.initiator,t.uint32(10).fork()).ldelim(),null!=e.passive&&e.hasOwnProperty("passive")&&it.channelBuilder.Info.encode(e.passive,t.uint32(18).fork()).ldelim(),t},e.decode=function(e,t){e instanceof tt||(e=tt.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new it.channelBuilder.Negotiation;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.initiator=it.channelBuilder.Info.decode(e,e.uint32());break;case 2:r.passive=it.channelBuilder.Info.decode(e,e.uint32());break;default:e.skipType(7&i)}}return r},e}(),e.Info=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.id=0,e.prototype.wss="",e.prototype.wcId=0,e.prototype.wsSupported=!1,e.prototype.wsTried=!1,e.prototype.dcSupported=!1,e.prototype.dcTried=!1,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=nt.create()),null!=e.id&&e.hasOwnProperty("id")&&t.uint32(8).uint32(e.id),null!=e.wss&&e.hasOwnProperty("wss")&&t.uint32(18).string(e.wss),null!=e.wcId&&e.hasOwnProperty("wcId")&&t.uint32(24).uint32(e.wcId),null!=e.wsSupported&&e.hasOwnProperty("wsSupported")&&t.uint32(32).bool(e.wsSupported),null!=e.wsTried&&e.hasOwnProperty("wsTried")&&t.uint32(40).bool(e.wsTried),null!=e.dcSupported&&e.hasOwnProperty("dcSupported")&&t.uint32(48).bool(e.dcSupported),null!=e.dcTried&&e.hasOwnProperty("dcTried")&&t.uint32(56).bool(e.dcTried),t},e.decode=function(e,t){e instanceof tt||(e=tt.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new it.channelBuilder.Info;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.id=e.uint32();break;case 2:r.wss=e.string();break;case 3:r.wcId=e.uint32();break;case 4:r.wsSupported=e.bool();break;case 5:r.wsTried=e.bool();break;case 6:r.dcSupported=e.bool();break;case 7:r.dcTried=e.bool();break;default:e.skipType(7&i)}}return r},e}(),e}(),ct=it.fullMesh=function(){var e={};return e.Message=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t;return e.prototype.members=null,e.prototype.adjacentMembers=null,e.prototype.heartbeat=!1,Object.defineProperty(e.prototype,"type",{get:rt.oneOfGetter(t=["members","adjacentMembers","heartbeat"]),set:rt.oneOfSetter(t)}),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=nt.create()),null!=e.members&&e.hasOwnProperty("members")&&it.fullMesh.Peers.encode(e.members,t.uint32(10).fork()).ldelim(),null!=e.adjacentMembers&&e.hasOwnProperty("adjacentMembers")&&it.fullMesh.Peers.encode(e.adjacentMembers,t.uint32(26).fork()).ldelim(),null!=e.heartbeat&&e.hasOwnProperty("heartbeat")&&t.uint32(32).bool(e.heartbeat),t},e.decode=function(e,t){e instanceof tt||(e=tt.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new it.fullMesh.Message;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.members=it.fullMesh.Peers.decode(e,e.uint32());break;case 3:r.adjacentMembers=it.fullMesh.Peers.decode(e,e.uint32());break;case 4:r.heartbeat=e.bool();break;default:e.skipType(7&i)}}return r},e}(),e.Peers=function(){function e(e){if(this.ids=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.ids=rt.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=nt.create()),null!=e.ids&&e.ids.length){t.uint32(10).fork();for(var n=0;n<e.ids.length;++n)t.uint32(e.ids[n]);t.ldelim()}return t},e.decode=function(e,t){e instanceof tt||(e=tt.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new it.fullMesh.Peers;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:if(r.ids&&r.ids.length||(r.ids=[]),2==(7&i))for(var o=e.uint32()+e.pos;e.pos<o;)r.ids.push(e.uint32());else r.ids.push(e.uint32());break;default:e.skipType(7&i)}}return r},e}(),e.ConnectionRequest=function(){function e(e){if(this.adjacentIds=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.id=0,e.prototype.adjacentIds=rt.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=nt.create()),null!=e.id&&e.hasOwnProperty("id")&&t.uint32(8).uint32(e.id),null!=e.adjacentIds&&e.adjacentIds.length){t.uint32(18).fork();for(var n=0;n<e.adjacentIds.length;++n)t.uint32(e.adjacentIds[n]);t.ldelim()}return t},e.decode=function(e,t){e instanceof tt||(e=tt.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new it.fullMesh.ConnectionRequest;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.id=e.uint32();break;case 2:if(r.adjacentIds&&r.adjacentIds.length||(r.adjacentIds=[]),2==(7&i))for(var o=e.uint32()+e.pos;e.pos<o;)r.adjacentIds.push(e.uint32());else r.adjacentIds.push(e.uint32());break;default:e.skipType(7&i)}}return r},e}(),e}(),ut=it.dataChannelBuilder=function(){var e={};return e.Message=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t;return e.prototype.offer="",e.prototype.answer="",e.prototype.candidate=null,Object.defineProperty(e.prototype,"type",{get:rt.oneOfGetter(t=["offer","answer","candidate"]),set:rt.oneOfSetter(t)}),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=nt.create()),null!=e.offer&&e.hasOwnProperty("offer")&&t.uint32(10).string(e.offer),null!=e.answer&&e.hasOwnProperty("answer")&&t.uint32(18).string(e.answer),null!=e.candidate&&e.hasOwnProperty("candidate")&&it.dataChannelBuilder.IceCandidate.encode(e.candidate,t.uint32(26).fork()).ldelim(),t},e.decode=function(e,t){e instanceof tt||(e=tt.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new it.dataChannelBuilder.Message;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.offer=e.string();break;case 2:r.answer=e.string();break;case 3:r.candidate=it.dataChannelBuilder.IceCandidate.decode(e,e.uint32());break;default:e.skipType(7&i)}}return r},e}(),e.IceCandidate=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.candidate="",e.prototype.sdpMid="",e.prototype.sdpMLineIndex=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=nt.create()),null!=e.candidate&&e.hasOwnProperty("candidate")&&t.uint32(10).string(e.candidate),null!=e.sdpMid&&e.hasOwnProperty("sdpMid")&&t.uint32(18).string(e.sdpMid),null!=e.sdpMLineIndex&&e.hasOwnProperty("sdpMLineIndex")&&t.uint32(24).uint32(e.sdpMLineIndex),t},e.decode=function(e,t){e instanceof tt||(e=tt.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new it.dataChannelBuilder.IceCandidate;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.candidate=e.string();break;case 2:r.sdpMid=e.string();break;case 3:r.sdpMLineIndex=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),e}(),lt=it.channel=function(){var e={};return e.Message=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t;return e.prototype.initPing=null,e.prototype.initPong=0,Object.defineProperty(e.prototype,"type",{get:rt.oneOfGetter(t=["initPing","initPong"]),set:rt.oneOfSetter(t)}),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=nt.create()),null!=e.initPing&&e.hasOwnProperty("initPing")&&it.channel.Data.encode(e.initPing,t.uint32(10).fork()).ldelim(),null!=e.initPong&&e.hasOwnProperty("initPong")&&t.uint32(16).uint32(e.initPong),t},e.decode=function(e,t){e instanceof tt||(e=tt.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new it.channel.Message;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.initPing=it.channel.Data.decode(e,e.uint32());break;case 2:r.initPong=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),e.Data=function(){function e(e){if(this.members=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.topology=0,e.prototype.wcId=0,e.prototype.senderId=0,e.prototype.members=rt.emptyArray,e.prototype.key="",e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=nt.create()),null!=e.topology&&e.hasOwnProperty("topology")&&t.uint32(8).uint32(e.topology),null!=e.wcId&&e.hasOwnProperty("wcId")&&t.uint32(16).uint32(e.wcId),null!=e.senderId&&e.hasOwnProperty("senderId")&&t.uint32(24).uint32(e.senderId),null!=e.members&&e.members.length){t.uint32(34).fork();for(var n=0;n<e.members.length;++n)t.uint32(e.members[n]);t.ldelim()}return null!=e.key&&e.hasOwnProperty("key")&&t.uint32(42).string(e.key),t},e.decode=function(e,t){e instanceof tt||(e=tt.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new it.channel.Data;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.topology=e.uint32();break;case 2:r.wcId=e.uint32();break;case 3:r.senderId=e.uint32();break;case 4:if(r.members&&r.members.length||(r.members=[]),2==(7&i))for(var o=e.uint32()+e.pos;e.pos<o;)r.members.push(e.uint32());else r.members.push(e.uint32());break;case 5:r.key=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),ht=it.signaling=function(){var e={};return e.Message=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t;return e.prototype.heartbeat=!1,e.prototype.content=null,e.prototype.connect=null,e.prototype.connected=!1,Object.defineProperty(e.prototype,"type",{get:rt.oneOfGetter(t=["heartbeat","content","connect","connected"]),set:rt.oneOfSetter(t)}),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=nt.create()),null!=e.heartbeat&&e.hasOwnProperty("heartbeat")&&t.uint32(8).bool(e.heartbeat),null!=e.content&&e.hasOwnProperty("content")&&it.signaling.Content.encode(e.content,t.uint32(18).fork()).ldelim(),null!=e.connect&&e.hasOwnProperty("connect")&&it.signaling.GroupData.encode(e.connect,t.uint32(26).fork()).ldelim(),null!=e.connected&&e.hasOwnProperty("connected")&&t.uint32(32).bool(e.connected),t},e.decode=function(e,t){e instanceof tt||(e=tt.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new it.signaling.Message;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.heartbeat=e.bool();break;case 2:r.content=it.signaling.Content.decode(e,e.uint32());break;case 3:r.connect=it.signaling.GroupData.decode(e,e.uint32());break;case 4:r.connected=e.bool();break;default:e.skipType(7&i)}}return r},e}(),e.Content=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.senderId=0,e.prototype.recipientId=0,e.prototype.lastData=!1,e.prototype.data=rt.newBuffer([]),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=nt.create()),null!=e.senderId&&e.hasOwnProperty("senderId")&&t.uint32(8).uint32(e.senderId),null!=e.recipientId&&e.hasOwnProperty("recipientId")&&t.uint32(16).uint32(e.recipientId),null!=e.lastData&&e.hasOwnProperty("lastData")&&t.uint32(24).bool(e.lastData),null!=e.data&&e.hasOwnProperty("data")&&t.uint32(34).bytes(e.data),t},e.decode=function(e,t){e instanceof tt||(e=tt.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new it.signaling.Content;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.senderId=e.uint32();break;case 2:r.recipientId=e.uint32();break;case 3:r.lastData=e.bool();break;case 4:r.data=e.bytes();break;default:e.skipType(7&i)}}return r},e}(),e.GroupData=function(){function e(e){if(this.members=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.id=0,e.prototype.members=rt.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=nt.create()),null!=e.id&&e.hasOwnProperty("id")&&t.uint32(8).uint32(e.id),null!=e.members&&e.members.length){t.uint32(18).fork();for(var n=0;n<e.members.length;++n)t.uint32(e.members[n]);t.ldelim()}return t},e.decode=function(e,t){e instanceof tt||(e=tt.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new it.signaling.GroupData;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.id=e.uint32();break;case 2:if(r.members&&r.members.length||(r.members=[]),2==(7&i))for(var o=e.uint32()+e.pos;e.pos<o;)r.members.push(e.uint32());else r.members.push(e.uint32());break;default:e.skipType(7&i)}}return r},e}(),e}(),pt=ht.Message.encode(ht.Message.create({heartbeat:!0})).finish();!function(e){e[e.CONNECTING=0]="CONNECTING",e[e.OPEN=1]="OPEN",e[e.CHECKING=2]="CHECKING",e[e.CHECKED=4]="CHECKED",e[e.CLOSED=3]="CLOSED"}(He||(He={}));var ft,dt=function(){function e(e,t){this.STREAM_ID=1,this.wc=e,this.url=t,this.state=He.CLOSED,this.connected=!1,this.missedHeartbeat=0,this.streamSubject=new s.Subject,this.stateSubject=new s.Subject}return Object.defineProperty(e.prototype,"messageFromStream",{get:function(){return this.streamSubject.asObservable()},enumerable:!0,configurable:!0}),e.prototype.sendOverStream=function(e){C.signaling(this.wc.myId+" Forward message",e),this.send({content:{recipientId:e.recipientId,senderId:e.senderId,lastData:void 0===e.content,data:ot.encode(ot.create(e)).finish()}})},Object.defineProperty(e.prototype,"onState",{get:function(){return this.stateSubject.asObservable()},enumerable:!0,configurable:!0}),e.prototype.check=function(){var e=this;this.state!==He.CHECKED&&this.state!==He.OPEN||(this.setState(He.CHECKING),this.send({connect:{id:this.wc.myId,members:this.wc.members.filter(function(t){return t!==e.wc.myId})}}))},e.prototype.connect=function(e){var t=this;if(!z())throw new Error("Failed to join over Signaling: WebSocket is not supported by your environment");this.setState(He.CONNECTING),this.ws=new u.WebSocket(this.fullUrl(e)),this.ws.binaryType="arraybuffer",this.connectionTimeout=setTimeout(function(){t.ws&&t.ws.readyState!==t.ws.OPEN&&(C.signaling("Failed to connect to Signaling server "+t.url+": connection timeout"),t.close())},1e4),this.ws.onopen=function(){t.setState(He.OPEN),t.connectionTimeout&&clearTimeout(t.connectionTimeout),t.startHeartbeat()},this.ws.onerror=function(e){return C.signaling("WebSocket ERROR",e)},this.ws.onclose=function(e){t.clean(),t.setState(He.CLOSED)},this.ws.onmessage=function(e){var n=e.data;return t.handleMessage(n)}},e.prototype.close=function(){this.state!==He.CLOSED&&(this.ws&&(this.ws.onmessage=function(){},this.ws.onclose=function(){},this.ws.onerror=function(){},this.ws.close(1e3)),this.clean(),this.setState(He.CLOSED))},e.prototype.clean=function(){this.connectionTimeout&&clearTimeout(this.connectionTimeout),this.heartbeatInterval&&clearInterval(this.heartbeatInterval),this.ws=void 0},e.prototype.handleMessage=function(e){var t=this;try{var n=ht.Message.decode(new Uint8Array(e));switch(n.type){case"heartbeat":this.missedHeartbeat=0;break;case"connected":this.connected=n.connected,this.setState(He.CHECKED),n.connected||this.wc.channelBuilder.connectOverSignaling().catch(function(){return t.check()});break;case"content":var r=n.content,i=r.data,o=r.senderId,s=r.recipientId,a=ot.decode(i);a.senderId=o,a.recipientId=s,C.signaling("StreamMessage RECEIVED: ",a),this.streamSubject.next(a)}}catch(e){C.warn("Decode Signaling message error: ",e)}},e.prototype.setState=function(e){this.state!==e&&(this.state=e,this.stateSubject.next(e))},e.prototype.startHeartbeat=function(){var e=this;this.missedHeartbeat=0,this.heartbeatInterval=setInterval(function(){try{if(e.missedHeartbeat++,e.missedHeartbeat>=3)throw new Error("Too many missed heartbeats");e.heartbeat()}catch(t){e.close()}},5e3)},e.prototype.send=function(e){if(this.ws&&this.ws.readyState===u.WebSocket.OPEN)try{this.ws.send(ht.Message.encode(ht.Message.create(e)).finish())}catch(e){C.signaling("Failed send to Signaling",e)}},e.prototype.heartbeat=function(){if(this.ws&&this.ws.readyState===u.WebSocket.OPEN)try{this.ws.send(pt)}catch(e){C.signaling("Failed send to Signaling: "+e.message)}},e.prototype.fullUrl=function(e){var t=this.url.endsWith("/")?this.url+e:this.url+"/"+e;return P?t:t+"?favored"},e}();!function(e){e[e.JOINING=0]="JOINING",e[e.JOINED=1]="JOINED",e[e.LEFT=2]="LEFT"}(ft||(ft={}));var yt,bt=new u.TextEncoder,gt=new u.TextDecoder,mt=function(e){function t(){var n=e.call(this,t.SERVICE_ID,st.Message)||this;return n.buffers=new Map,n}return h(t,e),t.prototype.clean=function(){this.buffers.clear()},t.prototype.encodeUserMessage=function(t){var n=this.userDataToType(t),r=n.type,i=n.bytes,o={length:i.length,type:r};if(i.length<=15e3)return o.full=i,[e.prototype.encode.call(this,o)];o.chunk={id:Math.ceil(65535*Math.random())};for(var s=Math.ceil(i.length/15e3),a=new Array(s),c=0;c<s;c++){var u=15e3*c,l=u+Math.min(15e3,i.length-15e3*c);o.chunk.nb=c,o.chunk.content=new Uint8Array(i.slice(u,l)),a[c]=e.prototype.encode.call(this,o)}return a},t.prototype.decodeUserMessage=function(t,n){try{var r=e.prototype.decode.call(this,t),i=r.length,o=r.type,s=r.contentType,a=r.full,c=r.chunk,u=void 0;switch(s){case"full":u=a;break;case"chunk":var l=this.getBuffer(n,c.id);void 0===l?(l=new vt(i,c.content,c.nb),this.setBuffer(n,c.id,l),u=void 0):u=l.append(c.content,c.nb);break;default:throw new Error("Unknown message integrity")}if(void 0!==u)switch(o){case st.Message.Type.U_INT_8_ARRAY:return u;case st.Message.Type.STRING:return gt.decode(u);default:throw new Error("Unknown message type")}return u}catch(e){return void C.warn("Decode user message error: ",e)}},t.prototype.userDataToType=function(e){if(e instanceof Uint8Array)return{type:st.Message.Type.U_INT_8_ARRAY,bytes:e};if("string"==typeof e)return{type:st.Message.Type.STRING,bytes:bt.encode(e)};if(e instanceof String)return{type:st.Message.Type.STRING,bytes:bt.encode(""+e)};throw new Error("Message neigther a string type or a Uint8Array type")},t.prototype.getBuffer=function(e,t){var n=this.buffers.get(e);if(void 0!==n)return n.get(t)},t.prototype.setBuffer=function(e,t,n){var r=this.buffers.get(e);void 0===r&&(r=new Map),r.set(t,n),this.buffers.set(e,r)},t.SERVICE_ID=743,t}(q),vt=function(){function e(e,t,n){this.fullData=new Uint8Array(e),this.currentLength=0,this.append(t,n)}return e.prototype.append=function(e,t){var n,r,i=15e3*t;this.currentLength+=e.length;try{for(var o=y(e),s=o.next();!s.done;s=o.next()){var a=s.value;this.fullData[i++]=a}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return this.currentLength===this.fullData.length?this.fullData:void 0},e}(),wt=function(){function e(t,n,r,i,o){var s=this;C.channel("New Channel "+r+": Me: "+t.myId+" with "+i),this.wc=t,this.wsOrDc=n,this.type=r,this.pc=o,this.missedHeartbeat=0,this.heartbeatMsg=new Uint8Array(0),this.resolveInit=function(){},P?(n.binaryType="arraybuffer",this.send=this.sendInBrowser):this.pc?(n.binaryType="arraybuffer",this.send=this.sendInNodeOverDataChannel):this.send=this.sendInNodeOverWebSocket,r===e.WITH_INTERNAL?(this.id=i,this.heartbeatMsg=this.createHeartbeatMsg(),this.init=Promise.resolve(),this.initHandlers()):(this.id=N,r===e.WITH_JOINING&&this.sendInitPing(),this.init=new Promise(function(e,t){return s.resolveInit=function(){s.heartbeatMsg=s.createHeartbeatMsg(),e()}}),this.wsOrDc.onmessage=function(e){var t=e.data;try{var n=lt.Message.decode(new Uint8Array(t));s.handleInitMessage(n)}catch(e){C.warn("Decode inner Channel message error: ",e)}})}return e.remoteType=function(t){return t===e.WITH_INTERNAL?e.WITH_INTERNAL:t===e.WITH_JOINING?e.WITH_MEMBER:e.WITH_JOINING},Object.defineProperty(e.prototype,"url",{get:function(){return this.pc?"":this.wsOrDc.url},enumerable:!0,configurable:!0}),e.prototype.encodeAndSend=function(e){var t=void 0===e?{}:e,n=t.senderId,r=void 0===n?this.wc.myId:n,i=t.recipientId,o=void 0===i?0:i,s=t.serviceId,a=t.content;this.send(ot.encode(ot.create({senderId:r,recipientId:o,serviceId:s,content:a})).finish())},e.prototype.close=function(){this.wsOrDc.onmessage=void 0,this.wsOrDc.onclose=void 0,this.wsOrDc.onerror=void 0,this.pc?(this.pc.oniceconnectionstatechange=function(){},this.pc.close()):this.wsOrDc.close(1e3)},e.prototype.sendHeartbeat=function(){this.missedHeartbeat++,this.missedHeartbeat>=3?(C.channel(this.id+" channel closed: too many missed heartbeats"),this.wc.topology.onChannelClose(this),this.close()):this.send(this.heartbeatMsg)},e.prototype.sendInBrowser=function(e){try{this.wsOrDc.send(e)}catch(e){C.channel("Channel sendInBrowser ERROR",e)}},e.prototype.sendInNodeOverWebSocket=function(e){try{this.wsOrDc.send(e,{binary:!0})}catch(e){C.channel("Channel sendInNodeOverWebSocket ERROR",e)}},e.prototype.sendInNodeOverDataChannel=function(e){this.sendInBrowser(e.slice(0))},e.prototype.handleInitMessage=function(e){switch(e.type){case"initPing":C.channel(this.wc.myId+" received InitPing");var t=e.initPing,n=t.topology,r=t.wcId,i=t.senderId,o=t.members,s=t.key;this.wc.topologyEnum!==n?C.channel("Different topology. This message should never be shown: something is wrong"):o.includes(this.id)&&this.wc.id,this.wc.id=r,this.wc.key=s,this.id=i,C.channel(this.wc.myId+" send InitPong"),this.send(lt.Message.encode(lt.Message.create({initPong:this.wc.myId})).finish()),this.initData={members:o},this.initHandlers(),this.resolveInit();break;case"initPong":C.channel(this.wc.myId+" received InitPong"),this.id=e.initPong,this.initHandlers(),this.resolveInit();break;default:C.channel('Unknown message type: "'+e.type+'". This message should never be shown: something went wrong')}},e.prototype.initHandlers=function(){var e=this;this.wsOrDc.onmessage=function(t){var n=t.data;try{var r=ot.decode(new Uint8Array(n));if(0===r.recipientId||r.recipientId===e.wc.myId)if(r.serviceId===mt.SERVICE_ID){var i=e.wc.userMsg.decodeUserMessage(r.content,r.senderId);i&&e.wc.onMessage(r.senderId,i)}else 0===r.serviceId?e.missedHeartbeat=0:e.wc.streamSubject.next(p({channel:e},r));r.recipientId!==e.wc.myId&&e.wc.topology.forward(r)}catch(e){C.warn("Decode general Channel message error: ",e)}},this.wsOrDc.onclose=function(t){C.channel("Connection with "+e.id+" has closed",t),e.pc&&(e.pc.oniceconnectionstatechange=function(){}),e.wc.topology.onChannelClose(e)},this.pc&&(this.pc.oniceconnectionstatechange=function(){e.pc&&"failed"===e.pc.iceConnectionState&&(e.close(),e.wc.topology.onChannelClose(e))}),this.wsOrDc.onerror=function(e){return C.channel("Channel error: ",e)}},e.prototype.createHeartbeatMsg=function(){return ot.encode(ot.create({serviceId:0,senderId:this.wc.myId,recipientId:this.id})).finish()},e.prototype.sendInitPing=function(){C.channel("initialize..."),this.send(lt.Message.encode(lt.Message.create({initPing:{topology:this.wc.topologyEnum,wcId:this.wc.id,senderId:this.wc.myId,members:this.wc.members,key:this.wc.key}})).finish())},e.WITH_INTERNAL=0,e.WITH_JOINING=1,e.WITH_MEMBER=2,e}(),St=function(){function e(e){this.wc=e,this.channelsSubject=new s.Subject}return Object.defineProperty(e.prototype,"channels",{get:function(){return this.channelsSubject.asObservable()},enumerable:!0,configurable:!0}),e.prototype.newWebSocket=function(e,t,n){this.channelsSubject.next({id:t,channel:new wt(this.wc,e,n,t)})},e.prototype.connect=function(e,t,n,r,i){return f(this,void 0,void 0,function(){var o,s,a,c=this;return d(this,function(l){switch(l.label){case 0:return L(e),o=this.composeUrl(e,wt.remoteType(t),i,r),s=new u.WebSocket(o),[4,new Promise(function(r,i){var o=setTimeout(function(){s.readyState!==s.OPEN&&(s.close(),i(new Error("WebSocket 4000ms connection timeout with '"+e+"'")))},4e3);s.onopen=function(){clearTimeout(o),r(new wt(c.wc,s,t,n))},s.onerror=function(e){return i(e)},s.onclose=function(t){i(new Error("WebSocket with '"+e+"' closed "+t.code+": "+t.reason))}})];case 1:return a=l.sent(),this.channelsSubject.next({id:n,channel:a}),[2]}})})},e.prototype.composeUrl=function(e,t,n,r){var i=e+"/?type="+t+"&wcId="+n+"&senderId="+r;return t!==wt.WITH_INTERNAL&&(i+="&key="+this.wc.key),i},e.listenUrl=new s.BehaviorSubject(""),e}(),Ot=function(){function e(e,t,n,r,i){var o=this;this.finalMessageReceived=!1,this.finalMessageSent=!1,this.id=e,this.pc=t,this.send=n,this._onError=function(){},this.candidates=new s.ReplaySubject,this.remotes=r,this.isSDPSent=!1,this.remotes.set(e,this),this.timer=setTimeout(function(){"connected"!==o.pc.iceConnectionState&&"completed"!==o.pc.iceConnectionState&&o._onError(new Error(i+"ms connection timeout"))},i),t.oniceconnectionstatechange=function(){C.webrtc("LOCAL ICE CONNECTION STATE",t.iceConnectionState),"failed"===t.iceConnectionState&&o._onError(new Error("Ice Connection State is FAILED"))},t.onicecandidate=function(e){null!==e.candidate?(C.webrtc("LOCAL ICE CANDIDATE",e.candidate.candidate),o.send({candidate:{candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex}})):(o.pc.onicecandidate=function(){},o.isSDPSent&&o.sendFinalMessage())}}return Object.defineProperty(e.prototype,"onError",{get:function(){return this._onError},set:function(e){var t=this;this._onError=function(n){C.webrtc("ERROR: ",n.message),t.clean("clean"!==n.message),e(n)}},enumerable:!0,configurable:!0}),e.prototype.sdpIsSent=function(){this.isSDPSent=!0,"complete"===this.pc.iceGatheringState&&this.sendFinalMessage()},e.prototype.clean=function(e){void 0===e&&(e=!0),C.webrtc("CLEAN REMOTE"),this.pc.oniceconnectionstatechange=function(){},this.pc.onicecandidate=function(){},this.pc.ondatachannel=function(){},this._onError=function(){},this.candidates.complete(),this.remotes.delete(this.id),clearTimeout(this.timer),this.pc.close(),e&&this.sendFinalMessage()},e.prototype.dataChannelOpen=function(e){C.webrtc("DATA CHANNEL with "+this.id+" OPEN"),this.finalMessageReceived&&this.finalMessageSent&&this.remotes.delete(this.id),this.pc.oniceconnectionstatechange=function(){},e.onopen=function(){},this.pc.ondatachannel=function(){},this._onError=function(){}},e.prototype.handleMessage=function(e){var t=this;if(e.type)switch(e.type){case"offer":C.webrtc("REMOTE OFFER",{offer:e.offer}),this.pc.setRemoteDescription({type:"offer",sdp:e.offer}).then(function(){return t.candidates.subscribe(function(e){return t.pc.addIceCandidate(e).catch(function(e){return C.webrtc("Failed to addIceCandidate",e)})})}).then(function(){return t.pc.createAnswer()}).then(function(e){return t.pc.setLocalDescription(e)}).then(function(){var e=t.pc.localDescription.sdp;C.webrtc("Send LOCAL ANSWER",{answer:e}),t.send({answer:e}),t.sdpIsSent()}).catch(function(e){return t._onError(e)});break;case"answer":C.webrtc("REMOTE ANSWER is received",{answer:e.answer}),this.pc.setRemoteDescription({type:"answer",sdp:e.answer}).then(function(){t.candidates.subscribe(function(e){return t.pc.addIceCandidate(e).catch(function(e){return C.webrtc(t.id+": Failed to add REMOTE Ice Candidate",e)})})}).catch(function(e){return t._onError(e)});break;case"candidate":C.webrtc("REMOTE ICE CANDIDATE is received",e.candidate),this.candidates.next(new u.RTCIceCandidate(e.candidate));break;default:this._onError(new Error("Buffer Protocol unknown message from the remote peer"))}else C.webrtc("REMOTE FINAL MESSAGE received"),this.finalMessageReceived=!0,this.candidates.complete(),this.finalMessageSent&&this.remotes.delete(this.id)},e.prototype.sendFinalMessage=function(){this.finalMessageSent||(this.finalMessageSent=!0,this.send({}),this.finalMessageReceived&&this.remotes.delete(this.id))},e}(),It=function(e){function t(n,r){var i=e.call(this,t.SERVICE_ID,ut.Message)||this;return i.wc=n,i.allStreams=e.prototype.useAllStreams.call(i,n,n.signaling),i.rtcConfiguration=r,i.channelsSubject=new s.Subject,i.remotes=new Map,i.allStreams.message.subscribe(function(e){var t=e.streamId,n=e.senderId,r=e.recipientId,o=e.msg,s=i.remotes.get(n);if(s&&s.finalMessageReceived&&(s.clean(!1),s=void 0),!s){if(!o.type||"offer"!==o.type&&"candidate"!==o.type)return;try{s=i.createRemote(t,n,r,!0)}catch(e){return}}s.handleMessage(o)}),i}return h(t,e),Object.defineProperty(t.prototype,"channels",{get:function(){return this.channelsSubject.asObservable()},enumerable:!0,configurable:!0}),t.prototype.connect=function(e,t,n){return f(this,void 0,void 0,function(){var r,i,o,s,a,c,u,l=this;return d(this,function(h){switch(h.label){case 0:return C.webrtc("connectWith call",{targetId:e,myId:t,type:n}),r=n===wt.WITH_INTERNAL?this.wc.STREAM_ID:this.wc.signaling.STREAM_ID,(i=this.remotes.get(e))?i.clean():i=this.createRemote(r,e,t),o=wt.remoteType(n),s=i.pc.createDataChannel('{"id":'+this.wc.myId+',"type":'+o+"}"),[4,i.pc.createOffer()];case 1:return a=h.sent(),[4,i.pc.setLocalDescription(a)];case 2:return h.sent(),c=i.pc.localDescription.sdp,this.allStreams.sendOver(r,{offer:c},e,t),i.sdpIsSent(),[4,new Promise(function(t,r){i.onError=function(e){return r(e)},s.onopen=function(){i.dataChannelOpen(s),t(new wt(l.wc,s,n,e,i.pc))}})];case 3:return u=h.sent(),this.channelsSubject.next({id:e,channel:u}),[2]}})})},t.prototype.clean=function(e){if(e){var t=this.remotes.get(e);t&&t.clean(!1)}else this.remotes.forEach(function(e){return e.onError(new Error("clean"))})},t.prototype.createRemote=function(e,t,n,r){var i=this;void 0===r&&(r=!1);var o=new Ot(t,new u.RTCPeerConnection(this.rtcConfiguration),function(r){return i.allStreams.sendOver(e,r,t,n)},this.remotes,9e3);r?(C.webrtc("create a new remote object with "+t+" - PASSIVE"),o.pc.ondatachannel=function(e){var n=e.channel,r=JSON.parse(n.label),s=r.id,a=r.type;n.onopen=function(){o.dataChannelOpen(n);var e=new wt(i.wc,n,a,s,o.pc);i.channelsSubject.next({id:t,channel:e})}}):C.webrtc("create a new remote object with "+t+" - INITIATOR");return o},t.SERVICE_ID=7431,t}(q);!function(e){e.RESPONSE_TIMEOUT="Response timeout: remote peer is not responding",e.CONNECTION_TIMEOUT="Connection timeout: unable to establish a channel within a specified time",e.DENIED="Connection denied: remote peer refused the connection request",e.CLEAN="Clean: all connections in progress must be stopped",e.IN_PROGRESS="Connection setup is already in progress",e.NEGOTIATION_ERROR="All connection possibilities have been tried and none of them worked"}(yt||(yt={}));var _t,xt=function(){function e(){this.connections=new Map}return e.prototype.create=function(e,t,n,r){var i=this,o={};return o.promise=new Promise(function(s,a){var c=setTimeout(function(){return o.reject(new Error(yt.RESPONSE_TIMEOUT))},n);o.resolve=function(){clearTimeout(c),s(),o.promise=new Promise(function(n,s){var a=setTimeout(function(){C.channelBuilder("on Connection timeout callback"),r(),o.reject(new Error(yt.CONNECTION_TIMEOUT))},t);o.resolve=function(){clearTimeout(a),i.connections.delete(e),n()},o.reject=function(t){o.promise.catch(function(){}),clearTimeout(a),i.connections.delete(e),s(t)}})},o.reject=function(t){o.promise.catch(function(){}),clearTimeout(c),i.connections.delete(e),a(t)},i.connections.set(e,o)}),o},e.prototype.get=function(e){return this.connections.get(e)},e.prototype.has=function(e,t){return this.connections.has(t)},e.prototype.clean=function(){this.connections.forEach(function(e){return e.reject(new Error(yt.CLEAN))}),this.connections.clear()},e}(),Et=Math.max(9e3,4e3)+5e3,kt=function(e){function t(n){var r=e.call(this,t.SERVICE_ID,at.Message)||this;return r.wc=n,r.allStreams=e.prototype.useAllStreams.call(r,n,n.signaling),r.connectsInProgress=new xt,r.channelsSubject=new s.Subject,r.onConnectionRequest=function(){return!0},r.dataChannelBuilder=new It(r.wc,r.wc.rtcConfiguration),r.myInfo={wsTried:!1,wsSupported:z(),dcTried:!1,dcSupported:!!u.RTCPeerConnection&&"createDataChannel"in u.RTCPeerConnection.prototype},r.negotiationEncoded=e.prototype.encode.call(r,{negotiation:{initiator:r.myInfo}}),t.connectResTrueEncoded||t.connectResFalseEncoded||(t.connectResTrueEncoded=e.prototype.encode.call(r,{connectionResponse:!0}),t.connectResFalseEncoded=e.prototype.encode.call(r,{connectionResponse:!1})),r.allStreams.message.subscribe(function(e){var t=e.streamId,n=e.senderId,i=e.recipientId,o=e.msg;r.handleMessage(t,n,i,o)}),r.subscribeToChannels(),r.subscribeToURLandIDChange(),r}return h(t,e),t.prototype.clean=function(){C.channelBuilder("CLEAN call"),this.dataChannelBuilder.clean(),this.connectsInProgress.clean()},Object.defineProperty(t.prototype,"onChannel",{get:function(){return this.channelsSubject.asObservable()},enumerable:!0,configurable:!0}),t.prototype.connectOverWebChannel=function(e,t,n){return void 0===t&&(t=function(){}),void 0===n&&(n=new Uint8Array),f(this,void 0,void 0,function(){return d(this,function(r){return[2,this.connectOver(this.wc.STREAM_ID,e,t,n)]})})},t.prototype.connectOverSignaling=function(e,t){return void 0===e&&(e=function(){}),void 0===t&&(t=new Uint8Array),f(this,void 0,void 0,function(){return d(this,function(n){return[2,this.connectOver(this.wc.signaling.STREAM_ID,0,e,t)]})})},t.prototype.connectOver=function(e,t,n,r){return f(this,void 0,void 0,function(){var i,o=this;return d(this,function(s){switch(s.label){case 0:return(i=this.connectsInProgress.get(t))?[3,2]:(this.allStreams.sendOver(e,{connectionRequest:r},t,this.wc.myId),[4,(i=this.connectsInProgress.create(t,Et,2e3,function(){return o.dataChannelBuilder.clean(t)})).promise]);case 1:return s.sent(),n(),[2,i.promise];case 2:throw new Error(yt.IN_PROGRESS)}})})},t.prototype.handleMessage=function(e,n,r,i){var o=this;switch(i.type){case"connectionRequest":if(C.channelBuilder("connection Request from ",n),s=this.connectsInProgress.get(n)){if(!(n<this.wc.myId))return;s.reject(new Error(yt.IN_PROGRESS))}this.onConnectionRequest(e,i.connectionRequest)?((s=this.connectsInProgress.create(n,Et,2e3,function(){return o.dataChannelBuilder.clean(n)})).resolve(),C.channelBuilder("connection Response POSITIVE to ",n),this.allStreams.sendOver(e,t.connectResTrueEncoded,n,r)):(C.channelBuilder("connection Response NEGATIVE to ",n),this.allStreams.sendOver(e,t.connectResFalseEncoded,n,r));break;case"connectionResponse":var s;C.channelBuilder("connection Response from ",n),(s=this.connectsInProgress.get(n))&&(i.connectionResponse?(s.resolve(),C.channelBuilder("Send first negotiation message to ",n),this.allStreams.sendOver(e,this.negotiationEncoded,n,r)):s.reject(new Error(yt.DENIED)));break;case"negotiation":if(this.connectsInProgress.has(e,n)){var a=i.negotiation,c=a.initiator,u=a.passive;u||(c.id=n,(u=p({},this.myInfo)).id=r),C.channelBuilder("NEGOTIATION message to proceed from "+n+": ",JSON.stringify({isIamInitiatore:u.id===n,passive:u,initiator:c,senderId:n,recipientId:r})),this.isNagotiable(c,u)?this.proceedNegotiation(e,c,u,u.id===n).catch(function(t){o.rejectConnection(e,n,t),C.channelBuilder("NEGOTIATION with "+n+" FIALED: ",{passive:u,initiator:c}),o.allStreams.sendOver(e,{negotiation:{initiator:c,passive:u}},n,r)}):this.rejectConnection(e,n,new Error(yt.NEGOTIATION_ERROR))}}},t.prototype.proceedNegotiation=function(e,t,n,r){return f(this,void 0,void 0,function(){var i,o,s,a,c;return d(this,function(u){switch(u.label){case 0:return i=b(r?[t,n]:[n,t],2),o=i[0],s=i[1],(a=s.wss&&!o.wsTried)?[4,this.tryWs(e,o,s,r)]:[3,2];case 1:a=u.sent(),u.label=2;case 2:return a?[2]:o.wss&&!s.wsTried?(C.channelBuilder("Prompt the other to connect over WebSocket"),this.allStreams.sendOver(e,{negotiation:{initiator:t,passive:n}},s.id,o.id),[2]):o.dcSupported&&s.dcSupported?(c=!o.dcTried)?[4,this.tryDc(e,o,s,r)]:[3,4]:[3,5];case 3:c=u.sent(),u.label=4;case 4:if(c)return[2];if(!s.dcTried)return C.channelBuilder("Prompt the other to connect over RTCDataChannel"),this.allStreams.sendOver(e,{negotiation:{initiator:t,passive:n}},s.id,o.id),[2];u.label=5;case 5:throw new Error(yt.NEGOTIATION_ERROR)}})})},t.prototype.tryWs=function(e,t,n,r){return f(this,void 0,void 0,function(){var i,o,s;return d(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),i=this.getType(e,r),o=i===wt.WITH_MEMBER?n.wcId:this.wc.myId,[4,this.wc.webSocketBuilder.connect(n.wss,i,n.id,t.id,o)];case 1:return a.sent(),C.channelBuilder("New WebSocket connection with "+n.id),[2,!0];case 2:return"clean"!==(s=a.sent()).message?(C.channelBuilder("WebSocket failed with "+n.id,s),t.wsTried=!0,[2,!1]):[2,!0];case 3:return[2]}})})},t.prototype.tryDc=function(e,t,n,r){return f(this,void 0,void 0,function(){var i,o;return d(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),i=this.getType(e,r),[4,this.dataChannelBuilder.connect(n.id,t.id,i)];case 1:return s.sent(),C.channelBuilder("New RTCDataChannel with "+n.id),[2,!0];case 2:return"clean"!==(o=s.sent()).message?(C.channelBuilder("RTCDataChannel failed with "+n.id,o),t.dcTried=!0,[2,!1]):[2,!0];case 3:return[2]}})})},t.prototype.getType=function(e,t){return e===this.wc.STREAM_ID?wt.WITH_INTERNAL:t?wt.WITH_MEMBER:wt.WITH_JOINING},t.prototype.isNagotiable=function(e,t){return e.wss&&!t.wsTried||t.wss&&!e.wsTried||e.dcSupported&&t.dcSupported&&(!e.dcTried||!t.dcTried)},t.prototype.subscribeToChannels=function(){var e=this;Object(s.merge)(this.dataChannelBuilder.channels,this.wc.webSocketBuilder.channels).subscribe(function(t){var n=t.id,r=t.channel;r.init.then(function(){C.channelBuilder("NEW Channel from ",JSON.stringify({type:r.type,id:n}));var t=e.connectsInProgress.get(n);t?(C.channelBuilder("RESOLVE this NEW Channel"),t.resolve()):C.channelBuilder("this NEW Channel NOT FOUND"),e.channelsSubject.next(r)})})},t.prototype.subscribeToURLandIDChange=function(){var t=this;St.listenUrl.subscribe(function(n){n&&(t.myInfo.wss=n,t.negotiationEncoded=e.prototype.encode.call(t,{negotiation:{initiator:t.myInfo}}))}),this.wc.onIdChange.subscribe(function(n){t.myInfo.wcId=t.wc.id,t.negotiationEncoded=e.prototype.encode.call(t,{negotiation:{initiator:t.myInfo}})})},t.prototype.rejectConnection=function(e,t,n){var r=this.connectsInProgress.get(t);r&&r.reject(n)},t.SERVICE_ID=74,t}(q),Tt=function(e){function t(n){var r=e.call(this,n,t.SERVICE_ID,ct.Message)||this;return r.adjacentMembers=new Map,r.distantMembers=new Map,r.antecedentId=0,r.delayedMembers=new Set,r.delayedMembersTimers=new Set,r.adjacentBots=new Set,r.heartbeatMsg=e.prototype.encode.call(r,{heartbeat:!0}),r.wcStream.message.subscribe(function(e){var t=e.channel,n=e.senderId,i=e.msg;return r.handleServiceMessage(t,n,i)}),r.wc.channelBuilder.onConnectionRequest=function(e,t){try{var n=ct.ConnectionRequest.decode(t),i=n.id,o=n.adjacentIds;return e!==r.wc.STREAM_ID||(C.topology("CONNECTION REQUEST from "+i+", where adjacent members are: ",o),r.createOrUpdateDistantMember(i,o))}catch(e){return C.warn("Decode Fullmesh onConnectionRequest message error: ",e),!1}},r.wc.channelBuilder.onChannel.subscribe(function(t){C.topology("New adjacent member: "+t.id),r.distantMembers.delete(t.id),r.delayedMembers.delete(t.id);var n=r.adjacentMembers.get(t.id);if(n&&(C.topology("Replacing the same channel"),n.close()),r.adjacentMembers.set(t.id,t),t.url&&r.adjacentBots.add(t),r.notifyDistantMembers(),r.heartbeatInterval||r.startHeartbeatInterval(),t.type===wt.WITH_MEMBER){e.prototype.setState.call(r,$.CONSTRUCTING);var i=t.initData.members;r.connectToMembers(i,t.id).then(function(){e.prototype.setState.call(r,$.CONSTRUCTED),r.startMembersCheckIntervals()})}else r.startMembersCheckIntervals();r.wc.onMemberJoinProxy(t.id),r.updateAntecedentId()}),P&&(window.fullmesh=function(){C.topology("Fullmesh info:",{myId:r.wc.myId,antecedentId:r.antecedentId,signalingState:r.wc.signaling.state,webGroupState:r.wc.state,topologyState:$[r.state],adjacentBots:Array.from(r.adjacentBots).map(function(e){return e.id}),adjacentMembers:Array.from(r.adjacentMembers.keys()).toString(),distantMembers:Array.from(r.distantMembers.keys()).toString(),distantMembersDETAILS:Array.from(r.distantMembers.keys()).map(function(e){var t=r.distantMembers.get(e);return{id:e,adjacentMembers:t?t.adjacentIds:[]}})})}),r}return h(t,e),t.prototype.send=function(e){var t=this;this.adjacentMembers.forEach(function(t){return t.encodeAndSend(e)}),this.distantMembers.forEach(function(n,r){t.sendToDistantPeer(n,p({},e,{recipientId:r}))})},t.prototype.sendTo=function(e){var t=this.adjacentMembers.get(e.recipientId);t?t.encodeAndSend(e):this.sendToDistantPeer(this.distantMembers.get(e.recipientId),e)},t.prototype.forward=function(e){this.sendTo(e)},t.prototype.leave=function(){this.state!==$.IDLE&&(C.topology("LEAVE"),this.clean(),this.adjacentMembers.forEach(function(e){return e.close()}),this.wc.onAdjacentMembersLeaveProxy(Array.from(this.adjacentMembers.keys())),this.adjacentMembers.clear(),e.prototype.setState.call(this,$.IDLE))},t.prototype.onChannelClose=function(e){this.adjacentMembers.delete(e.id)&&(this.adjacentBots.delete(e),this.delayedMembers.delete(e.id),this.wc.onAdjacentMembersLeaveProxy([e.id]),0===this.adjacentMembers.size?this.clean():(this.notifyDistantMembers(),this.updateAntecedentId()),C.topology("Channel closed with "+e.id))},Object.defineProperty(t.prototype,"neighbors",{get:function(){return Array.from(this.adjacentMembers.values())},enumerable:!0,configurable:!0}),t.prototype.clean=function(){C.topology("CLEAN"),this.wc.onDistantMembersLeaveProxy(Array.from(this.distantMembers.keys())),this.distantMembers.clear(),this.antecedentId=0,clearInterval(this.heartbeatInterval),this.heartbeatInterval=void 0,clearInterval(this.membersCheckInterval),this.membersCheckInterval=void 0,this.delayedMembers.clear(),this.delayedMembersTimers.forEach(function(e){return clearTimeout(e)}),this.delayedMembersTimers.clear(),this.adjacentBots.clear()},t.prototype.handleServiceMessage=function(e,t,n){switch(n.type){case"members":this.connectToMembers(n.members.ids,t);break;case"adjacentMembers":C.topology("adjacent members received from "+t,n.adjacentMembers.ids);var r=n.adjacentMembers.ids;this.createOrUpdateDistantMember(t,r);break;case"heartbeat":var i=this.distantMembers.get(t);i&&(i.missedHeartbeat=0)}},t.prototype.connectToMembers=function(e,t){var n,r,i=this,o=e.filter(function(e){return!i.adjacentMembers.has(e)&&e!==i.wc.myId});if(0!==o.length){C.topology("TRY TO CONNECT to members",o);var s=[],a=ct.ConnectionRequest.encode(ct.ConnectionRequest.create({id:this.wc.myId,adjacentIds:Array.from(this.adjacentMembers.keys())})).finish(),c=function(e){u.distantMembers.has(e)||(u.distantMembers.set(e,{adjacentIds:[t],missedHeartbeat:0}),C.topology("NEW distant member = "+e+"; BIS",t),u.updateAntecedentId()),u.delayedMembers.has(e)||(s[s.length]=u.wc.channelBuilder.connectOverWebChannel(e,function(){i.wc.onMemberJoinProxy(e),i.updateAntecedentId()},a).catch(function(t){if(C.topology("FAILED to connect to "+e+", because: "+t.message),t.message===yt.CONNECTION_TIMEOUT||t.message===yt.NEGOTIATION_ERROR||t.message===yt.IN_PROGRESS){i.delayedMembers.add(e);var n=setTimeout(function(){i.delayedMembers.delete(e),i.delayedMembersTimers.delete(n)},3e5);i.delayedMembersTimers.add(n)}}))},u=this;try{for(var l=y(o),h=l.next();!h.done;h=l.next()){c(h.value)}}catch(e){n={error:e}}finally{try{h&&!h.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}return Promise.all(s)}return Promise.resolve()},t.prototype.notifyDistantMembers=function(){var t=this;if(0!==this.distantMembers.size){var n=e.prototype.encode.call(this,{adjacentMembers:{ids:Array.from(this.adjacentMembers.keys())}});this.distantMembers.forEach(function(e,r){return t.wcStream.send(n,r)})}},t.prototype.startMembersCheckIntervals=function(){var e=this;this.membersCheckInterval||(this.membersCheckInterval=setInterval(function(){e.antecedentId&&e.wcStream.send({members:{ids:e.wc.members}},e.antecedentId)},2e4))},t.prototype.startHeartbeatInterval=function(){var e=this;this.heartbeatInterval=setInterval(function(){e.adjacentMembers.forEach(function(e){return e.sendHeartbeat()}),e.distantMembers.forEach(function(t,n){t.missedHeartbeat++,t.missedHeartbeat>=4&&(C.topology("Distant peer "+n+" stopped to responding: too many missed heartbeats"),e.distantMembers.delete(n)&&(e.delayedMembers.delete(n),e.wc.onDistantMembersLeaveProxy([n]),e.updateAntecedentId())),e.wcStream.send(e.heartbeatMsg,n)})},3e3)},t.prototype.sendToDistantPeer=function(e,t){for(var n=1;n<=3;n++){var r=this.findRoutedChannel(e,n);if(r)return void r.encodeAndSend(t)}},t.prototype.findRoutedChannel=function(e,t){var n,r,i,o,s,a;if(e){try{for(var c=y(this.adjacentBots),u=c.next();!u.done;u=c.next()){var l=u.value;if(e.adjacentIds.includes(l.id))return l}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}try{for(var h=y(this.adjacentMembers),p=h.next();!p.done;p=h.next()){var f=b(p.value,2),d=f[0];l=f[1];if(e.adjacentIds.includes(d))return l}}catch(e){i={error:e}}finally{try{p&&!p.done&&(o=h.return)&&o.call(h)}finally{if(i)throw i.error}}if(0!==t)try{for(var g=y(e.adjacentIds),m=g.next();!m.done;m=g.next()){var v=m.value;if(l=this.findRoutedChannel(this.distantMembers.get(v),t-1))return l}}catch(e){s={error:e}}finally{try{m&&!m.done&&(a=g.return)&&a.call(g)}finally{if(s)throw s.error}}}},t.prototype.createOrUpdateDistantMember=function(e,t){if(!this.adjacentMembers.has(e)){var n=this.distantMembers.get(e);return n?(n.adjacentIds=t,C.topology("UPDATE distant member = "+e,n.adjacentIds)):(this.distantMembers.set(e,{adjacentIds:t,missedHeartbeat:0}),this.wc.onMemberJoinProxy(e),C.topology("NEW distant member = "+e,t),this.updateAntecedentId()),!0}return C.topology("ABNORMAL update or create a distant member "+e+", but he is also an adjacent member"),!1},t.prototype.updateAntecedentId=function(){var e,t;if(this.adjacentMembers.size>0){var n=-1,r=-1;try{for(var i=y(this.wc.members),o=i.next();!o.done;o=i.next()){var s=o.value;s!==this.wc.myId&&(s<this.wc.myId&&s>r&&(r=s),n<s&&(n=s))}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}this.antecedentId=-1!==r?r:n}else this.antecedentId=0;C.topology("UPDATE, antecedentId = "+this.antecedentId+", members = ",JSON.stringify(this.wc.members))},t.SERVICE_ID=74315,t}(W),Ct={topology:G.FULL_MESH,signalingServer:"wss://signaling.netflux.coedit.re",rtcConfiguration:{iceServers:[{urls:"stun:stun3.l.google.com:19302"}]},autoRejoin:!0},Mt=function(){function e(e){this.STREAM_ID=2;var t=p({},Ct,e),n=t.topology,r=t.autoRejoin,i=t.rtcConfiguration,o=t.signalingServer;this.streamSubject=new s.Subject,this.idSubject=new s.Subject,this.topologyEnum=n,this.autoRejoin=r,this.rtcConfiguration=i,this.members=[],this._id=0,this.key="",this.myId=0,this.state=ft.LEFT,this.rejoinEnabled=!1,this.rejoinTimer=void 0,this.topology={},this._onAlone=function(){},this.onMemberJoin=function(){},this.onMemberLeave=function(){},this.onMessage=function(){},this.onMyId=function(){},this.onStateChange=function(){},this.onSignalingStateChange=function(){},this.userMsg=new mt,this.signaling=new dt(this,o),this.subscribeToSignalingState(),this.webSocketBuilder=new St(this),this.channelBuilder=new kt(this),this.setTopology(n),P&&this.subscribeToBrowserEvents()}return Object.defineProperty(e.prototype,"onIdChange",{get:function(){return this.idSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(e){this._id=e,this.idSubject.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"messageFromStream",{get:function(){return this.streamSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onAlone",{set:function(e){this._onAlone=e},enumerable:!0,configurable:!0}),e.prototype.sendOverStream=function(e){this.topology.sendTo(e)},e.prototype.join=function(e){void 0===e&&(e=function(){for(var e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",t=F(42),n="",r=0;r<42;r++)n+=e[t[r]%e.length];return n}()),function(e){if("string"!=typeof e)throw new Error('The key type "'+typeof e+'" is not a "string"');if(""===e)throw new Error("The key is an empty string");if(e.length>D)throw new Error("The key length of "+e.length+" exceeds the maximum of "+D+" characters")}(e),this.state===ft.LEFT&&this.startJoin(e)},e.prototype.invite=function(e){var t,n;L(e);var r=U(e);try{for(var i=y(this.topology.neighbors),o=i.next();!o.done;o=i.next()){if(r===U(o.value.url))return}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}this.webSocketBuilder.connect(e,wt.WITH_JOINING,-1,-1,this.id).catch(function(t){return C.webgroup("Failed to invite the bot "+e+": "+t.message)})},e.prototype.leave=function(){this.state!==ft.LEFT&&(this.key="",this.internalLeave())},e.prototype.send=function(e){var t,n;if(1!==this.members.length)try{for(var r=y(this.userMsg.encodeUserMessage(e)),i=r.next();!i.done;i=r.next()){var o=i.value;this.topology.send({senderId:this.myId,recipientId:0,serviceId:mt.SERVICE_ID,content:o})}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},e.prototype.sendTo=function(e,t){var n,r;if(1!==this.members.length)try{for(var i=y(this.userMsg.encodeUserMessage(t)),o=i.next();!o.done;o=i.next()){var s=o.value;this.topology.sendTo({senderId:this.myId,recipientId:e,serviceId:mt.SERVICE_ID,content:s})}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},e.prototype.onMemberJoinProxy=function(e){this.members.includes(e)||(this.members[this.members.length]=e,this.onMemberJoin(e))},e.prototype.onAdjacentMembersLeaveProxy=function(e){this.onMemberLeaveProxy(e)&&(1===this.members.length?(this._onAlone(),this.topology.leave()):this.signaling.state===He.CHECKED&&this.topology.state===$.CONSTRUCTED&&this.signaling.check())},e.prototype.onDistantMembersLeaveProxy=function(e){this.onMemberLeaveProxy(e)},e.prototype.init=function(e,t){void 0===t&&(t=B()),C.webgroup("INIT"),this.id=t,this.myId=B(),this.members=[this.myId],this.key=e,this.rejoinEnabled=this.autoRejoin,this.onMyId(this.myId),this.rejoinTimer&&(clearTimeout(this.rejoinTimer),this.rejoinTimer=void 0),this.setState(ft.JOINING)},e.prototype.clean=function(){C.webgroup("CLEAN"),this.rejoinTimer&&(clearTimeout(this.rejoinTimer),this.rejoinTimer=void 0),this.members=[],this.id=0,this.myId=0},e.prototype.setState=function(e){this.state!==e&&(C.webGroupState(ft[e],this.myId),this.state=e,this.onStateChange(e))},e.prototype.setTopology=function(e){var t=this;this.topologyEnum=e,this.topology=new Tt(this),this.topology.onState.subscribe(function(e){switch(C.webgroup("Topology state: ",$[e]),e){case $.CONSTRUCTING:t.setState(ft.JOINING);break;case $.CONSTRUCTED:t.signaling.state===He.OPEN?t.signaling.check():t.signaling.state===He.CHECKED?(t.setState(ft.JOINED),t.signaling.check()):t.signaling.state===He.CLOSED&&t.signaling.connect(t.key);break;case $.IDLE:switch(t.channelBuilder.clean(),t.userMsg.clean(),t.signaling.state){case He.CLOSED:t.rejoinEnabled?t.rejoin():t.internalLeave();break;case He.CONNECTING:t.setState(ft.JOINING);break;case He.OPEN:t.setState(ft.JOINING),t.signaling.check();break;case He.CHECKING:t.setState(ft.JOINING);break;case He.CHECKED:t.signaling.check()}}})},e.prototype.subscribeToSignalingState=function(){var e=this;this.signaling.onState.subscribe(function(t){switch(C.signalingState(He[t],e.myId),e.onSignalingStateChange(t),t){case He.CLOSED:e.topology.state===$.IDLE?e.rejoinEnabled?e.rejoin():e.internalLeave():e.topology.state===$.CONSTRUCTED&&(1===e.members.length?e.topology.leave():e.rejoinEnabled&&!e.rejoinTimer&&e.reconnectToSignaling());break;case He.OPEN:e.topology.state!==$.CONSTRUCTING&&e.signaling.check();break;case He.CHECKED:e.topology.state===$.IDLE?e.signaling.connected&&e.topology.setJoinedState():e.topology.state===$.CONSTRUCTED&&e.setState(ft.JOINED)}})},e.prototype.subscribeToBrowserEvents=function(){var e=this;window.addEventListener("online",function(){return e.onBrowserBack()}),window.addEventListener("visibilitychange",function(){return e.onBrowserBack()}),window.addEventListener("beforeunload",function(){return e.leave()})},e.prototype.startJoin=function(e){void 0===e&&(e=this.key),C.webgroup("start join..."),this.init(e),this.signaling.connect(e)},e.prototype.rejoin=function(){var e=this;this.setState(ft.JOINING),R()&&A()?(this.clean(),C.webgroup("rejoin in 3000ms"),this.rejoinTimer=setTimeout(function(){e.signaling.state===He.CLOSED&&R()&&A()&&e.rejoinEnabled?e.startJoin():(C.webgroup("abandon rejoin because: ",{isVisible:R(),isOnline:A(),signalingState:He[e.signaling.state],rejoinEnabled:e.rejoinEnabled}),e.internalLeave()),e.rejoinTimer=void 0},3e3)):this.internalLeave()},e.prototype.reconnectToSignaling=function(){var e=this;1!==this.members.length||R()&&A()?(C.webgroup("reconnect to Signaling server in 3000ms"),this.setState(ft.JOINING),this.rejoinTimer=setTimeout(function(){e.signaling.state===He.CLOSED&&(R()&&A()?e.rejoinEnabled&&e.signaling.connect(e.key):1===e.members.length&&e.internalLeave()),e.rejoinTimer=void 0},3e3)):this.internalLeave()},e.prototype.onBrowserBack=function(){R()&&A()&&(C.webgroup("onBrowserBack",{isVisible:R(),isOnline:A()}),this.rejoinEnabled=this.autoRejoin,this.rejoinEnabled&&(this.state===ft.LEFT?this.startJoin():this.signaling.state===He.CLOSED&&this.signaling.connect(this.key)))},e.prototype.onMemberLeaveProxy=function(e){var t=this,n=!1;return e.forEach(function(e){t.members.includes(e)&&(t.members.splice(t.members.indexOf(e),1),n=!0,t.onMemberLeave(e))}),n},e.prototype.internalLeave=function(){C.webgroup("internal leave"),this.rejoinEnabled=!1,this.signaling.close(),this.topology.leave(),this.clean(),this.setState(ft.LEFT)},e}(),jt=new WeakMap,Nt=function(){function e(e){void 0===e&&(e={});var t=new Mt(e);jt.set(this,t),this.id=void 0,Reflect.defineProperty(this,"id",{configurable:!1,enumerable:!0,get:function(){return t.id}}),this.myId=void 0,Reflect.defineProperty(this,"myId",{configurable:!1,enumerable:!0,get:function(){return t.myId}}),this.key=void 0,Reflect.defineProperty(this,"key",{configurable:!1,enumerable:!0,get:function(){return t.key}}),this.members=void 0,Reflect.defineProperty(this,"members",{configurable:!1,enumerable:!0,get:function(){return t.members}}),this.neighbors=void 0,Reflect.defineProperty(this,"neighbors",{configurable:!1,enumerable:!0,get:function(){return t.topology.neighbors.map(function(e){return e.id})}}),this.topology=void 0,Reflect.defineProperty(this,"topology",{configurable:!1,enumerable:!0,get:function(){return t.topologyEnum}}),this.state=void 0,Reflect.defineProperty(this,"state",{configurable:!1,enumerable:!0,get:function(){return t.state}}),this.signalingState=void 0,Reflect.defineProperty(this,"signalingState",{configurable:!1,enumerable:!0,get:function(){return t.signaling.state}}),this.signalingServer=void 0,Reflect.defineProperty(this,"signalingServer",{configurable:!1,enumerable:!0,get:function(){return t.signaling.url}}),this.autoRejoin=void 0,Reflect.defineProperty(this,"autoRejoin",{configurable:!1,enumerable:!0,get:function(){return t.autoRejoin},set:function(e){return t.autoRejoin=e}}),this.onMessage=void 0,Reflect.defineProperty(this,"onMessage",{configurable:!0,enumerable:!0,get:function(){return"none"===t.onMessage.name?void 0:t.onMessage},set:function(e){t.onMessage="function"!=typeof e?function(){}:e}}),this.onMyId=void 0,Reflect.defineProperty(this,"onMyId",{configurable:!0,enumerable:!0,get:function(){return"none"===t.onMyId.name?void 0:t.onMyId},set:function(e){t.onMyId="function"!=typeof e?function(){}:e}}),this.onMemberJoin=void 0,Reflect.defineProperty(this,"onMemberJoin",{configurable:!0,enumerable:!0,get:function(){return"none"===t.onMemberJoin.name?void 0:t.onMemberJoin},set:function(e){t.onMemberJoin="function"!=typeof e?function(){}:e}}),this.onMemberLeave=void 0,Reflect.defineProperty(this,"onMemberLeave",{configurable:!0,enumerable:!0,get:function(){return"none"===t.onMemberLeave.name?void 0:t.onMemberLeave},set:function(e){t.onMemberLeave="function"!=typeof e?function(){}:e}}),this.onStateChange=void 0,Reflect.defineProperty(this,"onStateChange",{configurable:!0,enumerable:!0,get:function(){return"none"===t.onStateChange.name?void 0:t.onStateChange},set:function(e){t.onStateChange="function"!=typeof e?function(){}:e}}),this.onSignalingStateChange=void 0,Reflect.defineProperty(this,"onSignalingStateChange",{configurable:!0,enumerable:!0,get:function(){return"none"===t.onSignalingStateChange.name?void 0:t.onSignalingStateChange},set:function(e){t.onSignalingStateChange="function"!=typeof e?function(){}:e}})}return e.prototype.join=function(e){var t=jt.get(this);if(t)return t.join(e);throw new Error("WebChannel is undefined")},e.prototype.invite=function(e){var t=jt.get(this);if(t)return t.invite(e);throw new Error("WebChannel is undefined")},e.prototype.leave=function(){var e=jt.get(this);if(e)return e.leave();throw new Error("WebChannel is undefined")},e.prototype.send=function(e){var t=jt.get(this);if(t)return t.send(e);throw new Error("WebChannel is undefined")},e.prototype.sendTo=function(e,t){var n=jt.get(this);if(n)return n.sendTo(e,t);throw new Error("WebChannel is undefined")},e}(),Pt=(function(){function e(){}Object.defineProperty(e,"CONNECTING",{get:function(){return He.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(e,"OPEN",{get:function(){return He.OPEN},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CLOSED",{get:function(){return He.CLOSED},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CHECKING",{get:function(){return He.CHECKING},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CHECKED",{get:function(){return He.CHECKED},enumerable:!0,configurable:!0})}(),function(){function e(){}return Object.defineProperty(e,"JOINING",{get:function(){return ft.JOINING},enumerable:!0,configurable:!0}),Object.defineProperty(e,"JOINED",{get:function(){return ft.JOINED},enumerable:!0,configurable:!0}),Object.defineProperty(e,"LEFT",{get:function(){return ft.LEFT},enumerable:!0,configurable:!0}),e}()),At=(function(){function e(){}Object.defineProperty(e,"FULL_MESH",{get:function(){return G.FULL_MESH},enumerable:!0,configurable:!0})}(),function(){function e(){}Object.defineProperty(e,"DEBUG",{get:function(){return m.DEBUG},enumerable:!0,configurable:!0}),Object.defineProperty(e,"WEB_GROUP",{get:function(){return m.WEB_GROUP},enumerable:!0,configurable:!0}),Object.defineProperty(e,"WEBRTC",{get:function(){return m.WEBRTC},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CHANNEL",{get:function(){return m.CHANNEL},enumerable:!0,configurable:!0}),Object.defineProperty(e,"TOPOLOGY",{get:function(){return m.TOPOLOGY},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SIGNALING",{get:function(){return m.SIGNALING},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CHANNEL_BUILDER",{get:function(){return m.CHANNEL_BUILDER},enumerable:!0,configurable:!0})}(),{url:"",perMessageDeflate:!1,leaveOnceAlone:!0,server:void 0,webGroupOptions:Ct}),Rt=function(){function e(e){this.wcOptions=p({},Ct,e.webGroupOptions);var t=p({},At,e),n=t.leaveOnceAlone,r=t.server,i=t.url,o=t.perMessageDeflate;this.leaveOnceAlone=n,this.server=r,this.listenUrl=i,this.perMessageDeflate=o,this.webGroups=new Map,this.onWebGroup=function(){},this.onError=function(){},this.init()}return Object.defineProperty(e.prototype,"url",{get:function(){if(""!==this.listenUrl)return this.listenUrl;var e=this.server.address();return"ws://"+e.address+":"+e.port},enumerable:!0,configurable:!0}),e.prototype.init=function(){var e=this;this.webSocketServer=new o.Server({perMessageDeflate:this.perMessageDeflate,verifyClient:function(t){return e.validateURLQuery(t)},server:this.server}),(this.server||this.webSocketServer).on("listening",function(){return St.listenUrl.next(e.url)}),this.webSocketServer.on("error",function(t){St.listenUrl.next(""),e.onError(t)}),this.webSocketServer.on("connection",function(t){var n,r=e.readURLQuery(t.upgradeReq.url),i=r.type,o=r.wcId,s=r.senderId,a=r.key,c=e.webGroups.get(o);if(i!==wt.WITH_MEMBER||void 0!==c&&c.state!==Pt.LEFT){if(void 0===c)return void t.close();n=jt.get(c).webSocketBuilder}else{c=new Nt(e.wcOptions),e.webGroups.set(o,c);var u=jt.get(c);e.leaveOnceAlone&&(u.onAlone=function(){u.leave(),e.webGroups.delete(o)}),u.init(a,o),e.onWebGroup(c),u.onMyId(u.myId),n=u.webSocketBuilder}n.newWebSocket(t,s,i)})},e.prototype.validateURLQuery=function(e){try{var t=this.readURLQuery(e.req.url),n=t.type,r=t.wcId,i=t.key;switch(n){case wt.WITH_INTERNAL:return this.webGroups.has(r);case wt.WITH_MEMBER:var o=this.webGroups.get(r);return!!i&&(void 0===o||o.state===Pt.LEFT);case wt.WITH_JOINING:o=this.webGroups.get(r);return!!i&&void 0!==o&&o.key===i&&o.state!==Pt.LEFT;default:return!1}}catch(e){return C.warn(e.message),!1}},e.prototype.readURLQuery=function(e){var t="Query parse error: ",n=Object(c.parse)(e,!0).query,r=n.type,i=n.wcId,o=n.senderId,s=n.key;if("string"!=typeof r)throw new Error(t+'"type" parameter is not a string ');if("string"!=typeof i)throw new Error(t+'"wcId" parameter is not a string ');if("string"!=typeof o)throw new Error(t+'"senderId" parameter is not a string ');if("string"!=typeof s&&void 0!==s)throw new Error(t+'"type" parameter is not a string ');if(!r)throw new Error(t+'"type" parameter is undefined');if(!i)throw new Error(t+'"wcId" parameter is undefined');if(!o)throw new Error(t+'"senderId" parameter is undefined');return{type:Number.parseInt(r,10),wcId:Number.parseInt(i,10),senderId:Number.parseInt(o,10),key:s}},e}(),Lt=function(){return function(e){_t=new Rt(e),this.server=void 0,Reflect.defineProperty(this,"server",{configurable:!1,enumerable:!0,get:function(){return _t.server}}),this.perMessageDeflate=void 0,Reflect.defineProperty(this,"perMessageDeflate",{configurable:!1,enumerable:!0,get:function(){return _t.perMessageDeflate}}),this.leaveOnceAlone=void 0,Reflect.defineProperty(this,"leaveOnceAlone",{configurable:!1,enumerable:!0,get:function(){return _t.leaveOnceAlone}}),this.webGroups=void 0,Reflect.defineProperty(this,"webGroups",{configurable:!1,enumerable:!0,get:function(){return _t.webGroups}}),this.url=void 0,Reflect.defineProperty(this,"url",{configurable:!1,enumerable:!0,get:function(){return _t.url}}),this.onWebGroup=void 0,Reflect.defineProperty(this,"onWebGroup",{configurable:!0,enumerable:!0,get:function(){return"none"===_t.onWebGroup.name?void 0:_t.onWebGroup},set:function(e){_t.onWebGroup="function"!=typeof e?function(){}:e}}),this.onError=void 0,Reflect.defineProperty(this,"onError",{configurable:!0,enumerable:!0,get:function(){return"none"===_t.onError.name?void 0:_t.onError},set:function(e){_t.onError="function"!=typeof e?function(){}:e}})}}()},function(e,t,n){"use strict";n.r(t),n.d(t,"KeyState",function(){return i}),n.d(t,"Symmetric",function(){return j}),n.d(t,"KeyAgreementBD",function(){return Je}),n.d(t,"enableDebug",function(){return E}),n.d(t,"Streams",function(){return C}),n.d(t,"MuteCrypto",function(){return M});var r=n(0);n.d(t,"asymmetricCrypto",function(){return r.asymmetricCrypto});var i,o=n(11),s={};!function(e){e[e.UNDEFINED=0]="UNDEFINED",e[e.CALCUL_IN_PROGRESS=1]="CALCUL_IN_PROGRESS",e[e.READY=2]="READY"}(i||(i={}));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function c(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function u(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}c((r=r.apply(e,t||[])).next())})}function l(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function h(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}function p(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function f(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(p(arguments[t]));return e}var d=["%cMUTE CRYPTO:%c ","background-color: #81C784; padding: 0 2px",""],y=["%cMUTE CRYPTO ERROR:%c ","background-color: #81C784; padding: 0 2px",""],b=["%cMUTE CRYPTO:%c %cPERFORMANCE:%c ","background-color: #81C784; padding: 0 2px","","background-color: #FFCC80; padding: 0 2px",""],g={debug:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return console.log.apply(console,f(d,e))},error:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return console.error.apply(console,f(y,e))}},m={debug:function(){},error:function(){}},v=m,w=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];console.assert.apply(console,f([e,"MUTE-CRYPTO: "+t],n))},S=function(){},O=S,I={mark:function(e){return s.performance.mark(e)},measure:function(e,t,n){s.performance.measure(e,t,n);var r=s.performance.getEntriesByName(e)[0];console.log.apply(console,f(b,[r.name+" = "+r.duration.toFixed(0)+"ms"])),s.performance.clearMeasures()}},_={mark:function(){},measure:function(){}},x=_;function E(e){void 0===e&&(e=!0),e?(v=g,O=w,x=I):(v=m,O=S,x=_)}function k(e){for(var t,n=0,r=e.length,i="";n<r;)t=e.subarray(n,Math.min(n+32768,r)),i+=String.fromCharCode.apply(null,t),n+=32768;return T(i).substr(0,20)+"..."}function T(e){return"undefined"==typeof window?new Buffer(e).toString("base64"):window.btoa(e)}var C,M=function(){function e(){this.onStateChange=function(){},this.state=i.UNDEFINED}return e.generateKey=function(){return u(this,void 0,void 0,function(){var e,t;return l(this,function(n){switch(n.label){case 0:return[4,r.symmetricCrypto.generateEncryptionKey()];case 1:return e=n.sent(),[4,r.symmetricCrypto.exportKey(e)];case 2:return t=n.sent(),[2,r.symmetricCrypto.toB64(t)]}})})},e.prototype.setState=function(e){this.state!==e&&(v.debug("key state = "+i[e]),this.state=e,this.onStateChange(this.state))},e}(),j=function(e){function t(){var t=e.call(this)||this;return t.key=void 0,t}return c(t,e),t.prototype.importKey=function(t){return u(this,void 0,void 0,function(){var n;return l(this,function(o){switch(o.label){case 0:return n=this,[4,r.symmetricCrypto.importKey(r.symmetricCrypto.fromB64(t))];case 1:return n.key=o.sent(),e.prototype.setState.call(this,i.READY),[2]}})})},t.prototype.encrypt=function(e){return u(this,void 0,void 0,function(){return l(this,function(t){if(this.key)return[2,r.symmetricCrypto.encrypt(e,this.key)];throw new Error("Cryptographic key is not ready yet.")})})},t.prototype.decrypt=function(e){return u(this,void 0,void 0,function(){return l(this,function(t){if(this.key)return[2,r.symmetricCrypto.decrypt(e,this.key)];throw new Error("Cryptographic key is not ready yet.")})})},t}(M);!function(e){e[e.KEY_AGREEMENT_BD=700]="KEY_AGREEMENT_BD"}(C||(C={}));var N=function(){function e(e,t,n){this.value=e,this.initiatorId=t,this.initiatorCounter=n}return e.prototype.isEqual=function(e,t){return this.initiatorId===e&&this.initiatorCounter===t},e}(),P=function(){function e(e,t,n,i,o,s){x.mark("start cycle"),this.id=e,this.myId=i,this.myMembers=s,this.isZBroadcasted=!1,this.isXBroadcasted=!1,this.isFinished=!1,this.firstXadded=!1,this.counter=t,this.members=n,this.send=o,this._onKey=function(){},this.r=r.keyAgreementCrypto.generateRi(),x.mark("R ready"),this.z=r.keyAgreementCrypto.computeZi(this.r),x.mark("Z ready"),this.zArray=new Array(n.length),this.zArray[n.indexOf(i)]=this.z,this.xArray=new Array(n.length)}return e.prototype.addX=function(e,t){this.xArray[e]=t,this.firstXadded||x.mark("start X array"),this.firstXadded=!0},Object.defineProperty(e.prototype,"onKey",{set:function(e){this._onKey=e},enumerable:!0,configurable:!0}),e.prototype.isReadyToBroadcastZ=function(e){return this.members.every(function(t){return e.includes(t)})},e.prototype.checkZArray=function(e,t){var n,i;if(this.isXBroadcasted)this.debug("checkZArray abort -> X broadcasted already");else if(this.members.every(function(e){return t.includes(e)})){try{for(var o=h(this.zArray),s=o.next();!s.done;s=o.next()){if(void 0===s.value)return void this.debug("checkZArray abort -> missing Z value")}}catch(e){n={error:e}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}x.mark("Z array ready"),this.debug("checkZArray OK");var a=this.members.indexOf(e),c=(a+1)%this.members.length,u=(this.members.length+a-1)%this.members.length,l=r.keyAgreementCrypto.computeXi(this.r,this.zArray[c],this.zArray[u]);x.mark("X ready"),this.assert(void 0===this.xArray[a],"Setting my X value twice"),this.addX(a,l),this.broadcastX(l),this.checkXArray(e,t)}else this.debug("checkZArray abort -> missing a member")},e.prototype.checkXArray=function(e,t){return u(this,void 0,void 0,function(){var n,i,o,s,a,c,u,p,f;return l(this,function(l){switch(l.label){case 0:if(this.isFinished)return this.debug("checkXArray abort -> key computed already"),[2];if(!this.members.every(function(e){return t.includes(e)}))return this.debug("checkXArray abort -> missing a member"),[2];try{for(o=h(this.xArray),s=o.next();!s.done;s=o.next())if(void 0===s.value)return this.debug("checkXArray abort -> missing X value"),[2]}catch(e){n={error:e}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return x.mark("X array ready"),this.isFinished=!0,this.debug("checkXArray OK"),a=this.members.indexOf(e),c=(this.members.length+a-1)%this.members.length,u=r.keyAgreementCrypto.computeSharedSecret(this.r,this.xArray[a],this.zArray[c],this.xArray),f=N.bind,[4,r.keyAgreementCrypto.deriveKey(u)];case 1:return p=new(f.apply(N,[void 0,l.sent(),this.id,this.counter])),x.mark("end cycle"),x.measure("R","start cycle","R ready"),x.measure("Z","R ready","Z ready"),x.measure("X","Z array ready","X ready"),x.measure("Z array full","Z ready","Z array ready"),x.measure("X array full","start X array","X array ready"),x.measure("secret key","X array ready","end cycle"),x.measure(this.id+"("+this.counter+"): cycle","start cycle","end cycle"),this._onKey(p),[2]}})})},e.prototype.debug=function(e){v.debug(this.id+"("+this.counter+"): "+e+": ",this.formatCycle())},e.prototype.assert=function(e,t){O(e,this.id+"("+this.counter+"): "+t,this.formatCycle())},e.prototype.broadcastZ=function(){this.send({initiator:{id:this.id,counter:this.counter,members:this.members},z:this.z}),this.isZBroadcasted=!0,v.debug("broadcast my Z value")},e.prototype.broadcastX=function(e){this.send({initiator:{id:this.id,counter:this.counter,members:this.members},x:e}),this.isXBroadcasted=!0,this.debug("broadcast my X value")},e.prototype.formatCycle=function(){return{initiatorId:this.id,initiatorCounter:this.counter,initiatorMembers:this.members.slice(),myId:this.myId,myMembers:this.myMembers.slice(),zArray:this.zArray.map(function(e){var t="";return e.forEach(function(e){return t+=String.fromCharCode(e)}),T(t).substring(0,7)}),xArray:this.xArray.map(function(e){var t="";return e.forEach(function(e){return t+=String.fromCharCode(e)}),T(t).substring(0,7)})}},e}(),A="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function R(e,t){return e(t={exports:{}},t.exports),t.exports}var L=function(e,t){var n=new Array(arguments.length-1),r=0,i=2,o=!0;for(;i<arguments.length;)n[r++]=arguments[i++];return new Promise(function(i,s){n[r]=function(e){if(o)if(o=!1,e)s(e);else{for(var t=new Array(arguments.length-1),n=0;n<t.length;)t[n++]=arguments[n];i.apply(null,t)}};try{e.apply(t||null,n)}catch(e){o&&(o=!1,s(e))}})};var B=R(function(e,t){var n=t;n.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;--t%4>1&&"="===e.charAt(t);)++n;return Math.ceil(3*e.length)/4-n};for(var r=new Array(64),i=new Array(123),o=0;o<64;)i[r[o]=o<26?o+65:o<52?o+71:o<62?o-4:o-59|43]=o++;n.encode=function(e,t,n){for(var i,o=null,s=[],a=0,c=0;t<n;){var u=e[t++];switch(c){case 0:s[a++]=r[u>>2],i=(3&u)<<4,c=1;break;case 1:s[a++]=r[i|u>>4],i=(15&u)<<2,c=2;break;case 2:s[a++]=r[i|u>>6],s[a++]=r[63&u],c=0}a>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,s)),a=0)}return c&&(s[a++]=r[i],s[a++]=61,1===c&&(s[a++]=61)),o?(a&&o.push(String.fromCharCode.apply(String,s.slice(0,a))),o.join("")):String.fromCharCode.apply(String,s.slice(0,a))};n.decode=function(e,t,n){for(var r,o=n,s=0,a=0;a<e.length;){var c=e.charCodeAt(a++);if(61===c&&s>1)break;if(void 0===(c=i[c]))throw Error("invalid encoding");switch(s){case 0:r=c,s=1;break;case 1:t[n++]=r<<2|(48&c)>>4,r=c,s=2;break;case 2:t[n++]=(15&r)<<4|(60&c)>>2,r=c,s=3;break;case 3:t[n++]=(3&r)<<6|c,s=0}}if(1===s)throw Error("invalid encoding");return n-o},n.test=function(e){return/^(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/.test(e)}}),D=U;function U(){this._listeners={}}U.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this},U.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var n=this._listeners[e],r=0;r<n.length;)n[r].fn===t?n.splice(r,1):++r;return this},U.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],r=1;r<arguments.length;)n.push(arguments[r++]);for(r=0;r<t.length;)t[r].fn.apply(t[r++].ctx,n)}return this};var F=z(z);function z(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),n=new Uint8Array(t.buffer),r=128===n[3];function i(e,r,i){t[0]=e,r[i]=n[0],r[i+1]=n[1],r[i+2]=n[2],r[i+3]=n[3]}function o(e,r,i){t[0]=e,r[i]=n[3],r[i+1]=n[2],r[i+2]=n[1],r[i+3]=n[0]}function s(e,r){return n[0]=e[r],n[1]=e[r+1],n[2]=e[r+2],n[3]=e[r+3],t[0]}function a(e,r){return n[3]=e[r],n[2]=e[r+1],n[1]=e[r+2],n[0]=e[r+3],t[0]}e.writeFloatLE=r?i:o,e.writeFloatBE=r?o:i,e.readFloatLE=r?s:a,e.readFloatBE=r?a:s}():function(){function t(e,t,n,r){var i=t<0?1:0;if(i&&(t=-t),0===t)e(1/t>0?0:2147483648,n,r);else if(isNaN(t))e(2143289344,n,r);else if(t>3.4028234663852886e38)e((i<<31|2139095040)>>>0,n,r);else if(t<1.1754943508222875e-38)e((i<<31|Math.round(t/1.401298464324817e-45))>>>0,n,r);else{var o=Math.floor(Math.log(t)/Math.LN2);e((i<<31|o+127<<23|8388607&Math.round(t*Math.pow(2,-o)*8388608))>>>0,n,r)}}function n(e,t,n){var r=e(t,n),i=2*(r>>31)+1,o=r>>>23&255,s=8388607&r;return 255===o?s?NaN:i*(1/0):0===o?1.401298464324817e-45*i*s:i*Math.pow(2,o-150)*(s+8388608)}e.writeFloatLE=t.bind(null,G),e.writeFloatBE=t.bind(null,$),e.readFloatLE=n.bind(null,q),e.readFloatBE=n.bind(null,W)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),n=new Uint8Array(t.buffer),r=128===n[7];function i(e,r,i){t[0]=e,r[i]=n[0],r[i+1]=n[1],r[i+2]=n[2],r[i+3]=n[3],r[i+4]=n[4],r[i+5]=n[5],r[i+6]=n[6],r[i+7]=n[7]}function o(e,r,i){t[0]=e,r[i]=n[7],r[i+1]=n[6],r[i+2]=n[5],r[i+3]=n[4],r[i+4]=n[3],r[i+5]=n[2],r[i+6]=n[1],r[i+7]=n[0]}function s(e,r){return n[0]=e[r],n[1]=e[r+1],n[2]=e[r+2],n[3]=e[r+3],n[4]=e[r+4],n[5]=e[r+5],n[6]=e[r+6],n[7]=e[r+7],t[0]}function a(e,r){return n[7]=e[r],n[6]=e[r+1],n[5]=e[r+2],n[4]=e[r+3],n[3]=e[r+4],n[2]=e[r+5],n[1]=e[r+6],n[0]=e[r+7],t[0]}e.writeDoubleLE=r?i:o,e.writeDoubleBE=r?o:i,e.readDoubleLE=r?s:a,e.readDoubleBE=r?a:s}():function(){function t(e,t,n,r,i,o){var s=r<0?1:0;if(s&&(r=-r),0===r)e(0,i,o+t),e(1/r>0?0:2147483648,i,o+n);else if(isNaN(r))e(0,i,o+t),e(2146959360,i,o+n);else if(r>1.7976931348623157e308)e(0,i,o+t),e((s<<31|2146435072)>>>0,i,o+n);else{var a;if(r<2.2250738585072014e-308)e((a=r/5e-324)>>>0,i,o+t),e((s<<31|a/4294967296)>>>0,i,o+n);else{var c=Math.floor(Math.log(r)/Math.LN2);1024===c&&(c=1023),e(4503599627370496*(a=r*Math.pow(2,-c))>>>0,i,o+t),e((s<<31|c+1023<<20|1048576*a&1048575)>>>0,i,o+n)}}}function n(e,t,n,r,i){var o=e(r,i+t),s=e(r,i+n),a=2*(s>>31)+1,c=s>>>20&2047,u=4294967296*(1048575&s)+o;return 2047===c?u?NaN:a*(1/0):0===c?5e-324*a*u:a*Math.pow(2,c-1075)*(u+4503599627370496)}e.writeDoubleLE=t.bind(null,G,0,4),e.writeDoubleBE=t.bind(null,$,4,0),e.readDoubleLE=n.bind(null,q,0,4),e.readDoubleBE=n.bind(null,W,4,0)}(),e}function G(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function $(e,t,n){t[n]=e>>>24,t[n+1]=e>>>16&255,t[n+2]=e>>>8&255,t[n+3]=255&e}function q(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function W(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}var V=function(e){return null};var H=R(function(e,t){var n=t;n.length=function(e){for(var t=0,n=0,r=0;r<e.length;++r)(n=e.charCodeAt(r))<128?t+=1:n<2048?t+=2:55296==(64512&n)&&56320==(64512&e.charCodeAt(r+1))?(++r,t+=4):t+=3;return t},n.read=function(e,t,n){if(n-t<1)return"";for(var r,i=null,o=[],s=0;t<n;)(r=e[t++])<128?o[s++]=r:r>191&&r<224?o[s++]=(31&r)<<6|63&e[t++]:r>239&&r<365?(r=((7&r)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,o[s++]=55296+(r>>10),o[s++]=56320+(1023&r)):o[s++]=(15&r)<<12|(63&e[t++])<<6|63&e[t++],s>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),s=0);return i?(s&&i.push(String.fromCharCode.apply(String,o.slice(0,s))),i.join("")):String.fromCharCode.apply(String,o.slice(0,s))},n.write=function(e,t,n){for(var r,i,o=n,s=0;s<e.length;++s)(r=e.charCodeAt(s))<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):55296==(64512&r)&&56320==(64512&(i=e.charCodeAt(s+1)))?(r=65536+((1023&r)<<10)+(1023&i),++s,t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128);return n-o}}),K=function(e,t,n){var r=n||8192,i=r>>>1,o=null,s=r;return function(n){if(n<1||n>i)return e(n);s+n>r&&(o=e(r),s=0);var a=t.call(o,s,s+=n);return 7&s&&(s=1+(7|s)),a}};var J=X;function X(e,t){this.lo=e>>>0,this.hi=t>>>0}var Z=X.zero=new X(0,0);Z.toNumber=function(){return 0},Z.zzEncode=Z.zzDecode=function(){return this},Z.length=function(){return 1};var Y=X.zeroHash="\0\0\0\0\0\0\0\0";X.fromNumber=function(e){if(0===e)return Z;var t=e<0;t&&(e=-e);var n=e>>>0,r=(e-n)/4294967296>>>0;return t&&(r=~r>>>0,n=~n>>>0,++n>4294967295&&(n=0,++r>4294967295&&(r=0))),new X(n,r)},X.from=function(e){if("number"==typeof e)return X.fromNumber(e);if(te.isString(e)){if(!te.Long)return X.fromNumber(parseInt(e,10));e=te.Long.fromString(e)}return e.low||e.high?new X(e.low>>>0,e.high>>>0):Z},X.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+4294967296*n)}return this.lo+4294967296*this.hi},X.prototype.toLong=function(e){return te.Long?new te.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var Q=String.prototype.charCodeAt;X.fromHash=function(e){return e===Y?Z:new X((Q.call(e,0)|Q.call(e,1)<<8|Q.call(e,2)<<16|Q.call(e,3)<<24)>>>0,(Q.call(e,4)|Q.call(e,5)<<8|Q.call(e,6)<<16|Q.call(e,7)<<24)>>>0)},X.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},X.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},X.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},X.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10};var ee,te=R(function(e,t){var n=t;function r(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;++i)void 0!==e[r[i]]&&n||(e[r[i]]=t[r[i]]);return e}function i(e){function t(e,n){if(!(this instanceof t))return new t(e,n);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&r(this,n)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}n.asPromise=L,n.base64=B,n.EventEmitter=D,n.float=F,n.inquire=V,n.utf8=H,n.pool=K,n.LongBits=J,n.global="undefined"!=typeof window&&window||void 0!==A&&A||"undefined"!=typeof self&&self||A,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isNode=Boolean(n.global.process&&n.global.process.versions&&n.global.process.versions.node),n.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},n.isString=function(e){return"string"==typeof e||e instanceof String},n.isObject=function(e){return e&&"object"==typeof e},n.isset=n.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!=typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},n.Buffer=function(){try{var e=n.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(e){return"number"==typeof e?n.Buffer?n._Buffer_allocUnsafe(e):new n.Array(e):n.Buffer?n._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},n.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(e){return e?n.LongBits.from(e).toHash():n.LongBits.zeroHash},n.longFromHash=function(e,t){var r=n.LongBits.fromHash(e);return n.Long?n.Long.fromBits(r.lo,r.hi,t):r.toNumber(Boolean(t))},n.merge=r,n.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},n.newError=i,n.ProtocolError=i("ProtocolError"),n.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;n>-1;--n)if(1===t[e[n]]&&void 0!==this[e[n]]&&null!==this[e[n]])return e[n]}},n.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){var e=n.Buffer;e?(n._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},n._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):n._Buffer_from=n._Buffer_allocUnsafe=null}}),ne=ue,re=te.LongBits,ie=te.base64,oe=te.utf8;function se(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function ae(){}function ce(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function ue(){this.len=0,this.head=new se(ae,0,0),this.tail=this.head,this.states=null}function le(e,t,n){t[n]=255&e}function he(e,t){this.len=e,this.next=void 0,this.val=t}function pe(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[n++]=127&e.lo|128,e.lo=e.lo>>>7;t[n++]=e.lo}function fe(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}ue.create=te.Buffer?function(){return(ue.create=function(){return new ee})()}:function(){return new ue},ue.alloc=function(e){return new te.Array(e)},te.Array!==Array&&(ue.alloc=te.pool(ue.alloc,te.Array.prototype.subarray)),ue.prototype._push=function(e,t,n){return this.tail=this.tail.next=new se(e,t,n),this.len+=t,this},he.prototype=Object.create(se.prototype),he.prototype.fn=function(e,t,n){for(;e>127;)t[n++]=127&e|128,e>>>=7;t[n]=e},ue.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new he((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},ue.prototype.int32=function(e){return e<0?this._push(pe,10,re.fromNumber(e)):this.uint32(e)},ue.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},ue.prototype.uint64=function(e){var t=re.from(e);return this._push(pe,t.length(),t)},ue.prototype.int64=ue.prototype.uint64,ue.prototype.sint64=function(e){var t=re.from(e).zzEncode();return this._push(pe,t.length(),t)},ue.prototype.bool=function(e){return this._push(le,1,e?1:0)},ue.prototype.fixed32=function(e){return this._push(fe,4,e>>>0)},ue.prototype.sfixed32=ue.prototype.fixed32,ue.prototype.fixed64=function(e){var t=re.from(e);return this._push(fe,4,t.lo)._push(fe,4,t.hi)},ue.prototype.sfixed64=ue.prototype.fixed64,ue.prototype.float=function(e){return this._push(te.float.writeFloatLE,4,e)},ue.prototype.double=function(e){return this._push(te.float.writeDoubleLE,8,e)};var de=te.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var r=0;r<e.length;++r)t[n+r]=e[r]};ue.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(le,1,0);if(te.isString(e)){var n=ue.alloc(t=ie.length(e));ie.decode(e,n,0),e=n}return this.uint32(t)._push(de,t,e)},ue.prototype.string=function(e){var t=oe.length(e);return t?this.uint32(t)._push(oe.write,t,e):this._push(le,1,0)},ue.prototype.fork=function(){return this.states=new ce(this),this.head=this.tail=new se(ae,0,0),this.len=0,this},ue.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new se(ae,0,0),this.len=0),this},ue.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},ue.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},ue._configure=function(e){ee=e};var ye=ge;(ge.prototype=Object.create(ne.prototype)).constructor=ge;var be=te.Buffer;function ge(){ne.call(this)}ge.alloc=function(e){return(ge.alloc=te._Buffer_allocUnsafe)(e)};var me=be&&be.prototype instanceof Uint8Array&&"set"===be.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var r=0;r<e.length;)t[n++]=e[r++]};function ve(e,t,n){e.length<40?te.utf8.write(e,t,n):t.utf8Write(e,n)}ge.prototype.bytes=function(e){te.isString(e)&&(e=te._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(me,t,e),this},ge.prototype.string=function(e){var t=be.byteLength(e);return this.uint32(t),t&&this._push(ve,t,e),this};var we,Se=xe,Oe=te.LongBits,Ie=te.utf8;function _e(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function xe(e){this.buf=e,this.pos=0,this.len=e.length}var Ee,ke="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new xe(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new xe(e);throw Error("illegal buffer")};function Te(){var e=new Oe(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw _e(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw _e(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function Ce(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function Me(){if(this.pos+8>this.len)throw _e(this,8);return new Oe(Ce(this.buf,this.pos+=4),Ce(this.buf,this.pos+=4))}xe.create=te.Buffer?function(e){return(xe.create=function(e){return te.Buffer.isBuffer(e)?new we(e):ke(e)})(e)}:ke,xe.prototype._slice=te.Array.prototype.subarray||te.Array.prototype.slice,xe.prototype.uint32=(Ee=4294967295,function(){if(Ee=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return Ee;if(Ee=(Ee|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return Ee;if(Ee=(Ee|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return Ee;if(Ee=(Ee|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return Ee;if(Ee=(Ee|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return Ee;if((this.pos+=5)>this.len)throw this.pos=this.len,_e(this,10);return Ee}),xe.prototype.int32=function(){return 0|this.uint32()},xe.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},xe.prototype.bool=function(){return 0!==this.uint32()},xe.prototype.fixed32=function(){if(this.pos+4>this.len)throw _e(this,4);return Ce(this.buf,this.pos+=4)},xe.prototype.sfixed32=function(){if(this.pos+4>this.len)throw _e(this,4);return 0|Ce(this.buf,this.pos+=4)},xe.prototype.float=function(){if(this.pos+4>this.len)throw _e(this,4);var e=te.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},xe.prototype.double=function(){if(this.pos+8>this.len)throw _e(this,4);var e=te.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},xe.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw _e(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)},xe.prototype.string=function(){var e=this.bytes();return Ie.read(e,0,e.length)},xe.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw _e(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw _e(this)}while(128&this.buf[this.pos++]);return this},xe.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},xe._configure=function(e){we=e;var t=te.Long?"toLong":"toNumber";te.merge(xe.prototype,{int64:function(){return Te.call(this)[t](!1)},uint64:function(){return Te.call(this)[t](!0)},sint64:function(){return Te.call(this).zzDecode()[t](!1)},fixed64:function(){return Me.call(this)[t](!0)},sfixed64:function(){return Me.call(this)[t](!1)}})};var je=Ne;function Ne(e){Se.call(this,e)}(Ne.prototype=Object.create(Se.prototype)).constructor=Ne,te.Buffer&&(Ne.prototype._slice=te.Buffer.prototype.slice),Ne.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len))};var Pe=Ae;function Ae(e,t,n){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");te.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(n)}(Ae.prototype=Object.create(te.EventEmitter.prototype)).constructor=Ae,Ae.prototype.rpcCall=function e(t,n,r,i,o){if(!i)throw TypeError("request must be specified");var s=this;if(!o)return te.asPromise(e,s,t,n,r,i);if(s.rpcImpl)try{return s.rpcImpl(t,n[s.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(e,n){if(e)return s.emit("error",e,t),o(e);if(null!==n){if(!(n instanceof r))try{n=r[s.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return s.emit("error",e,t),o(e)}return s.emit("data",n,t),o(null,n)}s.end(!0)})}catch(e){return s.emit("error",e,t),void setTimeout(function(){o(e)},0)}else setTimeout(function(){o(Error("already ended"))},0)},Ae.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};var Re=R(function(e,t){t.Service=Pe}),Le={},Be=R(function(e,t){var n=t;function r(){n.Reader._configure(n.BufferReader),n.util._configure()}n.build="minimal",n.Writer=ne,n.BufferWriter=ye,n.Reader=Se,n.BufferReader=je,n.util=te,n.rpc=Re,n.roots=Le,n.configure=r,n.Writer._configure(n.BufferWriter),r()}),De=Be.Reader,Ue=Be.Writer,Fe=Be.util,ze=Be.roots;const Ge=De,$e=Ue,qe=Fe,We=ze.default||(ze.default={}),Ve=We.Message=(()=>{function e(e){if(e)for(let t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.content=qe.newBuffer([]),e.prototype.signature=qe.newBuffer([]),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$e.create()),null!=e.content&&e.hasOwnProperty("content")&&t.uint32(10).bytes(e.content),null!=e.signature&&e.hasOwnProperty("signature")&&t.uint32(18).bytes(e.signature),t},e.decode=function(e,t){e instanceof Ge||(e=Ge.create(e));let n=void 0===t?e.len:e.pos+t,r=new We.Message;for(;e.pos<n;){let t=e.uint32();switch(t>>>3){case 1:r.content=e.bytes();break;case 2:r.signature=e.bytes();break;default:e.skipType(7&t)}}return r},e})(),He=We.Content=(()=>{function e(e){if(e)for(let t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}let t;return e.prototype.initiator=null,e.prototype.z=qe.newBuffer([]),e.prototype.x=qe.newBuffer([]),Object.defineProperty(e.prototype,"type",{get:qe.oneOfGetter(t=["z","x"]),set:qe.oneOfSetter(t)}),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$e.create()),null!=e.initiator&&e.hasOwnProperty("initiator")&&We.Initiator.encode(e.initiator,t.uint32(10).fork()).ldelim(),null!=e.z&&e.hasOwnProperty("z")&&t.uint32(18).bytes(e.z),null!=e.x&&e.hasOwnProperty("x")&&t.uint32(26).bytes(e.x),t},e.decode=function(e,t){e instanceof Ge||(e=Ge.create(e));let n=void 0===t?e.len:e.pos+t,r=new We.Content;for(;e.pos<n;){let t=e.uint32();switch(t>>>3){case 1:r.initiator=We.Initiator.decode(e,e.uint32());break;case 2:r.z=e.bytes();break;case 3:r.x=e.bytes();break;default:e.skipType(7&t)}}return r},e})(),Ke=(We.Initiator=(()=>{function e(e){if(this.members=[],e)for(let t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.id=0,e.prototype.counter=0,e.prototype.members=qe.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=$e.create()),null!=e.id&&e.hasOwnProperty("id")&&t.uint32(8).uint32(e.id),null!=e.counter&&e.hasOwnProperty("counter")&&t.uint32(16).uint32(e.counter),null!=e.members&&e.members.length){t.uint32(26).fork();for(let n=0;n<e.members.length;++n)t.uint32(e.members[n]);t.ldelim()}return t},e.decode=function(e,t){e instanceof Ge||(e=Ge.create(e));let n=void 0===t?e.len:e.pos+t,r=new We.Initiator;for(;e.pos<n;){let t=e.uint32();switch(t>>>3){case 1:r.id=e.uint32();break;case 2:r.counter=e.uint32();break;case 3:if(r.members&&r.members.length||(r.members=[]),2==(7&t)){let t=e.uint32()+e.pos;for(;e.pos<t;)r.members.push(e.uint32())}else r.members.push(e.uint32());break;default:e.skipType(7&t)}}return r},e})(),We.CipherMessage=(()=>{function e(e){if(e)for(let t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.id=0,e.prototype.counter=0,e.prototype.content=qe.newBuffer([]),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$e.create()),null!=e.id&&e.hasOwnProperty("id")&&t.uint32(8).uint32(e.id),null!=e.counter&&e.hasOwnProperty("counter")&&t.uint32(16).uint32(e.counter),null!=e.content&&e.hasOwnProperty("content")&&t.uint32(26).bytes(e.content),t},e.decode=function(e,t){e instanceof Ge||(e=Ge.create(e));let n=void 0===t?e.len:e.pos+t,r=new We.CipherMessage;for(;e.pos<n;){let t=e.uint32();switch(t>>>3){case 1:r.id=e.uint32();break;case 2:r.counter=e.uint32();break;case 3:r.content=e.bytes();break;default:e.skipType(7&t)}}return r},e})());var Je=function(e){function t(){var t=e.call(this)||this;return t._signingKey=void 0,t.myCounter=0,t.cycles=new Map,t.members=[],t.send=function(){},t.myId=0,t.key=void 0,t.previousKey=void 0,t.isReady=!1,t}return c(t,e),t.prototype.encrypt=function(e){return u(this,void 0,void 0,function(){var t;return l(this,function(n){switch(n.label){case 0:return this.key?[4,r.symmetricCrypto.encrypt(e,this.key.value)]:[3,2];case 1:return t=n.sent(),[2,Ke.encode(Ke.create({id:this.key.initiatorId,counter:this.key.initiatorCounter,content:t})).finish()];case 2:throw v.debug("Failed to encrypt a message: cryptographic key is not ready yet"),new Error("Failed to encrypt a message: cryptographic key is not ready yet")}})})},t.prototype.decrypt=function(e){return u(this,void 0,void 0,function(){var t,n,i,o;return l(this,function(s){if(this.key){if(t=Ke.decode(e),n=t.id,i=t.counter,o=t.content,this.key.isEqual(n,i))return[2,r.symmetricCrypto.decrypt(o,this.key.value)];if(this.previousKey&&this.previousKey.isEqual(n,i))return[2,r.symmetricCrypto.decrypt(o,this.previousKey.value)]}throw v.debug("Failed to decrypt a message"),new Error("Failed to decrypt a message")})})},Object.defineProperty(t.prototype,"signingKey",{set:function(e){this._signingKey=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onSend",{set:function(e){var t=this;this.send=function(n){var i=He.encode(He.create(n)).finish();t._signingKey?r.asymmetricCrypto.sign(i,t._signingKey).then(function(t){v.debug("Signing message: ",{signature:k(t)}),e(Ve.encode(Ve.create({content:i,signature:t})).finish(),C.KEY_AGREEMENT_BD)}).catch(function(e){return v.error("Signing failed: ",e)}):e(Ve.encode(Ve.create({content:i})).finish(),C.KEY_AGREEMENT_BD)}},enumerable:!0,configurable:!0}),t.prototype.addMember=function(e){this.members.push(e),this.members.sort(function(e,t){return e-t}),v.debug("MEMBER Joined: ",{id:e,currentMembers:this.members.slice()}),this.checkCycles()},t.prototype.removeMember=function(e){var t=this.members.indexOf(e);-1!==t&&this.members.splice(t,1),v.debug("MEMBER Left: ",{id:e,currentMembers:this.members.slice()}),this.checkCycles()},t.prototype.onMessage=function(t,n,o){return u(this,void 0,void 0,function(){var s,a,c,u,h,p,f,d,y,b,g,m;return l(this,function(l){switch(l.label){case 0:return s=Ve.decode(n),a=s.content,c=s.signature,u=He.decode(a),p=(h=u).initiator,f=p.id,d=p.counter,y=p.members,b=h.type,o?[4,r.asymmetricCrypto.verifySignature(a,c,o)]:[3,2];case 1:if(!l.sent())throw v.error("Verify signature NOT OK: ",{id:t,signature:k(c)}),new Error("Wrong signature");v.debug("Verify signature OK: ",{id:t,signature:k(c)}),l.label=2;case 2:if(!y.includes(this.myId))return[2];if((void 0===(g=this.cycles.get(f))||g.counter<d)&&(e.prototype.setState.call(this,i.CALCUL_IN_PROGRESS),(g=this.createCycle(f,d,y)).debug("NOT an initiator starts a NEW CYCLE"),!g.isZBroadcasted&&g.isReadyToBroadcastZ(this.members)&&(g.broadcastZ(),g.checkZArray(this.myId,this.members))),g.counter===d&&!g.isFinished)switch(m=g.members.indexOf(t),b){case"z":g.debug("received Z value from "+t+", "+m),g.assert(-1!==m,"Unable to find a corresponding Z value of "+t),g.assert(void 0===g.zArray[m],"Setting Z value twice"),g.zArray[m]=u.z.slice(),g.checkZArray(this.myId,this.members);break;case"x":g.debug("received X value from "+t+", "+m),g.assert(-1!==m,"Unable to find a corresponding X value of "+t),g.assert(void 0===g.xArray[m],"Setting X value twice"),g.addX(m,u.x.slice()),g.checkXArray(this.myId,this.members)}return[2]}})})},t.prototype.setMyId=function(e){var t=this.members.indexOf(this.myId);-1!==t?this.members[t]=e:this.members.push(e),this.myId=e,this.myCounter=0,this.members.sort(function(e,t){return e-t})},t.prototype.setReady=function(){this.isReady=!0,this.isInitiator&&this.start()},t.prototype.checkCycles=function(){var e,t;if(this.members.length>1)if(this.isInitiator)this.start();else try{for(var n=h(this.cycles.values()),r=n.next();!r.done;r=n.next()){var i=r.value;if(i.debug("CHECK CYCLE"),!i.isFinished){if(!i.isZBroadcasted&&i.isReadyToBroadcastZ(this.members)){i.broadcastZ(),i.checkZArray(this.myId,this.members);continue}i.checkZArray(this.myId,this.members),i.checkXArray(this.myId,this.members)}}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},Object.defineProperty(t.prototype,"isInitiator",{get:function(){return this.members.length>1&&this.members[0]===this.myId},enumerable:!0,configurable:!0}),t.prototype.start=function(){this.isReady&&this.members.length>1&&(e.prototype.setState.call(this,i.CALCUL_IN_PROGRESS),v.debug("INITIATOR starts a NEW CYCLE"),this.createCycle(this.myId,++this.myCounter,this.members).broadcastZ())},t.prototype.createCycle=function(t,n,o){var s=this,a=new P(t,n,o,this.myId,this.send,this.members);return this.cycles.set(t,a),a.onKey=function(t){s.key&&(s.previousKey=s.key),s.key=t,e.prototype.setState.call(s,i.READY),r.symmetricCrypto.exportKey(s.key.value).then(function(e){v.debug("KEY =",r.symmetricCrypto.toB64(e))})},a},t}(M);s.performance=o.performance},function(e,t){e.exports=require("util")},function(e,t){e.exports=require("url")},function(e,t){e.exports=require("perf_hooks")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(13),i=n(14),o=n(15),s=n(16),a=n(17),c=n(18),u=n(7),l=n(19),h=n(4),p=n(24);let f;try{f=n(26).version}catch(e){try{f=n(!function(){var e=new Error("Cannot find module './package.json'");throw e.code="MODULE_NOT_FOUND",e}()).version}catch(t){h.log.error(e),f=""}}const d="Repono",y="0.0.0.0",b=2e4,g="ws://localhost:20000",m="ws://localhost:8010",v="mutedocs",w="keyagreement",S=!1,O="info",I="";r.version(f).option("-h, --host <ip or host name>","Host address to bind to.",y).option("-p, --port <number>","Port to use for the server.",b).option("-b, --botURL <number>","Bot public URL.",g).option("-s, --signalingURL <url>","Signaling server url.",m).option("","\n").option("-c --cryptography <string>",'Specify cryptography type. Possible values are: "none", "metadata", "keyagreement"',w).option("--cors","Enable Cross-origin Resource Sharing.",S).option("-n, --name <bot name>","Bot name.",d).option("-d, --database <name>","Database name.",v).option("","\n").option("--key <file path>","Private key for the certificate").option("--cert <file path>","The server certificate").option("--ca <file path>","The additional intermediate certificate or certificates that web browsers will need in order to validate the server certificate.").option("","\n").option("-l, --logLevel <none|trace|debug|info|warn|error|fatal>","Logging level.",/^(none|trace|debug|info|warn|error|fatal)$/i,O).option("-f, --logFolder <path>","Path to where log files would be stored.\n                              If not specified stdout will used.",I).parse(process.argv);const{name:_,host:x,port:E,botURL:k,signalingURL:T,database:C,cryptography:M,cors:j,key:N,cert:P,ca:A,logLevel:R,logFolder:L}=r;h.createLogger(L,R),"none"!==R&&u.setLogLevel(u.LogLevel.DEBUG),process.on("uncaughtException",e=>{console.error("uncaughtException -> ",e)});const B=new p.MongooseAdapter;function D(e){const t=e.split("/");return`bot.storage@${e.indexOf("://")>-1?t[2]:t[0]}`}B.connect("localhost",C).then(()=>{h.log.info("Connected to the database  ");let e=new s;const t=new c;return t.get("/info",e=>{e.body={displayName:_,login:D(k),avatar:l.BotStorage.AVATAR,version:f}}).get("/docs/:login",async e=>{await B.lookupMetadataByLogin(e.params.login).then(t=>e.body=t).catch(t=>{h.log.error("Could not retreive the document list stored in database",t),e.status=500})}).post("/remove",e=>{const{key:t,login:n}=e.request.body;e.request.body&&t&&n?B.removeLogin(t,n).then(()=>{e.body=!0}).catch(t=>{h.log.error(`Failed to remove login ${n}`,t),e.status=500}):e.status=404}),j&&(e=e.use(o())),e.use(a()).use(t.routes()).use(t.allowedMethods())}).then(e=>{if(h.log.info("Configured routes  "),N&&P&&A){const t=n(27);return n(28).createServer({key:t.readFileSync(N),cert:t.readFileSync(P),ca:t.readFileSync(A)},e.callback())}return i.createServer(e.callback())}).then(e=>{return h.log.info("Configured server  "),e.on("clientError",e=>{h.log.error("Client Error",e)}),new u.Bot({url:k,server:e,leaveOnceAlone:!1,webGroupOptions:{signalingServer:T}}).onWebGroup=(e=>{const t=new l.BotStorage(_,D(k),e,B,M);h.log.info("New peer to peer network invitation received for ",t.signalingKey)}),new Promise(t=>e.listen(E,x,t))}).then(()=>{h.log.info(`Successfully started the storage bot server at ${x}:${E} with the following settings`,{name:_,host:x,port:E,botURL:k,signalingURL:T,cryptography:M,logLevel:R,logFolder:L})}).catch(e=>h.log.fatal(e))},function(e,t){e.exports=require("commander")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("kcors")},function(e,t){e.exports=require("koa")},function(e,t){e.exports=require("koa-bodyparser")},function(e,t){e.exports=require("koa-router")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(20),i=n(8),o=n(1),s=n(2),a=n(7),c=n(9),u=n(4),l=n(22),h=12e4,p=1e4;class f{constructor(e,t,n,i,s){this.crdtStrategy=r.Strategy.LOGOOTSPLIT,this.displayName=e,this.login=t,this.wg=n,this.synchronize=(()=>{}),this.syncDocContentInterval=void 0,this.saveChain=Promise.resolve(),this.mongooseAdapter=i,this.message$=new o.ReplaySubject,this.memberJoin$=new o.ReplaySubject,this.memberLeave$=new o.ReplaySubject,this.state$=new o.ReplaySubject,this.myId$=new o.ReplaySubject,this.subs=[],this.saveInterval=setInterval(()=>{this.mongoDoc&&this.saveContent()},h),this.initWebGroup(),this.initMuteCrypto(s),this.retreiveDocument(n.key).then(e=>{this.mongoDoc=e;const t=e.get("operations").map(e=>r.RichOperationStrategy.fromPlain(this.crdtStrategy,e)),n=r.StateStrategy.emptyState(this.crdtStrategy);n&&(n.remoteOperations=t||[],this.initMuteCore(e,n))}).catch(e=>u.log.error(`Failed to initialize document ${n.key}`,e))}get signalingKey(){return this.wg.key}initWebGroup(){this.wg.onStateChange=(e=>{e===a.WebGroupState.LEFT&&(this.saveContent(),global.clearInterval(this.saveInterval)),this.state$.next(e)}),this.wg.onMemberJoin=(e=>this.memberJoin$.next(e)),this.wg.onMemberLeave=(e=>{this.wg.members.length<2&&this.saveContent(),this.memberLeave$.next(e)}),this.wg.onMyId=(e=>this.myId$.next(e))}async retreiveDocument(e){const t=await this.mongooseAdapter.find(e);return t||await this.mongooseAdapter.create(e)}initMuteCore(e,t){const n=r.MuteCoreFactory.createMuteCore({strategy:r.Strategy.LOGOOTSPLIT,profile:{displayName:this.displayName,login:this.login,avatar:f.AVATAR},docContent:t,metaTitle:{title:e.get("title"),titleModified:e.get("titleModified")},metaFixData:{docCreated:e.get("created"),cryptoKey:e.get("cryptoKey")},metaLogs:{share:e.get("shareLogs"),vector:this.mongooseAdapter.getShareVector(e)}});return this.subs[this.subs.length]=n.remoteMetadataUpdate$.subscribe(({type:e,data:t})=>{switch(e){case r.MetaDataType.Title:const{title:n,titleModified:o}=t;this.saveTitle(n,o);break;case r.MetaDataType.FixData:const{docCreated:s,cryptoKey:a}=t;this.saveFixData(s,a),this.crypto instanceof i.Symmetric&&this.crypto.importKey(a);break;case r.MetaDataType.Logs:const{share:u,vector:l}=t;this.saveLogs(u,c.isUndefined(l)?new Map:l)}}),n.messageIn$=this.message$.asObservable(),this.subs[this.subs.length]=n.messageOut$.subscribe(({streamId:e,content:t,recipientId:n})=>{e===r.Streams.DOCUMENT_CONTENT&&this.crypto&&this.crypto.state===i.KeyState.READY?this.crypto.encrypt(t).then(t=>this.send(e,t,n)).catch(e=>u.log.error("Failed to encrypt a message: ",e)):this.send(e,t,n)}),this.subs[this.subs.length]=n.remoteTextOperations$.subscribe(()=>{this.lastReceivedState=n.state}),n.memberJoin$=this.memberJoin$,n.memberLeave$=this.memberLeave$,this.subs[this.subs.length]=n.collabJoin$.subscribe(({login:e})=>{this.saveLogins(e)}),this.subs[this.subs.length]=n.remoteCollabUpdate$.subscribe(({login:e})=>this.saveLogins(e)),this.synchronize=(()=>{this.wg.members.length>1&&(this.crypto?this.crypto.state===i.KeyState.READY&&n.synchronize():n.synchronize())}),n.collabJoin$.subscribe(()=>n.synchronize()),n}initMuteCrypto(e){switch(u.log.debug("CRYPTOGRAPHY type = ",e),e){case"none":this.crypto=void 0,this.wg.onMessage=((e,t)=>{try{this.message$.next(Object.assign({senderId:e},l.Message.decode(t)))}catch(e){u.log.error("Failed to decode a message: ",e)}});break;case"metadata":this.crypto=new i.Symmetric;const t=this.crypto;this.wg.onMessage=((e,n)=>{try{const{streamId:i,content:o}=l.Message.decode(n);i===r.Streams.DOCUMENT_CONTENT?t.decrypt(o).then(t=>{this.message$.next({senderId:e,streamId:i,content:t})}).catch(e=>u.log.warn("Failed to decrypt document content: ",JSON.stringify(e))):this.message$.next({senderId:e,streamId:i,content:o})}catch(e){u.log.warn("Message from network decode error: ",e.message)}});break;case"keyagreement":this.crypto=new i.KeyAgreementBD,this.crypto.onSend=((e,t)=>this.send(t,e));const n=this.crypto;this.memberJoin$.subscribe(e=>n.addMember(e)),this.memberLeave$.subscribe(e=>n.removeMember(e)),this.state$.subscribe(e=>{e===a.WebGroupState.JOINED&&n.setReady()}),this.myId$.subscribe(e=>n.setMyId(e)),this.wg.onMessage=((e,t)=>{const{streamId:o,content:s}=l.Message.decode(t);o===i.Streams.KEY_AGREEMENT_BD?n.onMessage(e,s):o===r.Streams.DOCUMENT_CONTENT?n.decrypt(s).then(t=>this.message$.next({senderId:e,streamId:o,content:t})).catch(e=>u.log.warn("Failed to decrypt document content: ",JSON.stringify(e))):this.message$.next({senderId:e,streamId:o,content:s})});const c=new o.Subject;this.crypto.onStateChange=(e=>c.next(e)),this.subs[this.subs.length]=o.merge(c.pipe(s.filter(e=>e===i.KeyState.READY)),this.state$.pipe(s.filter(e=>e===a.WebGroupState.JOINED))).pipe(s.auditTime(1e3)).subscribe(()=>this.restartSyncInterval())}}send(e,t,n){const r=l.Message.create({streamId:e,content:t});void 0===n?this.wg.send(l.Message.encode(r).finish()):(n=0===n?this.randomMember():n,this.wg.sendTo(n,l.Message.encode(r).finish()))}randomMember(){const e=this.wg.members.filter(e=>e!==this.wg.myId);return e[Math.ceil(Math.random()*e.length)-1]}saveContent(){try{this.mongoDoc&&this.lastReceivedState&&this.lastReceivedState!==this.lastSavedState&&(this.mongoDoc.set({operations:this.lastReceivedState.remoteOperations.map(e=>({id:e.id,clock:e.clock,operation:e.operation,dependencies:Array.from(e.dependencies)}))}),this.saveDoc(),this.lastSavedState=this.lastReceivedState)}catch(e){u.log.error("Failed save the document content:",e)}}saveLogins(e){if(this.mongoDoc&&e&&"anonymous"!==e){const t=this.mongoDoc.get("logins");t.includes(e)||(t.push(e),this.mongoDoc.set({logins:t}),this.saveDoc())}}saveTitle(e,t){this.mongoDoc&&(this.mongoDoc.set({title:e,titleModified:t}),this.saveDoc())}saveFixData(e,t){this.mongoDoc&&(this.mongoDoc.set({created:e,cryptoKey:t}),this.saveDoc())}saveLogs(e,t){if(this.mongoDoc){const n=new Map;t.forEach((e,t)=>{n.set(t.toString(),e)}),this.mongoDoc.set({shareLogs:e,shareLogsVector:n}),this.saveDoc()}}async saveDoc(){this.saveChain=this.saveChain.then(async()=>{this.mongoDoc&&await this.mongoDoc.save()}).catch(e=>u.log.warn("Could not save the document: ",e))}restartSyncInterval(){this.syncDocContentInterval&&clearInterval(this.syncDocContentInterval),this.synchronize(),this.syncDocContentInterval=setInterval(()=>this.synchronize(),p)}}f.AVATAR="https://www.shareicon.net/data/256x256/2016/01/01/228083_bot_256x256.png",f.ID=9137,t.BotStorage=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),i=function(){function e(){this.subs=[]}return Object.defineProperty(e.prototype,"newSub",{set:function(e){this.subs[this.subs.length]=e},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.subs.forEach(function(e){return e.unsubscribe()})},e}(),o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function s(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var a=function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};var c,u={e:{}};function l(){try{return c.apply(this,arguments)}catch(e){return u.e=e,u}}function h(e){return c=e,l}function p(e){return"function"==typeof e}var f=!1,d={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){if(e){var t=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+t.stack)}else f&&console.log("RxJS: Back to a better error behavior. Thank you. <3");f=e},get useDeprecatedSynchronousErrorHandling(){return f}};function y(e){setTimeout(function(){throw e})}var b={closed:!0,next:function(e){},error:function(e){if(d.useDeprecatedSynchronousErrorHandling)throw e;y(e)},complete:function(){}},g=Array.isArray||function(e){return e&&"number"==typeof e.length};function m(e){return null!=e&&"object"==typeof e}function v(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}v.prototype=Object.create(Error.prototype);var w=v,S=function(){function e(e){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,e&&(this._unsubscribe=e)}var t;return e.prototype.unsubscribe=function(){var e,t=!1;if(!this.closed){var n=this._parent,r=this._parents,i=this._unsubscribe,o=this._subscriptions;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;for(var s=-1,a=r?r.length:0;n;)n.remove(this),n=++s<a&&r[s]||null;if(p(i))h(i).call(this)===u&&(t=!0,e=e||(u.e instanceof w?O(u.e.errors):[u.e]));if(g(o))for(s=-1,a=o.length;++s<a;){var c=o[s];if(m(c))if(h(c.unsubscribe).call(c)===u){t=!0,e=e||[];var l=u.e;l instanceof w?e=e.concat(O(l.errors)):e.push(l)}}if(t)throw new w(e)}},e.prototype.add=function(t){if(!t||t===e.EMPTY)return e.EMPTY;if(t===this)return this;var n=t;switch(typeof t){case"function":n=new e(t);case"object":if(n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if("function"!=typeof n._addParent){var r=n;(n=new e)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}return(this._subscriptions||(this._subscriptions=[])).push(n),n._addParent(this),n},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},e.prototype._addParent=function(e){var t=this._parent,n=this._parents;t&&t!==e?n?-1===n.indexOf(e)&&n.push(e):this._parents=[e]:this._parent=e},e.EMPTY=((t=new e).closed=!0,t),e}();function O(e){return e.reduce(function(e,t){return e.concat(t instanceof w?t.errors:t)},[])}var I="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),_=function(e){function t(n,r,i){var o=e.call(this)||this;switch(o.syncErrorValue=null,o.syncErrorThrown=!1,o.syncErrorThrowable=!1,o.isStopped=!1,o._parentSubscription=null,arguments.length){case 0:o.destination=b;break;case 1:if(!n){o.destination=b;break}if("object"==typeof n){n instanceof t?(o.syncErrorThrowable=n.syncErrorThrowable,o.destination=n,n.add(o)):(o.syncErrorThrowable=!0,o.destination=new x(o,n));break}default:o.syncErrorThrowable=!0,o.destination=new x(o,n,r,i)}return o}return s(t,e),t.prototype[I]=function(){return this},t.create=function(e,n,r){var i=new t(e,n,r);return i.syncErrorThrowable=!1,i},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parent,t=this._parents;return this._parent=null,this._parents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parent=e,this._parents=t,this._parentSubscription=null,this},t}(S),x=function(e){function t(t,n,r,i){var o,s=e.call(this)||this;s._parentSubscriber=t;var a=s;return p(n)?o=n:n&&(o=n.next,r=n.error,i=n.complete,n!==b&&(p((a=Object.create(n)).unsubscribe)&&s.add(a.unsubscribe.bind(a)),a.unsubscribe=s.unsubscribe.bind(s))),s._context=a,s._next=o,s._error=r,s._complete=i,s}return s(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;d.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,n=d.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):y(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;y(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};d.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){if(this.unsubscribe(),d.useDeprecatedSynchronousErrorHandling)throw e;y(e)}},t.prototype.__tryOrSetError=function(e,t,n){if(!d.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,n)}catch(t){return d.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=t,e.syncErrorThrown=!0,!0):(y(t),!0)}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(_),E=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.destination.next(t)},t.prototype.notifyError=function(e,t){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()},t}(_),k=function(e){function t(t,n,r){var i=e.call(this)||this;return i.parent=t,i.outerValue=n,i.outerIndex=r,i.index=0,i}return s(t,e),t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)},t.prototype._error=function(e){this.parent.notifyError(e,this),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},t}(_);var T="function"==typeof Symbol&&Symbol.observable||"@@observable";function C(){}var M=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this.operator,i=function(e,t,n){if(e){if(e instanceof _)return e;if(e[I])return e[I]()}return e||t||n?new _(e,t,n):new _(b)}(e,t,n);if(r?r.call(i,this.source):i.add(this.source||d.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),d.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){d.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),!function(e){for(;e;){var t=e,n=t.closed,r=t.destination,i=t.isStopped;if(n||i)return!1;e=r&&r instanceof _?r:null}return!0}(e)?console.warn(t):e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=j(t))(function(t,r){var i;i=n.subscribe(function(t){try{e(t)}catch(e){r(e),i&&i.unsubscribe()}},r,t)})},e.prototype._subscribe=function(e){var t=this.source;return t&&t.subscribe(e)},e.prototype[T]=function(){return this},e.prototype.pipe=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return 0===t.length?this:((e=t)?1===e.length?e[0]:function(t){return e.reduce(function(e,t){return t(e)},t)}:C)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=j(e))(function(e,n){var r;t.subscribe(function(e){return r=e},function(e){return n(e)},function(){return e(r)})})},e.create=function(t){return new e(t)},e}();function j(e){if(e||(e=d.Promise||Promise),!e)throw new Error("no Promise impl found");return e}var N=function(e){return function(t){for(var n=0,r=e.length;n<r&&!t.closed;n++)t.next(e[n]);t.closed||t.complete()}};var P="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";var A=function(e){if(e instanceof M)return function(t){return e._isScalar?(t.next(e.value),void t.complete()):e.subscribe(t)};if(e&&"function"==typeof e[T])return i=e,function(e){var t=i[T]();if("function"!=typeof t.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return t.subscribe(e)};if((r=e)&&"number"==typeof r.length&&"function"!=typeof r)return N(e);if(function(e){return e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}(e))return n=e,function(e){return n.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,y),e};if(e&&"function"==typeof e[P])return t=e,function(e){for(var n=t[P]();;){var r=n.next();if(r.done){e.complete();break}if(e.next(r.value),e.closed)break}return"function"==typeof n.return&&e.add(function(){n.return&&n.return()}),e};var t,n,r,i,o=m(e)?"an invalid object":"'"+e+"'";throw new TypeError("You provided "+o+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function R(e,t,n,r,i){if(void 0===i&&(i=new k(e,n,r)),!i.closed)return A(t)(i)}!function(e){function t(t,n){var r=e.call(this,t)||this;return r.durationSelector=n,r.hasValue=!1,r}s(t,e),t.prototype._next=function(e){if(this.value=e,this.hasValue=!0,!this.throttled){var t=h(this.durationSelector)(e);if(t===u)this.destination.error(u.e);else{var n=R(this,t);!n||n.closed?this.clearThrottle():this.add(this.throttled=n)}}},t.prototype.clearThrottle=function(){var e=this.value,t=this.hasValue,n=this.throttled;n&&(this.remove(n),this.throttled=null,n.unsubscribe()),t&&(this.value=null,this.hasValue=!1,this.destination.next(e))},t.prototype.notifyNext=function(e,t,n,r){this.clearThrottle()},t.prototype.notifyComplete=function(){this.clearThrottle()}}(E);var L=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return s(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e;var n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(r,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return t;clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n=!1,r=void 0;try{this.work(e)}catch(e){n=!0,r=!!e&&e||new Error(e)}if(n)return this.unsubscribe(),r},t.prototype._unsubscribe=function(){var e=this.id,t=this.scheduler,n=t.actions,r=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null},t}(function(e){function t(t,n){return e.call(this)||this}return s(t,e),t.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},t}(S)),B=function(){function e(t,n){void 0===n&&(n=e.now),this.SchedulerAction=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(n,t)},e.now=function(){return Date.now()},e}(),D=function(e){function t(n,r){void 0===r&&(r=B.now);var i=e.call(this,n,function(){return t.delegate&&t.delegate!==i?t.delegate.now():r()})||this;return i.actions=[],i.active=!1,i.scheduled=void 0,i}return s(t,e),t.prototype.schedule=function(n,r,i){return void 0===r&&(r=0),t.delegate&&t.delegate!==this?t.delegate.schedule(n,r,i):e.prototype.schedule.call(this,n,r,i)},t.prototype.flush=function(e){var t=this.actions;if(this.active)t.push(e);else{var n;this.active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(B);new D(L);(function(e){function t(t,n){var r=e.call(this,t)||this;return r.buffer=[],r.add(R(r,n)),r}s(t,e),t.prototype._next=function(e){this.buffer.push(e)},t.prototype.notifyNext=function(e,t,n,r,i){var o=this.buffer;this.buffer=[],this.destination.next(o)}})(E),function(e){function t(t,n){var r=e.call(this,t)||this;return r.bufferSize=n,r.buffer=[],r}s(t,e),t.prototype._next=function(e){var t=this.buffer;t.push(e),t.length==this.bufferSize&&(this.destination.next(t),this.buffer=[])},t.prototype._complete=function(){var t=this.buffer;t.length>0&&this.destination.next(t),e.prototype._complete.call(this)}}(_),function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.bufferSize=n,i.startBufferEvery=r,i.buffers=[],i.count=0,i}s(t,e),t.prototype._next=function(e){var t=this.bufferSize,n=this.startBufferEvery,r=this.buffers,i=this.count;this.count++,i%n==0&&r.push([]);for(var o=r.length;o--;){var s=r[o];s.push(e),s.length===t&&(r.splice(o,1),this.destination.next(s))}},t.prototype._complete=function(){for(var t=this.buffers,n=this.destination;t.length>0;){var r=t.shift();r.length>0&&n.next(r)}e.prototype._complete.call(this)}}(_);var U=function(){return function(){this.buffer=[]}}();!function(e){function t(t,n,r,i,o){var s=e.call(this,t)||this;s.bufferTimeSpan=n,s.bufferCreationInterval=r,s.maxBufferSize=i,s.scheduler=o,s.contexts=[];var a=s.openContext();if(s.timespanOnly=null==r||r<0,s.timespanOnly){var c={subscriber:s,context:a,bufferTimeSpan:n};s.add(a.closeAction=o.schedule(F,n,c))}else{var u={subscriber:s,context:a},l={bufferTimeSpan:n,bufferCreationInterval:r,subscriber:s,scheduler:o};s.add(a.closeAction=o.schedule(G,n,u)),s.add(o.schedule(z,r,l))}return s}s(t,e),t.prototype._next=function(e){for(var t,n=this.contexts,r=n.length,i=0;i<r;i++){var o=n[i],s=o.buffer;s.push(e),s.length==this.maxBufferSize&&(t=o)}t&&this.onBufferFull(t)},t.prototype._error=function(t){this.contexts.length=0,e.prototype._error.call(this,t)},t.prototype._complete=function(){for(var t=this.contexts,n=this.destination;t.length>0;){var r=t.shift();n.next(r.buffer)}e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){this.contexts=null},t.prototype.onBufferFull=function(e){this.closeContext(e);var t=e.closeAction;if(t.unsubscribe(),this.remove(t),!this.closed&&this.timespanOnly){e=this.openContext();var n=this.bufferTimeSpan,r={subscriber:this,context:e,bufferTimeSpan:n};this.add(e.closeAction=this.scheduler.schedule(F,n,r))}},t.prototype.openContext=function(){var e=new U;return this.contexts.push(e),e},t.prototype.closeContext=function(e){this.destination.next(e.buffer);var t=this.contexts;(t?t.indexOf(e):-1)>=0&&t.splice(t.indexOf(e),1)}}(_);function F(e){var t=e.subscriber,n=e.context;n&&t.closeContext(n),t.closed||(e.context=t.openContext(),e.context.closeAction=this.schedule(e,e.bufferTimeSpan))}function z(e){var t=e.bufferCreationInterval,n=e.bufferTimeSpan,r=e.subscriber,i=e.scheduler,o=r.openContext();r.closed||(r.add(o.closeAction=i.schedule(G,n,{subscriber:r,context:o})),this.schedule(e,t))}function G(e){var t=e.subscriber,n=e.context;t.closeContext(n)}(function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.openings=n,i.closingSelector=r,i.contexts=[],i.add(R(i,n)),i}s(t,e),t.prototype._next=function(e){for(var t=this.contexts,n=t.length,r=0;r<n;r++)t[r].buffer.push(e)},t.prototype._error=function(t){for(var n=this.contexts;n.length>0;){var r=n.shift();r.subscription.unsubscribe(),r.buffer=null,r.subscription=null}this.contexts=null,e.prototype._error.call(this,t)},t.prototype._complete=function(){for(var t=this.contexts;t.length>0;){var n=t.shift();this.destination.next(n.buffer),n.subscription.unsubscribe(),n.buffer=null,n.subscription=null}this.contexts=null,e.prototype._complete.call(this)},t.prototype.notifyNext=function(e,t,n,r,i){e?this.closeBuffer(e):this.openBuffer(t)},t.prototype.notifyComplete=function(e){this.closeBuffer(e.context)},t.prototype.openBuffer=function(e){try{var t=this.closingSelector.call(this,e);t&&this.trySubscribe(t)}catch(e){this._error(e)}},t.prototype.closeBuffer=function(e){var t=this.contexts;if(t&&e){var n=e.buffer,r=e.subscription;this.destination.next(n),t.splice(t.indexOf(e),1),this.remove(r),r.unsubscribe()}},t.prototype.trySubscribe=function(e){var t=this.contexts,n=new S,r={buffer:[],subscription:n};t.push(r);var i=R(this,e,r);!i||i.closed?this.closeBuffer(r):(i.context=r,this.add(i),n.add(i))}})(E),function(e){function t(t,n){var r=e.call(this,t)||this;return r.closingSelector=n,r.subscribing=!1,r.openBuffer(),r}s(t,e),t.prototype._next=function(e){this.buffer.push(e)},t.prototype._complete=function(){var t=this.buffer;t&&this.destination.next(t),e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){this.buffer=null,this.subscribing=!1},t.prototype.notifyNext=function(e,t,n,r,i){this.openBuffer()},t.prototype.notifyComplete=function(){this.subscribing?this.complete():this.openBuffer()},t.prototype.openBuffer=function(){var e=this.closingSubscription;e&&(this.remove(e),e.unsubscribe());var t=this.buffer;this.buffer&&this.destination.next(t),this.buffer=[];var n=h(this.closingSelector)();n===u?this.error(u.e):(e=new S,this.closingSubscription=e,this.add(e),this.subscribing=!0,e.add(R(this,n)),this.subscribing=!1)}}(E),function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.selector=n,i.caught=r,i}s(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=void 0;try{n=this.selector(t,this.caught)}catch(t){return void e.prototype.error.call(this,t)}this._unsubscribeAndRecycle();var r=new k(this,void 0,void 0);this.add(r),R(this,n,void 0,void 0,r)}}}(E);function $(e,t){return new M(t?function(n){var r=new S,i=0;return r.add(t.schedule(function(){i!==e.length?(n.next(e[i++]),n.closed||r.add(this.schedule())):n.complete()})),r}:N(e))}var q={},W=(function(e){function t(t,n){var r=e.call(this,t)||this;return r.resultSelector=n,r.active=0,r.values=[],r.observables=[],r}s(t,e),t.prototype._next=function(e){this.values.push(q),this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.active=t,this.toRespond=t;for(var n=0;n<t;n++){var r=e[n];this.add(R(this,r,r,n))}}},t.prototype.notifyComplete=function(e){0==(this.active-=1)&&this.destination.complete()},t.prototype.notifyNext=function(e,t,n,r,i){var o=this.values,s=o[n],a=this.toRespond?s===q?--this.toRespond:this.toRespond:0;o[n]=t,0===a&&(this.resultSelector?this._tryResultSelector(o):this.destination.next(o.slice()))},t.prototype._tryResultSelector=function(e){var t;try{t=this.resultSelector.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)}}(E),new M(function(e){return e.complete()}));function V(e){return e?function(e){return new M(function(t){return e.schedule(function(){return t.complete()})})}(e):W}function H(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n,r=e[e.length-1];switch((n=r)&&"function"==typeof n.schedule?e.pop():r=void 0,e.length){case 0:return V(r);case 1:return r?$(e,r):function(e){var t=new M(function(t){t.next(e),t.complete()});return t._isScalar=!0,t.value=e,t}(e[0]);default:return $(e,r)}}var K=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new J(e,this.project,this.thisArg))},e}(),J=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.project=n,i.count=0,i.thisArg=r||i,i}return s(t,e),t.prototype._next=function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(_);!function(e){function t(t,n,r){void 0===r&&(r=Number.POSITIVE_INFINITY);var i=e.call(this,t)||this;return i.project=n,i.concurrent=r,i.hasCompleted=!1,i.buffer=[],i.active=0,i.index=0,i}s(t,e),t.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},t.prototype._tryNext=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(e){return void this.destination.error(e)}this.active++,this._innerSub(t,e,n)},t.prototype._innerSub=function(e,t,n){var r=new k(this,void 0,void 0);this.destination.add(r),R(this,e,t,n,r)},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e,t,n,r,i){this.destination.next(t)},t.prototype.notifyComplete=function(e){var t=this.buffer;this.remove(e),this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}(E);function X(e){return e}(function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.predicate=n,i.source=r,i.count=0,i.index=0,i}s(t,e),t.prototype._next=function(e){this.predicate?this._tryPredicate(e):this.count++},t.prototype._tryPredicate=function(e){var t;try{t=this.predicate(e,this.index++,this.source)}catch(e){return void this.destination.error(e)}t&&this.count++},t.prototype._complete=function(){this.destination.next(this.count),this.destination.complete()}})(_),function(e){function t(t,n){var r=e.call(this,t)||this;return r.durationSelector=n,r.hasValue=!1,r.durationSubscription=null,r}s(t,e),t.prototype._next=function(e){try{var t=this.durationSelector.call(this,e);t&&this._tryNext(e,t)}catch(e){this.destination.error(e)}},t.prototype._complete=function(){this.emitValue(),this.destination.complete()},t.prototype._tryNext=function(e,t){var n=this.durationSubscription;this.value=e,this.hasValue=!0,n&&(n.unsubscribe(),this.remove(n)),(n=R(this,t))&&!n.closed&&this.add(this.durationSubscription=n)},t.prototype.notifyNext=function(e,t,n,r,i){this.emitValue()},t.prototype.notifyComplete=function(){this.emitValue()},t.prototype.emitValue=function(){if(this.hasValue){var t=this.value,n=this.durationSubscription;n&&(this.durationSubscription=null,n.unsubscribe(),this.remove(n)),this.value=null,this.hasValue=!1,e.prototype._next.call(this,t)}}}(E),function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.dueTime=n,i.scheduler=r,i.debouncedSubscription=null,i.lastValue=null,i.hasValue=!1,i}s(t,e),t.prototype._next=function(e){this.clearDebounce(),this.lastValue=e,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(Z,this.dueTime,this))},t.prototype._complete=function(){this.debouncedNext(),this.destination.complete()},t.prototype.debouncedNext=function(){if(this.clearDebounce(),this.hasValue){var e=this.lastValue;this.lastValue=null,this.hasValue=!1,this.destination.next(e)}},t.prototype.clearDebounce=function(){var e=this.debouncedSubscription;null!==e&&(this.remove(e),e.unsubscribe(),this.debouncedSubscription=null)}}(_);function Z(e){e.debouncedNext()}var Y=function(){function e(e){this.defaultValue=e}return e.prototype.call=function(e,t){return t.subscribe(new Q(e,this.defaultValue))},e}(),Q=function(e){function t(t,n){var r=e.call(this,t)||this;return r.defaultValue=n,r.isEmpty=!0,r}return s(t,e),t.prototype._next=function(e){this.isEmpty=!1,this.destination.next(e)},t.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},t}(_);function ee(e){var t=e.error;e.subscriber.error(t)}var te=function(){function e(e,t,n){this.kind=e,this.value=t,this.error=n,this.hasValue="N"===e}return e.prototype.observe=function(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}},e.prototype.do=function(e,t,n){switch(this.kind){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return n&&n()}},e.prototype.accept=function(e,t,n){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,n)},e.prototype.toObservable=function(){var e,t;switch(this.kind){case"N":return H(this.value);case"E":return e=this.error,new M(t?function(n){return t.schedule(ee,0,{error:e,subscriber:n})}:function(t){return t.error(e)});case"C":return V()}throw new Error("unexpected notification kind value")},e.createNext=function(t){return void 0!==t?new e("N",t):e.undefinedValueNotification},e.createError=function(t){return new e("E",void 0,t)},e.createComplete=function(){return e.completeNotification},e.completeNotification=new e("C"),e.undefinedValueNotification=new e("N",void 0),e}(),ne=(function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.delay=n,i.scheduler=r,i.queue=[],i.active=!1,i.errored=!1,i}s(t,e),t.dispatch=function(e){for(var t=e.source,n=t.queue,r=e.scheduler,i=e.destination;n.length>0&&n[0].time-r.now()<=0;)n.shift().notification.observe(i);if(n.length>0){var o=Math.max(0,n[0].time-r.now());this.schedule(e,o)}else this.unsubscribe(),t.active=!1},t.prototype._schedule=function(e){this.active=!0,this.destination.add(e.schedule(t.dispatch,this.delay,{source:this,destination:this.destination,scheduler:e}))},t.prototype.scheduleNotification=function(e){if(!0!==this.errored){var t=this.scheduler,n=new ne(t.now()+this.delay,e);this.queue.push(n),!1===this.active&&this._schedule(t)}},t.prototype._next=function(e){this.scheduleNotification(te.createNext(e))},t.prototype._error=function(e){this.errored=!0,this.queue=[],this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.scheduleNotification(te.createComplete()),this.unsubscribe()}}(_),function(){return function(e,t){this.time=e,this.notification=t}}()),re=(function(e){function t(t,n){var r=e.call(this,t)||this;return r.delayDurationSelector=n,r.completed=!1,r.delayNotifierSubscriptions=[],r.index=0,r}s(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.destination.next(e),this.removeSubscription(i),this.tryComplete()},t.prototype.notifyError=function(e,t){this._error(e)},t.prototype.notifyComplete=function(e){var t=this.removeSubscription(e);t&&this.destination.next(t),this.tryComplete()},t.prototype._next=function(e){var t=this.index++;try{var n=this.delayDurationSelector(e,t);n&&this.tryDelay(n,e)}catch(e){this.destination.error(e)}},t.prototype._complete=function(){this.completed=!0,this.tryComplete(),this.unsubscribe()},t.prototype.removeSubscription=function(e){e.unsubscribe();var t=this.delayNotifierSubscriptions.indexOf(e);return-1!==t&&this.delayNotifierSubscriptions.splice(t,1),e.outerValue},t.prototype.tryDelay=function(e,t){var n=R(this,e,t);n&&!n.closed&&(this.destination.add(n),this.delayNotifierSubscriptions.push(n))},t.prototype.tryComplete=function(){this.completed&&0===this.delayNotifierSubscriptions.length&&this.destination.complete()}}(E),function(e){function t(t,n){var r=e.call(this)||this;return r.source=t,r.subscriptionDelay=n,r}s(t,e),t.prototype._subscribe=function(e){this.subscriptionDelay.subscribe(new re(e,this.source))}}(M),function(e){function t(t,n){var r=e.call(this)||this;return r.parent=t,r.source=n,r.sourceSubscribed=!1,r}return s(t,e),t.prototype._next=function(e){this.subscribeToSource()},t.prototype._error=function(e){this.unsubscribe(),this.parent.error(e)},t.prototype._complete=function(){this.unsubscribe(),this.subscribeToSource()},t.prototype.subscribeToSource=function(){this.sourceSubscribed||(this.sourceSubscribed=!0,this.unsubscribe(),this.source.subscribe(this.parent))},t}(_));(function(e){function t(t){return e.call(this,t)||this}s(t,e),t.prototype._next=function(e){e.observe(this.destination)}})(_),function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.keySelector=n,i.values=new Set,r&&i.add(R(i,r)),i}s(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.values.clear()},t.prototype.notifyError=function(e,t){this._error(e)},t.prototype._next=function(e){this.keySelector?this._useKeySelector(e):this._finalizeNext(e,e)},t.prototype._useKeySelector=function(e){var t,n=this.destination;try{t=this.keySelector(e)}catch(e){return void n.error(e)}this._finalizeNext(t,e)},t.prototype._finalizeNext=function(e,t){var n=this.values;n.has(e)||(n.add(e),this.destination.next(t))}}(E),function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.keySelector=r,i.hasKey=!1,"function"==typeof n&&(i.compare=n),i}s(t,e),t.prototype.compare=function(e,t){return e===t},t.prototype._next=function(e){var t=e;if(this.keySelector&&(t=h(this.keySelector)(e))===u)return this.destination.error(u.e);var n=!1;if(this.hasKey){if((n=h(this.compare)(this.key,t))===u)return this.destination.error(u.e)}else this.hasKey=!0;!1===Boolean(n)&&(this.key=t,this.destination.next(e))}}(_);function ie(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}ie.prototype=Object.create(Error.prototype);var oe=ie;function se(e,t){return function(n){return n.lift(new ae(e,t))}}var ae=function(){function e(e,t){this.predicate=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new ce(e,this.predicate,this.thisArg))},e}(),ce=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.predicate=n,i.thisArg=r,i.count=0,i}return s(t,e),t.prototype._next=function(e){var t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}t&&this.destination.next(e)},t}(_);var ue=function(){function e(e,t,n){this.nextOrObserver=e,this.error=t,this.complete=n}return e.prototype.call=function(e,t){return t.subscribe(new le(e,this.nextOrObserver,this.error,this.complete))},e}(),le=function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o._tapNext=C,o._tapError=C,o._tapComplete=C,o._tapError=r||C,o._tapComplete=i||C,p(n)?(o._context=o,o._tapNext=n):n&&(o._context=n,o._tapNext=n.next||C,o._tapError=n.error||C,o._tapComplete=n.complete||C),o}return s(t,e),t.prototype._next=function(e){try{this._tapNext.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.next(e)},t.prototype._error=function(e){try{this._tapError.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.error(e)},t.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()},t}(_);function he(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}he.prototype=Object.create(Error.prototype);var pe=he,fe=function(e){return void 0===e&&(e=de),t={hasValue:!1,next:function(){this.hasValue=!0},complete:function(){if(!this.hasValue)throw e()}},function(e){return e.lift(new ue(t,n,r))};var t,n,r};function de(){return new pe}var ye=function(){function e(e){if(this.total=e,this.total<0)throw new oe}return e.prototype.call=function(e,t){return t.subscribe(new be(e,this.total))},e}(),be=function(e){function t(t,n){var r=e.call(this,t)||this;return r.total=n,r.count=0,r}return s(t,e),t.prototype._next=function(e){var t=this.total,n=++this.count;n<=t&&(this.destination.next(e),n===t&&(this.destination.complete(),this.unsubscribe()))},t}(_);(function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o.predicate=n,o.thisArg=r,o.source=i,o.index=0,o.thisArg=r||o,o}s(t,e),t.prototype.notifyComplete=function(e){this.destination.next(e),this.destination.complete()},t.prototype._next=function(e){var t=!1;try{t=this.predicate.call(this.thisArg,e,this.index++,this.source)}catch(e){return void this.destination.error(e)}t||this.notifyComplete(!1)},t.prototype._complete=function(){this.notifyComplete(!0)}})(_),function(e){function t(t){var n=e.call(this,t)||this;return n.hasCompleted=!1,n.hasSubscription=!1,n}s(t,e),t.prototype._next=function(e){this.hasSubscription||(this.hasSubscription=!0,this.add(R(this,e)))},t.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete()},t.prototype.notifyComplete=function(e){this.remove(e),this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()}}(E),function(e){function t(t,n){var r=e.call(this,t)||this;return r.project=n,r.hasSubscription=!1,r.hasCompleted=!1,r.index=0,r}s(t,e),t.prototype._next=function(e){this.hasSubscription||this.tryNext(e)},t.prototype.tryNext=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(e){return void this.destination.error(e)}this.hasSubscription=!0,this._innerSub(t,e,n)},t.prototype._innerSub=function(e,t,n){var r=new k(this,void 0,void 0);this.destination.add(r),R(this,e,t,n,r)},t.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e,t,n,r,i){this.destination.next(t)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.remove(e),this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()}}(E),function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o.project=n,o.concurrent=r,o.scheduler=i,o.index=0,o.active=0,o.hasCompleted=!1,r<Number.POSITIVE_INFINITY&&(o.buffer=[]),o}s(t,e),t.dispatch=function(e){var t=e.subscriber,n=e.result,r=e.value,i=e.index;t.subscribeToProjection(n,r,i)},t.prototype._next=function(e){var n=this.destination;if(n.closed)this._complete();else{var r=this.index++;if(this.active<this.concurrent){n.next(e);var i=h(this.project)(e,r);if(i===u)n.error(u.e);else if(this.scheduler){var o={subscriber:this,result:i,value:e,index:r};this.destination.add(this.scheduler.schedule(t.dispatch,0,o))}else this.subscribeToProjection(i,e,r)}else this.buffer.push(e)}},t.prototype.subscribeToProjection=function(e,t,n){this.active++,this.destination.add(R(this,e,t,n))},t.prototype._complete=function(){this.hasCompleted=!0,this.hasCompleted&&0===this.active&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e,t,n,r,i){this._next(t)},t.prototype.notifyComplete=function(e){var t=this.buffer;this.destination.remove(e),this.active--,t&&t.length>0&&this._next(t.shift()),this.hasCompleted&&0===this.active&&this.destination.complete()}}(E),function(e){function t(t,n){var r=e.call(this,t)||this;return r.add(new S(n)),r}s(t,e)}(_),function(e){function t(t,n,r,i,o){var s=e.call(this,t)||this;return s.predicate=n,s.source=r,s.yieldIndex=i,s.thisArg=o,s.index=0,s}s(t,e),t.prototype.notifyComplete=function(e){var t=this.destination;t.next(e),t.complete(),this.unsubscribe()},t.prototype._next=function(e){var t=this.predicate,n=this.thisArg,r=this.index++;try{t.call(n||this,e,r,this.source)&&this.notifyComplete(this.yieldIndex?r:e)}catch(e){this.destination.error(e)}},t.prototype._complete=function(){this.notifyComplete(this.yieldIndex?-1:void 0)}}(_);function ge(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?se(function(t,n){return e(t,n,r)}):X,(i=1,function(e){return 0===i?V():e.lift(new ye(i))}),n?function(e){return void 0===e&&(e=null),function(t){return t.lift(new Y(e))}}(t):fe(function(){return new pe}));var i}}function me(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}me.prototype=Object.create(Error.prototype);var ve=me,we=function(e){function t(t,n){var r=e.call(this)||this;return r.subject=t,r.subscriber=n,r.closed=!1,r}return s(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var n=t.indexOf(this.subscriber);-1!==n&&t.splice(n,1)}}},t}(S),Se=function(e){function t(t){var n=e.call(this,t)||this;return n.destination=t,n}return s(t,e),t}(_),Oe=function(e){function t(){var t=e.call(this)||this;return t.observers=[],t.closed=!1,t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return s(t,e),t.prototype[I]=function(){return new Se(this)},t.prototype.lift=function(e){var t=new Ie(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new ve;if(!this.isStopped)for(var t=this.observers,n=t.length,r=t.slice(),i=0;i<n;i++)r[i].next(e)},t.prototype.error=function(e){if(this.closed)throw new ve;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,n=t.length,r=t.slice(),i=0;i<n;i++)r[i].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new ve;this.isStopped=!0;for(var e=this.observers,t=e.length,n=e.slice(),r=0;r<t;r++)n[r].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new ve;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new ve;return this.hasError?(e.error(this.thrownError),S.EMPTY):this.isStopped?(e.complete(),S.EMPTY):(this.observers.push(e),new we(this,e))},t.prototype.asObservable=function(){var e=new M;return e.source=this,e},t.create=function(e,t){return new Ie(e,t)},t}(M),Ie=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return s(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){return this.source?this.source.subscribe(e):S.EMPTY},t}(Oe),_e=(function(e){function t(t,n,r,i,o){var s=e.call(this,t)||this;return s.keySelector=n,s.elementSelector=r,s.durationSelector=i,s.subjectSelector=o,s.groups=null,s.attemptedToUnsubscribe=!1,s.count=0,s}s(t,e),t.prototype._next=function(e){var t;try{t=this.keySelector(e)}catch(e){return void this.error(e)}this._group(e,t)},t.prototype._group=function(e,t){var n=this.groups;n||(n=this.groups=new Map);var r,i=n.get(t);if(this.elementSelector)try{r=this.elementSelector(e)}catch(e){this.error(e)}else r=e;if(!i){i=this.subjectSelector?this.subjectSelector():new Oe,n.set(t,i);var o=new xe(t,i,this);if(this.destination.next(o),this.durationSelector){var s=void 0;try{s=this.durationSelector(new xe(t,i))}catch(e){return void this.error(e)}this.add(s.subscribe(new _e(t,i,this)))}}i.closed||i.next(r)},t.prototype._error=function(e){var t=this.groups;t&&(t.forEach(function(t,n){t.error(e)}),t.clear()),this.destination.error(e)},t.prototype._complete=function(){var e=this.groups;e&&(e.forEach(function(e,t){e.complete()}),e.clear()),this.destination.complete()},t.prototype.removeGroup=function(e){this.groups.delete(e)},t.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,0===this.count&&e.prototype.unsubscribe.call(this))}}(_),function(e){function t(t,n,r){var i=e.call(this,n)||this;return i.key=t,i.group=n,i.parent=r,i}return s(t,e),t.prototype._next=function(e){this.complete()},t.prototype._unsubscribe=function(){var e=this.parent,t=this.key;this.key=this.parent=null,e&&e.removeGroup(t)},t}(_)),xe=function(e){function t(t,n,r){var i=e.call(this)||this;return i.key=t,i.groupSubject=n,i.refCountSubscription=r,i}return s(t,e),t.prototype._subscribe=function(e){var t=new S,n=this.refCountSubscription,r=this.groupSubject;return n&&!n.closed&&t.add(new Ee(n)),t.add(r.subscribe(e)),t},t}(M),Ee=function(e){function t(t){var n=e.call(this)||this;return n.parent=t,t.count++,n}return s(t,e),t.prototype.unsubscribe=function(){var t=this.parent;t.closed||this.closed||(e.prototype.unsubscribe.call(this),t.count-=1,0===t.count&&t.attemptedToUnsubscribe&&t.unsubscribe())},t}(S);(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}s(t,e),t.prototype._next=function(e){}})(_),function(e){function t(t){return e.call(this,t)||this}s(t,e),t.prototype.notifyComplete=function(e){var t=this.destination;t.next(e),t.complete()},t.prototype._next=function(e){this.notifyComplete(!1)},t.prototype._complete=function(){this.notifyComplete(!0)}}(_),function(e){function t(t,n){var r=e.call(this,t)||this;return r.total=n,r.ring=new Array,r.count=0,r}s(t,e),t.prototype._next=function(e){var t=this.ring,n=this.total,r=this.count++;t.length<n?t.push(e):t[r%n]=e},t.prototype._complete=function(){var e=this.destination,t=this.count;if(t>0)for(var n=this.count>=this.total?this.total:this.count,r=this.ring,i=0;i<n;i++){var o=t++%n;e.next(r[o])}e.complete()}}(_),function(e){function t(t,n){var r=e.call(this,t)||this;return r.value=n,r}s(t,e),t.prototype._next=function(e){this.destination.next(this.value)}}(_),function(e){function t(t){return e.call(this,t)||this}s(t,e),t.prototype._next=function(e){this.destination.next(te.createNext(e))},t.prototype._error=function(e){var t=this.destination;t.next(te.createError(e)),t.complete()},t.prototype._complete=function(){var e=this.destination;e.next(te.createComplete()),e.complete()}}(_),function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o.accumulator=n,o._seed=r,o.hasSeed=i,o.index=0,o}s(t,e),Object.defineProperty(t.prototype,"seed",{get:function(){return this._seed},set:function(e){this.hasSeed=!0,this._seed=e},enumerable:!0,configurable:!0}),t.prototype._next=function(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)},t.prototype._tryNext=function(e){var t,n=this.index++;try{t=this.accumulator(this.seed,e,n)}catch(e){this.destination.error(e)}this.seed=t,this.destination.next(t)}}(_),function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o.accumulator=n,o.acc=r,o.concurrent=i,o.hasValue=!1,o.hasCompleted=!1,o.buffer=[],o.active=0,o.index=0,o}s(t,e),t.prototype._next=function(e){if(this.active<this.concurrent){var t=this.index++,n=h(this.accumulator)(this.acc,e),r=this.destination;n===u?r.error(u.e):(this.active++,this._innerSub(n,e,t))}else this.buffer.push(e)},t.prototype._innerSub=function(e,t,n){var r=new k(this,void 0,void 0);this.destination.add(r),R(this,e,t,n,r)},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete()),this.unsubscribe()},t.prototype.notifyNext=function(e,t,n,r,i){var o=this.destination;this.acc=t,this.hasValue=!0,o.next(t)},t.prototype.notifyComplete=function(e){var t=this.buffer;this.destination.remove(e),this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete())}}(E);var ke=function(){function e(e){this.connectable=e}return e.prototype.call=function(e,t){var n=this.connectable;n._refCount++;var r=new Te(e,n),i=t.subscribe(r);return r.closed||(r.connection=n.connect()),i},e}(),Te=function(e){function t(t,n){var r=e.call(this,t)||this;return r.connectable=n,r}return s(t,e),t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;if(t<=0)this.connection=null;else if(e._refCount=t-1,t>1)this.connection=null;else{var n=this.connection,r=e._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}else this.connection=null},t}(_),Ce=function(e){function t(t,n){var r=e.call(this)||this;return r.source=t,r.subjectFactory=n,r._refCount=0,r._isComplete=!1,r}return s(t,e),t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject},t.prototype.connect=function(){var e=this._connection;return e||(this._isComplete=!1,(e=this._connection=new S).add(this.source.subscribe(new Me(this.getSubject(),this))),e.closed?(this._connection=null,e=S.EMPTY):this._connection=e),e},t.prototype.refCount=function(){return(e=this).lift(new ke(e));var e},t}(M).prototype,Me=(Ce._subscribe,Ce._isComplete,Ce.getSubject,Ce.connect,Ce.refCount,function(e){function t(t,n){var r=e.call(this,t)||this;return r.connectable=n,r}return s(t,e),t.prototype._error=function(t){this._unsubscribe(),e.prototype._error.call(this,t)},t.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}},t}(Se)),je=(function(e){function t(t,n){var r=e.call(this,t)||this;return r.connectable=n,r}s(t,e),t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;if(t<=0)this.connection=null;else if(e._refCount=t-1,t>1)this.connection=null;else{var n=this.connection,r=e._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}else this.connection=null}}(_),function(e){function t(t,n,r){void 0===r&&(r=0);var i=e.call(this,t)||this;return i.scheduler=n,i.delay=r,i}return s(t,e),t.dispatch=function(e){var t=e.notification,n=e.destination;t.observe(n),this.unsubscribe()},t.prototype.scheduleMessage=function(e){this.destination.add(this.scheduler.schedule(t.dispatch,this.delay,new Ne(e,this.destination)))},t.prototype._next=function(e){this.scheduleMessage(te.createNext(e))},t.prototype._error=function(e){this.scheduleMessage(te.createError(e)),this.unsubscribe()},t.prototype._complete=function(){this.scheduleMessage(te.createComplete()),this.unsubscribe()},t}(_)),Ne=function(){return function(e,t){this.notification=e,this.destination=t}}(),Pe=(function(e){function t(t,n){var r=e.call(this,t)||this;return r.destination=t,r.nextSources=n,r}s(t,e),t.prototype.notifyError=function(e,t){this.subscribeToNextSource()},t.prototype.notifyComplete=function(e){this.subscribeToNextSource()},t.prototype._error=function(e){this.subscribeToNextSource(),this.unsubscribe()},t.prototype._complete=function(){this.subscribeToNextSource(),this.unsubscribe()},t.prototype.subscribeToNextSource=function(){var e=this.nextSources.shift();if(e){var t=new k(this,void 0,void 0);this.destination.add(t),R(this,e,void 0,void 0,t)}else this.destination.complete()}}(E),function(e){function t(t){var n=e.call(this,t)||this;return n.hasPrev=!1,n}s(t,e),t.prototype._next=function(e){this.hasPrev?this.destination.next([this.prev,e]):this.hasPrev=!0,this.prev=e}}(_),function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}s(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return n&&!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new ve;return this._value},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)}}(Oe),function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.value=null,t.hasNext=!1,t.hasCompleted=!1,t}s(t,e),t.prototype._subscribe=function(t){return this.hasError?(t.error(this.thrownError),S.EMPTY):this.hasCompleted&&this.hasNext?(t.next(this.value),t.complete(),S.EMPTY):e.prototype._subscribe.call(this,t)},t.prototype.next=function(e){this.hasCompleted||(this.value=e,this.hasNext=!0)},t.prototype.error=function(t){this.hasCompleted||e.prototype.error.call(this,t)},t.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&e.prototype.next.call(this,this.value),e.prototype.complete.call(this)}}(Oe),function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return s(t,e),t.prototype.schedule=function(t,n){return void 0===n&&(n=0),n>0?e.prototype.schedule.call(this,t,n):(this.delay=n,this.state=t,this.scheduler.flush(this),this)},t.prototype.execute=function(t,n){return n>0||this.closed?e.prototype.execute.call(this,t,n):this._execute(t,n)},t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0?e.prototype.requestAsyncId.call(this,t,n,r):t.flush(this)},t}(L)),Ae=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t}(D))(Pe),Re=(function(e){function t(t,n,r){void 0===t&&(t=Number.POSITIVE_INFINITY),void 0===n&&(n=Number.POSITIVE_INFINITY);var i=e.call(this)||this;return i.scheduler=r,i._events=[],i._infiniteTimeWindow=!1,i._bufferSize=t<1?1:t,i._windowTime=n<1?1:n,n===Number.POSITIVE_INFINITY?(i._infiniteTimeWindow=!0,i.next=i.nextInfiniteTimeWindow):i.next=i.nextTimeWindow,i}s(t,e),t.prototype.nextInfiniteTimeWindow=function(t){var n=this._events;n.push(t),n.length>this._bufferSize&&n.shift(),e.prototype.next.call(this,t)},t.prototype.nextTimeWindow=function(t){this._events.push(new Re(this._getNow(),t)),this._trimBufferThenGetEvents(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){var t,n=this._infiniteTimeWindow,r=n?this._events:this._trimBufferThenGetEvents(),i=this.scheduler,o=r.length;if(this.closed)throw new ve;if(this.isStopped||this.hasError?t=S.EMPTY:(this.observers.push(e),t=new we(this,e)),i&&e.add(e=new je(e,i)),n)for(var s=0;s<o&&!e.closed;s++)e.next(r[s]);else for(s=0;s<o&&!e.closed;s++)e.next(r[s].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),t},t.prototype._getNow=function(){return(this.scheduler||Ae).now()},t.prototype._trimBufferThenGetEvents=function(){for(var e=this._getNow(),t=this._bufferSize,n=this._windowTime,r=this._events,i=r.length,o=0;o<i&&!(e-r[o].time<n);)o++;return i>t&&(o=Math.max(o,i-t)),o>0&&r.splice(0,o),r}}(Oe),function(){return function(e,t){this.time=e,this.value=t}}());(function(e){function t(t){var n=e.call(this,t)||this;return n.hasFirst=!1,n.observables=[],n.subscriptions=[],n}s(t,e),t.prototype._next=function(e){this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{for(var n=0;n<t&&!this.hasFirst;n++){var r=e[n],i=R(this,r,r,n);this.subscriptions&&this.subscriptions.push(i),this.add(i)}this.observables=null}},t.prototype.notifyNext=function(e,t,n,r,i){if(!this.hasFirst){this.hasFirst=!0;for(var o=0;o<this.subscriptions.length;o++)if(o!==n){var s=this.subscriptions[o];s.unsubscribe(),this.remove(s)}this.subscriptions=null}this.destination.next(t)}})(E),function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.count=n,i.source=r,i}s(t,e),t.prototype.complete=function(){if(!this.isStopped){var t=this.source,n=this.count;if(0===n)return e.prototype.complete.call(this);n>-1&&(this.count=n-1),t.subscribe(this._unsubscribeAndRecycle())}}}(_),function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.notifier=n,i.source=r,i.sourceIsBeingSubscribedTo=!0,i}s(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.sourceIsBeingSubscribedTo=!0,this.source.subscribe(this)},t.prototype.notifyComplete=function(t){if(!1===this.sourceIsBeingSubscribedTo)return e.prototype.complete.call(this)},t.prototype.complete=function(){if(this.sourceIsBeingSubscribedTo=!1,!this.isStopped){if(this.retries||this.subscribeToRetries(),!this.retriesSubscription||this.retriesSubscription.closed)return e.prototype.complete.call(this);this._unsubscribeAndRecycle(),this.notifications.next()}},t.prototype._unsubscribe=function(){var e=this.notifications,t=this.retriesSubscription;e&&(e.unsubscribe(),this.notifications=null),t&&(t.unsubscribe(),this.retriesSubscription=null),this.retries=null},t.prototype._unsubscribeAndRecycle=function(){var t=this._unsubscribe;return this._unsubscribe=null,e.prototype._unsubscribeAndRecycle.call(this),this._unsubscribe=t,this},t.prototype.subscribeToRetries=function(){this.notifications=new Oe;var t=h(this.notifier)(this.notifications);if(t===u)return e.prototype.complete.call(this);this.retries=t,this.retriesSubscription=R(this,t)}}(E),function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.count=n,i.source=r,i}s(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=this.source,r=this.count;if(0===r)return e.prototype.error.call(this,t);r>-1&&(this.count=r-1),n.subscribe(this._unsubscribeAndRecycle())}}}(_),function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.notifier=n,i.source=r,i}s(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=this.errors,r=this.retries,i=this.retriesSubscription;if(r)this.errors=null,this.retriesSubscription=null;else{if(n=new Oe,(r=h(this.notifier)(n))===u)return e.prototype.error.call(this,u.e);i=R(this,r)}this._unsubscribeAndRecycle(),this.errors=n,this.retries=r,this.retriesSubscription=i,n.next(t)}},t.prototype._unsubscribe=function(){var e=this.errors,t=this.retriesSubscription;e&&(e.unsubscribe(),this.errors=null),t&&(t.unsubscribe(),this.retriesSubscription=null),this.retries=null},t.prototype.notifyNext=function(e,t,n,r,i){var o=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=o,this.source.subscribe(this)}}(E),function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hasValue=!1,t}s(t,e),t.prototype._next=function(e){this.value=e,this.hasValue=!0},t.prototype.notifyNext=function(e,t,n,r,i){this.emitValue()},t.prototype.notifyComplete=function(){this.emitValue()},t.prototype.emitValue=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.value))}}(E),function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.period=n,i.scheduler=r,i.hasValue=!1,i.add(r.schedule(Le,n,{subscriber:i,period:n})),i}s(t,e),t.prototype._next=function(e){this.lastValue=e,this.hasValue=!0},t.prototype.notifyNext=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.lastValue))}}(_);function Le(e){var t=e.subscriber,n=e.period;t.notifyNext(),this.schedule(e,n)}!function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.compareTo=n,i.comparor=r,i._a=[],i._b=[],i._oneComplete=!1,i.destination.add(n.subscribe(new Be(t,i))),i}s(t,e),t.prototype._next=function(e){this._oneComplete&&0===this._b.length?this.emit(!1):(this._a.push(e),this.checkValues())},t.prototype._complete=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0,this.unsubscribe()},t.prototype.checkValues=function(){for(var e=this._a,t=this._b,n=this.comparor;e.length>0&&t.length>0;){var r=e.shift(),i=t.shift(),o=!1;n?(o=h(n)(r,i))===u&&this.destination.error(u.e):o=r===i,o||this.emit(!1)}},t.prototype.emit=function(e){var t=this.destination;t.next(e),t.complete()},t.prototype.nextB=function(e){this._oneComplete&&0===this._a.length?this.emit(!1):(this._b.push(e),this.checkValues())},t.prototype.completeB=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0}}(_);var Be=function(e){function t(t,n){var r=e.call(this,t)||this;return r.parent=n,r}return s(t,e),t.prototype._next=function(e){this.parent.nextB(e)},t.prototype._error=function(e){this.parent.error(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.completeB(),this.unsubscribe()},t}(_),De=(function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.predicate=n,i.source=r,i.seenValue=!1,i.index=0,i}s(t,e),t.prototype.applySingleValue=function(e){this.seenValue?this.destination.error("Sequence contains more than one element"):(this.seenValue=!0,this.singleValue=e)},t.prototype._next=function(e){var t=this.index++;this.predicate?this.tryNext(e,t):this.applySingleValue(e)},t.prototype.tryNext=function(e,t){try{this.predicate(e,t,this.source)&&this.applySingleValue(e)}catch(e){this.destination.error(e)}},t.prototype._complete=function(){var e=this.destination;this.index>0?(e.next(this.seenValue?this.singleValue:void 0),e.complete()):e.error(new pe)}}(_),function(e){function t(t,n){var r=e.call(this,t)||this;return r.total=n,r.count=0,r}s(t,e),t.prototype._next=function(e){++this.count>this.total&&this.destination.next(e)}}(_),function(e){function t(t,n){var r=e.call(this,t)||this;return r._skipCount=n,r._count=0,r._ring=new Array(n),r}s(t,e),t.prototype._next=function(e){var t=this._skipCount,n=this._count++;if(n<t)this._ring[n]=e;else{var r=n%t,i=this._ring,o=i[r];i[r]=e,this.destination.next(o)}}}(_),function(e){function t(t,n){var r=e.call(this,t)||this;r.hasValue=!1;var i=new k(r,void 0,void 0);return r.add(i),r.innerSubscription=i,R(r,n,void 0,void 0,i),r}s(t,e),t.prototype._next=function(t){this.hasValue&&e.prototype._next.call(this,t)},t.prototype.notifyNext=function(e,t,n,r,i){this.hasValue=!0,this.innerSubscription&&this.innerSubscription.unsubscribe()},t.prototype.notifyComplete=function(){}}(E),function(e){function t(t,n){var r=e.call(this,t)||this;return r.predicate=n,r.skipping=!0,r.index=0,r}s(t,e),t.prototype._next=function(e){var t=this.destination;this.skipping&&this.tryCallPredicate(e),this.skipping||t.next(e)},t.prototype.tryCallPredicate=function(e){try{var t=this.predicate(e,this.index++);this.skipping=Boolean(t)}catch(e){this.destination.error(e)}}}(_),1),Ue={};var Fe=function(e){var t=De++;return Ue[t]=e,Promise.resolve().then(function(){return function(e){var t=Ue[e];t&&t()}(t)}),t},ze=function(e){delete Ue[e]},Ge=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return s(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t.scheduled||(t.scheduled=Fe(t.flush.bind(t,null))))},t.prototype.recycleAsyncId=function(t,n,r){if(void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0)return e.prototype.recycleAsyncId.call(this,t,n,r);0===t.actions.length&&(ze(n),t.scheduled=void 0)},t}(L),$e=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,n=this.actions,r=-1,i=n.length;e=e||n.shift();do{if(t=e.execute(e.state,e.delay))break}while(++r<i&&(e=n.shift()));if(this.active=!1,t){for(;++r<i&&(e=n.shift());)e.unsubscribe();throw t}},t}(D))(Ge);(function(e){function t(t,n,r){void 0===n&&(n=0),void 0===r&&(r=$e);var i,o=e.call(this)||this;return o.source=t,o.delayTime=n,o.scheduler=r,(g(i=n)||!(i-parseFloat(i)+1>=0)||n<0)&&(o.delayTime=0),r&&"function"==typeof r.schedule||(o.scheduler=$e),o}s(t,e),t.create=function(e,n,r){return void 0===n&&(n=0),void 0===r&&(r=$e),new t(e,n,r)},t.dispatch=function(e){var t=e.source,n=e.subscriber;return this.add(t.subscribe(n))},t.prototype._subscribe=function(e){var n=this.delayTime,r=this.source;return this.scheduler.schedule(t.dispatch,n,{source:r,subscriber:e})}})(M),function(e){function t(t,n){var r=e.call(this,t)||this;return r.project=n,r.index=0,r}s(t,e),t.prototype._next=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(e){return void this.destination.error(e)}this._innerSub(t,e,n)},t.prototype._innerSub=function(e,t,n){var r=this.innerSubscription;r&&r.unsubscribe();var i=new k(this,void 0,void 0);this.destination.add(i),this.innerSubscription=R(this,e,t,n,i)},t.prototype._complete=function(){var t=this.innerSubscription;t&&!t.closed||e.prototype._complete.call(this),this.unsubscribe()},t.prototype._unsubscribe=function(){this.innerSubscription=null},t.prototype.notifyComplete=function(t){this.destination.remove(t),this.innerSubscription=null,this.isStopped&&e.prototype._complete.call(this)},t.prototype.notifyNext=function(e,t,n,r,i){this.destination.next(t)}}(E),function(e){function t(t){var n=e.call(this,t)||this;return n.seenValue=!1,n}s(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.seenValue=!0,this.complete()},t.prototype.notifyComplete=function(){}}(E),function(e){function t(t,n){var r=e.call(this,t)||this;return r.predicate=n,r.index=0,r}s(t,e),t.prototype._next=function(e){var t,n=this.destination;try{t=this.predicate(e,this.index++)}catch(e){return void n.error(e)}this.nextOrComplete(e,t)},t.prototype.nextOrComplete=function(e,t){var n=this.destination;Boolean(t)?n.next(e):n.complete()}}(_),function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o.destination=t,o.durationSelector=n,o._leading=r,o._trailing=i,o._hasValue=!1,o}s(t,e),t.prototype._next=function(e){this._hasValue=!0,this._sendValue=e,this._throttled||(this._leading?this.send():this.throttle(e))},t.prototype.send=function(){var e=this._hasValue,t=this._sendValue;e&&(this.destination.next(t),this.throttle(t)),this._hasValue=!1,this._sendValue=null},t.prototype.throttle=function(e){var t=this.tryDurationSelector(e);t&&this.add(this._throttled=R(this,t))},t.prototype.tryDurationSelector=function(e){try{return this.durationSelector(e)}catch(e){return this.destination.error(e),null}},t.prototype.throttlingDone=function(){var e=this._throttled,t=this._trailing;e&&e.unsubscribe(),this._throttled=null,t&&this.send()},t.prototype.notifyNext=function(e,t,n,r,i){this.throttlingDone()},t.prototype.notifyComplete=function(){this.throttlingDone()}}(E),function(e){function t(t,n,r,i,o){var s=e.call(this,t)||this;return s.duration=n,s.scheduler=r,s.leading=i,s.trailing=o,s._hasTrailingValue=!1,s._trailingValue=null,s}s(t,e),t.prototype._next=function(e){this.throttled?this.trailing&&(this._trailingValue=e,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(qe,this.duration,{subscriber:this})),this.leading&&this.destination.next(e))},t.prototype._complete=function(){this._hasTrailingValue?(this.destination.next(this._trailingValue),this.destination.complete()):this.destination.complete()},t.prototype.clearThrottle=function(){var e=this.throttled;e&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),e.unsubscribe(),this.remove(e),this.throttled=null)}}(_);function qe(e){e.subscriber.clearThrottle()}(function(e){function t(t,n,r,i,o){var s=e.call(this,t)||this;return s.absoluteTimeout=n,s.waitFor=r,s.withObservable=i,s.scheduler=o,s.action=null,s.scheduleTimeout(),s}s(t,e),t.dispatchTimeout=function(e){var t=e.withObservable;e._unsubscribeAndRecycle(),e.add(R(e,t))},t.prototype.scheduleTimeout=function(){var e=this.action;e?this.action=e.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(t.dispatchTimeout,this.waitFor,this))},t.prototype._next=function(t){this.absoluteTimeout||this.scheduleTimeout(),e.prototype._next.call(this,t)},t.prototype._unsubscribe=function(){this.action=null,this.scheduler=null,this.withObservable=null}})(E),function(e){function t(t){var n=e.call(this,t)||this;return n.window=new Oe,t.next(n.window),n}s(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.openWindow()},t.prototype.notifyError=function(e,t){this._error(e)},t.prototype.notifyComplete=function(e){this._complete()},t.prototype._next=function(e){this.window.next(e)},t.prototype._error=function(e){this.window.error(e),this.destination.error(e)},t.prototype._complete=function(){this.window.complete(),this.destination.complete()},t.prototype._unsubscribe=function(){this.window=null},t.prototype.openWindow=function(){var e=this.window;e&&e.complete();var t=this.destination,n=this.window=new Oe;t.next(n)}}(E),function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.destination=t,i.windowSize=n,i.startWindowEvery=r,i.windows=[new Oe],i.count=0,t.next(i.windows[0]),i}s(t,e),t.prototype._next=function(e){for(var t=this.startWindowEvery>0?this.startWindowEvery:this.windowSize,n=this.destination,r=this.windowSize,i=this.windows,o=i.length,s=0;s<o&&!this.closed;s++)i[s].next(e);var a=this.count-r+1;if(a>=0&&a%t==0&&!this.closed&&i.shift().complete(),++this.count%t==0&&!this.closed){var c=new Oe;i.push(c),n.next(c)}},t.prototype._error=function(e){var t=this.windows;if(t)for(;t.length>0&&!this.closed;)t.shift().error(e);this.destination.error(e)},t.prototype._complete=function(){var e=this.windows;if(e)for(;e.length>0&&!this.closed;)e.shift().complete();this.destination.complete()},t.prototype._unsubscribe=function(){this.count=0,this.windows=null}}(_);var We=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._numberOfNextedValues=0,t}return s(t,e),t.prototype.next=function(t){this._numberOfNextedValues++,e.prototype.next.call(this,t)},Object.defineProperty(t.prototype,"numberOfNextedValues",{get:function(){return this._numberOfNextedValues},enumerable:!0,configurable:!0}),t}(Oe);!function(e){function t(t,n,r,i,o){var s=e.call(this,t)||this;s.destination=t,s.windowTimeSpan=n,s.windowCreationInterval=r,s.maxWindowSize=i,s.scheduler=o,s.windows=[];var a=s.openWindow();if(null!==r&&r>=0){var c={subscriber:s,window:a,context:null},u={windowTimeSpan:n,windowCreationInterval:r,subscriber:s,scheduler:o};s.add(o.schedule(Ke,n,c)),s.add(o.schedule(He,r,u))}else{var l={subscriber:s,window:a,windowTimeSpan:n};s.add(o.schedule(Ve,n,l))}return s}s(t,e),t.prototype._next=function(e){for(var t=this.windows,n=t.length,r=0;r<n;r++){var i=t[r];i.closed||(i.next(e),i.numberOfNextedValues>=this.maxWindowSize&&this.closeWindow(i))}},t.prototype._error=function(e){for(var t=this.windows;t.length>0;)t.shift().error(e);this.destination.error(e)},t.prototype._complete=function(){for(var e=this.windows;e.length>0;){var t=e.shift();t.closed||t.complete()}this.destination.complete()},t.prototype.openWindow=function(){var e=new We;return this.windows.push(e),this.destination.next(e),e},t.prototype.closeWindow=function(e){e.complete();var t=this.windows;t.splice(t.indexOf(e),1)}}(_);function Ve(e){var t=e.subscriber,n=e.windowTimeSpan,r=e.window;r&&t.closeWindow(r),e.window=t.openWindow(),this.schedule(e,n)}function He(e){var t=e.windowTimeSpan,n=e.subscriber,r=e.scheduler,i=e.windowCreationInterval,o=n.openWindow(),s={action:this,subscription:null},a={subscriber:n,window:o,context:s};s.subscription=r.schedule(Ke,t,a),this.add(s.subscription),this.schedule(e,i)}function Ke(e){var t=e.subscriber,n=e.window,r=e.context;r&&r.action&&r.subscription&&r.action.remove(r.subscription),t.closeWindow(n)}(function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.openings=n,i.closingSelector=r,i.contexts=[],i.add(i.openSubscription=R(i,n,n)),i}s(t,e),t.prototype._next=function(e){var t=this.contexts;if(t)for(var n=t.length,r=0;r<n;r++)t[r].window.next(e)},t.prototype._error=function(t){var n=this.contexts;if(this.contexts=null,n)for(var r=n.length,i=-1;++i<r;){var o=n[i];o.window.error(t),o.subscription.unsubscribe()}e.prototype._error.call(this,t)},t.prototype._complete=function(){var t=this.contexts;if(this.contexts=null,t)for(var n=t.length,r=-1;++r<n;){var i=t[r];i.window.complete(),i.subscription.unsubscribe()}e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.contexts;if(this.contexts=null,e)for(var t=e.length,n=-1;++n<t;){var r=e[n];r.window.unsubscribe(),r.subscription.unsubscribe()}},t.prototype.notifyNext=function(e,t,n,r,i){if(e===this.openings){var o=h(this.closingSelector)(t);if(o===u)return this.error(u.e);var s=new Oe,a=new S,c={window:s,subscription:a};this.contexts.push(c);var l=R(this,o,c);l.closed?this.closeWindow(this.contexts.length-1):(l.context=c,a.add(l)),this.destination.next(s)}else this.closeWindow(this.contexts.indexOf(e))},t.prototype.notifyError=function(e){this.error(e)},t.prototype.notifyComplete=function(e){e!==this.openSubscription&&this.closeWindow(this.contexts.indexOf(e.context))},t.prototype.closeWindow=function(e){if(-1!==e){var t=this.contexts,n=t[e],r=n.window,i=n.subscription;t.splice(e,1),r.complete(),i.unsubscribe()}}})(E),function(e){function t(t,n){var r=e.call(this,t)||this;return r.destination=t,r.closingSelector=n,r.openWindow(),r}s(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.openWindow(i)},t.prototype.notifyError=function(e,t){this._error(e)},t.prototype.notifyComplete=function(e){this.openWindow(e)},t.prototype._next=function(e){this.window.next(e)},t.prototype._error=function(e){this.window.error(e),this.destination.error(e),this.unsubscribeClosingNotification()},t.prototype._complete=function(){this.window.complete(),this.destination.complete(),this.unsubscribeClosingNotification()},t.prototype.unsubscribeClosingNotification=function(){this.closingNotification&&this.closingNotification.unsubscribe()},t.prototype.openWindow=function(e){void 0===e&&(e=null),e&&(this.remove(e),e.unsubscribe());var t=this.window;t&&t.complete();var n=this.window=new Oe;this.destination.next(n);var r=h(this.closingSelector)();if(r===u){var i=u.e;this.destination.error(i),this.window.error(i)}else this.add(this.closingNotification=R(this,r))}}(E),function(e){function t(t,n,r){var i=e.call(this,t)||this;i.observables=n,i.project=r,i.toRespond=[];var o=n.length;i.values=new Array(o);for(var s=0;s<o;s++)i.toRespond.push(s);for(s=0;s<o;s++){var a=n[s];i.add(R(i,a,a,s))}return i}s(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.values[n]=t;var o=this.toRespond;if(o.length>0){var s=o.indexOf(n);-1!==s&&o.splice(s,1)}},t.prototype.notifyComplete=function(){},t.prototype._next=function(e){if(0===this.toRespond.length){var t=[e].concat(this.values);this.project?this._tryProject(t):this.destination.next(t)}},t.prototype._tryProject=function(e){var t;try{t=this.project.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)}}(E);function Je(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[e.length-1];return"function"==typeof n&&e.pop(),$(e,void 0).lift(new Xe(n))}var Xe=function(){function e(e){this.resultSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new Ze(e,this.resultSelector))},e}(),Ze=function(e){function t(t,n,r){void 0===r&&(r=Object.create(null));var i=e.call(this,t)||this;return i.iterators=[],i.active=0,i.resultSelector="function"==typeof n?n:null,i.values=r,i}return s(t,e),t.prototype._next=function(e){var t=this.iterators;g(e)?t.push(new Qe(e)):"function"==typeof e[P]?t.push(new Ye(e[P]())):t.push(new et(this.destination,this,e))},t.prototype._complete=function(){var e=this.iterators,t=e.length;if(this.unsubscribe(),0!==t){this.active=t;for(var n=0;n<t;n++){var r=e[n];if(r.stillUnsubscribed)this.destination.add(r.subscribe(r,n));else this.active--}}else this.destination.complete()},t.prototype.notifyInactive=function(){this.active--,0===this.active&&this.destination.complete()},t.prototype.checkIterators=function(){for(var e=this.iterators,t=e.length,n=this.destination,r=0;r<t;r++){if("function"==typeof(s=e[r]).hasValue&&!s.hasValue())return}var i=!1,o=[];for(r=0;r<t;r++){var s,a=(s=e[r]).next();if(s.hasCompleted()&&(i=!0),a.done)return void n.complete();o.push(a.value)}this.resultSelector?this._tryresultSelector(o):n.next(o),i&&n.complete()},t.prototype._tryresultSelector=function(e){var t;try{t=this.resultSelector.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(_),Ye=function(){function e(e){this.iterator=e,this.nextResult=e.next()}return e.prototype.hasValue=function(){return!0},e.prototype.next=function(){var e=this.nextResult;return this.nextResult=this.iterator.next(),e},e.prototype.hasCompleted=function(){var e=this.nextResult;return e&&e.done},e}(),Qe=function(){function e(e){this.array=e,this.index=0,this.length=0,this.length=e.length}return e.prototype[P]=function(){return this},e.prototype.next=function(e){var t=this.index++,n=this.array;return t<this.length?{value:n[t],done:!1}:{value:null,done:!0}},e.prototype.hasValue=function(){return this.array.length>this.index},e.prototype.hasCompleted=function(){return this.array.length===this.index},e}(),et=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.parent=n,i.observable=r,i.stillUnsubscribed=!0,i.buffer=[],i.isComplete=!1,i}return s(t,e),t.prototype[P]=function(){return this},t.prototype.next=function(){var e=this.buffer;return 0===e.length&&this.isComplete?{value:null,done:!0}:{value:e.shift(),done:!1}},t.prototype.hasValue=function(){return this.buffer.length>0},t.prototype.hasCompleted=function(){return 0===this.buffer.length&&this.isComplete},t.prototype.notifyComplete=function(){this.buffer.length>0?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},t.prototype.notifyNext=function(e,t,n,r,i){this.buffer.push(t),this.parent.checkIterators()},t.prototype.subscribe=function(e,t){return R(this,this.observable,this,t)},t}(E),tt=function(e){function t(t,n,r,i){var o,s,a=e.call(this)||this;return a.proto=i,a.messageIn$=t.pipe(se(function(e){return e.streamId===r}),(o=function(e){var t=e.senderId,n=e.content;return{senderId:t,msg:i.decode(n)}},function(e){if("function"!=typeof o)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return e.lift(new K(o,s))})),a.messageOut$=n,a.streamId=r,a}return s(t,e),t.prototype.send=function(e,t){this.messageOut$.next({streamId:this.streamId,recipientId:t,content:this.proto.encode(this.proto.create(e)).finish()})},t}(i),nt={};function rt(){return"getRandomValues"in nt.crypto?nt.crypto.getRandomValues(new Int32Array(1))[0]:nt.crypto.randomBytes(4).readInt32BE(0,!0)}var it=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return s(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t.scheduled||(t.scheduled=requestAnimationFrame(function(){return t.flush(null)})))},t.prototype.recycleAsyncId=function(t,n,r){if(void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0)return e.prototype.recycleAsyncId.call(this,t,n,r);0===t.actions.length&&(cancelAnimationFrame(n),t.scheduled=void 0)},t}(L),ot=(new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,n=this.actions,r=-1,i=n.length;e=e||n.shift();do{if(t=e.execute(e.state,e.delay))break}while(++r<i&&(e=n.shift()));if(this.active=!1,t){for(;++r<i&&(e=n.shift());)e.unsubscribe();throw t}},t}(D))(it),function(e){function t(t,n){void 0===t&&(t=ot),void 0===n&&(n=Number.POSITIVE_INFINITY);var r=e.call(this,t,function(){return r.frame})||this;return r.maxFrames=n,r.frame=0,r.index=-1,r}s(t,e),t.prototype.flush=function(){for(var e,t,n=this.actions,r=this.maxFrames;(t=n.shift())&&(this.frame=t.delay)<=r&&!(e=t.execute(t.state,t.delay)););if(e){for(;t=n.shift();)t.unsubscribe();throw e}},t.frameTimeFactor=10}(D),function(e){function t(t,n,r){void 0===r&&(r=t.index+=1);var i=e.call(this,t,n)||this;return i.scheduler=t,i.work=n,i.index=r,i.active=!0,i.index=t.index=r,i}return s(t,e),t.prototype.schedule=function(n,r){if(void 0===r&&(r=0),!this.id)return e.prototype.schedule.call(this,n,r);this.active=!1;var i=new t(this.scheduler,this.work);return this.add(i),i.schedule(n,r)},t.prototype.requestAsyncId=function(e,n,r){void 0===r&&(r=0),this.delay=e.frame+r;var i=e.actions;return i.push(this),i.sort(t.sortActions),!0},t.prototype.recycleAsyncId=function(e,t,n){void 0===n&&(n=0)},t.prototype._execute=function(t,n){if(!0===this.active)return e.prototype._execute.call(this,t,n)},t.sortActions=function(e,t){return e.delay===t.delay?e.index===t.index?0:e.index>t.index?1:-1:e.delay>t.delay?1:-1},t}(L)),st=(function(e){function t(t,n){var r=e.call(this,t)||this;r.sources=n,r.completed=0,r.haveValues=0;var i=n.length;r.values=new Array(i);for(var o=0;o<i;o++){var s=R(r,n[o],null,o);s&&r.add(s)}return r}s(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.values[n]=t,i._hasValue||(i._hasValue=!0,this.haveValues++)},t.prototype.notifyComplete=function(e){var t=this.destination,n=this.haveValues,r=this.values,i=r.length;e._hasValue?(this.completed++,this.completed===i&&(n===i&&t.next(r),t.complete())):t.complete()}}(E),new M(C),"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{});function at(e,t){return e(t={exports:{}},t.exports),t.exports}var ct=function(e,t){var n=new Array(arguments.length-1),r=0,i=2,o=!0;for(;i<arguments.length;)n[r++]=arguments[i++];return new Promise(function(i,s){n[r]=function(e){if(o)if(o=!1,e)s(e);else{for(var t=new Array(arguments.length-1),n=0;n<t.length;)t[n++]=arguments[n];i.apply(null,t)}};try{e.apply(t||null,n)}catch(e){o&&(o=!1,s(e))}})};var ut=at(function(e,t){var n=t;n.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;--t%4>1&&"="===e.charAt(t);)++n;return Math.ceil(3*e.length)/4-n};for(var r=new Array(64),i=new Array(123),o=0;o<64;)i[r[o]=o<26?o+65:o<52?o+71:o<62?o-4:o-59|43]=o++;n.encode=function(e,t,n){for(var i,o=null,s=[],a=0,c=0;t<n;){var u=e[t++];switch(c){case 0:s[a++]=r[u>>2],i=(3&u)<<4,c=1;break;case 1:s[a++]=r[i|u>>4],i=(15&u)<<2,c=2;break;case 2:s[a++]=r[i|u>>6],s[a++]=r[63&u],c=0}a>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,s)),a=0)}return c&&(s[a++]=r[i],s[a++]=61,1===c&&(s[a++]=61)),o?(a&&o.push(String.fromCharCode.apply(String,s.slice(0,a))),o.join("")):String.fromCharCode.apply(String,s.slice(0,a))};n.decode=function(e,t,n){for(var r,o=n,s=0,a=0;a<e.length;){var c=e.charCodeAt(a++);if(61===c&&s>1)break;if(void 0===(c=i[c]))throw Error("invalid encoding");switch(s){case 0:r=c,s=1;break;case 1:t[n++]=r<<2|(48&c)>>4,r=c,s=2;break;case 2:t[n++]=(15&r)<<4|(60&c)>>2,r=c,s=3;break;case 3:t[n++]=(3&r)<<6|c,s=0}}if(1===s)throw Error("invalid encoding");return n-o},n.test=function(e){return/^(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/.test(e)}}),lt=ht;function ht(){this._listeners={}}ht.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this},ht.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var n=this._listeners[e],r=0;r<n.length;)n[r].fn===t?n.splice(r,1):++r;return this},ht.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],r=1;r<arguments.length;)n.push(arguments[r++]);for(r=0;r<t.length;)t[r].fn.apply(t[r++].ctx,n)}return this};var pt=ft(ft);function ft(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),n=new Uint8Array(t.buffer),r=128===n[3];function i(e,r,i){t[0]=e,r[i]=n[0],r[i+1]=n[1],r[i+2]=n[2],r[i+3]=n[3]}function o(e,r,i){t[0]=e,r[i]=n[3],r[i+1]=n[2],r[i+2]=n[1],r[i+3]=n[0]}function s(e,r){return n[0]=e[r],n[1]=e[r+1],n[2]=e[r+2],n[3]=e[r+3],t[0]}function a(e,r){return n[3]=e[r],n[2]=e[r+1],n[1]=e[r+2],n[0]=e[r+3],t[0]}e.writeFloatLE=r?i:o,e.writeFloatBE=r?o:i,e.readFloatLE=r?s:a,e.readFloatBE=r?a:s}():function(){function t(e,t,n,r){var i=t<0?1:0;if(i&&(t=-t),0===t)e(1/t>0?0:2147483648,n,r);else if(isNaN(t))e(2143289344,n,r);else if(t>3.4028234663852886e38)e((i<<31|2139095040)>>>0,n,r);else if(t<1.1754943508222875e-38)e((i<<31|Math.round(t/1.401298464324817e-45))>>>0,n,r);else{var o=Math.floor(Math.log(t)/Math.LN2);e((i<<31|o+127<<23|8388607&Math.round(t*Math.pow(2,-o)*8388608))>>>0,n,r)}}function n(e,t,n){var r=e(t,n),i=2*(r>>31)+1,o=r>>>23&255,s=8388607&r;return 255===o?s?NaN:i*(1/0):0===o?1.401298464324817e-45*i*s:i*Math.pow(2,o-150)*(s+8388608)}e.writeFloatLE=t.bind(null,dt),e.writeFloatBE=t.bind(null,yt),e.readFloatLE=n.bind(null,bt),e.readFloatBE=n.bind(null,gt)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),n=new Uint8Array(t.buffer),r=128===n[7];function i(e,r,i){t[0]=e,r[i]=n[0],r[i+1]=n[1],r[i+2]=n[2],r[i+3]=n[3],r[i+4]=n[4],r[i+5]=n[5],r[i+6]=n[6],r[i+7]=n[7]}function o(e,r,i){t[0]=e,r[i]=n[7],r[i+1]=n[6],r[i+2]=n[5],r[i+3]=n[4],r[i+4]=n[3],r[i+5]=n[2],r[i+6]=n[1],r[i+7]=n[0]}function s(e,r){return n[0]=e[r],n[1]=e[r+1],n[2]=e[r+2],n[3]=e[r+3],n[4]=e[r+4],n[5]=e[r+5],n[6]=e[r+6],n[7]=e[r+7],t[0]}function a(e,r){return n[7]=e[r],n[6]=e[r+1],n[5]=e[r+2],n[4]=e[r+3],n[3]=e[r+4],n[2]=e[r+5],n[1]=e[r+6],n[0]=e[r+7],t[0]}e.writeDoubleLE=r?i:o,e.writeDoubleBE=r?o:i,e.readDoubleLE=r?s:a,e.readDoubleBE=r?a:s}():function(){function t(e,t,n,r,i,o){var s=r<0?1:0;if(s&&(r=-r),0===r)e(0,i,o+t),e(1/r>0?0:2147483648,i,o+n);else if(isNaN(r))e(0,i,o+t),e(2146959360,i,o+n);else if(r>1.7976931348623157e308)e(0,i,o+t),e((s<<31|2146435072)>>>0,i,o+n);else{var a;if(r<2.2250738585072014e-308)e((a=r/5e-324)>>>0,i,o+t),e((s<<31|a/4294967296)>>>0,i,o+n);else{var c=Math.floor(Math.log(r)/Math.LN2);1024===c&&(c=1023),e(4503599627370496*(a=r*Math.pow(2,-c))>>>0,i,o+t),e((s<<31|c+1023<<20|1048576*a&1048575)>>>0,i,o+n)}}}function n(e,t,n,r,i){var o=e(r,i+t),s=e(r,i+n),a=2*(s>>31)+1,c=s>>>20&2047,u=4294967296*(1048575&s)+o;return 2047===c?u?NaN:a*(1/0):0===c?5e-324*a*u:a*Math.pow(2,c-1075)*(u+4503599627370496)}e.writeDoubleLE=t.bind(null,dt,0,4),e.writeDoubleBE=t.bind(null,yt,4,0),e.readDoubleLE=n.bind(null,bt,0,4),e.readDoubleBE=n.bind(null,gt,4,0)}(),e}function dt(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function yt(e,t,n){t[n]=e>>>24,t[n+1]=e>>>16&255,t[n+2]=e>>>8&255,t[n+3]=255&e}function bt(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function gt(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}var mt=function(e){return null};var vt=at(function(e,t){var n=t;n.length=function(e){for(var t=0,n=0,r=0;r<e.length;++r)(n=e.charCodeAt(r))<128?t+=1:n<2048?t+=2:55296==(64512&n)&&56320==(64512&e.charCodeAt(r+1))?(++r,t+=4):t+=3;return t},n.read=function(e,t,n){if(n-t<1)return"";for(var r,i=null,o=[],s=0;t<n;)(r=e[t++])<128?o[s++]=r:r>191&&r<224?o[s++]=(31&r)<<6|63&e[t++]:r>239&&r<365?(r=((7&r)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,o[s++]=55296+(r>>10),o[s++]=56320+(1023&r)):o[s++]=(15&r)<<12|(63&e[t++])<<6|63&e[t++],s>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),s=0);return i?(s&&i.push(String.fromCharCode.apply(String,o.slice(0,s))),i.join("")):String.fromCharCode.apply(String,o.slice(0,s))},n.write=function(e,t,n){for(var r,i,o=n,s=0;s<e.length;++s)(r=e.charCodeAt(s))<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):55296==(64512&r)&&56320==(64512&(i=e.charCodeAt(s+1)))?(r=65536+((1023&r)<<10)+(1023&i),++s,t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128);return n-o}}),wt=function(e,t,n){var r=n||8192,i=r>>>1,o=null,s=r;return function(n){if(n<1||n>i)return e(n);s+n>r&&(o=e(r),s=0);var a=t.call(o,s,s+=n);return 7&s&&(s=1+(7|s)),a}};var St=Ot;function Ot(e,t){this.lo=e>>>0,this.hi=t>>>0}var It=Ot.zero=new Ot(0,0);It.toNumber=function(){return 0},It.zzEncode=It.zzDecode=function(){return this},It.length=function(){return 1};var _t=Ot.zeroHash="\0\0\0\0\0\0\0\0";Ot.fromNumber=function(e){if(0===e)return It;var t=e<0;t&&(e=-e);var n=e>>>0,r=(e-n)/4294967296>>>0;return t&&(r=~r>>>0,n=~n>>>0,++n>4294967295&&(n=0,++r>4294967295&&(r=0))),new Ot(n,r)},Ot.from=function(e){if("number"==typeof e)return Ot.fromNumber(e);if(kt.isString(e)){if(!kt.Long)return Ot.fromNumber(parseInt(e,10));e=kt.Long.fromString(e)}return e.low||e.high?new Ot(e.low>>>0,e.high>>>0):It},Ot.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+4294967296*n)}return this.lo+4294967296*this.hi},Ot.prototype.toLong=function(e){return kt.Long?new kt.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var xt=String.prototype.charCodeAt;Ot.fromHash=function(e){return e===_t?It:new Ot((xt.call(e,0)|xt.call(e,1)<<8|xt.call(e,2)<<16|xt.call(e,3)<<24)>>>0,(xt.call(e,4)|xt.call(e,5)<<8|xt.call(e,6)<<16|xt.call(e,7)<<24)>>>0)},Ot.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},Ot.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},Ot.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},Ot.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10};var Et,kt=at(function(e,t){var n=t;function r(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;++i)void 0!==e[r[i]]&&n||(e[r[i]]=t[r[i]]);return e}function i(e){function t(e,n){if(!(this instanceof t))return new t(e,n);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&r(this,n)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}n.asPromise=ct,n.base64=ut,n.EventEmitter=lt,n.float=pt,n.inquire=mt,n.utf8=vt,n.pool=wt,n.LongBits=St,n.global="undefined"!=typeof window&&window||void 0!==st&&st||"undefined"!=typeof self&&self||st,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isNode=Boolean(n.global.process&&n.global.process.versions&&n.global.process.versions.node),n.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},n.isString=function(e){return"string"==typeof e||e instanceof String},n.isObject=function(e){return e&&"object"==typeof e},n.isset=n.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!=typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},n.Buffer=function(){try{var e=n.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(e){return"number"==typeof e?n.Buffer?n._Buffer_allocUnsafe(e):new n.Array(e):n.Buffer?n._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},n.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(e){return e?n.LongBits.from(e).toHash():n.LongBits.zeroHash},n.longFromHash=function(e,t){var r=n.LongBits.fromHash(e);return n.Long?n.Long.fromBits(r.lo,r.hi,t):r.toNumber(Boolean(t))},n.merge=r,n.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},n.newError=i,n.ProtocolError=i("ProtocolError"),n.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;n>-1;--n)if(1===t[e[n]]&&void 0!==this[e[n]]&&null!==this[e[n]])return e[n]}},n.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){var e=n.Buffer;e?(n._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},n._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):n._Buffer_from=n._Buffer_allocUnsafe=null}}),Tt=Rt,Ct=kt.LongBits,Mt=kt.base64,jt=kt.utf8;function Nt(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function Pt(){}function At(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function Rt(){this.len=0,this.head=new Nt(Pt,0,0),this.tail=this.head,this.states=null}function Lt(e,t,n){t[n]=255&e}function Bt(e,t){this.len=e,this.next=void 0,this.val=t}function Dt(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[n++]=127&e.lo|128,e.lo=e.lo>>>7;t[n++]=e.lo}function Ut(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}Rt.create=kt.Buffer?function(){return(Rt.create=function(){return new Et})()}:function(){return new Rt},Rt.alloc=function(e){return new kt.Array(e)},kt.Array!==Array&&(Rt.alloc=kt.pool(Rt.alloc,kt.Array.prototype.subarray)),Rt.prototype._push=function(e,t,n){return this.tail=this.tail.next=new Nt(e,t,n),this.len+=t,this},Bt.prototype=Object.create(Nt.prototype),Bt.prototype.fn=function(e,t,n){for(;e>127;)t[n++]=127&e|128,e>>>=7;t[n]=e},Rt.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new Bt((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},Rt.prototype.int32=function(e){return e<0?this._push(Dt,10,Ct.fromNumber(e)):this.uint32(e)},Rt.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},Rt.prototype.uint64=function(e){var t=Ct.from(e);return this._push(Dt,t.length(),t)},Rt.prototype.int64=Rt.prototype.uint64,Rt.prototype.sint64=function(e){var t=Ct.from(e).zzEncode();return this._push(Dt,t.length(),t)},Rt.prototype.bool=function(e){return this._push(Lt,1,e?1:0)},Rt.prototype.fixed32=function(e){return this._push(Ut,4,e>>>0)},Rt.prototype.sfixed32=Rt.prototype.fixed32,Rt.prototype.fixed64=function(e){var t=Ct.from(e);return this._push(Ut,4,t.lo)._push(Ut,4,t.hi)},Rt.prototype.sfixed64=Rt.prototype.fixed64,Rt.prototype.float=function(e){return this._push(kt.float.writeFloatLE,4,e)},Rt.prototype.double=function(e){return this._push(kt.float.writeDoubleLE,8,e)};var Ft=kt.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var r=0;r<e.length;++r)t[n+r]=e[r]};Rt.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(Lt,1,0);if(kt.isString(e)){var n=Rt.alloc(t=Mt.length(e));Mt.decode(e,n,0),e=n}return this.uint32(t)._push(Ft,t,e)},Rt.prototype.string=function(e){var t=jt.length(e);return t?this.uint32(t)._push(jt.write,t,e):this._push(Lt,1,0)},Rt.prototype.fork=function(){return this.states=new At(this),this.head=this.tail=new Nt(Pt,0,0),this.len=0,this},Rt.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Nt(Pt,0,0),this.len=0),this},Rt.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},Rt.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},Rt._configure=function(e){Et=e};var zt=$t;($t.prototype=Object.create(Tt.prototype)).constructor=$t;var Gt=kt.Buffer;function $t(){Tt.call(this)}$t.alloc=function(e){return($t.alloc=kt._Buffer_allocUnsafe)(e)};var qt=Gt&&Gt.prototype instanceof Uint8Array&&"set"===Gt.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var r=0;r<e.length;)t[n++]=e[r++]};function Wt(e,t,n){e.length<40?kt.utf8.write(e,t,n):t.utf8Write(e,n)}$t.prototype.bytes=function(e){kt.isString(e)&&(e=kt._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(qt,t,e),this},$t.prototype.string=function(e){var t=Gt.byteLength(e);return this.uint32(t),t&&this._push(Wt,t,e),this};var Vt,Ht=Zt,Kt=kt.LongBits,Jt=kt.utf8;function Xt(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function Zt(e){this.buf=e,this.pos=0,this.len=e.length}var Yt,Qt="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Zt(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Zt(e);throw Error("illegal buffer")};function en(){var e=new Kt(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw Xt(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw Xt(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function tn(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function nn(){if(this.pos+8>this.len)throw Xt(this,8);return new Kt(tn(this.buf,this.pos+=4),tn(this.buf,this.pos+=4))}Zt.create=kt.Buffer?function(e){return(Zt.create=function(e){return kt.Buffer.isBuffer(e)?new Vt(e):Qt(e)})(e)}:Qt,Zt.prototype._slice=kt.Array.prototype.subarray||kt.Array.prototype.slice,Zt.prototype.uint32=(Yt=4294967295,function(){if(Yt=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return Yt;if(Yt=(Yt|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return Yt;if(Yt=(Yt|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return Yt;if(Yt=(Yt|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return Yt;if(Yt=(Yt|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return Yt;if((this.pos+=5)>this.len)throw this.pos=this.len,Xt(this,10);return Yt}),Zt.prototype.int32=function(){return 0|this.uint32()},Zt.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},Zt.prototype.bool=function(){return 0!==this.uint32()},Zt.prototype.fixed32=function(){if(this.pos+4>this.len)throw Xt(this,4);return tn(this.buf,this.pos+=4)},Zt.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Xt(this,4);return 0|tn(this.buf,this.pos+=4)},Zt.prototype.float=function(){if(this.pos+4>this.len)throw Xt(this,4);var e=kt.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},Zt.prototype.double=function(){if(this.pos+8>this.len)throw Xt(this,4);var e=kt.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},Zt.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw Xt(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)},Zt.prototype.string=function(){var e=this.bytes();return Jt.read(e,0,e.length)},Zt.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw Xt(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw Xt(this)}while(128&this.buf[this.pos++]);return this},Zt.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},Zt._configure=function(e){Vt=e;var t=kt.Long?"toLong":"toNumber";kt.merge(Zt.prototype,{int64:function(){return en.call(this)[t](!1)},uint64:function(){return en.call(this)[t](!0)},sint64:function(){return en.call(this).zzDecode()[t](!1)},fixed64:function(){return nn.call(this)[t](!0)},sfixed64:function(){return nn.call(this)[t](!1)}})};var rn=on;function on(e){Ht.call(this,e)}(on.prototype=Object.create(Ht.prototype)).constructor=on,kt.Buffer&&(on.prototype._slice=kt.Buffer.prototype.slice),on.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len))};var sn=an;function an(e,t,n){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");kt.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(n)}(an.prototype=Object.create(kt.EventEmitter.prototype)).constructor=an,an.prototype.rpcCall=function e(t,n,r,i,o){if(!i)throw TypeError("request must be specified");var s=this;if(!o)return kt.asPromise(e,s,t,n,r,i);if(s.rpcImpl)try{return s.rpcImpl(t,n[s.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(e,n){if(e)return s.emit("error",e,t),o(e);if(null!==n){if(!(n instanceof r))try{n=r[s.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return s.emit("error",e,t),o(e)}return s.emit("data",n,t),o(null,n)}s.end(!0)})}catch(e){return s.emit("error",e,t),void setTimeout(function(){o(e)},0)}else setTimeout(function(){o(Error("already ended"))},0)},an.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};var cn,un=at(function(e,t){t.Service=sn}),ln={},hn=at(function(e,t){var n=t;function r(){n.Reader._configure(n.BufferReader),n.util._configure()}n.build="minimal",n.Writer=Tt,n.BufferWriter=zt,n.Reader=Ht,n.BufferReader=rn,n.util=kt,n.rpc=un,n.roots=ln,n.configure=r,n.Writer._configure(n.BufferWriter),r()}),pn=hn.Reader,fn=hn.Writer,dn=hn.util,yn=hn.roots,bn=pn,gn=fn,mn=dn,vn=yn.default||(yn.default={}),wn=vn.sync=function(){var e={};return e.RichOperationMsg=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t;return e.prototype.richLogootSOpsMsg=null,Object.defineProperty(e.prototype,"type",{get:mn.oneOfGetter(t=["richLogootSOpsMsg"]),set:mn.oneOfSetter(t)}),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=gn.create()),null!=e.richLogootSOpsMsg&&e.hasOwnProperty("richLogootSOpsMsg")&&vn.sync.RichLogootSOperationMsg.encode(e.richLogootSOpsMsg,t.uint32(10).fork()).ldelim(),t},e.decode=function(e,t){e instanceof bn||(e=bn.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new vn.sync.RichOperationMsg;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.richLogootSOpsMsg=vn.sync.RichLogootSOperationMsg.decode(e,e.uint32());break;default:e.skipType(7&i)}}return r},e}(),e.SyncMsg=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t;return e.prototype.richOpMsg=null,e.prototype.querySync=null,e.prototype.replySync=null,Object.defineProperty(e.prototype,"type",{get:mn.oneOfGetter(t=["richOpMsg","querySync","replySync"]),set:mn.oneOfSetter(t)}),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=gn.create()),null!=e.richOpMsg&&e.hasOwnProperty("richOpMsg")&&vn.sync.RichOperationMsg.encode(e.richOpMsg,t.uint32(10).fork()).ldelim(),null!=e.querySync&&e.hasOwnProperty("querySync")&&vn.sync.QuerySyncMsg.encode(e.querySync,t.uint32(18).fork()).ldelim(),null!=e.replySync&&e.hasOwnProperty("replySync")&&vn.sync.ReplySyncMsg.encode(e.replySync,t.uint32(26).fork()).ldelim(),t},e.decode=function(e,t){e instanceof bn||(e=bn.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new vn.sync.SyncMsg;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.richOpMsg=vn.sync.RichOperationMsg.decode(e,e.uint32());break;case 2:r.querySync=vn.sync.QuerySyncMsg.decode(e,e.uint32());break;case 3:r.replySync=vn.sync.ReplySyncMsg.decode(e,e.uint32());break;default:e.skipType(7&i)}}return r},e}(),e.QuerySyncMsg=function(){function e(e){if(this.vector={},e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.vector=mn.emptyObject,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=gn.create()),null!=e.vector&&e.hasOwnProperty("vector"))for(var n=Object.keys(e.vector),r=0;r<n.length;++r)t.uint32(10).fork().uint32(8).int32(n[r]).uint32(16).int32(e.vector[n[r]]).ldelim();return t},e.decode=function(e,t){e instanceof bn||(e=bn.create(e));for(var n,r=void 0===t?e.len:e.pos+t,i=new vn.sync.QuerySyncMsg;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:e.skip().pos++,i.vector===mn.emptyObject&&(i.vector={}),n=e.int32(),e.pos++,i.vector[n]=e.int32();break;default:e.skipType(7&o)}}return i},e}(),e.ReplySyncMsg=function(){function e(e){if(this.richOpsMsg=[],this.intervals=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.richOpsMsg=mn.emptyArray,e.prototype.intervals=mn.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=gn.create()),null!=e.richOpsMsg&&e.richOpsMsg.length)for(var n=0;n<e.richOpsMsg.length;++n)vn.sync.RichOperationMsg.encode(e.richOpsMsg[n],t.uint32(10).fork()).ldelim();if(null!=e.intervals&&e.intervals.length)for(n=0;n<e.intervals.length;++n)vn.sync.IntervalMsg.encode(e.intervals[n],t.uint32(18).fork()).ldelim();return t},e.decode=function(e,t){e instanceof bn||(e=bn.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new vn.sync.ReplySyncMsg;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.richOpsMsg&&r.richOpsMsg.length||(r.richOpsMsg=[]),r.richOpsMsg.push(vn.sync.RichOperationMsg.decode(e,e.uint32()));break;case 2:r.intervals&&r.intervals.length||(r.intervals=[]),r.intervals.push(vn.sync.IntervalMsg.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e}(),e.IdentifierMsg=function(){function e(e){if(this.tuples=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.tuples=mn.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=gn.create()),null!=e.tuples&&e.tuples.length)for(var n=0;n<e.tuples.length;++n)vn.sync.IdentifierTupleMsg.encode(e.tuples[n],t.uint32(10).fork()).ldelim();return t},e.decode=function(e,t){e instanceof bn||(e=bn.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new vn.sync.IdentifierMsg;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.tuples&&r.tuples.length||(r.tuples=[]),r.tuples.push(vn.sync.IdentifierTupleMsg.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e}(),e.IdentifierTupleMsg=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.random=0,e.prototype.replicaNumber=0,e.prototype.clock=0,e.prototype.offset=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=gn.create()),null!=e.random&&e.hasOwnProperty("random")&&t.uint32(8).int32(e.random),null!=e.replicaNumber&&e.hasOwnProperty("replicaNumber")&&t.uint32(16).int32(e.replicaNumber),null!=e.clock&&e.hasOwnProperty("clock")&&t.uint32(24).int32(e.clock),null!=e.offset&&e.hasOwnProperty("offset")&&t.uint32(32).int32(e.offset),t},e.decode=function(e,t){e instanceof bn||(e=bn.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new vn.sync.IdentifierTupleMsg;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.random=e.int32();break;case 2:r.replicaNumber=e.int32();break;case 3:r.clock=e.int32();break;case 4:r.offset=e.int32();break;default:e.skipType(7&i)}}return r},e}(),e.IdentifierIntervalMsg=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.idBegin=null,e.prototype.end=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=gn.create()),null!=e.idBegin&&e.hasOwnProperty("idBegin")&&vn.sync.IdentifierMsg.encode(e.idBegin,t.uint32(10).fork()).ldelim(),null!=e.end&&e.hasOwnProperty("end")&&t.uint32(16).int32(e.end),t},e.decode=function(e,t){e instanceof bn||(e=bn.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new vn.sync.IdentifierIntervalMsg;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.idBegin=vn.sync.IdentifierMsg.decode(e,e.uint32());break;case 2:r.end=e.int32();break;default:e.skipType(7&i)}}return r},e}(),e.IntervalMsg=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.id=0,e.prototype.begin=0,e.prototype.end=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=gn.create()),null!=e.id&&e.hasOwnProperty("id")&&t.uint32(8).int32(e.id),null!=e.begin&&e.hasOwnProperty("begin")&&t.uint32(16).int32(e.begin),null!=e.end&&e.hasOwnProperty("end")&&t.uint32(24).int32(e.end),t},e.decode=function(e,t){e instanceof bn||(e=bn.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new vn.sync.IntervalMsg;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.id=e.int32();break;case 2:r.begin=e.int32();break;case 3:r.end=e.int32();break;default:e.skipType(7&i)}}return r},e}(),e.RichLogootSOperationMsg=function(){function e(e){if(this.dependencies={},e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t;return e.prototype.id=0,e.prototype.clock=0,e.prototype.logootSAddMsg=null,e.prototype.logootSDelMsg=null,e.prototype.dependencies=mn.emptyObject,Object.defineProperty(e.prototype,"type",{get:mn.oneOfGetter(t=["logootSAddMsg","logootSDelMsg"]),set:mn.oneOfSetter(t)}),e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=gn.create()),null!=e.id&&e.hasOwnProperty("id")&&t.uint32(8).int32(e.id),null!=e.clock&&e.hasOwnProperty("clock")&&t.uint32(16).int32(e.clock),null!=e.logootSAddMsg&&e.hasOwnProperty("logootSAddMsg")&&vn.sync.LogootSAddMsg.encode(e.logootSAddMsg,t.uint32(26).fork()).ldelim(),null!=e.logootSDelMsg&&e.hasOwnProperty("logootSDelMsg")&&vn.sync.LogootSDelMsg.encode(e.logootSDelMsg,t.uint32(34).fork()).ldelim(),null!=e.dependencies&&e.hasOwnProperty("dependencies"))for(var n=Object.keys(e.dependencies),r=0;r<n.length;++r)t.uint32(42).fork().uint32(8).int32(n[r]).uint32(16).int32(e.dependencies[n[r]]).ldelim();return t},e.decode=function(e,t){e instanceof bn||(e=bn.create(e));for(var n,r=void 0===t?e.len:e.pos+t,i=new vn.sync.RichLogootSOperationMsg;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:i.id=e.int32();break;case 2:i.clock=e.int32();break;case 3:i.logootSAddMsg=vn.sync.LogootSAddMsg.decode(e,e.uint32());break;case 4:i.logootSDelMsg=vn.sync.LogootSDelMsg.decode(e,e.uint32());break;case 5:e.skip().pos++,i.dependencies===mn.emptyObject&&(i.dependencies={}),n=e.int32(),e.pos++,i.dependencies[n]=e.int32();break;default:e.skipType(7&o)}}return i},e}(),e.LogootSAddMsg=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.id=null,e.prototype.content="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=gn.create()),null!=e.id&&e.hasOwnProperty("id")&&vn.sync.IdentifierMsg.encode(e.id,t.uint32(10).fork()).ldelim(),null!=e.content&&e.hasOwnProperty("content")&&t.uint32(18).string(e.content),t},e.decode=function(e,t){e instanceof bn||(e=bn.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new vn.sync.LogootSAddMsg;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.id=vn.sync.IdentifierMsg.decode(e,e.uint32());break;case 2:r.content=e.string();break;default:e.skipType(7&i)}}return r},e}(),e.LogootSDelMsg=function(){function e(e){if(this.lid=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.lid=mn.emptyArray,e.prototype.author=0,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=gn.create()),null!=e.lid&&e.lid.length)for(var n=0;n<e.lid.length;++n)vn.sync.IdentifierIntervalMsg.encode(e.lid[n],t.uint32(10).fork()).ldelim();return null!=e.author&&e.hasOwnProperty("author")&&t.uint32(16).int32(e.author),t},e.decode=function(e,t){e instanceof bn||(e=bn.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new vn.sync.LogootSDelMsg;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.lid&&r.lid.length||(r.lid=[]),r.lid.push(vn.sync.IdentifierIntervalMsg.decode(e,e.uint32()));break;case 2:r.author=e.int32();break;default:e.skipType(7&i)}}return r},e}(),e}(),Sn=vn.collaborator=function(){var e={};return e.Collaborator=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.muteCoreId=0,e.prototype.displayName="",e.prototype.login="",e.prototype.email="",e.prototype.avatar="",e.prototype.deviceID="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=gn.create()),null!=e.muteCoreId&&e.hasOwnProperty("muteCoreId")&&t.uint32(8).sint32(e.muteCoreId),null!=e.displayName&&e.hasOwnProperty("displayName")&&t.uint32(18).string(e.displayName),null!=e.login&&e.hasOwnProperty("login")&&t.uint32(26).string(e.login),null!=e.email&&e.hasOwnProperty("email")&&t.uint32(34).string(e.email),null!=e.avatar&&e.hasOwnProperty("avatar")&&t.uint32(42).string(e.avatar),null!=e.deviceID&&e.hasOwnProperty("deviceID")&&t.uint32(50).string(e.deviceID),t},e.decode=function(e,t){e instanceof bn||(e=bn.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new vn.collaborator.Collaborator;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.muteCoreId=e.sint32();break;case 2:r.displayName=e.string();break;case 3:r.login=e.string();break;case 4:r.email=e.string();break;case 5:r.avatar=e.string();break;case 6:r.deviceID=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),On=vn.metadata=function(){var e={};return e.MetaData=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.type=0,e.prototype.data="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=gn.create()),null!=e.type&&e.hasOwnProperty("type")&&t.uint32(0).int32(e.type),null!=e.data&&e.hasOwnProperty("data")&&t.uint32(10).string(e.data),t},e.decode=function(e,t){e instanceof bn||(e=bn.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new vn.metadata.MetaData;e.pos<n;){var i=e.uint32();switch(i>>>3){case 0:r.type=e.int32();break;case 1:r.data=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}();(cn=t.Streams||(t.Streams={}))[cn.COLLABORATORS=400]="COLLABORATORS",cn[cn.METADATA=401]="METADATA",cn[cn.DOCUMENT_CONTENT=402]="DOCUMENT_CONTENT";var In,_n=function(){function e(e){this._state=e}return e.merge=function(e,t){var n=e.docCreated<t.docCreated?e:t;return{docCreated:n.docCreated,cryptoKey:n.cryptoKey}},e.prototype.handleRemoteFixDataState=function(t){return this._state=e.merge(this._state,t),this._state},Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),e}(),xn=function(e){function t(t,n,r,i,o){var s=e.call(this)||this;s.id=t,s.collaboratorService=n,s.document=r,s.sync=i,s.syncMsg=o,s._localOperationForLog$=new Oe,s._remoteOperationForLog=new Oe,s.document.remoteOperations$=s.sync.remoteOperations$,s.sync.localOperations$=s.document.localOperations$,s.sync.remoteQuerySync$=s.syncMsg.remoteQuerySync$,s.sync.remoteReplySync$=s.syncMsg.remoteReplySync$,s.sync.remoteRichOperations$=s.syncMsg.remoteRichOperations$,s.syncMsg.localRichOperations$=s.sync.localRichOperations$,s.syncMsg.querySync$=s.sync.querySync$,s.syncMsg.replySync$=s.sync.replySync$,s.newSub=s.document.localOperationLog$.subscribe(function(e){s.logLocalOperation(s.id,e.textop,e.operation)});var a=Je(s.document.remoteOperationLog$,s.sync.logsRemoteRichOperations$,function(e,t){return{v1:e,v2:t}});return s.newSub=a.subscribe(function(e){var t=e.v1,n=e.v2;s.logRemoteOperation(s.id,t.textop,t.operation,n.clock,n.author)}),s}return s(t,e),t.prototype.synchronize=function(){this.sync.sync()},t.prototype.indexFromId=function(e){return this.document.indexFromId(e)},t.prototype.positionFromIndex=function(e){return this.document.positionFromIndex(e)},Object.defineProperty(t.prototype,"localTextOperations$",{set:function(e){this.document.localTextOperations$=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"remoteTextOperations$",{get:function(){return this.document.remoteTextOperations$},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"localOperationForLog$",{get:function(){return this._localOperationForLog$.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"remoteOperationForLog$",{get:function(){return this._remoteOperationForLog.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"digestUpdate$",{get:function(){return this.document.digest$},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this._localOperationForLog$.complete(),this._remoteOperationForLog.complete(),e.prototype.dispose.call(this)},t}(i),En=function(e){function t(t){var n=e.call(this)||this;return n._doc=t,n.localOperationSubject=new Oe,n.remoteTextOperationSubject=new Oe,n.localOperationLogsSubject=new Oe,n.remoteOperationLogsSubject=new Oe,n.digestSubject=new Oe,n.updateSubject=new Oe,n}return s(t,e),t.prototype.dispose=function(){this.localOperationSubject.complete(),this.remoteTextOperationSubject.complete(),this.digestSubject.complete(),this.updateSubject.complete(),e.prototype.dispose.call(this)},Object.defineProperty(t.prototype,"doc",{get:function(){return this._doc},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"localTextOperations$",{set:function(e){var t=this;this.newSub=e.subscribe(function(e){t.handleLocalOperation(e),t.updateSubject.next()})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"remoteTextOperations$",{get:function(){return this.remoteTextOperationSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"remoteOperations$",{set:function(e){var t=this;this.newSub=e.subscribe(function(e){var n=e.collaborator,r=e.operations.map(function(e){return t.handleRemoteOperation(e)}).reduce(function(e,t){return e.concat(t)},[]);t.remoteTextOperationSubject.next({collaborator:n,operations:r}),t.updateSubject.next()})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"localOperations$",{get:function(){return this.localOperationSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"localOperationLog$",{get:function(){return this.localOperationLogsSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"remoteOperationLog$",{get:function(){return this.remoteOperationLogsSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"digest$",{get:function(){return this.digestSubject.asObservable()},enumerable:!0,configurable:!0}),t}(i),kn=function(){function e(e,t){this.richOps=e,this.intervals=t}return e.prototype.equals=function(e){return this.richOps.length===e.richOps.length&&this.intervals.length===e.intervals.length&&this.richOps.every(function(t,n){return t.equals(e.richOps[n])})&&this.intervals.every(function(t,n){return t.equals(e.intervals[n])})},e}(),Tn=function(){function e(e,t,n,r){void 0===r&&(r=new Map),this.id=e,this.clock=t,this.operation=n,this.dependencies=r}return e.prototype.equals=function(e){var t=this.id===e.id&&this.clock===e.clock,n=!0;return this.dependencies.forEach(function(t,r){e.dependencies.has(r)&&e.dependencies.get(r)===t||(n=!1)}),t&&n},e.prototype.toJson=function(){return JSON.stringify({id:this.id,clock:this.clock,operation:this.operation,dependencies:Array.from(this.dependencies)})},e}(),Cn=function(){function e(e,t,n){this.id=e,this.begin=t,this.end=n}return e.prototype.equals=function(e){return this.id===e.id&&this.begin===e.begin&&this.end===e.end},e}();!function(e){e[e.SUPERIOR=1]="SUPERIOR",e[e.INFERIOR=-1]="INFERIOR",e[e.EQUAL=2]="EQUAL",e[e.CONCURRENT=0]="CONCURRENT"}(In||(In={}));var Mn,jn=function(){function e(e){e&&e.forEach(function(e){console.assert(e>=0,"Each value of a state vector must be positive")}),this.vector=new Map(e)}return e.prototype.get=function(e){return this.vector.get(e)},e.prototype.set=function(e,t){console.assert(t>=0,"clock must be positive"),console.assert(this.isDeliverable(e,t)),this.vector.set(e,t)},e.prototype.clear=function(){this.vector.clear()},Object.defineProperty(e.prototype,"size",{get:function(){return this.vector.size},enumerable:!0,configurable:!0}),e.prototype.isAlreadyDelivered=function(e,t){var n=this.get(e);return void 0!==n&&n>=t},e.prototype.isDeliverable=function(e,t){if(this.isAlreadyDelivered(e,t))return!1;var n=this.get(e);return void 0===n?0===t:t===n+1},e.prototype.forEach=function(e){this.vector.forEach(e)},e.prototype.asMap=function(){return new Map(this.vector)},e.prototype.computeMissingIntervals=function(e){var t=this,n=[];return e.vector.forEach(function(e,r){var i=t.get(r);void 0===i?n.push(new Cn(r,0,e)):i<e&&n.push(new Cn(r,i+1,e))}),n},e.prototype.compareTo=function(e){var t=this;if(e.size<this.size)return-e.compareTo(this);var n=this.size<e.size?In.INFERIOR:In.EQUAL;return this.forEach(function(r,i){var o=e.get(i);void 0===o&&t.size===e.size?n=In.CONCURRENT:void 0===o?n=n===In.INFERIOR?In.CONCURRENT:In.SUPERIOR:r<o?n=n===In.SUPERIOR?In.CONCURRENT:In.INFERIOR:r>o&&(n=n===In.INFERIOR?In.CONCURRENT:In.SUPERIOR),In.CONCURRENT}),n},e.prototype.maxPairwise=function(e){var t=new Map,n=[];this.vector.forEach(function(r,i){n.push(i);var o=e.vector.get(i);o?t.set(i,Math.max(r,o)):t.set(i,r)}),e.vector.forEach(function(e,r){n.includes(r)||t.set(r,e)}),this.vector=t},e}(),Nn=function(e){function t(t,n,r,i,o){var s=e.call(this)||this;return s.id=t,s.clock=0,s.vector=new jn,s.querySyncSubject=new Oe,s.replySyncSubject=new Oe,s.collabsService=o,s.appliedOperationsSubject=new Oe,s.localRichOperationsSubject=new Oe,s.remoteOperationsSubject=new Oe,s.logsRemoteRichOperationsSubject=new Oe,s.richOperations=i,s.vector=new jn(r),s.clock=n,s}return s(t,e),t.prototype.sync=function(){this.querySyncSubject.next(this.vector)},Object.defineProperty(t.prototype,"querySync$",{get:function(){return this.querySyncSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"replySync$",{get:function(){return this.replySyncSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"localRichOperations$",{get:function(){return this.localRichOperationsSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"remoteOperations$",{get:function(){return this.remoteOperationsSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"logsRemoteRichOperations$",{get:function(){return this.logsRemoteRichOperationsSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stateElements",{get:function(){return{networkClock:this.clock,vector:this.vector.asMap(),richOperations:this.richOperations}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"remoteQuerySync$",{set:function(e){var t=this;this.newSub=e.subscribe(function(e){var n=t.computeMissingOps(e),r=t.vector.computeMissingIntervals(e);t.replySyncSubject.next(new kn(n,r))})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"remoteReplySync$",{set:function(e){var t=this;this.newSub=e.subscribe(function(e){var n=e.richOps,r=e.intervals;n.length>0&&t.applyRichOperations(n),r.forEach(function(e){var n=e.id,r=e.begin,i=e.end;t.richOperations.filter(function(e){var t=e.id,o=e.clock;return n===t&&r<=o&&o<=i}).forEach(function(e){return t.localRichOperationsSubject.next(e)})})})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"localOperations$",{set:function(e){var t=this;this.newSub=e.subscribe(function(e){var n=t.computeDependencies(e),r=new Tn(t.id,t.clock,e,n);t.updateState(r),t.localRichOperationsSubject.next(r),t.clock++})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"remoteRichOperations$",{set:function(e){var t=this;this.newSub=e.subscribe(function(e){return t.applyRichOperations([e])})},enumerable:!0,configurable:!0}),t.prototype.computeMissingOps=function(e){return this.richOperations.filter(function(t){var n=t.id,r=t.clock,i=e.get(n);return void 0===i||i<r})},t.prototype.dispose=function(){this.querySyncSubject.complete(),this.replySyncSubject.complete(),this.appliedOperationsSubject.complete(),this.localRichOperationsSubject.complete(),this.remoteOperationsSubject.complete(),this.logsRemoteRichOperationsSubject.complete(),e.prototype.dispose.call(this)},t.prototype.applyRichOperations=function(e){var t=this;setTimeout(function(){var n=e.filter(function(e){var n=e.id,r=e.clock;return!t.vector.isAlreadyDelivered(n,r)});if(n.length>0){var r=[];n.forEach(function(e){if(t.isDeliverable(e)){var n=e.operation;t.updateState(e),r.push(n),t.logsRemoteRichOperationsSubject.next({clock:e.clock,author:e.id,operation:e.operation})}else t.bufferOperation(e)}),r.length>0&&(t.remoteOperationsSubject.next({collaborator:t.collabsService.getCollaborator(n[0].id),operations:r}),t.appliedOperationsSubject.next())}})},t.prototype.bufferOperation=function(e){var t=this;this.appliedOperationsSubject.pipe(ge(function(){return t.isDeliverable(e)})).subscribe(function(){t.vector.isAlreadyDelivered(e.id,e.clock)||t.applyRichOperations([e])})},t.prototype.updateState=function(e){console.assert(this.isDeliverable(e));var t=e.id,n=e.clock;this.vector.set(t,n),this.richOperations.push(e)},t.prototype.isDeliverable=function(e){var t=e.id,n=e.clock,r=e.dependencies;return this.vector.isDeliverable(t,n)&&this.hasDeliveredDependencies(r)},t.prototype.hasDeliveredDependencies=function(e){var t=this,n=!0;return e.forEach(function(e,r){var i=t.vector.get(r);(void 0===i||e>i)&&(n=!1)}),n},t}(i),Pn=function(e){function n(n,r){var i=e.call(this,n,r,t.Streams.DOCUMENT_CONTENT,wn.SyncMsg)||this;return i.remoteQuerySyncSubject=new Oe,i.remoteQuerySyncIdSubject=new Oe,i.remoteRichOperationSubject=new Oe,i.remoteReplySyncSubject=new Oe,i.newSub=i.messageIn$.subscribe(function(e){var t=e.senderId,n=e.msg;switch(n.type){case"richOpMsg":i.handleRichOpMsg(n.richOpMsg);break;case"querySync":i.remoteQuerySyncIdSubject.next(t),i.handleQuerySyncMsg(n.querySync);break;case"replySync":i.handleReplySyncMsg(n.replySync)}}),i}return s(n,e),Object.defineProperty(n.prototype,"remoteRichOperations$",{get:function(){return this.remoteRichOperationSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"remoteQuerySync$",{get:function(){return this.remoteQuerySyncSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"remoteReplySync$",{get:function(){return this.remoteReplySyncSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"localRichOperations$",{set:function(t){var n=this;this.newSub=t.subscribe(function(t){e.prototype.send.call(n,{richOpMsg:n.serializeRichOperation(t)})})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"querySync$",{set:function(t){var n=this;this.newSub=t.subscribe(function(t){var r=wn.QuerySyncMsg.create();t.forEach(function(e,t){void 0!==t&&void 0!==e&&(r.vector[t]=e)}),e.prototype.send.call(n,{querySync:r})})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"replySync$",{set:function(t){var n=this;this.newSub=Je(t,this.remoteQuerySyncIdSubject.asObservable(),function(e,t){return{id:t,replySyncEvent:e}}).subscribe(function(t){var r=t.id,i=t.replySyncEvent,o=i.richOps,s=i.intervals,a=wn.ReplySyncMsg.create();a.richOpsMsg=o.map(function(e){return n.serializeRichOperation(e)}),a.intervals=s.map(function(e){var t=e.id,n=e.begin,r=e.end;return wn.IntervalMsg.create({id:t,begin:n,end:r})}),e.prototype.send.call(n,{replySync:a},r)})},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){this.remoteQuerySyncSubject.complete(),this.remoteQuerySyncIdSubject.complete(),this.remoteRichOperationSubject.complete(),this.remoteReplySyncSubject.complete(),e.prototype.dispose.call(this)},n.prototype.handleRichOpMsg=function(e){this.remoteRichOperationSubject.next(this.deserializeRichOperation(e))},n.prototype.handleQuerySyncMsg=function(e){var t=new Map;Object.keys(e.vector).forEach(function(n){t.set(parseInt(n,10),e.vector[n])}),this.remoteQuerySyncSubject.next(new jn(t))},n.prototype.handleReplySyncMsg=function(e){var t=this,n=e.richOpsMsg,r=e.intervals,i=n.map(function(e){return t.deserializeRichOperation(e)});this.remoteReplySyncSubject.next(new kn(i,r.map(function(e){var t=e.id,n=e.begin,r=e.end;return new Cn(t,n,r)})))},n}(tt),An=function(){function e(e,t,n,r,i){this._id=e,this._sequenceCRDT=t,this._remoteOperations=n,this._vector=r,this._networkClock=i}return e.isArray=function(e){var t=!0;return e instanceof Array?e.forEach(function(e){e instanceof Array&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]||(t=!1)}):t=!1,t},e.prototype.toJSON=function(){return JSON.stringify({vector:Array.from(this._vector),remoteOperations:this._remoteOperations.map(function(e){return e.toJson()}),sequenceCRDT:this._sequenceCRDT,networkClock:this._networkClock,id:this._id})},Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"remoteOperations",{get:function(){return this._remoteOperations},set:function(e){this._remoteOperations=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sequenceCRDT",{get:function(){return this._sequenceCRDT},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"networkClock",{get:function(){return this._networkClock},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vector",{get:function(){return this._vector},enumerable:!0,configurable:!0}),e}(),Rn=function(){function e(e,t,n){this.id=e,this.share=t,this.state=new jn(n)}return e.prototype.merge=function(e){var t=this.state.compareTo(e.state);t===In.INFERIOR?(this.share=e.share,this.state=e.state):t===In.CONCURRENT&&(this.share=this.share&&e.share,this.state.maxPairwise(e.state))},e.prototype.setShare=function(e){this.share=e;var t=this.state.get(this.id);void 0!==t?this.state.set(this.id,t+1):this.state.set(this.id,0)},e.prototype.getState=function(){return{share:this.share,vector:this.state.asMap(),id:this.id}},Object.defineProperty(e.prototype,"isShared",{get:function(){return this.share},enumerable:!0,configurable:!0}),e}(),Ln=function(){function e(e,t){this._id=e,this.crdt=new Rn(e,t.share,t.vector)}return e.prototype.handleLocalLogState=function(e){this.crdt.setShare(e)},e.prototype.handleRemoteLogState=function(e,t){var n=new Rn(e,t.share,t.vector);return this.crdt.merge(n),this.state},Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this.crdt.getState()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stateWithVectorAsArray",{get:function(){var e=this.state,t=e.vector||new Map,n=Array.from(t);return{share:e.share,vector:n}},enumerable:!0,configurable:!0}),e}(),Bn=function(){function e(e){this._state=e}return e.merge=function(e,t){var n=e.titleModified>t.titleModified?e:t;return{title:n.title,titleModified:n.titleModified}},e.prototype.handleLocalState=function(t){this._state=e.merge(this._state,t)},e.prototype.handleRemoteState=function(t){return this._state=e.merge(this._state,t),this._state},Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),e}();(Mn=t.MetaDataType||(t.MetaDataType={}))[Mn.Title=0]="Title",Mn[Mn.FixData=1]="FixData",Mn[Mn.Logs=2]="Logs";var Dn,Un=function(e){function n(n,r,i,o,s,a){var c=e.call(this,n,r,t.Streams.METADATA,On.MetaData)||this;return c.title=new Bn(i),c.fixData=new _n(o),c.logs=new Ln(a,s),c.localUpdateSubject=new Oe,c.remoteUpdateSubject=new Oe,c.newSub=c.messageIn$.subscribe(function(e){var n=e.msg,r=n.type,i=n.data,o=JSON.parse(i);switch(r){case t.MetaDataType.Title:c.remoteUpdateSubject.next({type:t.MetaDataType.Title,data:c.title.handleRemoteState(o)});break;case t.MetaDataType.FixData:c.remoteUpdateSubject.next({type:t.MetaDataType.FixData,data:c.fixData.handleRemoteFixDataState(o)});break;case t.MetaDataType.Logs:o.vector=new Map(o.vector),c.remoteUpdateSubject.next({type:t.MetaDataType.Logs,data:c.logs.handleRemoteLogState(o.id,{share:o.share,vector:o.vector})});break;default:console.error("No MetaDataType for type "+r)}}),c}return s(n,e),n.mergeTitle=function(e,t){return Bn.merge(e,t)},n.mergeFixData=function(e,t){return _n.merge(e,t)},Object.defineProperty(n.prototype,"localUpdate$",{set:function(n){var r=this;this.newSub=n.subscribe(function(n){var i=n.type,o=n.data;switch(i){case t.MetaDataType.Title:var s=o,a=s.title,c=s.titleModified;r.title.handleLocalState({title:a,titleModified:c}),e.prototype.send.call(r,{type:t.MetaDataType.Title,data:JSON.stringify(r.title.state)});break;case t.MetaDataType.FixData:break;case t.MetaDataType.Logs:var u=o.share;r.logs.handleLocalLogState(u),r.remoteUpdateSubject.next({type:t.MetaDataType.Logs,data:r.logs.state});var l=r.logs.state;e.prototype.send.call(r,{type:t.MetaDataType.Logs,data:JSON.stringify({id:r.logs.id,share:l.share,vector:Array.from(l.vector||new Map)})});break;default:console.error("No MetaDataType for type "+i)}})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"memberJoin$",{set:function(n){var r=this;this.newSub=n.subscribe(function(n){e.prototype.send.call(r,{type:t.MetaDataType.FixData,data:JSON.stringify(r.fixData.state)},n),e.prototype.send.call(r,{type:t.MetaDataType.Title,data:JSON.stringify(r.title.state)},n);var i=r.logs.stateWithVectorAsArray;e.prototype.send.call(r,{type:t.MetaDataType.Logs,data:JSON.stringify({share:i.share,vector:i.vector})},n)})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"remoteUpdate$",{get:function(){return this.remoteUpdateSubject.asObservable()},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){this.localUpdateSubject.complete(),this.remoteUpdateSubject.complete()},n}(tt),Fn=function(e){function n(n,r,i){var o=e.call(this,n,r,t.Streams.COLLABORATORS,Sn.Collaborator)||this;return o.me=i,o.collaborators=new Map,o.updateSubject=new Oe,o.joinSubject=new Oe,o.leaveSubject=new Oe,o.newSub=o.messageIn$.subscribe(function(e){var t=e.senderId,n=e.msg,r=a({id:t},n),i=o.collaborators.get(t);i?(i.muteCoreId=r.muteCoreId||i.muteCoreId,i.displayName=r.displayName||i.displayName,i.login=r.login||i.login,i.email=r.email||i.email,i.avatar=r.avatar||i.avatar,i.deviceID=r.deviceID||i.deviceID,o.updateSubject.next(i)):(o.collaborators.set(r.id,r),o.joinSubject.next(r))}),o}return s(n,e),n.prototype.getCollaborator=function(e){var t,n;try{for(var r=function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}(this.collaborators.values()),i=r.next();!i.done;i=r.next()){var o=i.value;if(o.muteCoreId===e)return o}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},Object.defineProperty(n.prototype,"remoteUpdate$",{get:function(){return this.updateSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"join$",{get:function(){return this.joinSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"leave$",{get:function(){return this.leaveSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"memberJoin$",{set:function(e){var t=this;this.newSub=e.subscribe(function(e){return t.emitUpdate(e)})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"memberLeave$",{set:function(e){var t=this;this.newSub=e.subscribe(function(e){var n=t.collaborators.get(e);n&&t.leaveSubject.next(n),t.collaborators.delete(e)})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"localUpdate",{set:function(e){var t=this;this.newSub=e.subscribe(function(e){Object.assign(t.me,e),t.emitUpdate()})},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){this.updateSubject.complete(),this.joinSubject.complete(),this.leaveSubject.complete(),e.prototype.dispose.call(this)},n.prototype.emitUpdate=function(t){var n=this.me,r=(n.id,function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]])}return n}(n,["id"]));e.prototype.send.call(this,r,t)},n}(tt);(Dn=t.Strategy||(t.Strategy={}))[Dn.LOGOOTSPLIT=100]="LOGOOTSPLIT";var zn="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Gn(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function $n(e,t){return e(t={exports:{}},t.exports),t.exports}var qn=$n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isDot=function(e){return"object"==typeof e&&null!==e&&"number"==typeof e.replicaNumber&&Number.isInteger(e.replicaNumber)&&"number"==typeof e.clock&&Number.isInteger(e.clock)}});Gn(qn);qn.isDot;var Wn=$n(function(e,t){function n(e){return Number.isSafeInteger(e)&&t.INT32_BOTTOM<=e&&e<=t.INT32_TOP}Object.defineProperty(t,"__esModule",{value:!0}),t.INT32_BOTTOM=-2147483648,t.INT32_TOP=2147483647,t.isInt32=n,t.randomInt32=function(e,t){console.assert(n(e),"l must be an int32"),console.assert(n(t),"u must be an int32"),console.assert(e<t,"u is greater than l");var r=Math.random()*(t-e)+e,i=Math.floor(r);return console.assert(n(i)&&e<=i&&i<t,"result is an integer 32 in [l, u["),i}});Gn(Wn);Wn.INT32_BOTTOM,Wn.INT32_TOP,Wn.isInt32,Wn.randomInt32;var Vn=$n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,n,r){console.assert([e,t,n,r].every(Wn.isInt32),"each value  int32"),this.random=e,this.replicaNumber=t,this.clock=n,this.offset=r}return e.fromPlain=function(t){return"object"==typeof t&&null!==t&&"number"==typeof t.random&&Wn.isInt32(t.random)&&"number"==typeof t.replicaNumber&&Wn.isInt32(t.replicaNumber)&&"number"==typeof t.clock&&Wn.isInt32(t.clock)&&"number"==typeof t.offset&&Wn.isInt32(t.offset)?new e(t.random,t.replicaNumber,t.clock,t.offset):null},e.fromBase=function(t,n){return console.assert(Wn.isInt32(n),"offset  int32"),new e(t.random,t.replicaNumber,t.clock,n)},e.prototype.compareTo=function(e){for(var t=this.asArray(),n=e.asArray(),r=0;r<t.length&&t[r]===n[r];)r++;return r===t.length?0:t[r]<n[r]?-1:1},e.prototype.equals=function(e){return this.equalsBase(e)&&this.offset===e.offset},e.prototype.equalsBase=function(e){return this.random===e.random&&this.replicaNumber===e.replicaNumber&&this.clock===e.clock},e.prototype.asArray=function(){return[this.random,this.replicaNumber,this.clock,this.offset]},e.prototype.digest=function(){return this.asArray().reduce(function(e,t){return 17*e+t|0},0)},e.prototype.toString=function(){return this.random+","+this.replicaNumber+","+this.clock+","+this.offset},e}();t.IdentifierTuple=n});Gn(Vn);Vn.IdentifierTuple;var Hn=$n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){console.assert(e.length>0,"tuples must not be empty");var t=e[e.length-1].random;console.assert(t>Wn.INT32_BOTTOM),this.tuples=e}return e.fromPlain=function(t){if("object"==typeof t&&null!==t){var n=t.tuples;if(n instanceof Array&&n.length>0){var r=n.map(Vn.IdentifierTuple.fromPlain).filter(function(e){return null!==e});if(n.length===r.length)return new e(r)}}return null},e.fromBase=function(t,n){return console.assert(Wn.isInt32(n),"offset  int32"),new e(t.tuples.map(function(e,r){return r===t.length-1?Vn.IdentifierTuple.fromBase(e,n):e}))},Object.defineProperty(e.prototype,"generator",{get:function(){return this.tuples[this.tuples.length-1].replicaNumber},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this.tuples.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"replicaNumber",{get:function(){return this.tuples[this.length-1].replicaNumber},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"clock",{get:function(){return this.tuples[this.length-1].clock},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dot",{get:function(){return{replicaNumber:this.replicaNumber,clock:this.clock}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastOffset",{get:function(){return this.tuples[this.length-1].offset},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"base",{get:function(){var e=this.tuples.reduce(function(e,t){return e.concat(t.asArray())},[]);return e.pop(),e},enumerable:!0,configurable:!0}),e.prototype.longestCommonPrefix=function(e){for(var t=[],n=Math.min(this.tuples.length,e.tuples.length),r=0;r<n&&this.tuples[r].equals(e.tuples[r]);)t.push(this.tuples[r]),r++;return t},e.prototype.longestCommonBase=function(e){for(var t=[],n=Math.min(this.tuples.length,e.tuples.length),r=0,i=!1;!i&&r<n;){var o=this.tuples[r],s=e.tuples[r];o.equals(s)?t.push(o):(i=!0,o.equalsBase(s)&&t.push(o)),r++}return t},e.prototype.isPrefix=function(e){return this.isBasePrefix(e)&&this.lastOffset===e.tuples[this.length-1].offset},e.prototype.isBasePrefix=function(e){var t=this;return this.length<=e.length&&this.tuples.every(function(n,r){var i=e.tuples[r];return r===t.tuples.length-1?n.equalsBase(i):n.equals(i)})},e.prototype.commonPrefixLength=function(e){for(var t=Math.min(this.tuples.length,e.tuples.length),n=0;n<t&&this.tuples[n].equals(e.tuples[n]);)n++;return n},e.prototype.equals=function(e){return this.equalsBase(e)&&this.lastOffset===e.lastOffset},e.prototype.equalsBase=function(e){var t=this;return this.length===e.length&&this.tuples.every(function(n,r){var i=e.tuples[r];return r<t.length-1?n.equals(i):n.equalsBase(i)})},e.prototype.compareTo=function(e){if(this.equals(e))return 0;if(this.isPrefix(e))return-1;if(e.isPrefix(this))return 1;var t=this.commonPrefixLength(e);return this.tuples[t].compareTo(e.tuples[t])},e.prototype.hasPlaceAfter=function(e){return console.assert(Wn.isInt32(e),"length  int32"),console.assert(e>0,"length > 0 "),this.lastOffset<=Wn.INT32_TOP-e},e.prototype.hasPlaceBefore=function(e){return console.assert(Wn.isInt32(e),"length  int32"),console.assert(e>0,"length > 0 "),this.lastOffset>=Wn.INT32_BOTTOM+e},e.prototype.maxOffsetBeforeNext=function(e,t){if(console.assert(Wn.isInt32(t),"max  int32"),console.assert(-1===this.compareTo(e),"this must be less than next"),this.equalsBase(e))return console.assert(t<e.lastOffset,"max must be less than next.lastOffset"),t;if(this.isBasePrefix(e)){var n=e.tuples[this.length-1].offset;return Math.min(n,t)}return t},e.prototype.minOffsetAfterPrev=function(e,t){if(console.assert(Wn.isInt32(t),"min  int32"),this.equalsBase(e))return console.assert(t>e.lastOffset,"min must be greater than prev.lastOffset"),t;if(this.isBasePrefix(e)){var n=e.tuples[this.length-1].offset;return Math.max(n+1,t)}return t},e.prototype.digest=function(){return this.tuples.reduce(function(e,t){return 17*e+t.digest()|0},0)},e.prototype.toString=function(){return"Id["+this.tuples.join(",")+"]"},e}();t.Identifier=n});Gn(Hn);Hn.Identifier;var Kn=$n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){console.assert(Wn.isInt32(t),"end  int32"),console.assert(e.lastOffset<=t,"idBegin must be less than or equal to idEnd"),this.idBegin=e,this.end=t}return e.fromPlain=function(t){if("object"==typeof t&&null!==t){var n=Hn.Identifier.fromPlain(t.idBegin);if(null!==n&&"number"==typeof t.end&&Wn.isInt32(t.end)&&n.lastOffset<=t.end)return new e(n,t.end)}return null},Object.defineProperty(e.prototype,"begin",{get:function(){return this.idBegin.lastOffset},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"idEnd",{get:function(){return this.getBaseId(this.end)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this.end-this.begin+1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"base",{get:function(){return this.idBegin.base},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dot",{get:function(){return this.idBegin.dot},enumerable:!0,configurable:!0}),e.prototype.equals=function(e){return this.idBegin.equals(e.idBegin)&&this.begin===e.begin&&this.end===e.end},e.prototype.union=function(t,n){console.assert(Wn.isInt32(t),"aBegin  int32"),console.assert(Wn.isInt32(n),"aEnd  int32");var r=Math.min(this.begin,t),i=Math.max(this.end,n);return new e(Hn.Identifier.fromBase(this.idBegin,r),i)},e.prototype.containsId=function(e){return-1===this.idBegin.compareTo(e)&&1===this.idEnd.compareTo(e)},e.prototype.getBaseId=function(e){return console.assert(Wn.isInt32(e),"offset  int32"),console.assert(this.begin<=e&&e<=this.end,"offset must be included in the interval"),Hn.Identifier.fromBase(this.idBegin,e)},e.prototype.digest=function(){return 17*this.idBegin.digest()+this.end|0},e.prototype.toString=function(){return"IdInterval["+this.idBegin.tuples.join(",")+" .. "+this.end+"]"},e}();t.IdentifierInterval=n});Gn(Kn);Kn.IdentifierInterval;var Jn=$n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){console.assert(Wn.isInt32(t)&&t>=0,"nbElt must be a non-negative integer"),this.idInterval=e,this.nbElement=t}return e.fromPlain=function(t){if("object"==typeof t&&null!==t){var n=t.idInterval,r=t.nbElement;if(n instanceof Object&&"number"==typeof r&&Wn.isInt32(r)&&r>=0){var i=Kn.IdentifierInterval.fromPlain(n);if(null!==i)return new e(i,r)}}return null},e.prototype.isMine=function(e){return this.idInterval.idBegin.generator===e},e.prototype.addBlock=function(e,t){console.assert(Wn.isInt32(t)&&t>0,"length must be a positive int32"),this.nbElement+=t,this.idInterval=this.idInterval.union(e,e+t-1)},e.prototype.delBlock=function(e){console.assert(Wn.isInt32(e)&&e>0,"nbElt must be a positive int32"),this.nbElement-=e},e.prototype.toString=function(){return"{"+this.nbElement+","+this.idInterval.toString()+"}"},e}();t.LogootSBlock=n});Gn(Jn);Jn.LogootSBlock;var Xn=$n(function(e,t){var n=zn&&zn.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var r=new Vn.IdentifierTuple(Wn.INT32_BOTTOM,0,0,0),i=new Vn.IdentifierTuple(Wn.INT32_TOP,0,0,0);function o(e,t){var r,i;return n(this,function(n){switch(n.label){case 0:r=0,i=e,n.label=1;case 1:return r<i.length?[4,i[r]]:[3,4];case 2:n.sent(),n.label=3;case 3:return r++,[3,1];case 4:return[4,t];case 5:return n.sent(),[3,4];case 6:return[2]}})}function s(e){return null!==e?e.tuples:[]}t.createBetweenPosition=function(e,t,n,a){console.assert(null===e||null===t||-1===e.compareTo(t),"id1 < id2"),console.assert(Wn.isInt32(n),"replicaNumber is an int32"),console.assert(Wn.isInt32(a),"clock is an int32");for(var c=o(s(e),r),u=o(s(t),i),l=[],h=c.next().value,p=u.next().value;p.random-h.random<2;)l.push(h),h=c.next().value,p=u.next().value;var f=Wn.randomInt32(h.random+1,p.random);return l.push(new Vn.IdentifierTuple(f,n,a,0)),new Hn.Identifier(l)}});Gn(Xn);Xn.createBetweenPosition;var Zn=$n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.compareBase=function(e,t){var n=e.idBegin,r=e.begin,i=e.end,o=t.idBegin,s=t.begin,a=t.end;return n.equalsBase(o)?r===s&&i===a?6:i+1===s?4:r===a+1?5:i<s?1:a<r?0:(console.warn("Trying to duplicate existing identifiers: ",e,t),6):function(e,t){var n=e.idBegin,r=t.idBegin;return console.assert(!n.equalsBase(r),"the bases of the ids must be different"),e.containsId(r)?3:t.containsId(n)?2:-1===n.compareTo(r)?1:0}(e,t)}});Gn(Zn);Zn.compareBase;var Yn=$n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){return function(){}}();t.LogootSOperation=n});Gn(Yn);Yn.LogootSOperation;var Qn=$n(function(e,t){var n,r=zn&&zn.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var i=Array.prototype.concat,o=function(){function e(){}return e.fromPlain=function(e){if("object"==typeof e&&null!==e){var t=e.lid;if(t instanceof Array&&t.length>0){for(var n=!0,r=0,i=[];n&&r<t.length;){var o=Kn.IdentifierInterval.fromPlain(t[r]);null!==o?i.push(o):n=!1,r++}if(n)return new s(i,-1)}}return null},e}(),s=function(e){function t(t,n){var r=this;return console.assert(t.length>0,"lid must not be empty"),console.assert(Wn.isInt32(n),"author  int32"),(r=e.call(this)||this).lid=t,r.author=n,r}return r(t,e),t.fromPlain=function(e){if("object"==typeof e&&null!==e){var n=e.lid,r=e.author;if(!(n instanceof Array&&n.length>0&&"number"==typeof r&&Wn.isInt32(r)))return o.fromPlain(e);for(var i=!0,s=0,a=[];i&&s<n.length;){var c=Kn.IdentifierInterval.fromPlain(n[s]);null!==c?a.push(c):i=!1,s++}if(i)return new t(a,r)}return null},t.prototype.equals=function(e){return this.lid.length===e.lid.length&&this.lid.every(function(t,n){var r=e.lid[n];return t.equals(r)})},t.prototype.execute=function(e){var t=this;return i.apply([],this.lid.map(function(n){return e.delBlock(n,t.author)}))},t}(Yn.LogootSOperation);t.LogootSDel=s});Gn(Qn);Qn.LogootSDel;var er=$n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){return function(e,t){this.index=e,this.author=t}}();t.TextOperation=n});Gn(er);er.TextOperation;var tr=$n(function(e,t){var n,r=zn&&zn.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t,n,r){var i=this;return console.assert(Wn.isInt32(t),"index   int32"),console.assert(Wn.isInt32(n),"length   int32"),console.assert(n>0,"length > 0"),console.assert(Wn.isInt32(r),"author  int32"),(i=e.call(this,t,r)||this).length=n,i}return r(t,e),t.prototype.equals=function(e){return this.index===e.index&&this.length===e.length},t.prototype.applyTo=function(e){return e.delLocal(this.index,this.index+this.length-1)},t}(er.TextOperation);t.TextDelete=i});Gn(tr);tr.TextDelete;var nr=$n(function(e,t){var n,r=zn&&zn.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.fromPlain=function(e){if("object"==typeof e&&null!==e){var t=e.l;if("string"==typeof t&&t.length>0){var n=e.id,r=Hn.Identifier.fromPlain(n);if(null!==r)return new o(r,t)}}return null},e}(),o=function(e){function t(t,n){var r=this;return console.assert(n.length>0,"content must not be empty"),(r=e.call(this)||this).id=t,r.content=n,r}return r(t,e),t.fromPlain=function(e){if("object"==typeof e&&null!==e){var n=e.content;if(!("string"==typeof n&&n.length>0))return i.fromPlain(e);var r=e.id,o=Hn.Identifier.fromPlain(r);if(null!==o)return new t(o,n)}return null},Object.defineProperty(t.prototype,"author",{get:function(){return this.id.replicaNumber},enumerable:!0,configurable:!0}),t.prototype.equals=function(e){return this.id.equals(e.id)&&this.content===e.content},t.prototype.execute=function(e){return e.addBlock(this.content,this.id)},t}(Yn.LogootSOperation);t.LogootSAdd=o});Gn(nr);nr.LogootSAdd;var rr=$n(function(e,t){var n,r=zn&&zn.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t,n,r){var i=this;return console.assert(Wn.isInt32(t),"index  int32"),console.assert(Wn.isInt32(r),"author  int32"),(i=e.call(this,t,r)||this).content=n,i}return r(t,e),t.prototype.equals=function(e){return this.index===e.index&&this.content===e.content},t.prototype.applyTo=function(e){return e.insertLocal(this.index,this.content)},t}(er.TextOperation);t.TextInsert=i});Gn(rr);rr.TextInsert;var ir=$n(function(e,t){function n(e){return null!==e?e.height:0}function r(e){return null!==e?e.sizeNodeAndChildren:0}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t,i,o,s){console.assert(Wn.isInt32(t),"actualBegin  int32"),console.assert(e.idInterval.begin<=t,"actualBegin must be greater than or equal to idInterval.begin"),this.block=e,this.actualBegin=t,this.length=i,this.left=o,this.right=s,this.height=Math.max(n(o),n(s))+1,this.sizeNodeAndChildren=i+r(o)+r(s)}return e.fromPlain=function(t){if("object"==typeof t&&null!==t){var n=t.block,r=t.actualBegin,i=t.length,o=t.left,s=t.right;if(n instanceof Object&&"number"==typeof r&&Wn.isInt32(r)&&"number"==typeof i&&Wn.isInt32(i)&&i>=0){var a=Jn.LogootSBlock.fromPlain(n),c=e.fromPlain(s),u=e.fromPlain(o);if(null!==a&&a.idInterval.begin<=r&&a.idInterval.end-a.idInterval.begin>=i-1)return new e(a,r,i,u,c)}}return null},e.leaf=function(t,n,r){return console.assert(Wn.isInt32(n),"aOffset  int32"),console.assert(Wn.isInt32(r),"lenth  int32"),console.assert(r>0,"lenth > 0"),t.addBlock(n,r),new e(t,n,r,null,null)},Object.defineProperty(e.prototype,"actualEnd",{get:function(){return this.actualBegin+this.length-1},enumerable:!0,configurable:!0}),e.prototype.getIdBegin=function(){return this.block.idInterval.getBaseId(this.actualBegin)},e.prototype.getIdEnd=function(){return this.block.idInterval.getBaseId(this.actualEnd)},e.prototype.addString=function(e){console.assert(Wn.isInt32(e),"length   int32"),this.sizeNodeAndChildren+=e},e.prototype.appendEnd=function(e){console.assert(Wn.isInt32(e),"length   int32"),console.assert(e>0,""+e," > 0");var t=this.actualEnd+1;return this.length+=e,this.block.addBlock(t,e),this.block.idInterval.getBaseId(t)},e.prototype.appendBegin=function(e){return console.assert(Wn.isInt32(e),"length   int32"),console.assert(e>0,""+e," > 0"),this.actualBegin-=e,this.length+=e,this.block.addBlock(this.actualBegin,e),this.getIdBegin()},e.prototype.deleteOffsets=function(e,t){console.assert(Wn.isInt32(e),"begin   int32"),console.assert(Wn.isInt32(t),"end   int32"),console.assert(e<=t,"begin <= end: "+e," <= "+t),console.assert(this.block.idInterval.begin<=e,"this.block.idInterval.begin <= to begin: "+this.block.idInterval.begin," <= "+e),console.assert(t<=this.block.idInterval.end,"end <= this.block.idInterval.end: "+t," <= "+this.block.idInterval.end);var n=null,r=Math.max(this.actualBegin,e),i=Math.min(this.actualEnd,t);if(r<=i){var o=i-r+1;this.block.delBlock(o),o!==this.length&&(r===this.actualBegin?this.actualBegin=i+1:i!==this.actualEnd&&(n=this.split(i-this.actualBegin+1,null))),this.length=this.length-o}return n},e.prototype.split=function(t,n){var r=new e(this.block,this.actualBegin+t,this.length-t,n,this.right);return this.length=t,this.right=r,this.height=Math.max(this.height,r.height),r},e.prototype.leftSubtreeSize=function(){return r(this.left)},e.prototype.rightSubtreeSize=function(){return r(this.right)},e.prototype.sumDirectChildren=function(){this.height=Math.max(n(this.left),n(this.right))+1,this.sizeNodeAndChildren=this.leftSubtreeSize()+this.rightSubtreeSize()+this.length},e.prototype.replaceChildren=function(e,t){this.left===e?this.left=t:this.right===e&&(this.right=t)},e.prototype.balanceScore=function(){return n(this.right)-n(this.left)},e.prototype.become=function(e){this.sizeNodeAndChildren=-this.length+e.length,this.length=e.length,this.actualBegin=e.actualBegin,this.block=e.block},e.prototype.isAppendableAfter=function(e,t){return this.block.isMine(e)&&this.block.idInterval.end===this.actualEnd&&this.block.idInterval.idEnd.hasPlaceAfter(t)},e.prototype.isAppendableBefore=function(e,t){return this.block.isMine(e)&&this.block.idInterval.begin===this.actualBegin&&this.block.idInterval.idBegin.hasPlaceBefore(t)},e.prototype.toString=function(){var e=this.getIdentifierInterval().toString(),t=null!==this.left?this.left.toString():"\t#";return(null!==this.right?this.right.toString():"\t#").replace(/(\t+)/g,"\t$1")+"\n\t"+e+"\n"+t.replace(/(\t+)/g,"\t$1")},e.prototype.toList=function(){var e=this.getIdentifierInterval(),t=null!==this.left?this.left.toList():[],n=null!==this.right?this.right.toList():[];return t.concat(e,n)},e.prototype.getIdentifierInterval=function(){return new Kn.IdentifierInterval(this.getIdBegin(),this.actualEnd)},e.prototype.getBlocks=function(){var e=[this.block],t=this.left;null!==t&&(e=e.concat(t.getBlocks()));var n=this.right;return null!==n&&(e=e.concat(n.getBlocks())),e},e}();t.RopesNodes=i});Gn(ir);ir.RopesNodes;var or=$n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.insert=function(e,t,n){console.assert(Number.isSafeInteger(t),"index  safe integer");var r=Math.max(0,t);return e.slice(0,r)+n+e.slice(r)},t.del=function(e,t,n){return console.assert(Number.isSafeInteger(t),"begin  safe integer"),console.assert(Number.isSafeInteger(n),"end  safe integer"),e.slice(0,t)+e.slice(n+1)},t.occurrences=function(e,t){for(var n=0,r=t.length,i=e.indexOf(t);-1!==i;)n++,i=e.indexOf(t,i+r);return n}});Gn(or);or.insert,or.del,or.occurrences;var sr=$n(function(e,t){function n(e){return e.left}function r(e){return e.right}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t,n,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=null),void 0===r&&(r=""),console.assert(Wn.isInt32(e),"replica  int32"),console.assert(Wn.isInt32(t),"clock  int32"),this.replicaNumber=e,this.clock=t,this.root=n,this.str=r;var i={};if(null!==n){console.assert(r.length===n.sizeNodeAndChildren,"str length must match the number of elements in the model");for(var o=0,s=n.getBlocks();o<s.length;o++){var a=s[o];i[a.idInterval.base.join(",")]=a}}else console.assert(0===r.length,"str must be empty when no root is provided");this.mapBaseToBlock=i}return e.empty=function(){return new e(0,0)},e.fromPlain=function(t,n,r){if(console.assert(Wn.isInt32(t),"replica  int32"),console.assert(Wn.isInt32(n),"clock  int32"),"object"==typeof r&&null!==r){var i=r.str,o=r.root;if("string"==typeof i){var s=ir.RopesNodes.fromPlain(o);if(null!==s&&i.length===s.sizeNodeAndChildren)return new e(t,n,s,i)}}return null},Object.defineProperty(e.prototype,"height",{get:function(){return this.root?this.root.height:0},enumerable:!0,configurable:!0}),e.prototype.getBlock=function(e){var t,n=this.mapBaseToBlock,r=e.base.join(",");return n.hasOwnProperty(r)?t=n[r]:(t=new Jn.LogootSBlock(e,0),this.mapBaseToBlock[r]=t),t},e.prototype.addBlockFrom=function(e,t,n,r){var i=this,o=this.addBlockFromRec(e,t,n,r);return o.forEach(function(e){i.applyTextInsert(e)}),o},e.prototype.addBlockFromRec=function(e,t,n,r){for(var i=t.idBegin.replicaNumber,o=[],s=[],a=!0,c=r;a;)switch(o.push(n),Zn.compareBase(t,n.getIdentifierInterval())){case 0:null===n.right?(n.right=ir.RopesNodes.leaf(this.getBlock(t),t.begin,e.length),c=c+n.leftSubtreeSize()+n.length,s.push(new rr.TextInsert(c,e,i)),a=!1):(c=c+n.leftSubtreeSize()+n.length,n=n.right);break;case 1:null===n.left?(n.left=ir.RopesNodes.leaf(this.getBlock(t),t.begin,e.length),s.push(new rr.TextInsert(c,e,i)),a=!1):n=n.left;break;case 2:var u=n.getIdBegin().length-1,l=t.idBegin.tuples[u].offset,h=ir.RopesNodes.leaf(this.getBlock(t),t.begin,e.length);o.push(n.split(l-n.actualBegin+1,h)),c+=n.leftSubtreeSize(),s.push(new rr.TextInsert(c+l-n.actualBegin+1,e,i)),a=!1;break;case 3:u=t.idBegin.length-1,l=n.getIdBegin().tuples[u].offset;var p=e.substr(0,l+1-t.begin),f=new Kn.IdentifierInterval(t.idBegin,l);null===n.left?(n.left=ir.RopesNodes.leaf(this.getBlock(f),f.begin,p.length),s.push(new rr.TextInsert(c,p,i))):Array.prototype.push.apply(s,this.addBlockFromRec(p,f,n.left,c)),p=e.substr(l+1-t.begin,e.length);var d=Hn.Identifier.fromBase(t.idBegin,l+1);f=new Kn.IdentifierInterval(d,t.end),c=c+n.leftSubtreeSize()+n.length,null===n.right?(n.right=ir.RopesNodes.leaf(this.getBlock(f),f.begin,p.length),s.push(new rr.TextInsert(c,p,i))):Array.prototype.push.apply(s,this.addBlockFromRec(p,f,n.right,c)),a=!1;break;case 4:if(null!==n.left){var y=n.getIdBegin().minOffsetAfterPrev(n.left.getIdEnd(),t.begin);(b=e.substr(y-t.begin,e.length)).length>0&&(n.appendBegin(b.length),s.push(new rr.TextInsert(c+n.leftSubtreeSize(),b,i)),this.ascendentUpdate(o,b.length)),y-1>=t.begin?(e=e.substr(0,y-t.begin),t=new Kn.IdentifierInterval(t.idBegin,y-1),n=n.left):a=!1}else s.push(new rr.TextInsert(c,e,i)),n.appendBegin(e.length),this.ascendentUpdate(o,e.length),a=!1;break;case 5:if(null!==n.right){y=n.getIdEnd().maxOffsetBeforeNext(n.right.getIdBegin(),t.end);var b=e.substr(0,y+1-t.begin);if(c=c+n.leftSubtreeSize()+n.length,b.length>0&&(n.appendEnd(b.length),s.push(new rr.TextInsert(c,b,i)),this.ascendentUpdate(o,b.length)),t.end>=y+1){e=e.substr(y+1-t.begin,e.length);d=Hn.Identifier.fromBase(t.idBegin,y+1);t=new Kn.IdentifierInterval(d,t.end),n=n.right,c+=b.length}else a=!1}else c=c+n.leftSubtreeSize()+n.length,s.push(new rr.TextInsert(c,e,i)),n.appendEnd(e.length),this.ascendentUpdate(o,e.length),a=!1;break;case 6:a=!1}return this.balance(o),s},e.prototype.applyTextInsert=function(e){this.str=or.insert(this.str,e.index,e.content)},e.prototype.applyTextDelete=function(e){var t=e.index+e.length-1;this.str=or.del(this.str,e.index,t)},e.prototype.addBlock=function(e,t){var n=t.replicaNumber,r=new Kn.IdentifierInterval(t,t.lastOffset+e.length-1);if(null===this.root){var i=new Jn.LogootSBlock(r,0);this.mapBaseToBlock[i.idInterval.base.join(",")]=i,this.root=ir.RopesNodes.leaf(i,t.lastOffset,e.length);var o=new rr.TextInsert(0,e,n);return this.applyTextInsert(o),[o]}return this.addBlockFrom(e,r,this.root,0)},e.prototype.mkNode=function(e,t,n){console.assert(Wn.isInt32(n)&&n>0,"length  int32"),console.assert(n>0,"length > 0");var r=Xn.createBetweenPosition(e,t,this.replicaNumber,this.clock++),i=new Kn.IdentifierInterval(r,n-1),o=new Jn.LogootSBlock(i,0);return this.mapBaseToBlock[i.base.join(",")]=o,ir.RopesNodes.leaf(o,0,n)},e.prototype.insertLocal=function(e,t){if(console.assert(Wn.isInt32(e),"pos  int32"),null===this.root)return this.root=this.mkNode(null,null,t.length),this.str=or.insert(this.str,e,t),new nr.LogootSAdd(this.root.getIdBegin(),t);var i=void 0,o=this.str.length;this.str=or.insert(this.str,e,t);var s=void 0;if(0===e){if((s=[]).push(this.root),(c=this.getXest(n,s)).isAppendableBefore(this.replicaNumber,t.length)){var a=c.appendBegin(t.length);return this.ascendentUpdate(s,t.length),new nr.LogootSAdd(a,t)}i=this.mkNode(null,c.getIdBegin(),t.length),c.left=i}else if(e>=o){var c;if((s=[]).push(this.root),(c=this.getXest(r,s)).isAppendableAfter(this.replicaNumber,t.length)){var u=c.appendEnd(t.length);return this.ascendentUpdate(s,t.length),new nr.LogootSAdd(u,t)}i=this.mkNode(c.getIdEnd(),null,t.length),c.right=i}else{var l=this.searchNode(e);if(l.i>0){var h=l.node.block.idInterval.getBaseId(l.node.actualBegin+l.i-1),p=l.node.block.idInterval.getBaseId(l.node.actualBegin+l.i);i=this.mkNode(h,p,t.length),(s=l.path).push(l.node.split(l.i,i))}else{var f=this.searchNode(e-1);if(l.node.isAppendableBefore(this.replicaNumber,t.length)){var d=l.node.appendBegin(t.length);return this.ascendentUpdate(l.path,t.length),new nr.LogootSAdd(d,t)}if(f.node.isAppendableAfter(this.replicaNumber,t.length)){var y=f.node.appendEnd(t.length);return this.ascendentUpdate(f.path,t.length),new nr.LogootSAdd(y,t)}(i=this.mkNode(f.node.getIdEnd(),l.node.getIdBegin(),t.length)).right=f.node.right,f.node.right=i,(s=f.path).push(i)}}return this.balance(s),new nr.LogootSAdd(i.getIdBegin(),t)},e.prototype.getXest=function(e,t){for(var n=t[t.length-1],r=e(n);null!==r;)n=r,t[t.length]=r,r=e(r);return n},e.prototype.searchPos=function(e,t){for(var n=0,r=this.root;null!==r;)if(t.push(r),-1===e.compareTo(r.getIdBegin()))r=r.left;else if(1===e.compareTo(r.getIdEnd()))n=n+r.leftSubtreeSize()+r.length,r=r.right;else{if(e.equalsBase(r.getIdBegin()))return n+r.leftSubtreeSize();r=null}return-1},e.prototype.searchNode=function(e){console.assert(Wn.isInt32(e),"pos  int32");for(var t=this.root,n=[];null!==t;){n.push(t);var r=t.leftSubtreeSize();if(e<r)t=t.left;else{if(e<r+t.length)return{i:e-r,node:t,path:n};e-=r+t.length,t=t.right}}return null},e.prototype.ascendentUpdate=function(e,t){console.assert(Wn.isInt32(t),"length  int32");for(var n=0,r=e;n<r.length;n++){r[n].addString(t)}},e.prototype.delBlock=function(e,t){for(var n,r=this,i=[];;){var o=[];if(-1===(n=this.searchPos(e.idBegin,o))){if(!(e.begin<e.end))break;var s=Hn.Identifier.fromBase(e.idBegin,e.begin+1);e=new Kn.IdentifierInterval(s,e.end)}else{var a=o[o.length-1],c=Math.min(e.end,a.actualEnd),u=n+e.begin-a.actualBegin,l=c-e.begin+1;i.push(new tr.TextDelete(u,l,t));var h=a.deleteOffsets(e.begin,c);if(0===a.length?this.delNode(o):null!==h?(o.push(h),this.balance(o)):this.ascendentUpdate(o,e.begin-c-1),c===e.end)break;s=Hn.Identifier.fromBase(e.idBegin,c);e=new Kn.IdentifierInterval(s,e.end)}}return i.forEach(function(e){r.applyTextDelete(e)}),i},e.prototype.delLocal=function(e,t){console.assert(Wn.isInt32(e),"begin  int32"),console.assert(Wn.isInt32(t),"end  int32"),console.assert(e<=t,""+e," <= "+t),this.str=or.del(this.str,e,t);var n=t-e+1,r=[];do{var i=this.searchNode(e);if(null!==i){var o=i.node.actualBegin+i.i,s=Math.min(o+n-1,i.node.actualEnd),a=i.node.getIdBegin(),c=Hn.Identifier.fromBase(a,o);r.push(new Kn.IdentifierInterval(c,s));var u=i.node.deleteOffsets(o,s);n-=s-o+1,0===i.node.length?this.delNode(i.path):null!==u?(i.path.push(u),this.balance(i.path)):this.ascendentUpdate(i.path,o-s-1)}else n=0}while(n>0);return new Qn.LogootSDel(r,this.replicaNumber)},e.prototype.delNode=function(e){var t=e[e.length-1];if(0===t.block.nbElement&&delete this.mapBaseToBlock[t.block.idInterval.base.join(",")],null===t.right)t===this.root?this.root=t.left:(e.pop(),e[e.length-1].replaceChildren(t,t.left));else if(null===t.left)t===this.root?this.root=t.right:(e.pop(),e[e.length-1].replaceChildren(t,t.right));else{e.push(t.right);var n=this.getMinPath(e);t.become(n),e.pop(),e[e.length-1].replaceChildren(n,n.right)}this.balance(e)},e.prototype.getMinPath=function(e){console.assert(0!==e.length,"path has at least one item");for(var t=e[e.length-1];null!==t.left;)t=t.left,e.push(t);return t},e.prototype.balance=function(e){for(;e.length>0;){var t=e.pop(),n=0===e.length?null:e[e.length-1];t.sumDirectChildren();for(var r=t.balanceScore();Math.abs(r)>=2;)n=r>=2?null!==t.right&&t.right.balanceScore()<=-1?this.rotateRL(t,n):this.rotateLeft(t,n):null!==t.left&&t.left.balanceScore()>=1?this.rotateLR(t,n):this.rotateRight(t,n),e.push(n),r=t.balanceScore()}},e.prototype.rotateLeft=function(e,t){console.assert(null!==e.right,"There exists a right node"),console.assert(e===this.root==(null===t),"The father is null when we are rotating left the root");var n=e.right;return e===this.root?this.root=n:t.replaceChildren(e,n),e.right=n.left,n.left=e,e.sumDirectChildren(),n.sumDirectChildren(),n},e.prototype.rotateRight=function(e,t){console.assert(null!==e.left,"There exists a left node"),console.assert(e===this.root==(null===t),"The father is null when we are rotating right the root");var n=e.left;return e===this.root?this.root=n:t.replaceChildren(e,n),e.left=n.right,n.right=e,e.sumDirectChildren(),n.sumDirectChildren(),n},e.prototype.rotateRL=function(e,t){console.assert(null!==e.right,"There exists a right node");var n=e.right;return console.assert(null!==n.left,"There exists a left node of the right node"),this.rotateRight(n,e),this.rotateLeft(e,t)},e.prototype.rotateLR=function(e,t){console.assert(null!==e.left,"There exists a left node");var n=e.left;return console.assert(null!==n.right,"There exists a right node of the left node"),this.rotateLeft(n,e),this.rotateRight(e,t)},e.prototype.getNext=function(e){var t=e[e.length-1];if(null===t.right){if(e.length>1)if(e[e.length-2].left===t)return e.pop(),!0;return!1}return e.push(t.right),this.getXest(n,e),!0},e.prototype.digest=function(){var e=0,t=this.root;if(null!==t)for(var n=0,r=t.toList();n<r.length;n++){e=17*e+r[n].digest()|0}return e},e}();t.LogootSRopes=i});Gn(sr);sr.LogootSRopes;var ar=$n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.documentLength=e.str.length,this.treeHeight=e.height,this.nodeNumber=0,this.nodeLengths=[],this.identifierLengths=[],this.nodesStats={max:0,min:-1,mean:0,median:0,lengthRepartition:new Map},this.identifiersStats={max:0,min:-1,mean:0,median:0,lengthRepartition:new Map},this.compute(e)}return Object.defineProperty(e.prototype,"numberOfNodes",{get:function(){return this.nodeNumber},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxNodeLength",{get:function(){return this.nodesStats.max},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minNodeLength",{get:function(){return this.nodesStats.min},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"meanNodeLength",{get:function(){return this.nodesStats.mean},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"medianNodeLength",{get:function(){return this.nodesStats.median},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"repartitionNodeLength",{get:function(){return this.nodesStats.lengthRepartition},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"repartitionNodeLengthString",{get:function(){var e=Array.from(this.nodesStats.lengthRepartition);e.sort(function(e,t){return e[0]-t[0]});var t="";return e.forEach(function(e){t+="("+e[0]+", "+e[1]+"), "}),t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxIdentifierLength",{get:function(){return this.identifiersStats.max},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minIdentifierLength",{get:function(){return this.identifiersStats.min},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"meanIdentifierLength",{get:function(){return this.identifiersStats.mean},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"medianIdentifierLength",{get:function(){return this.identifiersStats.median},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"repartitionIdentifierLength",{get:function(){return this.identifiersStats.lengthRepartition},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"repartitionIdentifierLengthString",{get:function(){var e=Array.from(this.identifiersStats.lengthRepartition);e.sort(function(e,t){return e[0]-t[0]});var t="";return e.forEach(function(e){t+="("+e[0]+", "+e[1]+"), "}),t},enumerable:!0,configurable:!0}),e.prototype.toString=function(){var e="";return e+="Document stats : \n",e+="\t Document length : "+this.documentLength+"\n",e+="\t Number of nodes : "+this.numberOfNodes+"\n",e+="\t Height of the tree : "+this.treeHeight+"\n",e+="\t Nodes : \n",e+="\t\tMax length : "+this.maxNodeLength+"\n",e+="\t\tMin length : "+this.minNodeLength+"\n",e+="\t\tMean length : "+this.meanNodeLength+"\n",e+="\t\tMedian length : "+this.medianNodeLength+"\n",e+="\t\tLength repartition : "+this.repartitionNodeLengthString+"\n",e+="\t Identifier : \n",e+="\t\tMax length : "+this.maxIdentifierLength+"\n",e+="\t\tMin length : "+this.minIdentifierLength+"\n",e+="\t\tMean length : "+this.meanIdentifierLength+"\n",e+="\t\tMedian length : "+this.medianIdentifierLength+"\n",e+="\t\tLength repartition : "+this.repartitionIdentifierLengthString+"\n"},e.prototype.compute=function(e){this.nodeNumber=this.recCompute(e.root),this.nodeLengths=this.nodeLengths.sort(function(e,t){return e-t}),this.identifierLengths=this.identifierLengths.sort(function(e,t){return e-t}),this.nodesStats.mean/=this.nodeNumber;var t=this.nodeLengths.length;this.nodesStats.median=t%2==0?(this.nodeLengths[t/2]+this.nodeLengths[t/2+1])/2:this.nodeLengths[Math.ceil(t/2)],this.identifiersStats.mean/=this.nodeNumber;var n=this.identifierLengths.length;this.identifiersStats.median=n%2==0?(this.identifierLengths[n/2]+this.identifierLengths[n/2+1])/2:this.identifierLengths[Math.ceil(n/2)]},e.prototype.recCompute=function(e){if(!e)return 0;var t=e.length;(this.nodeLengths.push(t),this.nodesStats.max=this.nodesStats.max<t?t:this.nodesStats.max,this.nodesStats.min=-1===this.nodesStats.min?t:this.nodesStats.min>t?t:this.nodesStats.min,this.nodesStats.mean+=t,this.nodesStats.lengthRepartition.has(t))?(n=this.nodesStats.lengthRepartition.get(t))&&this.nodesStats.lengthRepartition.set(t,n+1):this.nodesStats.lengthRepartition.set(t,1);var n,r=e.getIdBegin().length;(this.identifierLengths.push(r),this.identifiersStats.max=this.identifiersStats.max<r?r:this.identifiersStats.max,this.identifiersStats.min=-1===this.identifiersStats.min?r:this.identifiersStats.min>r?r:this.identifiersStats.min,this.identifiersStats.mean+=r,this.identifiersStats.lengthRepartition.has(r)&&this.identifiersStats.lengthRepartition)?(n=this.identifiersStats.lengthRepartition.get(r))&&this.identifiersStats.lengthRepartition.set(r,n+1):this.identifiersStats.lengthRepartition.set(r,1);return this.recCompute(e.left)+1+this.recCompute(e.right)},e}();t.Stats=n});Gn(ar);ar.Stats;var cr=$n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isDot=qn.isDot,t.IdentifierTuple=Vn.IdentifierTuple,t.Identifier=Hn.Identifier,t.IdentifierInterval=Kn.IdentifierInterval,t.LogootSBlock=Jn.LogootSBlock,t.LogootSRopes=sr.LogootSRopes,t.RopesNodes=ir.RopesNodes,t.LogootSDel=Qn.LogootSDel,t.TextDelete=tr.TextDelete,t.LogootSAdd=nr.LogootSAdd,t.TextInsert=rr.TextInsert,t.LogootSOperation=Yn.LogootSOperation,t.TextOperation=er.TextOperation,t.Stats=ar.Stats,t.insert=or.insert,t.del=or.del,t.occurrences=or.occurrences});Gn(cr);cr.isDot,cr.IdentifierTuple;var ur=cr.Identifier,lr=(cr.IdentifierInterval,cr.LogootSBlock,cr.LogootSRopes),hr=(cr.RopesNodes,cr.LogootSDel),pr=cr.TextDelete,fr=cr.LogootSAdd,dr=cr.TextInsert,yr=(cr.LogootSOperation,cr.TextOperation,cr.Stats,cr.insert,cr.del,cr.occurrences,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.fromPlain=function(e){if("object"==typeof e&&null!==e&&"number"==typeof e.id&&Number.isInteger(e.id)&&"number"==typeof e.clock&&Number.isInteger(e.clock)){var t=fr.fromPlain(e.logootSOp);if(t instanceof fr)return new br(e.id,e.clock,t);var n=hr.fromPlain(e.logootSOp);if(n instanceof hr)return e.dependencies instanceof Array&&e.dependencies.length>0?new br(e.id,e.clock,n,new Map(e.dependencies)):e.dependencies instanceof Map&&e.dependencies.size>0?new br(e.id,e.clock,n,e.dependencies):new br(e.id,e.clock,n,new Map)}return null},t}(Tn)),br=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.fromPlain=function(e){if("object"==typeof e&&null!==e&&"number"==typeof e.id&&Number.isInteger(e.id)&&"number"==typeof e.clock&&Number.isInteger(e.clock)){var n=fr.fromPlain(e.operation);if(n instanceof fr)return new t(e.id,e.clock,n);var r=hr.fromPlain(e.operation);if(r instanceof hr)return e.dependencies instanceof Array&&e.dependencies.length>0?new t(e.id,e.clock,r,new Map(e.dependencies)):e.dependencies instanceof Map&&e.dependencies.size>0?new t(e.id,e.clock,r,e.dependencies):new t(e.id,e.clock,r,new Map)}return yr.fromPlain(e)},t.prototype.equals=function(t){var n=!1;return this.operation instanceof fr&&t.operation instanceof fr?n=this.operation.equals(t.operation):this.operation instanceof hr&&t.operation instanceof hr&&(n=this.operation.equals(t.operation)),e.prototype.equals.call(this,t)&&n},t}(Tn),gr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.emptyState=function(){var e=rt();return new t(e,new lr(e),[],new Map,0)},t.fromPlain=function(e){if(null!==e&&"object"==typeof e&&e.remoteOperations instanceof Array){var n=e.remoteOperations.map(function(e){return br.fromPlain(e)});if(n.filter(function(e){return null===e}).length>0)return null;if(this.isArray(e.vector)&&e.sequenceCRDT&&"object"==typeof e.sequenceCRDT&&"number"==typeof e.sequenceCRDT.replicaNumber&&Number.isInteger(e.sequenceCRDT.replicaNumber)&&"number"==typeof e.sequenceCRDT.clock){var r=new Map(e.vector),i=lr.fromPlain(e.sequenceCRDT.replicaNumber,e.sequenceCRDT.clock,e.sequenceCRDT);if(!i)return null;var o=void 0;if("number"!=typeof e.networkClock||!Number.isInteger(e.networkClock))return null;o=e.networkClock;return"number"==typeof e.id&&Number.isInteger(e.id)?new t(e.id,i,n,r,o):null}var s=new t(0,new lr,[],new Map,0);return n.forEach(function(e){s.vector.set(e.id,e.clock),e.operation.execute(s._sequenceCRDT)}),s}return null},t}(An);var mr=function(){function e(){}return e.fromPlain=function(e,n){var r;switch(e){case t.Strategy.LOGOOTSPLIT:r=function(e,t){return e.fromPlain(t)}(gr,n);break;default:r=null}return r},e.emptyState=function(e){var n;switch(e){case t.Strategy.LOGOOTSPLIT:n=gr.emptyState();break;default:n=null}return n},e.getStr=function(e){return e instanceof gr?e.sequenceCRDT.str:void 0},e}(),vr=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}s(t,e),t.prototype.computeDependencies=function(e){return new Map}}(Nn),function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.computeDependencies=function(e){var t=this,n=new Map;return e instanceof hr&&e.lid.forEach(function(e){var r=e.idBegin.replicaNumber;n.set(r,t.vector.get(r))}),n},t}(Nn)),wr=function(e){function t(t,n,r,i,o){return e.call(this,t,n,r,i,o)||this}return s(t,e),t.prototype.logLocalOperation=function(e,t,n){if(n instanceof fr){var r=n,i=t;this._localOperationForLog$.next({type:"localInsertion",siteId:e,clock:this.sync.stateElements.networkClock,position:i.index,content:i.content,length:i.content.length,operation:r,context:this.sync.stateElements.vector})}else if(n instanceof hr){r=n,i=t;this._localOperationForLog$.next({type:"localDeletion",siteId:e,clock:this.sync.stateElements.networkClock,position:i.index,length:i.length,operation:r,context:this.sync.stateElements.vector})}},t.prototype.logRemoteOperation=function(e,t,n,r,i){if(n instanceof fr){var o=n;this._remoteOperationForLog.next({type:"remoteInsertion",siteId:e,remoteSiteId:i,remoteClock:r,textOperation:t,operation:o,context:this.sync.stateElements.vector})}else if(n instanceof hr){o=n;this._remoteOperationForLog.next({type:"remoteDeletion",siteId:e,remoteSiteId:i,remoteClock:r,textOperation:t,operation:o,context:this.sync.stateElements.vector})}},Object.defineProperty(t.prototype,"state",{get:function(){var e=this.sync.stateElements,t=e.vector,n=e.richOperations,r=e.networkClock;return new gr(this.id,this.document.doc,n,t,r)},enumerable:!0,configurable:!0}),t}(xn),Sr=function(e){function t(t){var n=e.call(this,t)||this;return n._doc=t,n}return s(t,e),t.prototype.handleLocalOperation=function(e){var t=this;e.forEach(function(e){var n=e.applyTo(t.doc);t.localOperationLogsSubject.next({textop:e,operation:n}),t.localOperationSubject.next(n)})},t.prototype.handleRemoteOperation=function(e){var t=e.execute(this.doc);return this.remoteOperationLogsSubject.next({textop:t,operation:e}),t},t.prototype.positionFromIndex=function(e){var t=this.doc.searchNode(e);if(null!==t){var n=t.node.actualBegin+t.i;return{id:ur.fromBase(t.node.getIdBegin(),n),index:t.i}}},t.prototype.indexFromId=function(e){return this.doc.searchPos(ur.fromPlain(e),new Array)},t}(En),Or=function(e){function t(t,n){return e.call(this,t,n)||this}return s(t,e),t.prototype.serializeRichOperation=function(e){var t=e.id,n=e.clock,r=e.operation,i=e.dependencies,o=Array.from(i).reduce(function(e,t){var n=t[0]+"",r=Object.create({});return r[n]=t[1],a({},e,r)},{}),s=wn.RichLogootSOperationMsg.create({id:t,clock:n,dependencies:o}),c=wn.RichOperationMsg.create({richLogootSOpsMsg:s});return c.richLogootSOpsMsg&&(r instanceof hr?c.richLogootSOpsMsg.logootSDelMsg=wn.LogootSDelMsg.create(r):r instanceof fr&&(c.richLogootSOpsMsg.logootSAddMsg=wn.LogootSAddMsg.create(r))),c},t.prototype.deserializeRichOperation=function(e){if(e.richLogootSOpsMsg){var t=fr.fromPlain(e.richLogootSOpsMsg.logootSAddMsg),n=hr.fromPlain(e.richLogootSOpsMsg.logootSDelMsg),r=new Map,i=e.richLogootSOpsMsg.dependencies;i&&"object"==typeof i&&Object.entries(i).forEach(function(e){r.set(parseInt(e[0],10),e[1])});var o=br.fromPlain({id:e.richLogootSOpsMsg.id,clock:e.richLogootSOpsMsg.clock,operation:t||n,dependencies:r});if(o)return o;throw new Error("Error in fromPlain")}throw new Error("Can't deserialize the RichOperation message : "+e)},t}(Pn),Ir=function(){function e(){}return e.createDocService=function(e,n,r,i,o,s){switch(e){case t.Strategy.LOGOOTSPLIT:if(o instanceof gr){var a=new Sr(o.sequenceCRDT),c=new vr(i,o.networkClock,o.vector,o.remoteOperations,s),u=new Or(n,r);return new wr(i,s,a,c,u)}throw new Error("State is not an instanceof LSState");default:throw new Error("This strategy doesn't exist")}},e}();var _r=function(){function e(){}return e.fromPlain=function(e,n){var r;switch(e){case t.Strategy.LOGOOTSPLIT:r=function(e,t){return e.fromPlain(t)}(br,n);break;default:r=null}return r},e}(),xr=function(e){function t(t,n){var r,i=t.profile,o=t.strategy,s=t.docContent,c=t.metaTitle,u=t.metaFixData,l=t.metaLogs,h=e.call(this)||this;return 0!==s.id?(r=s.id,i.muteCoreId=r):(r=i.muteCoreId||rt(),i.muteCoreId||(i.muteCoreId=r)),h._messageOut$=new Oe,h._messageIn$=new Oe,h.collaboratorsService=new Fn(h._messageIn$,h._messageOut$,a({id:0},i)),h.metaDataService=new Un(h._messageIn$,h._messageOut$,c,u,l,r),h.docService=n(o,h._messageIn$,h._messageOut$,r,s,h.collaboratorsService),h}return s(t,e),t.mergeTitle=function(e,t){return Un.mergeTitle(e,t)},t.mergeFixData=function(e,t){return Un.mergeFixData(e,t)},Object.defineProperty(t.prototype,"myMuteCoreId",{get:function(){return this.collaboratorsService.me.muteCoreId||0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this.docService.state},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"messageIn$",{set:function(e){var t=this;this.newSub=e.subscribe(function(e){return t._messageIn$.next(e)})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"messageOut$",{get:function(){return this._messageOut$.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"localOperationForLog$",{get:function(){return this.docService.localOperationForLog$},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"remoteOperationForLog",{get:function(){return this.docService.remoteOperationForLog$},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"localTextOperations$",{set:function(e){this.docService.localTextOperations$=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"remoteTextOperations$",{get:function(){return this.docService.remoteTextOperations$},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"digestUpdate$",{get:function(){return this.docService.digestUpdate$},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"remoteCollabUpdate$",{get:function(){return this.collaboratorsService.remoteUpdate$},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"localCollabUpdate$",{set:function(e){this.collaboratorsService.localUpdate=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"collabJoin$",{get:function(){return this.collaboratorsService.join$},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"collabLeave$",{get:function(){return this.collaboratorsService.leave$},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"memberJoin$",{set:function(e){this.collaboratorsService.memberJoin$=e,this.metaDataService.memberJoin$=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"memberLeave$",{set:function(e){this.collaboratorsService.memberLeave$=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"remoteMetadataUpdate$",{get:function(){return this.metaDataService.remoteUpdate$},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"localMetadataUpdate$",{set:function(e){this.metaDataService.localUpdate$=e},enumerable:!0,configurable:!0}),t.prototype.synchronize=function(){this.docService.synchronize()},t.prototype.indexFromId=function(e){return this.docService.indexFromId(e)},t.prototype.positionFromIndex=function(e){return this.docService.positionFromIndex(e)},t}(i),Er=function(){function e(){}return e.createMuteCore=function(e){switch(e.strategy){case t.Strategy.LOGOOTSPLIT:if(e.docContent instanceof gr)return new xr(e,Ir.createDocService);throw new Error("")}},e}();try{nt.crypto=r}catch(e){console.error(e.message)}t.MuteCore=xr,t.MuteCoreFactory=Er,t.TextInsert=dr,t.TextDelete=pr,t.RichOperation=Tn,t.State=An,t.StateStrategy=mr,t.RichOperationStrategy=_r},function(e,t){e.exports=require("bunyan")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.Message=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(23));var i=r.Reader,o=r.Writer,s=r.util,a=r.roots.default||(r.roots.default={});t.Message=a.Message=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.streamId=0,e.prototype.content=s.newBuffer([]),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=o.create()),null!=e.streamId&&e.hasOwnProperty("streamId")&&t.uint32(8).uint32(e.streamId),null!=e.content&&e.hasOwnProperty("content")&&t.uint32(18).bytes(e.content),t},e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new a.Message;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.streamId=e.uint32();break;case 2:r.content=e.bytes();break;default:e.skipType(7&o)}}return r},e}();t.default=a},function(e,t){e.exports=require("protobufjs/minimal")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(8),i=n(25),o=n(9),s=n(4),a="Untitled Document";t.MongooseAdapter=class{constructor(){this.DocModel=i.model("Doc",new i.Schema({key:String,signalingKey:{type:String,require:!0},cryptoKey:{type:String,default:""},title:{type:String,default:a},titleModified:{type:Number,default:0},created:Number,logins:[],operations:Array,shareLogs:Boolean,shareLogsVector:{type:Map,of:Number}}))}connect(e,t){return i.connection.on("close",()=>s.log.warn("Connection to the database has been closed")),i.connect(`mongodb://${e}:27017/${t}`,{useNewUrlParser:!0})}async find(e){const t=await this.DocModel.findOne({signalingKey:e}).exec();if(t){const e=t.get("key");e&&(t.set({key:void 0,signalingKey:e,cryptoKey:await r.Symmetric.generateKey()}),await t.save())}return t}async lookupMetadataByLogin(e){const t=await this.DocModel.find({logins:e},"-operations -logins").exec(),n=[];for(const e of t){const t=e.get("key");t&&(e.set({key:void 0,signalingKey:t,cryptoKey:await r.Symmetric.generateKey()}),await e.save());const i=e.get("signalingKey"),o=e.get("cryptoKey"),s=e.get("title"),a=e.get("titleModified"),c=e.get("created"),u=e.get("shareLogs"),l=this.getShareVector(e);n.push({signalingKey:i,cryptoKey:o,title:s,titleModified:a,created:c,shareLogs:u,shareLogsVector:l})}return n}async removeLogin(e,t){const n=await this.find(e);if(n){const e=n.get("logins");for(let n=0;n<e.length;n++)if(e[n]===t){e.splice(n);break}n.set("logins",e),await n.save()}}async create(e){const t=await r.Symmetric.generateKey();return this.DocModel.create({signalingKey:e,created:Date.now(),cryptoKey:t})}getShareVector(e){const t=e.get("shareLogsVector");if(o.isUndefined(t))return new Map;const n=new Map;for(const e of t.keys()){const r=parseInt(e,10);n.set(r,t.get(e))}return n}}},function(e,t){e.exports=require("mongoose")},function(e){e.exports={name:"mute-bot-storage",version:"2.3.0",description:"",main:"index.js",scripts:{start:"node server.js",dev:"nodemon --watch src -e js,ts --exec 'npm run build && chmod +x dist/server.js && node dist/server.js --cors --logLevel trace | bunyan'",build:"webpack",lint:"tslint --fix -p tsconfig.json 'src/**/*.ts' -e 'src/**/*.proto' -e 'src/**/*.d.ts' && prettier --write --list-different 'src/**/*.ts' './*.{ts,js,json,md}'  && markdownlint ./*.md -i 'CHANGELOG.md'",proto:"pbjs -t static-module -w es6 --no-verify --no-delimited --no-convert src/proto/index.proto -o src/proto/index.es6.js && pbts src/proto/index.es6.js -o src/proto/index.d.ts",postproto:"babel --presets env -o src/proto/index.js src/proto/index.es6.js && rm src/proto/index.es6.js",cz:"git-cz",precommit:"lint-staged && npm run build && git add dist/*",commitmsg:"commitlint -e $GIT_PARAMS",prerelease:"npm run build && git add dist/*",release:"standard-version --no-verify"},files:["dist/server.js"],keywords:["bot","storage","peer-network"],author:"",engines:{node:">=8.1.4"},license:"AGPL-3.0",dependencies:{"@coast-team/mute-core":"^9.1.2","@coast-team/mute-crypto":"^0.4.1",bunyan:"^1.8.12",commander:"^2.18.0",kcors:"^2.2.2",koa:"^2.5.2","koa-bodyparser":"^4.2.1","koa-router":"^7.4.0",mongoose:"^5.2.13",netflux:"^4.3.1","node-webcrypto-ossl":"^1.0.38",protobufjs:"^6.8.8",rxjs:"^6.3.3","text-encoding":"^0.6.4",uws:"10.148.1"},devDependencies:{"@commitlint/cli":"^7.1.2","@commitlint/config-conventional":"^7.1.2","@types/bunyan":"^1.8.4","@types/commander":"^2.12.2","@types/kcors":"^2.2.3","@types/koa":"^2.0.46","@types/koa-bodyparser":"^5.0.1","@types/koa-router":"^7.0.31","@types/mongoose":"^5.2.11","@types/node":"^8.10.29","babel-cli":"^6.26.0","babel-preset-env":"^1.7.0",commitizen:"^2.10.1","cz-conventional-changelog":"^2.1.0",husky:"^0.14.3","lint-staged":"^7.2.2","markdownlint-cli":"^0.13.0",nodemon:"^1.18.4",prettier:"^1.14.2","standard-version":"^4.4.0","ts-loader":"^5.0.0",tslint:"^5.11.0","tslint-config-prettier":"^1.15.0",typescript:"^3.0.3","validate-commit-msg":"^2.11.1",webpack:"^4.17.2","webpack-cli":"^3.1.0","webpack-node-externals":"^1.7.2"},commitlint:{extends:["@commitlint/config-conventional"]},config:{commitizen:{path:"node_modules/cz-conventional-changelog"}},"lint-staged":{linters:{"*.md":["prettier --write --list-different","git add","markdownlint -i 'CHANGELOG.md'"],"*.ts":["tslint --fix -p tsconfig.json -e src/proto/* -e 'src/**/*.d.ts'","git add"],"*.{ts,json,scss,css}":["prettier --write --list-different -e *proto*","git add"]},concurrent:!1}}},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("https")}]);