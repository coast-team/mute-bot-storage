!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=12)}([function(t,e){t.exports=require("rxjs")},function(t,e){t.exports=require("rxjs/operators")},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(22);e.createLogger=function(t,n){const i={name:"mute-bot-storage"};switch(""!==t&&(i.streams=[{type:"rotating-file",period:"1d",count:3,path:`${t}/${i.name}.log`}]),e.log=r.createLogger(i),n){case"none":e.log.level(r.FATAL+1);break;case"trace":e.log.level(r.TRACE);break;case"debug":e.log.level(r.DEBUG);break;case"info":e.log.level(r.INFO);break;case"warn":e.log.level(r.WARN);break;case"error":e.log.level(r.ERROR);break;case"fatal":e.log.level(r.FATAL);break;default:e.log.level(r.INFO)}}},function(t,e){t.exports=require("uws")},function(t,e,n){"use strict";n.r(e);var r=n(10),i=n.n(r),o={};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
function s(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(s,a)}u((r=r.apply(t,e||[])).next())})}function a(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}var u=new Uint8Array([1,0,1]),c={name:"RSA-OAEP",modulusLength:2048,hash:{name:"SHA-256"},publicExponent:u},h={name:"RSA-PSS",modulusLength:2048,hash:{name:"SHA-256"},publicExponent:u},l={name:"RSA-OAEP"},f={name:"RSA-PSS",saltLength:128},p={name:"RSA-OAEP",hash:{name:"SHA-256"}},d={name:"RSA-PSS",hash:{name:"SHA-256"}},y="jwk";var b=Object.freeze({generateSigningKeyPair:function(){return o.crypto.subtle.generateKey(h,!0,["sign","verify"])},generateEncryptionKeyPair:function(){return o.crypto.subtle.generateKey(c,!0,["encrypt","decrypt"])},exportKey:function(t){return s(this,void 0,void 0,function(){return a(this,function(e){return[2,o.crypto.subtle.exportKey(y,t)]})})},importKey:function(t){return s(this,void 0,void 0,function(){var e,n;return a(this,function(r){if(e=new TypeError("key_ops should not be undefined.    cryptoKeyPairData should be the same object as returned by exportKey ..."),t.key_ops){if(n=void 0,t.key_ops.includes("verify"))n=[d,"verify"];else if(t.key_ops.includes("encrypt"))n=[p,"encrypt"];else if(t.key_ops.includes("sign"))n=[d,"sign"];else{if(!t.key_ops.includes("decrypt"))throw e;n=[p,"decrypt"]}return[2,o.crypto.subtle.importKey(y,t,n[0],!0,[n[1]])]}throw e})})},sign:function(t,e){return s(this,void 0,void 0,function(){var n;return a(this,function(r){switch(r.label){case 0:return[4,o.crypto.subtle.sign(f,e,t)];case 1:return n=r.sent(),[2,new Uint8Array(n)]}})})},verifySignature:function(t,e,n){return s(this,void 0,void 0,function(){return a(this,function(r){return[2,o.crypto.subtle.verify(f,n,e,t)]})})},encrypt:function(t,e){return s(this,void 0,void 0,function(){var n;return a(this,function(r){switch(r.label){case 0:return[4,o.crypto.subtle.encrypt(l,e,t)];case 1:return n=r.sent(),[2,new Uint8Array(n)]}})})},decrypt:function(t,e){return s(this,void 0,void 0,function(){var n;return a(this,function(r){switch(r.label){case 0:return[4,o.crypto.subtle.decrypt(l,e,t)];case 1:return n=r.sent(),[2,new Uint8Array(n)]}})})}}),g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var m=function(t,e){return t(e={exports:{}},e.exports),e.exports}(function(t){!function(t,e){function n(t,e){if(!t)throw new Error(e||"Assertion failed")}function r(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}function o(t,e,n){if(o.isBN(t))return t;this.negative=0,this.words=null,this.length=0,this.red=null,null!==t&&("le"!==e&&"be"!==e||(n=e,e=10),this._init(t||0,e||10,n||"be"))}var s;"object"==typeof t?t.exports=o:e.BN=o,o.BN=o,o.wordSize=26;try{s=i.a.Buffer}catch(t){}function a(t,e,n){for(var r=0,i=Math.min(t.length,n),o=e;o<i;o++){var s=t.charCodeAt(o)-48;r<<=4,r|=s>=49&&s<=54?s-49+10:s>=17&&s<=22?s-17+10:15&s}return r}function u(t,e,n,r){for(var i=0,o=Math.min(t.length,n),s=e;s<o;s++){var a=t.charCodeAt(s)-48;i*=r,i+=a>=49?a-49+10:a>=17?a-17+10:a}return i}o.isBN=function(t){return t instanceof o||null!==t&&"object"==typeof t&&t.constructor.wordSize===o.wordSize&&Array.isArray(t.words)},o.max=function(t,e){return t.cmp(e)>0?t:e},o.min=function(t,e){return t.cmp(e)<0?t:e},o.prototype._init=function(t,e,r){if("number"==typeof t)return this._initNumber(t,e,r);if("object"==typeof t)return this._initArray(t,e,r);"hex"===e&&(e=16),n(e===(0|e)&&e>=2&&e<=36);var i=0;"-"===(t=t.toString().replace(/\s+/g,""))[0]&&i++,16===e?this._parseHex(t,i):this._parseBase(t,e,i),"-"===t[0]&&(this.negative=1),this.strip(),"le"===r&&this._initArray(this.toArray(),e,r)},o.prototype._initNumber=function(t,e,r){t<0&&(this.negative=1,t=-t),t<67108864?(this.words=[67108863&t],this.length=1):t<4503599627370496?(this.words=[67108863&t,t/67108864&67108863],this.length=2):(n(t<9007199254740992),this.words=[67108863&t,t/67108864&67108863,1],this.length=3),"le"===r&&this._initArray(this.toArray(),e,r)},o.prototype._initArray=function(t,e,r){if(n("number"==typeof t.length),t.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(t.length/3),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var o,s,a=0;if("be"===r)for(i=t.length-1,o=0;i>=0;i-=3)s=t[i]|t[i-1]<<8|t[i-2]<<16,this.words[o]|=s<<a&67108863,this.words[o+1]=s>>>26-a&67108863,(a+=24)>=26&&(a-=26,o++);else if("le"===r)for(i=0,o=0;i<t.length;i+=3)s=t[i]|t[i+1]<<8|t[i+2]<<16,this.words[o]|=s<<a&67108863,this.words[o+1]=s>>>26-a&67108863,(a+=24)>=26&&(a-=26,o++);return this.strip()},o.prototype._parseHex=function(t,e){this.length=Math.ceil((t.length-e)/6),this.words=new Array(this.length);for(var n=0;n<this.length;n++)this.words[n]=0;var r,i,o=0;for(n=t.length-6,r=0;n>=e;n-=6)i=a(t,n,n+6),this.words[r]|=i<<o&67108863,this.words[r+1]|=i>>>26-o&4194303,(o+=24)>=26&&(o-=26,r++);n+6!==e&&(i=a(t,e,n+6),this.words[r]|=i<<o&67108863,this.words[r+1]|=i>>>26-o&4194303),this.strip()},o.prototype._parseBase=function(t,e,n){this.words=[0],this.length=1;for(var r=0,i=1;i<=67108863;i*=e)r++;r--,i=i/e|0;for(var o=t.length-n,s=o%r,a=Math.min(o,o-s)+n,c=0,h=n;h<a;h+=r)c=u(t,h,h+r,e),this.imuln(i),this.words[0]+c<67108864?this.words[0]+=c:this._iaddn(c);if(0!==s){var l=1;for(c=u(t,h,t.length,e),h=0;h<s;h++)l*=e;this.imuln(l),this.words[0]+c<67108864?this.words[0]+=c:this._iaddn(c)}},o.prototype.copy=function(t){t.words=new Array(this.length);for(var e=0;e<this.length;e++)t.words[e]=this.words[e];t.length=this.length,t.negative=this.negative,t.red=this.red},o.prototype.clone=function(){var t=new o(null);return this.copy(t),t},o.prototype._expand=function(t){for(;this.length<t;)this.words[this.length++]=0;return this},o.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},o.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},o.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var c=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],h=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],l=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function f(t,e,n){n.negative=e.negative^t.negative;var r=t.length+e.length|0;n.length=r,r=r-1|0;var i=0|t.words[0],o=0|e.words[0],s=i*o,a=67108863&s,u=s/67108864|0;n.words[0]=a;for(var c=1;c<r;c++){for(var h=u>>>26,l=67108863&u,f=Math.min(c,e.length-1),p=Math.max(0,c-t.length+1);p<=f;p++){var d=c-p|0;h+=(s=(i=0|t.words[d])*(o=0|e.words[p])+l)/67108864|0,l=67108863&s}n.words[c]=0|l,u=0|h}return 0!==u?n.words[c]=0|u:n.length--,n.strip()}o.prototype.toString=function(t,e){var r;if(e=0|e||1,16===(t=t||10)||"hex"===t){r="";for(var i=0,o=0,s=0;s<this.length;s++){var a=this.words[s],u=(16777215&(a<<i|o)).toString(16);r=0!==(o=a>>>24-i&16777215)||s!==this.length-1?c[6-u.length]+u+r:u+r,(i+=2)>=26&&(i-=26,s--)}for(0!==o&&(r=o.toString(16)+r);r.length%e!=0;)r="0"+r;return 0!==this.negative&&(r="-"+r),r}if(t===(0|t)&&t>=2&&t<=36){var f=h[t],p=l[t];r="";var d=this.clone();for(d.negative=0;!d.isZero();){var y=d.modn(p).toString(t);r=(d=d.idivn(p)).isZero()?y+r:c[f-y.length]+y+r}for(this.isZero()&&(r="0"+r);r.length%e!=0;)r="0"+r;return 0!==this.negative&&(r="-"+r),r}n(!1,"Base should be between 2 and 36")},o.prototype.toNumber=function(){var t=this.words[0];return 2===this.length?t+=67108864*this.words[1]:3===this.length&&1===this.words[2]?t+=4503599627370496+67108864*this.words[1]:this.length>2&&n(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-t:t},o.prototype.toJSON=function(){return this.toString(16)},o.prototype.toBuffer=function(t,e){return n(void 0!==s),this.toArrayLike(s,t,e)},o.prototype.toArray=function(t,e){return this.toArrayLike(Array,t,e)},o.prototype.toArrayLike=function(t,e,r){var i=this.byteLength(),o=r||Math.max(1,i);n(i<=o,"byte array longer than desired length"),n(o>0,"Requested array length <= 0"),this.strip();var s,a,u="le"===e,c=new t(o),h=this.clone();if(u){for(a=0;!h.isZero();a++)s=h.andln(255),h.iushrn(8),c[a]=s;for(;a<o;a++)c[a]=0}else{for(a=0;a<o-i;a++)c[a]=0;for(a=0;!h.isZero();a++)s=h.andln(255),h.iushrn(8),c[o-a-1]=s}return c},Math.clz32?o.prototype._countBits=function(t){return 32-Math.clz32(t)}:o.prototype._countBits=function(t){var e=t,n=0;return e>=4096&&(n+=13,e>>>=13),e>=64&&(n+=7,e>>>=7),e>=8&&(n+=4,e>>>=4),e>=2&&(n+=2,e>>>=2),n+e},o.prototype._zeroBits=function(t){if(0===t)return 26;var e=t,n=0;return 0==(8191&e)&&(n+=13,e>>>=13),0==(127&e)&&(n+=7,e>>>=7),0==(15&e)&&(n+=4,e>>>=4),0==(3&e)&&(n+=2,e>>>=2),0==(1&e)&&n++,n},o.prototype.bitLength=function(){var t=this.words[this.length-1],e=this._countBits(t);return 26*(this.length-1)+e},o.prototype.zeroBits=function(){if(this.isZero())return 0;for(var t=0,e=0;e<this.length;e++){var n=this._zeroBits(this.words[e]);if(t+=n,26!==n)break}return t},o.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},o.prototype.toTwos=function(t){return 0!==this.negative?this.abs().inotn(t).iaddn(1):this.clone()},o.prototype.fromTwos=function(t){return this.testn(t-1)?this.notn(t).iaddn(1).ineg():this.clone()},o.prototype.isNeg=function(){return 0!==this.negative},o.prototype.neg=function(){return this.clone().ineg()},o.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},o.prototype.iuor=function(t){for(;this.length<t.length;)this.words[this.length++]=0;for(var e=0;e<t.length;e++)this.words[e]=this.words[e]|t.words[e];return this.strip()},o.prototype.ior=function(t){return n(0==(this.negative|t.negative)),this.iuor(t)},o.prototype.or=function(t){return this.length>t.length?this.clone().ior(t):t.clone().ior(this)},o.prototype.uor=function(t){return this.length>t.length?this.clone().iuor(t):t.clone().iuor(this)},o.prototype.iuand=function(t){var e;e=this.length>t.length?t:this;for(var n=0;n<e.length;n++)this.words[n]=this.words[n]&t.words[n];return this.length=e.length,this.strip()},o.prototype.iand=function(t){return n(0==(this.negative|t.negative)),this.iuand(t)},o.prototype.and=function(t){return this.length>t.length?this.clone().iand(t):t.clone().iand(this)},o.prototype.uand=function(t){return this.length>t.length?this.clone().iuand(t):t.clone().iuand(this)},o.prototype.iuxor=function(t){var e,n;this.length>t.length?(e=this,n=t):(e=t,n=this);for(var r=0;r<n.length;r++)this.words[r]=e.words[r]^n.words[r];if(this!==e)for(;r<e.length;r++)this.words[r]=e.words[r];return this.length=e.length,this.strip()},o.prototype.ixor=function(t){return n(0==(this.negative|t.negative)),this.iuxor(t)},o.prototype.xor=function(t){return this.length>t.length?this.clone().ixor(t):t.clone().ixor(this)},o.prototype.uxor=function(t){return this.length>t.length?this.clone().iuxor(t):t.clone().iuxor(this)},o.prototype.inotn=function(t){n("number"==typeof t&&t>=0);var e=0|Math.ceil(t/26),r=t%26;this._expand(e),r>0&&e--;for(var i=0;i<e;i++)this.words[i]=67108863&~this.words[i];return r>0&&(this.words[i]=~this.words[i]&67108863>>26-r),this.strip()},o.prototype.notn=function(t){return this.clone().inotn(t)},o.prototype.setn=function(t,e){n("number"==typeof t&&t>=0);var r=t/26|0,i=t%26;return this._expand(r+1),this.words[r]=e?this.words[r]|1<<i:this.words[r]&~(1<<i),this.strip()},o.prototype.iadd=function(t){var e,n,r;if(0!==this.negative&&0===t.negative)return this.negative=0,e=this.isub(t),this.negative^=1,this._normSign();if(0===this.negative&&0!==t.negative)return t.negative=0,e=this.isub(t),t.negative=1,e._normSign();this.length>t.length?(n=this,r=t):(n=t,r=this);for(var i=0,o=0;o<r.length;o++)e=(0|n.words[o])+(0|r.words[o])+i,this.words[o]=67108863&e,i=e>>>26;for(;0!==i&&o<n.length;o++)e=(0|n.words[o])+i,this.words[o]=67108863&e,i=e>>>26;if(this.length=n.length,0!==i)this.words[this.length]=i,this.length++;else if(n!==this)for(;o<n.length;o++)this.words[o]=n.words[o];return this},o.prototype.add=function(t){var e;return 0!==t.negative&&0===this.negative?(t.negative=0,e=this.sub(t),t.negative^=1,e):0===t.negative&&0!==this.negative?(this.negative=0,e=t.sub(this),this.negative=1,e):this.length>t.length?this.clone().iadd(t):t.clone().iadd(this)},o.prototype.isub=function(t){if(0!==t.negative){t.negative=0;var e=this.iadd(t);return t.negative=1,e._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(t),this.negative=1,this._normSign();var n,r,i=this.cmp(t);if(0===i)return this.negative=0,this.length=1,this.words[0]=0,this;i>0?(n=this,r=t):(n=t,r=this);for(var o=0,s=0;s<r.length;s++)o=(e=(0|n.words[s])-(0|r.words[s])+o)>>26,this.words[s]=67108863&e;for(;0!==o&&s<n.length;s++)o=(e=(0|n.words[s])+o)>>26,this.words[s]=67108863&e;if(0===o&&s<n.length&&n!==this)for(;s<n.length;s++)this.words[s]=n.words[s];return this.length=Math.max(this.length,s),n!==this&&(this.negative=1),this.strip()},o.prototype.sub=function(t){return this.clone().isub(t)};var p=function(t,e,n){var r,i,o,s=t.words,a=e.words,u=n.words,c=0,h=0|s[0],l=8191&h,f=h>>>13,p=0|s[1],d=8191&p,y=p>>>13,b=0|s[2],g=8191&b,m=b>>>13,v=0|s[3],w=8191&v,S=v>>>13,O=0|s[4],M=8191&O,I=O>>>13,_=0|s[5],x=8191&_,E=_>>>13,k=0|s[6],T=8191&k,C=k>>>13,j=0|s[7],A=8191&j,N=j>>>13,P=0|s[8],R=8191&P,B=P>>>13,L=0|s[9],D=8191&L,F=L>>>13,U=0|a[0],q=8191&U,z=U>>>13,$=0|a[1],G=8191&$,K=$>>>13,V=0|a[2],W=8191&V,H=V>>>13,J=0|a[3],Z=8191&J,X=J>>>13,Y=0|a[4],Q=8191&Y,tt=Y>>>13,et=0|a[5],nt=8191&et,rt=et>>>13,it=0|a[6],ot=8191&it,st=it>>>13,at=0|a[7],ut=8191&at,ct=at>>>13,ht=0|a[8],lt=8191&ht,ft=ht>>>13,pt=0|a[9],dt=8191&pt,yt=pt>>>13;n.negative=t.negative^e.negative,n.length=19;var bt=(c+(r=Math.imul(l,q))|0)+((8191&(i=(i=Math.imul(l,z))+Math.imul(f,q)|0))<<13)|0;c=((o=Math.imul(f,z))+(i>>>13)|0)+(bt>>>26)|0,bt&=67108863,r=Math.imul(d,q),i=(i=Math.imul(d,z))+Math.imul(y,q)|0,o=Math.imul(y,z);var gt=(c+(r=r+Math.imul(l,G)|0)|0)+((8191&(i=(i=i+Math.imul(l,K)|0)+Math.imul(f,G)|0))<<13)|0;c=((o=o+Math.imul(f,K)|0)+(i>>>13)|0)+(gt>>>26)|0,gt&=67108863,r=Math.imul(g,q),i=(i=Math.imul(g,z))+Math.imul(m,q)|0,o=Math.imul(m,z),r=r+Math.imul(d,G)|0,i=(i=i+Math.imul(d,K)|0)+Math.imul(y,G)|0,o=o+Math.imul(y,K)|0;var mt=(c+(r=r+Math.imul(l,W)|0)|0)+((8191&(i=(i=i+Math.imul(l,H)|0)+Math.imul(f,W)|0))<<13)|0;c=((o=o+Math.imul(f,H)|0)+(i>>>13)|0)+(mt>>>26)|0,mt&=67108863,r=Math.imul(w,q),i=(i=Math.imul(w,z))+Math.imul(S,q)|0,o=Math.imul(S,z),r=r+Math.imul(g,G)|0,i=(i=i+Math.imul(g,K)|0)+Math.imul(m,G)|0,o=o+Math.imul(m,K)|0,r=r+Math.imul(d,W)|0,i=(i=i+Math.imul(d,H)|0)+Math.imul(y,W)|0,o=o+Math.imul(y,H)|0;var vt=(c+(r=r+Math.imul(l,Z)|0)|0)+((8191&(i=(i=i+Math.imul(l,X)|0)+Math.imul(f,Z)|0))<<13)|0;c=((o=o+Math.imul(f,X)|0)+(i>>>13)|0)+(vt>>>26)|0,vt&=67108863,r=Math.imul(M,q),i=(i=Math.imul(M,z))+Math.imul(I,q)|0,o=Math.imul(I,z),r=r+Math.imul(w,G)|0,i=(i=i+Math.imul(w,K)|0)+Math.imul(S,G)|0,o=o+Math.imul(S,K)|0,r=r+Math.imul(g,W)|0,i=(i=i+Math.imul(g,H)|0)+Math.imul(m,W)|0,o=o+Math.imul(m,H)|0,r=r+Math.imul(d,Z)|0,i=(i=i+Math.imul(d,X)|0)+Math.imul(y,Z)|0,o=o+Math.imul(y,X)|0;var wt=(c+(r=r+Math.imul(l,Q)|0)|0)+((8191&(i=(i=i+Math.imul(l,tt)|0)+Math.imul(f,Q)|0))<<13)|0;c=((o=o+Math.imul(f,tt)|0)+(i>>>13)|0)+(wt>>>26)|0,wt&=67108863,r=Math.imul(x,q),i=(i=Math.imul(x,z))+Math.imul(E,q)|0,o=Math.imul(E,z),r=r+Math.imul(M,G)|0,i=(i=i+Math.imul(M,K)|0)+Math.imul(I,G)|0,o=o+Math.imul(I,K)|0,r=r+Math.imul(w,W)|0,i=(i=i+Math.imul(w,H)|0)+Math.imul(S,W)|0,o=o+Math.imul(S,H)|0,r=r+Math.imul(g,Z)|0,i=(i=i+Math.imul(g,X)|0)+Math.imul(m,Z)|0,o=o+Math.imul(m,X)|0,r=r+Math.imul(d,Q)|0,i=(i=i+Math.imul(d,tt)|0)+Math.imul(y,Q)|0,o=o+Math.imul(y,tt)|0;var St=(c+(r=r+Math.imul(l,nt)|0)|0)+((8191&(i=(i=i+Math.imul(l,rt)|0)+Math.imul(f,nt)|0))<<13)|0;c=((o=o+Math.imul(f,rt)|0)+(i>>>13)|0)+(St>>>26)|0,St&=67108863,r=Math.imul(T,q),i=(i=Math.imul(T,z))+Math.imul(C,q)|0,o=Math.imul(C,z),r=r+Math.imul(x,G)|0,i=(i=i+Math.imul(x,K)|0)+Math.imul(E,G)|0,o=o+Math.imul(E,K)|0,r=r+Math.imul(M,W)|0,i=(i=i+Math.imul(M,H)|0)+Math.imul(I,W)|0,o=o+Math.imul(I,H)|0,r=r+Math.imul(w,Z)|0,i=(i=i+Math.imul(w,X)|0)+Math.imul(S,Z)|0,o=o+Math.imul(S,X)|0,r=r+Math.imul(g,Q)|0,i=(i=i+Math.imul(g,tt)|0)+Math.imul(m,Q)|0,o=o+Math.imul(m,tt)|0,r=r+Math.imul(d,nt)|0,i=(i=i+Math.imul(d,rt)|0)+Math.imul(y,nt)|0,o=o+Math.imul(y,rt)|0;var Ot=(c+(r=r+Math.imul(l,ot)|0)|0)+((8191&(i=(i=i+Math.imul(l,st)|0)+Math.imul(f,ot)|0))<<13)|0;c=((o=o+Math.imul(f,st)|0)+(i>>>13)|0)+(Ot>>>26)|0,Ot&=67108863,r=Math.imul(A,q),i=(i=Math.imul(A,z))+Math.imul(N,q)|0,o=Math.imul(N,z),r=r+Math.imul(T,G)|0,i=(i=i+Math.imul(T,K)|0)+Math.imul(C,G)|0,o=o+Math.imul(C,K)|0,r=r+Math.imul(x,W)|0,i=(i=i+Math.imul(x,H)|0)+Math.imul(E,W)|0,o=o+Math.imul(E,H)|0,r=r+Math.imul(M,Z)|0,i=(i=i+Math.imul(M,X)|0)+Math.imul(I,Z)|0,o=o+Math.imul(I,X)|0,r=r+Math.imul(w,Q)|0,i=(i=i+Math.imul(w,tt)|0)+Math.imul(S,Q)|0,o=o+Math.imul(S,tt)|0,r=r+Math.imul(g,nt)|0,i=(i=i+Math.imul(g,rt)|0)+Math.imul(m,nt)|0,o=o+Math.imul(m,rt)|0,r=r+Math.imul(d,ot)|0,i=(i=i+Math.imul(d,st)|0)+Math.imul(y,ot)|0,o=o+Math.imul(y,st)|0;var Mt=(c+(r=r+Math.imul(l,ut)|0)|0)+((8191&(i=(i=i+Math.imul(l,ct)|0)+Math.imul(f,ut)|0))<<13)|0;c=((o=o+Math.imul(f,ct)|0)+(i>>>13)|0)+(Mt>>>26)|0,Mt&=67108863,r=Math.imul(R,q),i=(i=Math.imul(R,z))+Math.imul(B,q)|0,o=Math.imul(B,z),r=r+Math.imul(A,G)|0,i=(i=i+Math.imul(A,K)|0)+Math.imul(N,G)|0,o=o+Math.imul(N,K)|0,r=r+Math.imul(T,W)|0,i=(i=i+Math.imul(T,H)|0)+Math.imul(C,W)|0,o=o+Math.imul(C,H)|0,r=r+Math.imul(x,Z)|0,i=(i=i+Math.imul(x,X)|0)+Math.imul(E,Z)|0,o=o+Math.imul(E,X)|0,r=r+Math.imul(M,Q)|0,i=(i=i+Math.imul(M,tt)|0)+Math.imul(I,Q)|0,o=o+Math.imul(I,tt)|0,r=r+Math.imul(w,nt)|0,i=(i=i+Math.imul(w,rt)|0)+Math.imul(S,nt)|0,o=o+Math.imul(S,rt)|0,r=r+Math.imul(g,ot)|0,i=(i=i+Math.imul(g,st)|0)+Math.imul(m,ot)|0,o=o+Math.imul(m,st)|0,r=r+Math.imul(d,ut)|0,i=(i=i+Math.imul(d,ct)|0)+Math.imul(y,ut)|0,o=o+Math.imul(y,ct)|0;var It=(c+(r=r+Math.imul(l,lt)|0)|0)+((8191&(i=(i=i+Math.imul(l,ft)|0)+Math.imul(f,lt)|0))<<13)|0;c=((o=o+Math.imul(f,ft)|0)+(i>>>13)|0)+(It>>>26)|0,It&=67108863,r=Math.imul(D,q),i=(i=Math.imul(D,z))+Math.imul(F,q)|0,o=Math.imul(F,z),r=r+Math.imul(R,G)|0,i=(i=i+Math.imul(R,K)|0)+Math.imul(B,G)|0,o=o+Math.imul(B,K)|0,r=r+Math.imul(A,W)|0,i=(i=i+Math.imul(A,H)|0)+Math.imul(N,W)|0,o=o+Math.imul(N,H)|0,r=r+Math.imul(T,Z)|0,i=(i=i+Math.imul(T,X)|0)+Math.imul(C,Z)|0,o=o+Math.imul(C,X)|0,r=r+Math.imul(x,Q)|0,i=(i=i+Math.imul(x,tt)|0)+Math.imul(E,Q)|0,o=o+Math.imul(E,tt)|0,r=r+Math.imul(M,nt)|0,i=(i=i+Math.imul(M,rt)|0)+Math.imul(I,nt)|0,o=o+Math.imul(I,rt)|0,r=r+Math.imul(w,ot)|0,i=(i=i+Math.imul(w,st)|0)+Math.imul(S,ot)|0,o=o+Math.imul(S,st)|0,r=r+Math.imul(g,ut)|0,i=(i=i+Math.imul(g,ct)|0)+Math.imul(m,ut)|0,o=o+Math.imul(m,ct)|0,r=r+Math.imul(d,lt)|0,i=(i=i+Math.imul(d,ft)|0)+Math.imul(y,lt)|0,o=o+Math.imul(y,ft)|0;var _t=(c+(r=r+Math.imul(l,dt)|0)|0)+((8191&(i=(i=i+Math.imul(l,yt)|0)+Math.imul(f,dt)|0))<<13)|0;c=((o=o+Math.imul(f,yt)|0)+(i>>>13)|0)+(_t>>>26)|0,_t&=67108863,r=Math.imul(D,G),i=(i=Math.imul(D,K))+Math.imul(F,G)|0,o=Math.imul(F,K),r=r+Math.imul(R,W)|0,i=(i=i+Math.imul(R,H)|0)+Math.imul(B,W)|0,o=o+Math.imul(B,H)|0,r=r+Math.imul(A,Z)|0,i=(i=i+Math.imul(A,X)|0)+Math.imul(N,Z)|0,o=o+Math.imul(N,X)|0,r=r+Math.imul(T,Q)|0,i=(i=i+Math.imul(T,tt)|0)+Math.imul(C,Q)|0,o=o+Math.imul(C,tt)|0,r=r+Math.imul(x,nt)|0,i=(i=i+Math.imul(x,rt)|0)+Math.imul(E,nt)|0,o=o+Math.imul(E,rt)|0,r=r+Math.imul(M,ot)|0,i=(i=i+Math.imul(M,st)|0)+Math.imul(I,ot)|0,o=o+Math.imul(I,st)|0,r=r+Math.imul(w,ut)|0,i=(i=i+Math.imul(w,ct)|0)+Math.imul(S,ut)|0,o=o+Math.imul(S,ct)|0,r=r+Math.imul(g,lt)|0,i=(i=i+Math.imul(g,ft)|0)+Math.imul(m,lt)|0,o=o+Math.imul(m,ft)|0;var xt=(c+(r=r+Math.imul(d,dt)|0)|0)+((8191&(i=(i=i+Math.imul(d,yt)|0)+Math.imul(y,dt)|0))<<13)|0;c=((o=o+Math.imul(y,yt)|0)+(i>>>13)|0)+(xt>>>26)|0,xt&=67108863,r=Math.imul(D,W),i=(i=Math.imul(D,H))+Math.imul(F,W)|0,o=Math.imul(F,H),r=r+Math.imul(R,Z)|0,i=(i=i+Math.imul(R,X)|0)+Math.imul(B,Z)|0,o=o+Math.imul(B,X)|0,r=r+Math.imul(A,Q)|0,i=(i=i+Math.imul(A,tt)|0)+Math.imul(N,Q)|0,o=o+Math.imul(N,tt)|0,r=r+Math.imul(T,nt)|0,i=(i=i+Math.imul(T,rt)|0)+Math.imul(C,nt)|0,o=o+Math.imul(C,rt)|0,r=r+Math.imul(x,ot)|0,i=(i=i+Math.imul(x,st)|0)+Math.imul(E,ot)|0,o=o+Math.imul(E,st)|0,r=r+Math.imul(M,ut)|0,i=(i=i+Math.imul(M,ct)|0)+Math.imul(I,ut)|0,o=o+Math.imul(I,ct)|0,r=r+Math.imul(w,lt)|0,i=(i=i+Math.imul(w,ft)|0)+Math.imul(S,lt)|0,o=o+Math.imul(S,ft)|0;var Et=(c+(r=r+Math.imul(g,dt)|0)|0)+((8191&(i=(i=i+Math.imul(g,yt)|0)+Math.imul(m,dt)|0))<<13)|0;c=((o=o+Math.imul(m,yt)|0)+(i>>>13)|0)+(Et>>>26)|0,Et&=67108863,r=Math.imul(D,Z),i=(i=Math.imul(D,X))+Math.imul(F,Z)|0,o=Math.imul(F,X),r=r+Math.imul(R,Q)|0,i=(i=i+Math.imul(R,tt)|0)+Math.imul(B,Q)|0,o=o+Math.imul(B,tt)|0,r=r+Math.imul(A,nt)|0,i=(i=i+Math.imul(A,rt)|0)+Math.imul(N,nt)|0,o=o+Math.imul(N,rt)|0,r=r+Math.imul(T,ot)|0,i=(i=i+Math.imul(T,st)|0)+Math.imul(C,ot)|0,o=o+Math.imul(C,st)|0,r=r+Math.imul(x,ut)|0,i=(i=i+Math.imul(x,ct)|0)+Math.imul(E,ut)|0,o=o+Math.imul(E,ct)|0,r=r+Math.imul(M,lt)|0,i=(i=i+Math.imul(M,ft)|0)+Math.imul(I,lt)|0,o=o+Math.imul(I,ft)|0;var kt=(c+(r=r+Math.imul(w,dt)|0)|0)+((8191&(i=(i=i+Math.imul(w,yt)|0)+Math.imul(S,dt)|0))<<13)|0;c=((o=o+Math.imul(S,yt)|0)+(i>>>13)|0)+(kt>>>26)|0,kt&=67108863,r=Math.imul(D,Q),i=(i=Math.imul(D,tt))+Math.imul(F,Q)|0,o=Math.imul(F,tt),r=r+Math.imul(R,nt)|0,i=(i=i+Math.imul(R,rt)|0)+Math.imul(B,nt)|0,o=o+Math.imul(B,rt)|0,r=r+Math.imul(A,ot)|0,i=(i=i+Math.imul(A,st)|0)+Math.imul(N,ot)|0,o=o+Math.imul(N,st)|0,r=r+Math.imul(T,ut)|0,i=(i=i+Math.imul(T,ct)|0)+Math.imul(C,ut)|0,o=o+Math.imul(C,ct)|0,r=r+Math.imul(x,lt)|0,i=(i=i+Math.imul(x,ft)|0)+Math.imul(E,lt)|0,o=o+Math.imul(E,ft)|0;var Tt=(c+(r=r+Math.imul(M,dt)|0)|0)+((8191&(i=(i=i+Math.imul(M,yt)|0)+Math.imul(I,dt)|0))<<13)|0;c=((o=o+Math.imul(I,yt)|0)+(i>>>13)|0)+(Tt>>>26)|0,Tt&=67108863,r=Math.imul(D,nt),i=(i=Math.imul(D,rt))+Math.imul(F,nt)|0,o=Math.imul(F,rt),r=r+Math.imul(R,ot)|0,i=(i=i+Math.imul(R,st)|0)+Math.imul(B,ot)|0,o=o+Math.imul(B,st)|0,r=r+Math.imul(A,ut)|0,i=(i=i+Math.imul(A,ct)|0)+Math.imul(N,ut)|0,o=o+Math.imul(N,ct)|0,r=r+Math.imul(T,lt)|0,i=(i=i+Math.imul(T,ft)|0)+Math.imul(C,lt)|0,o=o+Math.imul(C,ft)|0;var Ct=(c+(r=r+Math.imul(x,dt)|0)|0)+((8191&(i=(i=i+Math.imul(x,yt)|0)+Math.imul(E,dt)|0))<<13)|0;c=((o=o+Math.imul(E,yt)|0)+(i>>>13)|0)+(Ct>>>26)|0,Ct&=67108863,r=Math.imul(D,ot),i=(i=Math.imul(D,st))+Math.imul(F,ot)|0,o=Math.imul(F,st),r=r+Math.imul(R,ut)|0,i=(i=i+Math.imul(R,ct)|0)+Math.imul(B,ut)|0,o=o+Math.imul(B,ct)|0,r=r+Math.imul(A,lt)|0,i=(i=i+Math.imul(A,ft)|0)+Math.imul(N,lt)|0,o=o+Math.imul(N,ft)|0;var jt=(c+(r=r+Math.imul(T,dt)|0)|0)+((8191&(i=(i=i+Math.imul(T,yt)|0)+Math.imul(C,dt)|0))<<13)|0;c=((o=o+Math.imul(C,yt)|0)+(i>>>13)|0)+(jt>>>26)|0,jt&=67108863,r=Math.imul(D,ut),i=(i=Math.imul(D,ct))+Math.imul(F,ut)|0,o=Math.imul(F,ct),r=r+Math.imul(R,lt)|0,i=(i=i+Math.imul(R,ft)|0)+Math.imul(B,lt)|0,o=o+Math.imul(B,ft)|0;var At=(c+(r=r+Math.imul(A,dt)|0)|0)+((8191&(i=(i=i+Math.imul(A,yt)|0)+Math.imul(N,dt)|0))<<13)|0;c=((o=o+Math.imul(N,yt)|0)+(i>>>13)|0)+(At>>>26)|0,At&=67108863,r=Math.imul(D,lt),i=(i=Math.imul(D,ft))+Math.imul(F,lt)|0,o=Math.imul(F,ft);var Nt=(c+(r=r+Math.imul(R,dt)|0)|0)+((8191&(i=(i=i+Math.imul(R,yt)|0)+Math.imul(B,dt)|0))<<13)|0;c=((o=o+Math.imul(B,yt)|0)+(i>>>13)|0)+(Nt>>>26)|0,Nt&=67108863;var Pt=(c+(r=Math.imul(D,dt))|0)+((8191&(i=(i=Math.imul(D,yt))+Math.imul(F,dt)|0))<<13)|0;return c=((o=Math.imul(F,yt))+(i>>>13)|0)+(Pt>>>26)|0,Pt&=67108863,u[0]=bt,u[1]=gt,u[2]=mt,u[3]=vt,u[4]=wt,u[5]=St,u[6]=Ot,u[7]=Mt,u[8]=It,u[9]=_t,u[10]=xt,u[11]=Et,u[12]=kt,u[13]=Tt,u[14]=Ct,u[15]=jt,u[16]=At,u[17]=Nt,u[18]=Pt,0!==c&&(u[19]=c,n.length++),n};function d(t,e,n){return(new y).mulp(t,e,n)}function y(t,e){this.x=t,this.y=e}Math.imul||(p=f),o.prototype.mulTo=function(t,e){var n=this.length+t.length;return 10===this.length&&10===t.length?p(this,t,e):n<63?f(this,t,e):n<1024?function(t,e,n){n.negative=e.negative^t.negative,n.length=t.length+e.length;for(var r=0,i=0,o=0;o<n.length-1;o++){var s=i;i=0;for(var a=67108863&r,u=Math.min(o,e.length-1),c=Math.max(0,o-t.length+1);c<=u;c++){var h=o-c,l=(0|t.words[h])*(0|e.words[c]),f=67108863&l;a=67108863&(f=f+a|0),i+=(s=(s=s+(l/67108864|0)|0)+(f>>>26)|0)>>>26,s&=67108863}n.words[o]=a,r=s,s=i}return 0!==r?n.words[o]=r:n.length--,n.strip()}(this,t,e):d(this,t,e)},y.prototype.makeRBT=function(t){for(var e=new Array(t),n=o.prototype._countBits(t)-1,r=0;r<t;r++)e[r]=this.revBin(r,n,t);return e},y.prototype.revBin=function(t,e,n){if(0===t||t===n-1)return t;for(var r=0,i=0;i<e;i++)r|=(1&t)<<e-i-1,t>>=1;return r},y.prototype.permute=function(t,e,n,r,i,o){for(var s=0;s<o;s++)r[s]=e[t[s]],i[s]=n[t[s]]},y.prototype.transform=function(t,e,n,r,i,o){this.permute(o,t,e,n,r,i);for(var s=1;s<i;s<<=1)for(var a=s<<1,u=Math.cos(2*Math.PI/a),c=Math.sin(2*Math.PI/a),h=0;h<i;h+=a)for(var l=u,f=c,p=0;p<s;p++){var d=n[h+p],y=r[h+p],b=n[h+p+s],g=r[h+p+s],m=l*b-f*g;g=l*g+f*b,b=m,n[h+p]=d+b,r[h+p]=y+g,n[h+p+s]=d-b,r[h+p+s]=y-g,p!==a&&(m=u*l-c*f,f=u*f+c*l,l=m)}},y.prototype.guessLen13b=function(t,e){var n=1|Math.max(e,t),r=1&n,i=0;for(n=n/2|0;n;n>>>=1)i++;return 1<<i+1+r},y.prototype.conjugate=function(t,e,n){if(!(n<=1))for(var r=0;r<n/2;r++){var i=t[r];t[r]=t[n-r-1],t[n-r-1]=i,i=e[r],e[r]=-e[n-r-1],e[n-r-1]=-i}},y.prototype.normalize13b=function(t,e){for(var n=0,r=0;r<e/2;r++){var i=8192*Math.round(t[2*r+1]/e)+Math.round(t[2*r]/e)+n;t[r]=67108863&i,n=i<67108864?0:i/67108864|0}return t},y.prototype.convert13b=function(t,e,r,i){for(var o=0,s=0;s<e;s++)o+=0|t[s],r[2*s]=8191&o,o>>>=13,r[2*s+1]=8191&o,o>>>=13;for(s=2*e;s<i;++s)r[s]=0;n(0===o),n(0==(-8192&o))},y.prototype.stub=function(t){for(var e=new Array(t),n=0;n<t;n++)e[n]=0;return e},y.prototype.mulp=function(t,e,n){var r=2*this.guessLen13b(t.length,e.length),i=this.makeRBT(r),o=this.stub(r),s=new Array(r),a=new Array(r),u=new Array(r),c=new Array(r),h=new Array(r),l=new Array(r),f=n.words;f.length=r,this.convert13b(t.words,t.length,s,r),this.convert13b(e.words,e.length,c,r),this.transform(s,o,a,u,r,i),this.transform(c,o,h,l,r,i);for(var p=0;p<r;p++){var d=a[p]*h[p]-u[p]*l[p];u[p]=a[p]*l[p]+u[p]*h[p],a[p]=d}return this.conjugate(a,u,r),this.transform(a,u,f,o,r,i),this.conjugate(f,o,r),this.normalize13b(f,r),n.negative=t.negative^e.negative,n.length=t.length+e.length,n.strip()},o.prototype.mul=function(t){var e=new o(null);return e.words=new Array(this.length+t.length),this.mulTo(t,e)},o.prototype.mulf=function(t){var e=new o(null);return e.words=new Array(this.length+t.length),d(this,t,e)},o.prototype.imul=function(t){return this.clone().mulTo(t,this)},o.prototype.imuln=function(t){n("number"==typeof t),n(t<67108864);for(var e=0,r=0;r<this.length;r++){var i=(0|this.words[r])*t,o=(67108863&i)+(67108863&e);e>>=26,e+=i/67108864|0,e+=o>>>26,this.words[r]=67108863&o}return 0!==e&&(this.words[r]=e,this.length++),this},o.prototype.muln=function(t){return this.clone().imuln(t)},o.prototype.sqr=function(){return this.mul(this)},o.prototype.isqr=function(){return this.imul(this.clone())},o.prototype.pow=function(t){var e=function(t){for(var e=new Array(t.bitLength()),n=0;n<e.length;n++){var r=n/26|0,i=n%26;e[n]=(t.words[r]&1<<i)>>>i}return e}(t);if(0===e.length)return new o(1);for(var n=this,r=0;r<e.length&&0===e[r];r++,n=n.sqr());if(++r<e.length)for(var i=n.sqr();r<e.length;r++,i=i.sqr())0!==e[r]&&(n=n.mul(i));return n},o.prototype.iushln=function(t){n("number"==typeof t&&t>=0);var e,r=t%26,i=(t-r)/26,o=67108863>>>26-r<<26-r;if(0!==r){var s=0;for(e=0;e<this.length;e++){var a=this.words[e]&o,u=(0|this.words[e])-a<<r;this.words[e]=u|s,s=a>>>26-r}s&&(this.words[e]=s,this.length++)}if(0!==i){for(e=this.length-1;e>=0;e--)this.words[e+i]=this.words[e];for(e=0;e<i;e++)this.words[e]=0;this.length+=i}return this.strip()},o.prototype.ishln=function(t){return n(0===this.negative),this.iushln(t)},o.prototype.iushrn=function(t,e,r){var i;n("number"==typeof t&&t>=0),i=e?(e-e%26)/26:0;var o=t%26,s=Math.min((t-o)/26,this.length),a=67108863^67108863>>>o<<o,u=r;if(i-=s,i=Math.max(0,i),u){for(var c=0;c<s;c++)u.words[c]=this.words[c];u.length=s}if(0===s);else if(this.length>s)for(this.length-=s,c=0;c<this.length;c++)this.words[c]=this.words[c+s];else this.words[0]=0,this.length=1;var h=0;for(c=this.length-1;c>=0&&(0!==h||c>=i);c--){var l=0|this.words[c];this.words[c]=h<<26-o|l>>>o,h=l&a}return u&&0!==h&&(u.words[u.length++]=h),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},o.prototype.ishrn=function(t,e,r){return n(0===this.negative),this.iushrn(t,e,r)},o.prototype.shln=function(t){return this.clone().ishln(t)},o.prototype.ushln=function(t){return this.clone().iushln(t)},o.prototype.shrn=function(t){return this.clone().ishrn(t)},o.prototype.ushrn=function(t){return this.clone().iushrn(t)},o.prototype.testn=function(t){n("number"==typeof t&&t>=0);var e=t%26,r=(t-e)/26,i=1<<e;return!(this.length<=r)&&!!(this.words[r]&i)},o.prototype.imaskn=function(t){n("number"==typeof t&&t>=0);var e=t%26,r=(t-e)/26;if(n(0===this.negative,"imaskn works only with positive numbers"),this.length<=r)return this;if(0!==e&&r++,this.length=Math.min(r,this.length),0!==e){var i=67108863^67108863>>>e<<e;this.words[this.length-1]&=i}return this.strip()},o.prototype.maskn=function(t){return this.clone().imaskn(t)},o.prototype.iaddn=function(t){return n("number"==typeof t),n(t<67108864),t<0?this.isubn(-t):0!==this.negative?1===this.length&&(0|this.words[0])<t?(this.words[0]=t-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(t),this.negative=1,this):this._iaddn(t)},o.prototype._iaddn=function(t){this.words[0]+=t;for(var e=0;e<this.length&&this.words[e]>=67108864;e++)this.words[e]-=67108864,e===this.length-1?this.words[e+1]=1:this.words[e+1]++;return this.length=Math.max(this.length,e+1),this},o.prototype.isubn=function(t){if(n("number"==typeof t),n(t<67108864),t<0)return this.iaddn(-t);if(0!==this.negative)return this.negative=0,this.iaddn(t),this.negative=1,this;if(this.words[0]-=t,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var e=0;e<this.length&&this.words[e]<0;e++)this.words[e]+=67108864,this.words[e+1]-=1;return this.strip()},o.prototype.addn=function(t){return this.clone().iaddn(t)},o.prototype.subn=function(t){return this.clone().isubn(t)},o.prototype.iabs=function(){return this.negative=0,this},o.prototype.abs=function(){return this.clone().iabs()},o.prototype._ishlnsubmul=function(t,e,r){var i,o,s=t.length+r;this._expand(s);var a=0;for(i=0;i<t.length;i++){o=(0|this.words[i+r])+a;var u=(0|t.words[i])*e;a=((o-=67108863&u)>>26)-(u/67108864|0),this.words[i+r]=67108863&o}for(;i<this.length-r;i++)a=(o=(0|this.words[i+r])+a)>>26,this.words[i+r]=67108863&o;if(0===a)return this.strip();for(n(-1===a),a=0,i=0;i<this.length;i++)a=(o=-(0|this.words[i])+a)>>26,this.words[i]=67108863&o;return this.negative=1,this.strip()},o.prototype._wordDiv=function(t,e){var n=(this.length,t.length),r=this.clone(),i=t,s=0|i.words[i.length-1];0!==(n=26-this._countBits(s))&&(i=i.ushln(n),r.iushln(n),s=0|i.words[i.length-1]);var a,u=r.length-i.length;if("mod"!==e){(a=new o(null)).length=u+1,a.words=new Array(a.length);for(var c=0;c<a.length;c++)a.words[c]=0}var h=r.clone()._ishlnsubmul(i,1,u);0===h.negative&&(r=h,a&&(a.words[u]=1));for(var l=u-1;l>=0;l--){var f=67108864*(0|r.words[i.length+l])+(0|r.words[i.length+l-1]);for(f=Math.min(f/s|0,67108863),r._ishlnsubmul(i,f,l);0!==r.negative;)f--,r.negative=0,r._ishlnsubmul(i,1,l),r.isZero()||(r.negative^=1);a&&(a.words[l]=f)}return a&&a.strip(),r.strip(),"div"!==e&&0!==n&&r.iushrn(n),{div:a||null,mod:r}},o.prototype.divmod=function(t,e,r){return n(!t.isZero()),this.isZero()?{div:new o(0),mod:new o(0)}:0!==this.negative&&0===t.negative?(a=this.neg().divmod(t,e),"mod"!==e&&(i=a.div.neg()),"div"!==e&&(s=a.mod.neg(),r&&0!==s.negative&&s.iadd(t)),{div:i,mod:s}):0===this.negative&&0!==t.negative?(a=this.divmod(t.neg(),e),"mod"!==e&&(i=a.div.neg()),{div:i,mod:a.mod}):0!=(this.negative&t.negative)?(a=this.neg().divmod(t.neg(),e),"div"!==e&&(s=a.mod.neg(),r&&0!==s.negative&&s.isub(t)),{div:a.div,mod:s}):t.length>this.length||this.cmp(t)<0?{div:new o(0),mod:this}:1===t.length?"div"===e?{div:this.divn(t.words[0]),mod:null}:"mod"===e?{div:null,mod:new o(this.modn(t.words[0]))}:{div:this.divn(t.words[0]),mod:new o(this.modn(t.words[0]))}:this._wordDiv(t,e);var i,s,a},o.prototype.div=function(t){return this.divmod(t,"div",!1).div},o.prototype.mod=function(t){return this.divmod(t,"mod",!1).mod},o.prototype.umod=function(t){return this.divmod(t,"mod",!0).mod},o.prototype.divRound=function(t){var e=this.divmod(t);if(e.mod.isZero())return e.div;var n=0!==e.div.negative?e.mod.isub(t):e.mod,r=t.ushrn(1),i=t.andln(1),o=n.cmp(r);return o<0||1===i&&0===o?e.div:0!==e.div.negative?e.div.isubn(1):e.div.iaddn(1)},o.prototype.modn=function(t){n(t<=67108863);for(var e=(1<<26)%t,r=0,i=this.length-1;i>=0;i--)r=(e*r+(0|this.words[i]))%t;return r},o.prototype.idivn=function(t){n(t<=67108863);for(var e=0,r=this.length-1;r>=0;r--){var i=(0|this.words[r])+67108864*e;this.words[r]=i/t|0,e=i%t}return this.strip()},o.prototype.divn=function(t){return this.clone().idivn(t)},o.prototype.egcd=function(t){n(0===t.negative),n(!t.isZero());var e=this,r=t.clone();e=0!==e.negative?e.umod(t):e.clone();for(var i=new o(1),s=new o(0),a=new o(0),u=new o(1),c=0;e.isEven()&&r.isEven();)e.iushrn(1),r.iushrn(1),++c;for(var h=r.clone(),l=e.clone();!e.isZero();){for(var f=0,p=1;0==(e.words[0]&p)&&f<26;++f,p<<=1);if(f>0)for(e.iushrn(f);f-- >0;)(i.isOdd()||s.isOdd())&&(i.iadd(h),s.isub(l)),i.iushrn(1),s.iushrn(1);for(var d=0,y=1;0==(r.words[0]&y)&&d<26;++d,y<<=1);if(d>0)for(r.iushrn(d);d-- >0;)(a.isOdd()||u.isOdd())&&(a.iadd(h),u.isub(l)),a.iushrn(1),u.iushrn(1);e.cmp(r)>=0?(e.isub(r),i.isub(a),s.isub(u)):(r.isub(e),a.isub(i),u.isub(s))}return{a:a,b:u,gcd:r.iushln(c)}},o.prototype._invmp=function(t){n(0===t.negative),n(!t.isZero());var e=this,r=t.clone();e=0!==e.negative?e.umod(t):e.clone();for(var i,s=new o(1),a=new o(0),u=r.clone();e.cmpn(1)>0&&r.cmpn(1)>0;){for(var c=0,h=1;0==(e.words[0]&h)&&c<26;++c,h<<=1);if(c>0)for(e.iushrn(c);c-- >0;)s.isOdd()&&s.iadd(u),s.iushrn(1);for(var l=0,f=1;0==(r.words[0]&f)&&l<26;++l,f<<=1);if(l>0)for(r.iushrn(l);l-- >0;)a.isOdd()&&a.iadd(u),a.iushrn(1);e.cmp(r)>=0?(e.isub(r),s.isub(a)):(r.isub(e),a.isub(s))}return(i=0===e.cmpn(1)?s:a).cmpn(0)<0&&i.iadd(t),i},o.prototype.gcd=function(t){if(this.isZero())return t.abs();if(t.isZero())return this.abs();var e=this.clone(),n=t.clone();e.negative=0,n.negative=0;for(var r=0;e.isEven()&&n.isEven();r++)e.iushrn(1),n.iushrn(1);for(;;){for(;e.isEven();)e.iushrn(1);for(;n.isEven();)n.iushrn(1);var i=e.cmp(n);if(i<0){var o=e;e=n,n=o}else if(0===i||0===n.cmpn(1))break;e.isub(n)}return n.iushln(r)},o.prototype.invm=function(t){return this.egcd(t).a.umod(t)},o.prototype.isEven=function(){return 0==(1&this.words[0])},o.prototype.isOdd=function(){return 1==(1&this.words[0])},o.prototype.andln=function(t){return this.words[0]&t},o.prototype.bincn=function(t){n("number"==typeof t);var e=t%26,r=(t-e)/26,i=1<<e;if(this.length<=r)return this._expand(r+1),this.words[r]|=i,this;for(var o=i,s=r;0!==o&&s<this.length;s++){var a=0|this.words[s];o=(a+=o)>>>26,a&=67108863,this.words[s]=a}return 0!==o&&(this.words[s]=o,this.length++),this},o.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},o.prototype.cmpn=function(t){var e,r=t<0;if(0!==this.negative&&!r)return-1;if(0===this.negative&&r)return 1;if(this.strip(),this.length>1)e=1;else{r&&(t=-t),n(t<=67108863,"Number is too big");var i=0|this.words[0];e=i===t?0:i<t?-1:1}return 0!==this.negative?0|-e:e},o.prototype.cmp=function(t){if(0!==this.negative&&0===t.negative)return-1;if(0===this.negative&&0!==t.negative)return 1;var e=this.ucmp(t);return 0!==this.negative?0|-e:e},o.prototype.ucmp=function(t){if(this.length>t.length)return 1;if(this.length<t.length)return-1;for(var e=0,n=this.length-1;n>=0;n--){var r=0|this.words[n],i=0|t.words[n];if(r!==i){r<i?e=-1:r>i&&(e=1);break}}return e},o.prototype.gtn=function(t){return 1===this.cmpn(t)},o.prototype.gt=function(t){return 1===this.cmp(t)},o.prototype.gten=function(t){return this.cmpn(t)>=0},o.prototype.gte=function(t){return this.cmp(t)>=0},o.prototype.ltn=function(t){return-1===this.cmpn(t)},o.prototype.lt=function(t){return-1===this.cmp(t)},o.prototype.lten=function(t){return this.cmpn(t)<=0},o.prototype.lte=function(t){return this.cmp(t)<=0},o.prototype.eqn=function(t){return 0===this.cmpn(t)},o.prototype.eq=function(t){return 0===this.cmp(t)},o.red=function(t){return new O(t)},o.prototype.toRed=function(t){return n(!this.red,"Already a number in reduction context"),n(0===this.negative,"red works only with positives"),t.convertTo(this)._forceRed(t)},o.prototype.fromRed=function(){return n(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},o.prototype._forceRed=function(t){return this.red=t,this},o.prototype.forceRed=function(t){return n(!this.red,"Already a number in reduction context"),this._forceRed(t)},o.prototype.redAdd=function(t){return n(this.red,"redAdd works only with red numbers"),this.red.add(this,t)},o.prototype.redIAdd=function(t){return n(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,t)},o.prototype.redSub=function(t){return n(this.red,"redSub works only with red numbers"),this.red.sub(this,t)},o.prototype.redISub=function(t){return n(this.red,"redISub works only with red numbers"),this.red.isub(this,t)},o.prototype.redShl=function(t){return n(this.red,"redShl works only with red numbers"),this.red.shl(this,t)},o.prototype.redMul=function(t){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.mul(this,t)},o.prototype.redIMul=function(t){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.imul(this,t)},o.prototype.redSqr=function(){return n(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},o.prototype.redISqr=function(){return n(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},o.prototype.redSqrt=function(){return n(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},o.prototype.redInvm=function(){return n(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},o.prototype.redNeg=function(){return n(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},o.prototype.redPow=function(t){return n(this.red&&!t.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,t)};var b={k256:null,p224:null,p192:null,p25519:null};function g(t,e){this.name=t,this.p=new o(e,16),this.n=this.p.bitLength(),this.k=new o(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function m(){g.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function v(){g.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function w(){g.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function S(){g.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function O(t){if("string"==typeof t){var e=o._prime(t);this.m=e.p,this.prime=e}else n(t.gtn(1),"modulus must be greater than 1"),this.m=t,this.prime=null}function M(t){O.call(this,t),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new o(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}g.prototype._tmp=function(){var t=new o(null);return t.words=new Array(Math.ceil(this.n/13)),t},g.prototype.ireduce=function(t){var e,n=t;do{this.split(n,this.tmp),e=(n=(n=this.imulK(n)).iadd(this.tmp)).bitLength()}while(e>this.n);var r=e<this.n?-1:n.ucmp(this.p);return 0===r?(n.words[0]=0,n.length=1):r>0?n.isub(this.p):n.strip(),n},g.prototype.split=function(t,e){t.iushrn(this.n,0,e)},g.prototype.imulK=function(t){return t.imul(this.k)},r(m,g),m.prototype.split=function(t,e){for(var n=Math.min(t.length,9),r=0;r<n;r++)e.words[r]=t.words[r];if(e.length=n,t.length<=9)return t.words[0]=0,void(t.length=1);var i=t.words[9];for(e.words[e.length++]=4194303&i,r=10;r<t.length;r++){var o=0|t.words[r];t.words[r-10]=(4194303&o)<<4|i>>>22,i=o}i>>>=22,t.words[r-10]=i,0===i&&t.length>10?t.length-=10:t.length-=9},m.prototype.imulK=function(t){t.words[t.length]=0,t.words[t.length+1]=0,t.length+=2;for(var e=0,n=0;n<t.length;n++){var r=0|t.words[n];e+=977*r,t.words[n]=67108863&e,e=64*r+(e/67108864|0)}return 0===t.words[t.length-1]&&(t.length--,0===t.words[t.length-1]&&t.length--),t},r(v,g),r(w,g),r(S,g),S.prototype.imulK=function(t){for(var e=0,n=0;n<t.length;n++){var r=19*(0|t.words[n])+e,i=67108863&r;r>>>=26,t.words[n]=i,e=r}return 0!==e&&(t.words[t.length++]=e),t},o._prime=function(t){if(b[t])return b[t];var e;if("k256"===t)e=new m;else if("p224"===t)e=new v;else if("p192"===t)e=new w;else{if("p25519"!==t)throw new Error("Unknown prime "+t);e=new S}return b[t]=e,e},O.prototype._verify1=function(t){n(0===t.negative,"red works only with positives"),n(t.red,"red works only with red numbers")},O.prototype._verify2=function(t,e){n(0==(t.negative|e.negative),"red works only with positives"),n(t.red&&t.red===e.red,"red works only with red numbers")},O.prototype.imod=function(t){return this.prime?this.prime.ireduce(t)._forceRed(this):t.umod(this.m)._forceRed(this)},O.prototype.neg=function(t){return t.isZero()?t.clone():this.m.sub(t)._forceRed(this)},O.prototype.add=function(t,e){this._verify2(t,e);var n=t.add(e);return n.cmp(this.m)>=0&&n.isub(this.m),n._forceRed(this)},O.prototype.iadd=function(t,e){this._verify2(t,e);var n=t.iadd(e);return n.cmp(this.m)>=0&&n.isub(this.m),n},O.prototype.sub=function(t,e){this._verify2(t,e);var n=t.sub(e);return n.cmpn(0)<0&&n.iadd(this.m),n._forceRed(this)},O.prototype.isub=function(t,e){this._verify2(t,e);var n=t.isub(e);return n.cmpn(0)<0&&n.iadd(this.m),n},O.prototype.shl=function(t,e){return this._verify1(t),this.imod(t.ushln(e))},O.prototype.imul=function(t,e){return this._verify2(t,e),this.imod(t.imul(e))},O.prototype.mul=function(t,e){return this._verify2(t,e),this.imod(t.mul(e))},O.prototype.isqr=function(t){return this.imul(t,t.clone())},O.prototype.sqr=function(t){return this.mul(t,t)},O.prototype.sqrt=function(t){if(t.isZero())return t.clone();var e=this.m.andln(3);if(n(e%2==1),3===e){var r=this.m.add(new o(1)).iushrn(2);return this.pow(t,r)}for(var i=this.m.subn(1),s=0;!i.isZero()&&0===i.andln(1);)s++,i.iushrn(1);n(!i.isZero());var a=new o(1).toRed(this),u=a.redNeg(),c=this.m.subn(1).iushrn(1),h=this.m.bitLength();for(h=new o(2*h*h).toRed(this);0!==this.pow(h,c).cmp(u);)h.redIAdd(u);for(var l=this.pow(h,i),f=this.pow(t,i.addn(1).iushrn(1)),p=this.pow(t,i),d=s;0!==p.cmp(a);){for(var y=p,b=0;0!==y.cmp(a);b++)y=y.redSqr();n(b<d);var g=this.pow(l,new o(1).iushln(d-b-1));f=f.redMul(g),l=g.redSqr(),p=p.redMul(l),d=b}return f},O.prototype.invm=function(t){var e=t._invmp(this.m);return 0!==e.negative?(e.negative=0,this.imod(e).redNeg()):this.imod(e)},O.prototype.pow=function(t,e){if(e.isZero())return new o(1).toRed(this);if(0===e.cmpn(1))return t.clone();var n=new Array(16);n[0]=new o(1).toRed(this),n[1]=t;for(var r=2;r<n.length;r++)n[r]=this.mul(n[r-1],t);var i=n[0],s=0,a=0,u=e.bitLength()%26;for(0===u&&(u=26),r=e.length-1;r>=0;r--){for(var c=e.words[r],h=u-1;h>=0;h--){var l=c>>h&1;i!==n[0]&&(i=this.sqr(i)),0!==l||0!==s?(s<<=1,s|=l,(4===++a||0===r&&0===h)&&(i=this.mul(i,n[s]),a=0,s=0)):a=0}u=26}return i},O.prototype.convertTo=function(t){var e=t.umod(this.m);return e===t?e.clone():e},O.prototype.convertFrom=function(t){var e=t.clone();return e.red=null,e},o.mont=function(t){return new M(t)},r(M,O),M.prototype.convertTo=function(t){return this.imod(t.ushln(this.shift))},M.prototype.convertFrom=function(t){var e=this.imod(t.mul(this.rinv));return e.red=null,e},M.prototype.imul=function(t,e){if(t.isZero()||e.isZero())return t.words[0]=0,t.length=1,t;var n=t.imul(e),r=n.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),i=n.isub(r).iushrn(this.shift),o=i;return i.cmp(this.m)>=0?o=i.isub(this.m):i.cmpn(0)<0&&(o=i.iadd(this.m)),o._forceRed(this)},M.prototype.mul=function(t,e){if(t.isZero()||e.isZero())return new o(0)._forceRed(this);var n=t.mul(e),r=n.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),i=n.isub(r).iushrn(this.shift),s=i;return i.cmp(this.m)>=0?s=i.isub(this.m):i.cmpn(0)<0&&(s=i.iadd(this.m)),s._forceRed(this)},M.prototype.invm=function(t){return this.imod(t._invmp(this.m).mul(this.r2))._forceRed(this)}}(t,g)}).BN,v="AES-GCM",w=256,S=12,O=128,M={name:v,length:w},I={name:v};function _(t){return t?{name:v,iv:o.crypto.getRandomValues(new Uint8Array(S)),length:w,tagLength:O}:{name:v,iv:new Uint8Array,length:w,tagLength:O}}function x(t,e){return new Promise(function(n){var r=new Uint8Array(t.length+e.length);r.set(t),r.set(e,t.length),n(r)})}function E(t){return new Promise(function(e){e([t.slice(0,S),t.slice(S,t.length)])})}var k={format:"raw",algorithm:"PBKDF2",extractable:!1,keyUsages:["deriveKey"]},T={info:{name:"PBKDF2",salt:new Uint8Array,iterations:1,hash:"SHA-256"},symmKeyParams:{name:v,length:w},extractable:!0,keyUsages:["encrypt","decrypt"]},C=new m("FFFFFFFFFFFFFFFFC90FDAA22168C234C4C6628B80DC1CD129024E088A67CC74020BBEA63B139B22514A08798E3404DDEF9519B3CD3A431B302B0A6DF25F14374FE1356D6D51C245E485B576625E7EC6F44C42E9A637ED6B0BFF5CB6F406B7EDEE386BFB5A899FA5AE9F24117C4B1FE649286651ECE45B3DC2007CB8A163BF0598DA48361C55D39A69163FA8FD24CF5F83655D23DCA3AD961C62F356208552BB9ED529077096966D670C354E4ABC9804F1746C08CA18217C32905E462E36CE3BE39E772C180E86039B2783A2EC07A28FB5C55DF06F4C52C9DE2BCBF6955817183995497CEA956AE515D2261898FA051015728E5A8AAAC42DAD33170D04507A33A85521ABDF1CBA64ECFB850458DBEF0A8AEA71575D060C7DB3970F85A6E1E4C7ABF5AE8CDB0933D71E8C94E04A25619DCEE3D2261AD2EE6BF12FFA06D98A0864D87602733EC86A64521F2B18177B200CBBE117577A615D6C770988C0BAD946E208E24FA074E5AB3143DB5BFCE0FD108E4B82D120A93AD2CAFFFFFFFFFFFFFFFF",16),j=new m(2),A=64;function N(t){return t.toArrayLike(Uint8Array)}var P=m.mont(C);var R=Object.freeze({deriveKey:function(t){return s(this,void 0,void 0,function(){var e;return a(this,function(n){switch(n.label){case 0:return[4,o.crypto.subtle.importKey(k.format,t,k.algorithm,k.extractable,k.keyUsages)];case 1:return e=n.sent(),[2,o.crypto.subtle.deriveKey(T.info,e,T.symmKeyParams,T.extractable,T.keyUsages)]}})})},generateRi:function(){return t=o.crypto.getRandomValues(new Uint8Array(A)),new m(t);var t},computeZi:function(t){return N(j.toRed(P).redPow(t).fromRed())},computeXi:function(t,e,n){return N(new m(n).toRed(P).redInvm().redMul(new m(e).toRed(P)).redPow(t).fromRed())},computeSharedSecret:function(t,e,n,r){for(var i,o,s=new m(n).toRed(P).redPow(t.muln(r.length)),a=function(t,e){var n=-1;return t.forEach(function(t,r){(function(t,e){if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(var n=0;n!==t.byteLength;n++)if(t[n]!==e[n])return!1;return!0})(t,e)&&(n=r)}),n}(r,e),u=new m(r.length-1),c=0;u.gtn(0);c++)o=(a+c)%r.length,i=new m(r[o]).toRed(P).redPow(u),s.redIMul(i),u.isubn(1);return N(s.fromRed())}});var B=Object.freeze({generateEncryptionKey:function(){return s(this,void 0,void 0,function(){return a(this,function(t){return[2,o.crypto.subtle.generateKey(M,!0,["encrypt","decrypt"])]})})},exportKey:function(t){return s(this,void 0,void 0,function(){return a(this,function(e){return[2,o.crypto.subtle.exportKey(y,t)]})})},toB64:function(t){return btoa(JSON.stringify(t))},fromB64:function(t){return JSON.parse(atob(t))},importKey:function(t){return s(this,void 0,void 0,function(){return a(this,function(e){return[2,o.crypto.subtle.importKey(y,t,I,!0,["encrypt","decrypt"])]})})},encrypt:function(t,e){return s(this,void 0,void 0,function(){var n,r;return a(this,function(i){switch(i.label){case 0:return n=_(!0),[4,o.crypto.subtle.encrypt(n,e,t)];case 1:return r=i.sent(),[2,x(n.iv,new Uint8Array(r))]}})})},decrypt:function(t,e){return s(this,void 0,void 0,function(){var n,r,i,s,u;return a(this,function(a){switch(a.label){case 0:return[4,E(t)];case 1:return n=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}.apply(void 0,[a.sent(),2]),r=n[0],i=n[1],(s=_(!1)).iv=r,[4,o.crypto.subtle.decrypt(s,e,i)];case 2:return u=a.sent(),[2,new Uint8Array(u)]}})})}});try{var L=n(19);o.crypto=new L}catch(t){console.error(t.message)}var D=n(11);n.d(e,"KeyState",function(){return F}),n.d(e,"Symmetric",function(){return ht}),n.d(e,"KeyAgreementBD",function(){return ke}),n.d(e,"enableDebug",function(){return st}),n.d(e,"Streams",function(){return ut}),n.d(e,"MuteCrypto",function(){return ct}),n.d(e,"asymmetricCrypto",function(){return b});var F,U={};!function(t){t[t.UNDEFINED=0]="UNDEFINED",t[t.CALCUL_IN_PROGRESS=1]="CALCUL_IN_PROGRESS",t[t.READY=2]="READY"}(F||(F={}));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var q=function(t,e){return(q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function z(t,e){function n(){this.constructor=t}q(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function $(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(s,a)}u((r=r.apply(t,e||[])).next())})}function G(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function K(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function V(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function W(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(V(arguments[e]));return t}var H=["%cMUTE CRYPTO:%c ","background-color: #81C784; padding: 0 2px",""],J=["%cMUTE CRYPTO ERROR:%c ","background-color: #81C784; padding: 0 2px",""],Z=["%cMUTE CRYPTO:%c %cPERFORMANCE:%c ","background-color: #81C784; padding: 0 2px","","background-color: #FFCC80; padding: 0 2px",""],X={debug:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return console.log.apply(console,W(H,t))},error:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return console.error.apply(console,W(J,t))}},Y={debug:function(){},error:function(){}},Q=Y,tt=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];console.assert.apply(console,W([t,"MUTE-CRYPTO: "+e],n))},et=function(){},nt=et,rt={mark:function(t){return U.performance.mark(t)},measure:function(t,e,n){U.performance.measure(t,e,n);var r=U.performance.getEntriesByName(t)[0];console.log.apply(console,W(Z,[r.name+" = "+r.duration.toFixed(0)+"ms"])),U.performance.clearMeasures()}},it={mark:function(){},measure:function(){}},ot=it;function st(t,e){void 0===t&&(t=!0),void 0===e&&(e=!0),t?(Q=X,nt=tt):(Q=Y,nt=et),ot=e?rt:it}function at(t){for(var e,n=0,r=t.length,i="";n<r;)e=t.subarray(n,Math.min(n+32768,r)),i+=String.fromCharCode.apply(null,e),n+=32768;return btoa(i).substr(0,20)+"..."}var ut,ct=function(){function t(){this.onStateChange=function(){},this.state=F.UNDEFINED}return t.generateKey=function(){return $(this,void 0,void 0,function(){var t,e;return G(this,function(n){switch(n.label){case 0:return[4,B.generateEncryptionKey()];case 1:return t=n.sent(),[4,B.exportKey(t)];case 2:return e=n.sent(),[2,B.toB64(e)]}})})},t.prototype.setState=function(t){this.state!==t&&(Q.debug("key state = "+F[t]),this.state=t,this.onStateChange(this.state))},t}(),ht=function(t){function e(){var e=t.call(this)||this;return e.key=void 0,e}return z(e,t),e.prototype.importKey=function(e){return $(this,void 0,void 0,function(){var n;return G(this,function(r){switch(r.label){case 0:return n=this,[4,B.importKey(B.fromB64(e))];case 1:return n.key=r.sent(),t.prototype.setState.call(this,F.READY),[2]}})})},e.prototype.encrypt=function(t){return $(this,void 0,void 0,function(){return G(this,function(e){if(this.key)return[2,B.encrypt(t,this.key)];throw new Error("Cryptographic key is not ready yet.")})})},e.prototype.decrypt=function(t){return $(this,void 0,void 0,function(){return G(this,function(e){if(this.key)return[2,B.decrypt(t,this.key)];throw new Error("Cryptographic key is not ready yet.")})})},e}(ct);!function(t){t[t.KEY_AGREEMENT_BD=700]="KEY_AGREEMENT_BD"}(ut||(ut={}));var lt=function(){function t(t,e,n){this.value=t,this.initiatorId=e,this.initiatorCounter=n}return t.prototype.isEqual=function(t,e){return this.initiatorId===t&&this.initiatorCounter===e},t}(),ft=function(){function t(t,e,n,r,i,o){ot.mark("start cycle"),this.id=t,this.myId=r,this.myMembers=o,this.isZBroadcasted=!1,this.isXBroadcasted=!1,this.isFinished=!1,this.firstXadded=!1,this.counter=e,this.members=n,this.send=i,this._onKey=function(){},this.r=R.generateRi(),ot.mark("R ready"),this.z=R.computeZi(this.r),ot.mark("Z ready"),this.zArray=new Array(n.length),this.zArray[n.indexOf(r)]=this.z,this.xArray=new Array(n.length)}return t.prototype.addX=function(t,e){this.xArray[t]=e,this.firstXadded||ot.mark("start X array"),this.firstXadded=!0},Object.defineProperty(t.prototype,"onKey",{set:function(t){this._onKey=t},enumerable:!0,configurable:!0}),t.prototype.isReadyToBroadcastZ=function(t){return this.members.every(function(e){return t.includes(e)})},t.prototype.checkZArray=function(t,e){var n,r;if(this.isXBroadcasted)this.debug("checkZArray abort -> X broadcasted already");else if(this.members.every(function(t){return e.includes(t)})){try{for(var i=K(this.zArray),o=i.next();!o.done;o=i.next()){if(void 0===o.value)return void this.debug("checkZArray abort -> missing Z value")}}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}ot.mark("Z array ready"),this.debug("checkZArray OK");var s=this.members.indexOf(t),a=(s+1)%this.members.length,u=(this.members.length+s-1)%this.members.length,c=R.computeXi(this.r,this.zArray[a],this.zArray[u]);ot.mark("X ready"),this.assert(void 0===this.xArray[s],"Setting my X value twice"),this.addX(s,c),this.broadcastX(c),this.checkXArray(t,e)}else this.debug("checkZArray abort -> missing a member")},t.prototype.checkXArray=function(t,e){return $(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c,h,l,f,p,d,y,b,g,v,w,S;return G(this,function(O){switch(O.label){case 0:if(this.isFinished)return this.debug("checkXArray abort -> key computed already"),[2];if(!this.members.every(function(t){return e.includes(t)}))return this.debug("checkXArray abort -> missing a member"),[2];try{for(u=K(this.xArray),c=u.next();!c.done;c=u.next())if(void 0===(v=c.value))return this.debug("checkXArray abort -> missing X value"),[2]}catch(t){n={error:t}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}ot.mark("X array ready"),this.isFinished=!0,this.debug("checkXArray OK"),h=this.members.indexOf(t),l=(this.members.length+h-1)%this.members.length,f=R.computeSharedSecret(this.r,this.xArray[h],this.zArray[l],this.xArray),this.debug("Value of r : "+this.r.toString(16));try{for(p=K(this.zArray),d=p.next();!d.done;d=p.next())y=d.value,this.debug("Value of z : "+new m(y).toString(16))}catch(t){i={error:t}}finally{try{d&&!d.done&&(o=p.return)&&o.call(p)}finally{if(i)throw i.error}}try{for(b=K(this.xArray),g=b.next();!g.done;g=b.next())v=g.value,this.debug("Value of x : "+new m(v).toString(16))}catch(t){s={error:t}}finally{try{g&&!g.done&&(a=b.return)&&a.call(b)}finally{if(s)throw s.error}}return this.debug("Value of sk : "+new m(f).toString(16)),S=lt.bind,[4,R.deriveKey(f)];case 1:return w=new(S.apply(lt,[void 0,O.sent(),this.id,this.counter])),ot.mark("end cycle"),ot.measure("R","start cycle","R ready"),ot.measure("Z","R ready","Z ready"),ot.measure("X","Z array ready","X ready"),ot.measure("Z array full","Z ready","Z array ready"),ot.measure("X array full","start X array","X array ready"),ot.measure("secret key","X array ready","end cycle"),ot.measure(this.id+"("+this.counter+"): cycle","start cycle","end cycle"),this._onKey(w),[2]}})})},t.prototype.debug=function(t){Q.debug(this.id+"("+this.counter+"): "+t+": ",this.formatCycle())},t.prototype.assert=function(t,e){nt(t,this.id+"("+this.counter+"): "+e,this.formatCycle())},t.prototype.broadcastZ=function(){this.send({initiator:{id:this.id,counter:this.counter,members:this.members},z:this.z}),this.isZBroadcasted=!0,Q.debug("broadcast my Z value")},t.prototype.broadcastX=function(t){this.send({initiator:{id:this.id,counter:this.counter,members:this.members},x:t}),this.isXBroadcasted=!0,this.debug("broadcast my X value")},t.prototype.formatCycle=function(){return{initiatorId:this.id,initiatorCounter:this.counter,initiatorMembers:this.members.slice(),myId:this.myId,myMembers:this.myMembers.slice(),zArray:this.zArray.map(function(t){var e="";return t.forEach(function(t){return e+=String.fromCharCode(t)}),btoa(e).substring(0,7)}),xArray:this.xArray.map(function(t){var e="";return t.forEach(function(t){return e+=String.fromCharCode(t)}),btoa(e).substring(0,7)})}},t}(),pt="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function dt(t,e){return t(e={exports:{}},e.exports),e.exports}var yt=function(t,e){var n=new Array(arguments.length-1),r=0,i=2,o=!0;for(;i<arguments.length;)n[r++]=arguments[i++];return new Promise(function(i,s){n[r]=function(t){if(o)if(o=!1,t)s(t);else{for(var e=new Array(arguments.length-1),n=0;n<e.length;)e[n++]=arguments[n];i.apply(null,e)}};try{t.apply(e||null,n)}catch(t){o&&(o=!1,s(t))}})};var bt=dt(function(t,e){var n=e;n.length=function(t){var e=t.length;if(!e)return 0;for(var n=0;--e%4>1&&"="===t.charAt(e);)++n;return Math.ceil(3*t.length)/4-n};for(var r=new Array(64),i=new Array(123),o=0;o<64;)i[r[o]=o<26?o+65:o<52?o+71:o<62?o-4:o-59|43]=o++;n.encode=function(t,e,n){for(var i,o=null,s=[],a=0,u=0;e<n;){var c=t[e++];switch(u){case 0:s[a++]=r[c>>2],i=(3&c)<<4,u=1;break;case 1:s[a++]=r[i|c>>4],i=(15&c)<<2,u=2;break;case 2:s[a++]=r[i|c>>6],s[a++]=r[63&c],u=0}a>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,s)),a=0)}return u&&(s[a++]=r[i],s[a++]=61,1===u&&(s[a++]=61)),o?(a&&o.push(String.fromCharCode.apply(String,s.slice(0,a))),o.join("")):String.fromCharCode.apply(String,s.slice(0,a))};n.decode=function(t,e,n){for(var r,o=n,s=0,a=0;a<t.length;){var u=t.charCodeAt(a++);if(61===u&&s>1)break;if(void 0===(u=i[u]))throw Error("invalid encoding");switch(s){case 0:r=u,s=1;break;case 1:e[n++]=r<<2|(48&u)>>4,r=u,s=2;break;case 2:e[n++]=(15&r)<<4|(60&u)>>2,r=u,s=3;break;case 3:e[n++]=(3&r)<<6|u,s=0}}if(1===s)throw Error("invalid encoding");return n-o},n.test=function(t){return/^(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/.test(t)}}),gt=mt;function mt(){this._listeners={}}mt.prototype.on=function(t,e,n){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:e,ctx:n||this}),this},mt.prototype.off=function(t,e){if(void 0===t)this._listeners={};else if(void 0===e)this._listeners[t]=[];else for(var n=this._listeners[t],r=0;r<n.length;)n[r].fn===e?n.splice(r,1):++r;return this},mt.prototype.emit=function(t){var e=this._listeners[t];if(e){for(var n=[],r=1;r<arguments.length;)n.push(arguments[r++]);for(r=0;r<e.length;)e[r].fn.apply(e[r++].ctx,n)}return this};var vt=wt(wt);function wt(t){return"undefined"!=typeof Float32Array?function(){var e=new Float32Array([-0]),n=new Uint8Array(e.buffer),r=128===n[3];function i(t,r,i){e[0]=t,r[i]=n[0],r[i+1]=n[1],r[i+2]=n[2],r[i+3]=n[3]}function o(t,r,i){e[0]=t,r[i]=n[3],r[i+1]=n[2],r[i+2]=n[1],r[i+3]=n[0]}function s(t,r){return n[0]=t[r],n[1]=t[r+1],n[2]=t[r+2],n[3]=t[r+3],e[0]}function a(t,r){return n[3]=t[r],n[2]=t[r+1],n[1]=t[r+2],n[0]=t[r+3],e[0]}t.writeFloatLE=r?i:o,t.writeFloatBE=r?o:i,t.readFloatLE=r?s:a,t.readFloatBE=r?a:s}():function(){function e(t,e,n,r){var i=e<0?1:0;if(i&&(e=-e),0===e)t(1/e>0?0:2147483648,n,r);else if(isNaN(e))t(2143289344,n,r);else if(e>3.4028234663852886e38)t((i<<31|2139095040)>>>0,n,r);else if(e<1.1754943508222875e-38)t((i<<31|Math.round(e/1.401298464324817e-45))>>>0,n,r);else{var o=Math.floor(Math.log(e)/Math.LN2);t((i<<31|o+127<<23|8388607&Math.round(e*Math.pow(2,-o)*8388608))>>>0,n,r)}}function n(t,e,n){var r=t(e,n),i=2*(r>>31)+1,o=r>>>23&255,s=8388607&r;return 255===o?s?NaN:i*(1/0):0===o?1.401298464324817e-45*i*s:i*Math.pow(2,o-150)*(s+8388608)}t.writeFloatLE=e.bind(null,St),t.writeFloatBE=e.bind(null,Ot),t.readFloatLE=n.bind(null,Mt),t.readFloatBE=n.bind(null,It)}(),"undefined"!=typeof Float64Array?function(){var e=new Float64Array([-0]),n=new Uint8Array(e.buffer),r=128===n[7];function i(t,r,i){e[0]=t,r[i]=n[0],r[i+1]=n[1],r[i+2]=n[2],r[i+3]=n[3],r[i+4]=n[4],r[i+5]=n[5],r[i+6]=n[6],r[i+7]=n[7]}function o(t,r,i){e[0]=t,r[i]=n[7],r[i+1]=n[6],r[i+2]=n[5],r[i+3]=n[4],r[i+4]=n[3],r[i+5]=n[2],r[i+6]=n[1],r[i+7]=n[0]}function s(t,r){return n[0]=t[r],n[1]=t[r+1],n[2]=t[r+2],n[3]=t[r+3],n[4]=t[r+4],n[5]=t[r+5],n[6]=t[r+6],n[7]=t[r+7],e[0]}function a(t,r){return n[7]=t[r],n[6]=t[r+1],n[5]=t[r+2],n[4]=t[r+3],n[3]=t[r+4],n[2]=t[r+5],n[1]=t[r+6],n[0]=t[r+7],e[0]}t.writeDoubleLE=r?i:o,t.writeDoubleBE=r?o:i,t.readDoubleLE=r?s:a,t.readDoubleBE=r?a:s}():function(){function e(t,e,n,r,i,o){var s=r<0?1:0;if(s&&(r=-r),0===r)t(0,i,o+e),t(1/r>0?0:2147483648,i,o+n);else if(isNaN(r))t(0,i,o+e),t(2146959360,i,o+n);else if(r>1.7976931348623157e308)t(0,i,o+e),t((s<<31|2146435072)>>>0,i,o+n);else{var a;if(r<2.2250738585072014e-308)t((a=r/5e-324)>>>0,i,o+e),t((s<<31|a/4294967296)>>>0,i,o+n);else{var u=Math.floor(Math.log(r)/Math.LN2);1024===u&&(u=1023),t(4503599627370496*(a=r*Math.pow(2,-u))>>>0,i,o+e),t((s<<31|u+1023<<20|1048576*a&1048575)>>>0,i,o+n)}}}function n(t,e,n,r,i){var o=t(r,i+e),s=t(r,i+n),a=2*(s>>31)+1,u=s>>>20&2047,c=4294967296*(1048575&s)+o;return 2047===u?c?NaN:a*(1/0):0===u?5e-324*a*c:a*Math.pow(2,u-1075)*(c+4503599627370496)}t.writeDoubleLE=e.bind(null,St,0,4),t.writeDoubleBE=e.bind(null,Ot,4,0),t.readDoubleLE=n.bind(null,Mt,0,4),t.readDoubleBE=n.bind(null,It,4,0)}(),t}function St(t,e,n){e[n]=255&t,e[n+1]=t>>>8&255,e[n+2]=t>>>16&255,e[n+3]=t>>>24}function Ot(t,e,n){e[n]=t>>>24,e[n+1]=t>>>16&255,e[n+2]=t>>>8&255,e[n+3]=255&t}function Mt(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0}function It(t,e){return(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}var _t=function(t){return null};var xt=dt(function(t,e){var n=e;n.length=function(t){for(var e=0,n=0,r=0;r<t.length;++r)(n=t.charCodeAt(r))<128?e+=1:n<2048?e+=2:55296==(64512&n)&&56320==(64512&t.charCodeAt(r+1))?(++r,e+=4):e+=3;return e},n.read=function(t,e,n){if(n-e<1)return"";for(var r,i=null,o=[],s=0;e<n;)(r=t[e++])<128?o[s++]=r:r>191&&r<224?o[s++]=(31&r)<<6|63&t[e++]:r>239&&r<365?(r=((7&r)<<18|(63&t[e++])<<12|(63&t[e++])<<6|63&t[e++])-65536,o[s++]=55296+(r>>10),o[s++]=56320+(1023&r)):o[s++]=(15&r)<<12|(63&t[e++])<<6|63&t[e++],s>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),s=0);return i?(s&&i.push(String.fromCharCode.apply(String,o.slice(0,s))),i.join("")):String.fromCharCode.apply(String,o.slice(0,s))},n.write=function(t,e,n){for(var r,i,o=n,s=0;s<t.length;++s)(r=t.charCodeAt(s))<128?e[n++]=r:r<2048?(e[n++]=r>>6|192,e[n++]=63&r|128):55296==(64512&r)&&56320==(64512&(i=t.charCodeAt(s+1)))?(r=65536+((1023&r)<<10)+(1023&i),++s,e[n++]=r>>18|240,e[n++]=r>>12&63|128,e[n++]=r>>6&63|128,e[n++]=63&r|128):(e[n++]=r>>12|224,e[n++]=r>>6&63|128,e[n++]=63&r|128);return n-o}}),Et=function(t,e,n){var r=n||8192,i=r>>>1,o=null,s=r;return function(n){if(n<1||n>i)return t(n);s+n>r&&(o=t(r),s=0);var a=e.call(o,s,s+=n);return 7&s&&(s=1+(7|s)),a}};var kt=Tt;function Tt(t,e){this.lo=t>>>0,this.hi=e>>>0}var Ct=Tt.zero=new Tt(0,0);Ct.toNumber=function(){return 0},Ct.zzEncode=Ct.zzDecode=function(){return this},Ct.length=function(){return 1};var jt=Tt.zeroHash="\0\0\0\0\0\0\0\0";Tt.fromNumber=function(t){if(0===t)return Ct;var e=t<0;e&&(t=-t);var n=t>>>0,r=(t-n)/4294967296>>>0;return e&&(r=~r>>>0,n=~n>>>0,++n>4294967295&&(n=0,++r>4294967295&&(r=0))),new Tt(n,r)},Tt.from=function(t){if("number"==typeof t)return Tt.fromNumber(t);if(Pt.isString(t)){if(!Pt.Long)return Tt.fromNumber(parseInt(t,10));t=Pt.Long.fromString(t)}return t.low||t.high?new Tt(t.low>>>0,t.high>>>0):Ct},Tt.prototype.toNumber=function(t){if(!t&&this.hi>>>31){var e=1+~this.lo>>>0,n=~this.hi>>>0;return e||(n=n+1>>>0),-(e+4294967296*n)}return this.lo+4294967296*this.hi},Tt.prototype.toLong=function(t){return Pt.Long?new Pt.Long(0|this.lo,0|this.hi,Boolean(t)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(t)}};var At=String.prototype.charCodeAt;Tt.fromHash=function(t){return t===jt?Ct:new Tt((At.call(t,0)|At.call(t,1)<<8|At.call(t,2)<<16|At.call(t,3)<<24)>>>0,(At.call(t,4)|At.call(t,5)<<8|At.call(t,6)<<16|At.call(t,7)<<24)>>>0)},Tt.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},Tt.prototype.zzEncode=function(){var t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this},Tt.prototype.zzDecode=function(){var t=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this},Tt.prototype.length=function(){var t=this.lo,e=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===e?t<16384?t<128?1:2:t<2097152?3:4:e<16384?e<128?5:6:e<2097152?7:8:n<128?9:10};var Nt,Pt=dt(function(t,e){var n=e;function r(t,e,n){for(var r=Object.keys(e),i=0;i<r.length;++i)void 0!==t[r[i]]&&n||(t[r[i]]=e[r[i]]);return t}function i(t){function e(t,n){if(!(this instanceof e))return new e(t,n);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&r(this,n)}return(e.prototype=Object.create(Error.prototype)).constructor=e,Object.defineProperty(e.prototype,"name",{get:function(){return t}}),e.prototype.toString=function(){return this.name+": "+this.message},e}n.asPromise=yt,n.base64=bt,n.EventEmitter=gt,n.float=vt,n.inquire=_t,n.utf8=xt,n.pool=Et,n.LongBits=kt,n.global="undefined"!=typeof window&&window||void 0!==pt&&pt||"undefined"!=typeof self&&self||pt,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isNode=Boolean(n.global.process&&n.global.process.versions&&n.global.process.versions.node),n.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},n.isString=function(t){return"string"==typeof t||t instanceof String},n.isObject=function(t){return t&&"object"==typeof t},n.isset=n.isSet=function(t,e){var n=t[e];return!(null==n||!t.hasOwnProperty(e))&&("object"!=typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},n.Buffer=function(){try{var t=n.inquire("buffer").Buffer;return t.prototype.utf8Write?t:null}catch(t){return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(t){return"number"==typeof t?n.Buffer?n._Buffer_allocUnsafe(t):new n.Array(t):n.Buffer?n._Buffer_from(t):"undefined"==typeof Uint8Array?t:new Uint8Array(t)},n.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(t){return t?n.LongBits.from(t).toHash():n.LongBits.zeroHash},n.longFromHash=function(t,e){var r=n.LongBits.fromHash(t);return n.Long?n.Long.fromBits(r.lo,r.hi,e):r.toNumber(Boolean(e))},n.merge=r,n.lcFirst=function(t){return t.charAt(0).toLowerCase()+t.substring(1)},n.newError=i,n.ProtocolError=i("ProtocolError"),n.oneOfGetter=function(t){for(var e={},n=0;n<t.length;++n)e[t[n]]=1;return function(){for(var t=Object.keys(this),n=t.length-1;n>-1;--n)if(1===e[t[n]]&&void 0!==this[t[n]]&&null!==this[t[n]])return t[n]}},n.oneOfSetter=function(t){return function(e){for(var n=0;n<t.length;++n)t[n]!==e&&delete this[t[n]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){var t=n.Buffer;t?(n._Buffer_from=t.from!==Uint8Array.from&&t.from||function(e,n){return new t(e,n)},n._Buffer_allocUnsafe=t.allocUnsafe||function(e){return new t(e)}):n._Buffer_from=n._Buffer_allocUnsafe=null}}),Rt=zt,Bt=Pt.LongBits,Lt=Pt.base64,Dt=Pt.utf8;function Ft(t,e,n){this.fn=t,this.len=e,this.next=void 0,this.val=n}function Ut(){}function qt(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function zt(){this.len=0,this.head=new Ft(Ut,0,0),this.tail=this.head,this.states=null}function $t(t,e,n){e[n]=255&t}function Gt(t,e){this.len=t,this.next=void 0,this.val=e}function Kt(t,e,n){for(;t.hi;)e[n++]=127&t.lo|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;for(;t.lo>127;)e[n++]=127&t.lo|128,t.lo=t.lo>>>7;e[n++]=t.lo}function Vt(t,e,n){e[n]=255&t,e[n+1]=t>>>8&255,e[n+2]=t>>>16&255,e[n+3]=t>>>24}zt.create=Pt.Buffer?function(){return(zt.create=function(){return new Nt})()}:function(){return new zt},zt.alloc=function(t){return new Pt.Array(t)},Pt.Array!==Array&&(zt.alloc=Pt.pool(zt.alloc,Pt.Array.prototype.subarray)),zt.prototype._push=function(t,e,n){return this.tail=this.tail.next=new Ft(t,e,n),this.len+=e,this},Gt.prototype=Object.create(Ft.prototype),Gt.prototype.fn=function(t,e,n){for(;t>127;)e[n++]=127&t|128,t>>>=7;e[n]=t},zt.prototype.uint32=function(t){return this.len+=(this.tail=this.tail.next=new Gt((t>>>=0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this},zt.prototype.int32=function(t){return t<0?this._push(Kt,10,Bt.fromNumber(t)):this.uint32(t)},zt.prototype.sint32=function(t){return this.uint32((t<<1^t>>31)>>>0)},zt.prototype.uint64=function(t){var e=Bt.from(t);return this._push(Kt,e.length(),e)},zt.prototype.int64=zt.prototype.uint64,zt.prototype.sint64=function(t){var e=Bt.from(t).zzEncode();return this._push(Kt,e.length(),e)},zt.prototype.bool=function(t){return this._push($t,1,t?1:0)},zt.prototype.fixed32=function(t){return this._push(Vt,4,t>>>0)},zt.prototype.sfixed32=zt.prototype.fixed32,zt.prototype.fixed64=function(t){var e=Bt.from(t);return this._push(Vt,4,e.lo)._push(Vt,4,e.hi)},zt.prototype.sfixed64=zt.prototype.fixed64,zt.prototype.float=function(t){return this._push(Pt.float.writeFloatLE,4,t)},zt.prototype.double=function(t){return this._push(Pt.float.writeDoubleLE,8,t)};var Wt=Pt.Array.prototype.set?function(t,e,n){e.set(t,n)}:function(t,e,n){for(var r=0;r<t.length;++r)e[n+r]=t[r]};zt.prototype.bytes=function(t){var e=t.length>>>0;if(!e)return this._push($t,1,0);if(Pt.isString(t)){var n=zt.alloc(e=Lt.length(t));Lt.decode(t,n,0),t=n}return this.uint32(e)._push(Wt,e,t)},zt.prototype.string=function(t){var e=Dt.length(t);return e?this.uint32(e)._push(Dt.write,e,t):this._push($t,1,0)},zt.prototype.fork=function(){return this.states=new qt(this),this.head=this.tail=new Ft(Ut,0,0),this.len=0,this},zt.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Ft(Ut,0,0),this.len=0),this},zt.prototype.ldelim=function(){var t=this.head,e=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=t.next,this.tail=e,this.len+=n),this},zt.prototype.finish=function(){for(var t=this.head.next,e=this.constructor.alloc(this.len),n=0;t;)t.fn(t.val,e,n),n+=t.len,t=t.next;return e},zt._configure=function(t){Nt=t};var Ht=Zt;(Zt.prototype=Object.create(Rt.prototype)).constructor=Zt;var Jt=Pt.Buffer;function Zt(){Rt.call(this)}Zt.alloc=function(t){return(Zt.alloc=Pt._Buffer_allocUnsafe)(t)};var Xt=Jt&&Jt.prototype instanceof Uint8Array&&"set"===Jt.prototype.set.name?function(t,e,n){e.set(t,n)}:function(t,e,n){if(t.copy)t.copy(e,n,0,t.length);else for(var r=0;r<t.length;)e[n++]=t[r++]};function Yt(t,e,n){t.length<40?Pt.utf8.write(t,e,n):e.utf8Write(t,n)}Zt.prototype.bytes=function(t){Pt.isString(t)&&(t=Pt._Buffer_from(t,"base64"));var e=t.length>>>0;return this.uint32(e),e&&this._push(Xt,e,t),this},Zt.prototype.string=function(t){var e=Jt.byteLength(t);return this.uint32(e),e&&this._push(Yt,e,t),this};var Qt,te=ie,ee=Pt.LongBits,ne=Pt.utf8;function re(t,e){return RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)}function ie(t){this.buf=t,this.pos=0,this.len=t.length}var oe,se="undefined"!=typeof Uint8Array?function(t){if(t instanceof Uint8Array||Array.isArray(t))return new ie(t);throw Error("illegal buffer")}:function(t){if(Array.isArray(t))return new ie(t);throw Error("illegal buffer")};function ae(){var t=new ee(0,0),e=0;if(!(this.len-this.pos>4)){for(;e<3;++e){if(this.pos>=this.len)throw re(this);if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(127&this.buf[this.pos++])<<7*e)>>>0,t}for(;e<4;++e)if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(127&this.buf[this.pos])<<28)>>>0,t.hi=(t.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return t;if(e=0,this.len-this.pos>4){for(;e<5;++e)if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}else for(;e<5;++e){if(this.pos>=this.len)throw re(this);if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}function ue(t,e){return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0}function ce(){if(this.pos+8>this.len)throw re(this,8);return new ee(ue(this.buf,this.pos+=4),ue(this.buf,this.pos+=4))}ie.create=Pt.Buffer?function(t){return(ie.create=function(t){return Pt.Buffer.isBuffer(t)?new Qt(t):se(t)})(t)}:se,ie.prototype._slice=Pt.Array.prototype.subarray||Pt.Array.prototype.slice,ie.prototype.uint32=(oe=4294967295,function(){if(oe=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return oe;if(oe=(oe|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return oe;if(oe=(oe|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return oe;if(oe=(oe|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return oe;if(oe=(oe|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return oe;if((this.pos+=5)>this.len)throw this.pos=this.len,re(this,10);return oe}),ie.prototype.int32=function(){return 0|this.uint32()},ie.prototype.sint32=function(){var t=this.uint32();return t>>>1^-(1&t)|0},ie.prototype.bool=function(){return 0!==this.uint32()},ie.prototype.fixed32=function(){if(this.pos+4>this.len)throw re(this,4);return ue(this.buf,this.pos+=4)},ie.prototype.sfixed32=function(){if(this.pos+4>this.len)throw re(this,4);return 0|ue(this.buf,this.pos+=4)},ie.prototype.float=function(){if(this.pos+4>this.len)throw re(this,4);var t=Pt.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t},ie.prototype.double=function(){if(this.pos+8>this.len)throw re(this,4);var t=Pt.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t},ie.prototype.bytes=function(){var t=this.uint32(),e=this.pos,n=this.pos+t;if(n>this.len)throw re(this,t);return this.pos+=t,Array.isArray(this.buf)?this.buf.slice(e,n):e===n?new this.buf.constructor(0):this._slice.call(this.buf,e,n)},ie.prototype.string=function(){var t=this.bytes();return ne.read(t,0,t.length)},ie.prototype.skip=function(t){if("number"==typeof t){if(this.pos+t>this.len)throw re(this,t);this.pos+=t}else do{if(this.pos>=this.len)throw re(this)}while(128&this.buf[this.pos++]);return this},ie.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(t=7&this.uint32());)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this},ie._configure=function(t){Qt=t;var e=Pt.Long?"toLong":"toNumber";Pt.merge(ie.prototype,{int64:function(){return ae.call(this)[e](!1)},uint64:function(){return ae.call(this)[e](!0)},sint64:function(){return ae.call(this).zzDecode()[e](!1)},fixed64:function(){return ce.call(this)[e](!0)},sfixed64:function(){return ce.call(this)[e](!1)}})};var he=le;function le(t){te.call(this,t)}(le.prototype=Object.create(te.prototype)).constructor=le,Pt.Buffer&&(le.prototype._slice=Pt.Buffer.prototype.slice),le.prototype.string=function(){var t=this.uint32();return this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len))};var fe=pe;function pe(t,e,n){if("function"!=typeof t)throw TypeError("rpcImpl must be a function");Pt.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=Boolean(e),this.responseDelimited=Boolean(n)}(pe.prototype=Object.create(Pt.EventEmitter.prototype)).constructor=pe,pe.prototype.rpcCall=function t(e,n,r,i,o){if(!i)throw TypeError("request must be specified");var s=this;if(!o)return Pt.asPromise(t,s,e,n,r,i);if(s.rpcImpl)try{return s.rpcImpl(e,n[s.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(t,n){if(t)return s.emit("error",t,e),o(t);if(null!==n){if(!(n instanceof r))try{n=r[s.responseDelimited?"decodeDelimited":"decode"](n)}catch(t){return s.emit("error",t,e),o(t)}return s.emit("data",n,e),o(null,n)}s.end(!0)})}catch(t){return s.emit("error",t,e),void setTimeout(function(){o(t)},0)}else setTimeout(function(){o(Error("already ended"))},0)},pe.prototype.end=function(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};var de=dt(function(t,e){e.Service=fe}),ye={},be=dt(function(t,e){var n=e;function r(){n.Reader._configure(n.BufferReader),n.util._configure()}n.build="minimal",n.Writer=Rt,n.BufferWriter=Ht,n.Reader=te,n.BufferReader=he,n.util=Pt,n.rpc=de,n.roots=ye,n.configure=r,n.Writer._configure(n.BufferWriter),r()}),ge=be.Reader,me=be.Writer,ve=be.util,we=be.roots;const Se=ge,Oe=me,Me=ve,Ie=we.default||(we.default={}),_e=Ie.Message=(()=>{function t(t){if(t)for(let e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.content=Me.newBuffer([]),t.prototype.signature=Me.newBuffer([]),t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=Oe.create()),null!=t.content&&t.hasOwnProperty("content")&&e.uint32(10).bytes(t.content),null!=t.signature&&t.hasOwnProperty("signature")&&e.uint32(18).bytes(t.signature),e},t.decode=function(t,e){t instanceof Se||(t=Se.create(t));let n=void 0===e?t.len:t.pos+e,r=new Ie.Message;for(;t.pos<n;){let e=t.uint32();switch(e>>>3){case 1:r.content=t.bytes();break;case 2:r.signature=t.bytes();break;default:t.skipType(7&e)}}return r},t})(),xe=Ie.Content=(()=>{function t(t){if(t)for(let e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}let e;return t.prototype.initiator=null,t.prototype.z=Me.newBuffer([]),t.prototype.x=Me.newBuffer([]),Object.defineProperty(t.prototype,"type",{get:Me.oneOfGetter(e=["z","x"]),set:Me.oneOfSetter(e)}),t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=Oe.create()),null!=t.initiator&&t.hasOwnProperty("initiator")&&Ie.Initiator.encode(t.initiator,e.uint32(10).fork()).ldelim(),null!=t.z&&t.hasOwnProperty("z")&&e.uint32(18).bytes(t.z),null!=t.x&&t.hasOwnProperty("x")&&e.uint32(26).bytes(t.x),e},t.decode=function(t,e){t instanceof Se||(t=Se.create(t));let n=void 0===e?t.len:t.pos+e,r=new Ie.Content;for(;t.pos<n;){let e=t.uint32();switch(e>>>3){case 1:r.initiator=Ie.Initiator.decode(t,t.uint32());break;case 2:r.z=t.bytes();break;case 3:r.x=t.bytes();break;default:t.skipType(7&e)}}return r},t})(),Ee=(Ie.Initiator=(()=>{function t(t){if(this.members=[],t)for(let e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.id=0,t.prototype.counter=0,t.prototype.members=Me.emptyArray,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=Oe.create()),null!=t.id&&t.hasOwnProperty("id")&&e.uint32(8).uint32(t.id),null!=t.counter&&t.hasOwnProperty("counter")&&e.uint32(16).uint32(t.counter),null!=t.members&&t.members.length){e.uint32(26).fork();for(let n=0;n<t.members.length;++n)e.uint32(t.members[n]);e.ldelim()}return e},t.decode=function(t,e){t instanceof Se||(t=Se.create(t));let n=void 0===e?t.len:t.pos+e,r=new Ie.Initiator;for(;t.pos<n;){let e=t.uint32();switch(e>>>3){case 1:r.id=t.uint32();break;case 2:r.counter=t.uint32();break;case 3:if(r.members&&r.members.length||(r.members=[]),2==(7&e)){let e=t.uint32()+t.pos;for(;t.pos<e;)r.members.push(t.uint32())}else r.members.push(t.uint32());break;default:t.skipType(7&e)}}return r},t})(),Ie.CipherMessage=(()=>{function t(t){if(t)for(let e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.id=0,t.prototype.counter=0,t.prototype.content=Me.newBuffer([]),t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=Oe.create()),null!=t.id&&t.hasOwnProperty("id")&&e.uint32(8).uint32(t.id),null!=t.counter&&t.hasOwnProperty("counter")&&e.uint32(16).uint32(t.counter),null!=t.content&&t.hasOwnProperty("content")&&e.uint32(26).bytes(t.content),e},t.decode=function(t,e){t instanceof Se||(t=Se.create(t));let n=void 0===e?t.len:t.pos+e,r=new Ie.CipherMessage;for(;t.pos<n;){let e=t.uint32();switch(e>>>3){case 1:r.id=t.uint32();break;case 2:r.counter=t.uint32();break;case 3:r.content=t.bytes();break;default:t.skipType(7&e)}}return r},t})());var ke=function(t){function e(){var e=t.call(this)||this;return e._signingKey=void 0,e.myCounter=0,e.cycles=new Map,e.members=[],e.send=function(){},e.myId=0,e.key=void 0,e.previousKey=void 0,e.isReady=!1,e}return z(e,t),e.prototype.encrypt=function(t){return $(this,void 0,void 0,function(){var e;return G(this,function(n){switch(n.label){case 0:return this.key?[4,B.encrypt(t,this.key.value)]:[3,2];case 1:return e=n.sent(),[2,Ee.encode(Ee.create({id:this.key.initiatorId,counter:this.key.initiatorCounter,content:e})).finish()];case 2:throw Q.debug("Failed to encrypt a message: cryptographic key is not ready yet"),new Error("Failed to encrypt a message: cryptographic key is not ready yet")}})})},e.prototype.decrypt=function(t){return $(this,void 0,void 0,function(){var e,n,r,i;return G(this,function(o){if(this.key){if(e=Ee.decode(t),n=e.id,r=e.counter,i=e.content,this.key.isEqual(n,r))return[2,B.decrypt(i,this.key.value)];if(this.previousKey&&this.previousKey.isEqual(n,r))return[2,B.decrypt(i,this.previousKey.value)]}throw Q.debug("Failed to decrypt a message"),new Error("Failed to decrypt a message")})})},Object.defineProperty(e.prototype,"signingKey",{set:function(t){this._signingKey=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onSend",{set:function(t){var e=this;this.send=function(n){var r=xe.encode(xe.create(n)).finish();e._signingKey?b.sign(r,e._signingKey).then(function(e){Q.debug("Signing message: ",{signature:at(e)}),t(_e.encode(_e.create({content:r,signature:e})).finish(),ut.KEY_AGREEMENT_BD)}).catch(function(t){return Q.error("Signing failed: ",t)}):t(_e.encode(_e.create({content:r})).finish(),ut.KEY_AGREEMENT_BD)}},enumerable:!0,configurable:!0}),e.prototype.addMember=function(t){this.members.push(t),this.members.sort(function(t,e){return t-e}),Q.debug("MEMBER Joined: ",{id:t,currentMembers:this.members.slice()}),this.checkCycles()},e.prototype.removeMember=function(t){var e=this.members.indexOf(t);-1!==e&&this.members.splice(e,1),Q.debug("MEMBER Left: ",{id:t,currentMembers:this.members.slice()}),this.checkCycles()},e.prototype.onMessage=function(e,n,r){return $(this,void 0,void 0,function(){var i,o,s,a,u,c,h,l,f,p,d,y;return G(this,function(g){switch(g.label){case 0:return i=_e.decode(n),o=i.content,s=i.signature,a=xe.decode(o),c=(u=a).initiator,h=c.id,l=c.counter,f=c.members,p=u.type,r?[4,b.verifySignature(o,s,r)]:[3,2];case 1:if(!g.sent())throw Q.error("Verify signature NOT OK: ",{id:e,signature:at(s)}),new Error("Wrong signature");Q.debug("Verify signature OK: ",{id:e,signature:at(s)}),g.label=2;case 2:if(!f.includes(this.myId))return[2];if((void 0===(d=this.cycles.get(h))||d.counter<l)&&(t.prototype.setState.call(this,F.CALCUL_IN_PROGRESS),(d=this.createCycle(h,l,f)).debug("NOT an initiator starts a NEW CYCLE"),!d.isZBroadcasted&&d.isReadyToBroadcastZ(this.members)&&(d.broadcastZ(),d.checkZArray(this.myId,this.members))),d.counter===l&&!d.isFinished)switch(y=d.members.indexOf(e),p){case"z":d.debug("received Z value from "+e+", "+y),d.assert(-1!==y,"Unable to find a corresponding Z value of "+e),d.assert(void 0===d.zArray[y],"Setting Z value twice"),d.zArray[y]=a.z.slice(),d.checkZArray(this.myId,this.members);break;case"x":d.debug("received X value from "+e+", "+y),d.assert(-1!==y,"Unable to find a corresponding X value of "+e),d.assert(void 0===d.xArray[y],"Setting X value twice"),d.addX(y,a.x.slice()),d.checkXArray(this.myId,this.members)}return[2]}})})},e.prototype.setMyId=function(t){var e=this.members.indexOf(this.myId);-1!==e?this.members[e]=t:this.members.push(t),this.myId=t,this.myCounter=0,this.members.sort(function(t,e){return t-e})},e.prototype.setReady=function(){this.isReady=!0,this.isInitiator&&this.start()},e.prototype.checkCycles=function(){var t,e;if(this.members.length>1)if(this.isInitiator)this.start();else try{for(var n=K(this.cycles.values()),r=n.next();!r.done;r=n.next()){var i=r.value;if(i.debug("CHECK CYCLE"),!i.isFinished){if(!i.isZBroadcasted&&i.isReadyToBroadcastZ(this.members)){i.broadcastZ(),i.checkZArray(this.myId,this.members);continue}i.checkZArray(this.myId,this.members),i.checkXArray(this.myId,this.members)}}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}},Object.defineProperty(e.prototype,"isInitiator",{get:function(){return this.members.length>1&&this.members[0]===this.myId},enumerable:!0,configurable:!0}),e.prototype.start=function(){this.isReady&&this.members.length>1&&(t.prototype.setState.call(this,F.CALCUL_IN_PROGRESS),Q.debug("INITIATOR starts a NEW CYCLE"),this.createCycle(this.myId,++this.myCounter,this.members).broadcastZ())},e.prototype.createCycle=function(e,n,r){var i=this,o=new ft(e,n,r,this.myId,this.send,this.members);return this.cycles.set(e,o),o.onKey=function(e){i.key&&(i.previousKey=i.key),i.key=e,t.prototype.setState.call(i,F.READY),B.exportKey(i.key.value).then(function(t){Q.debug("KEY =",B.toB64(t))})},o},e}(ct);U.performance=D.performance},function(t,e){t.exports=require("crypto")},function(t,e){t.exports=require("text-encoding")},function(t,e,n){"use strict";n.r(e),n.d(e,"Bot",function(){return Be}),n.d(e,"LogLevel",function(){return m}),n.d(e,"setLogLevel",function(){return j}),n.d(e,"Topology",function(){return z}),n.d(e,"SignalingState",function(){return Wt}),n.d(e,"WebGroupState",function(){return pe}),n.d(e,"WebGroup",function(){return Ae});var r=n(5),i=n(6),o=n(3),s=n(0),a=n(1),u=n(9),c={};c.WebSocket=o,c.TextEncoder=i.TextEncoder,c.TextDecoder=i.TextDecoder,c.cryptoNode=r;
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var h=function(t,e){return(h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function l(t,e){function n(){this.constructor=t}h(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var f=function(){return(f=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function p(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(s,a)}u((r=r.apply(t,e||[])).next())})}function d(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function y(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function b(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function g(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(b(arguments[e]));return t}var m,v="background-color: #FFCA28; padding: 0 3px",w="background-color: #b3ba2e; padding: 0 3px",S="background-color: #CE93D8; padding: 0 3px",O="background-color: #90CAF9; padding: 0 3px",M="background-color: #26A69A; padding: 0 3px",I="background-color: #66BB6A; padding: 0 3px",_="background-color: #F57C00; padding: 0 3px",x="background-color: #9FA8DA; padding: 0 2px",E="background-color: #EF9A9A; padding: 0 2px",k="background-color: #FF5252; padding: 0 2px",T={webgroup:function(){},signalingState:function(){},webGroupState:function(){},webrtc:function(){},channel:function(){},topology:function(){},signaling:function(){},channelBuilder:function(){},debug:function(){},warn:function(){}};!function(t){t[t.DEBUG=0]="DEBUG",t[t.WEB_GROUP=1]="WEB_GROUP",t[t.WEBRTC=2]="WEBRTC",t[t.CHANNEL=3]="CHANNEL",t[t.TOPOLOGY=4]="TOPOLOGY",t[t.SIGNALING=5]="SIGNALING",t[t.CHANNEL_BUILDER=6]="CHANNEL_BUILDER"}(m||(m={}));var C=[];function j(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];(C=t).includes(m.WEB_GROUP)?(T.webgroup=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];0===e.length?console.info("%cNETFLUX WebGroup%c: "+t,v,""):console.info.apply(console,g(["%cNETFLUX WebGroup%c: "+t,v,""],e))},T.signalingState=function(t,e){console.info("%cNETFLUX "+e+" WebGroup%c: Signaling: %c"+t+"%c",v,"",x,"")},T.webGroupState=function(t,e){console.info("%cNETFLUX "+e+" WebGroup%c: WebGroup: %c"+t+"%c",v,"",E,"")}):(T.webgroup=function(){},T.signalingState=function(){},T.webGroupState=function(){}),C.includes(m.WEBRTC)?T.webrtc=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];0===e.length?console.info("%cNETFLUX WebRTC%c: "+t,S,""):console.info.apply(console,g(["%cNETFLUX WebRTC%c: "+t,S,""],e))}:T.webrtc=function(){},C.includes(m.CHANNEL)?T.channel=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];0===e.length?console.info("%cNETFLUX Channel%c: "+t,O,""):console.info.apply(console,g(["%cNETFLUX Channel%c: "+t,O,""],e))}:T.channel=function(){},C.includes(m.TOPOLOGY)?T.topology=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];0===e.length?console.info("%cNETFLUX Topology%c: "+t,M,""):console.info.apply(console,g(["%cNETFLUX Topology%c: "+t,M,""],e))}:T.topology=function(){},C.includes(m.SIGNALING)?T.signaling=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];0===e.length?console.info("%cNETFLUX Signaling%c: "+t,I,""):console.info.apply(console,g(["%cNETFLUX Signaling%c: "+t,I,""],e))}:T.signaling=function(){},C.includes(m.CHANNEL_BUILDER)?T.channelBuilder=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];0===e.length?console.info("%cNETFLUX ChannelBuilder%c: "+t,_,""):console.info.apply(console,g(["%cNETFLUX ChannelBuilder%c: "+t,_,""],e))}:T.channelBuilder=function(){},C.includes(m.DEBUG)?T.debug=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];0===e.length?console.info("%cNETFLUX Debug%c: "+t,w,""):console.info.apply(console,g(["%cNETFLUX Debug%c: "+t,w,""],e))}:T.debug=function(){},T.warn=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];0===e.length?console.info("%cNETFLUX WARNING%c: "+t,k,""):console.info.apply(console,g(["%cNETFLUX WARNING%c: "+t,k,""],e))}}var A=2147483648,N="undefined"!=typeof window;function P(){return!N||navigator.onLine}function R(){return!N||"visible"===document.visibilityState}function B(t){if(!new RegExp(/^(wss|ws):\/\/((([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])|(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9]))(:[0-9]{1,5})?(\/.*)?$/,"i").test(t))throw new Error("Invalid URL: "+t)}function L(t){void 0===t&&(t=[]);var e=U()[0];return e<A&&(e+=A),t.includes(e)?L(t):e}var D=512;function F(t){return t.split("/")[2]}function U(t){var e;if(void 0===t&&(t=1),N)e=new Uint32Array(t),c.crypto.getRandomValues(e);else{e=[];for(var n=c.cryptoNode.randomBytes(4*t),r=0;r<n.length;r+=4)e[e.length]=n.readUInt32BE(r,!0)}return e}function q(){return!!c.WebSocket}var z,$,G=function(){function t(t,e){this.serviceId=t,this.proto=e}return t.prototype.useWebChannelStream=function(t){var e=this;return{id:t.STREAM_ID,message:t.messageFromStream.pipe(Object(a.filter)(function(t){return t.serviceId===e.serviceId}),Object(a.map)(function(t){var n=t.channel,r=t.senderId,i=t.recipientId,o=t.content;return{channel:n,senderId:r,recipientId:i,msg:e.decode(o)}}),Object(a.filter)(function(t){var e=t.msg;return e&&e.type})),send:function(n,r){t.sendOverStream({senderId:t.myId,recipientId:r,serviceId:e.serviceId,content:n instanceof Uint8Array?n:e.encode(n)})}}},t.prototype.useSignalingStream=function(t){var e=this;return{id:t.STREAM_ID,message:t.messageFromStream.pipe(Object(a.filter)(function(t){return t.serviceId===e.serviceId}),Object(a.map)(function(t){var n=t.senderId,r=t.recipientId,i=t.content;return{senderId:n,recipientId:r,msg:e.decode(i)}}),Object(a.filter)(function(t){var e=t.msg;return e&&e.type})),send:function(n,r,i){t.sendOverStream({senderId:i,recipientId:r,serviceId:e.serviceId,content:n instanceof Uint8Array?n:e.encode(n)})}}},t.prototype.useAllStreams=function(t,e){var n=this.useWebChannelStream(t),r=this.useSignalingStream(e);return{message:Object(s.merge)(n.message.pipe(Object(a.map)(function(t){var e=t.senderId,r=t.recipientId,i=t.msg;return{streamId:n.id,senderId:e,recipientId:r,msg:i}})),r.message.pipe(Object(a.map)(function(t){var e=t.senderId,n=t.recipientId,i=t.msg;return{streamId:r.id,senderId:e,recipientId:n,msg:i}}))),sendOver:function(t,e,i,o){t===n.id?n.send(e,i):r.send(e,i,o)}}},t.prototype.encode=function(t){return this.proto.encode(this.proto.create(t)).finish()},t.prototype.decode=function(t){try{return this.proto.decode(t)}catch(t){T.warn("Decode service message error: ",t)}return{type:void 0}},t}();!function(t){t[t.FULL_MESH=0]="FULL_MESH"}(z||(z={})),function(t){t[t.CONSTRUCTING=0]="CONSTRUCTING",t[t.CONSTRUCTED=1]="CONSTRUCTED",t[t.IDLE=2]="IDLE"}($||($={}));var K=function(t){function e(e,n,r){var i=t.call(this,n,r)||this;return i.wc=e,i.wcStream=t.prototype.useWebChannelStream.call(i,e),i.stateSubject=new s.Subject,i._state=$.IDLE,i}return l(e,t),Object.defineProperty(e.prototype,"onState",{get:function(){return this.stateSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),e.prototype.setJoinedState=function(){this.setState($.CONSTRUCTED)},e.prototype.setState=function(t){this.state!==t&&(T.topology("Topology state = "+$[t]),this._state=t,this.stateSubject.next(t))},e}(G),V="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function W(t,e){return t(e={exports:{}},e.exports),e.exports}var H=function(t,e){var n=new Array(arguments.length-1),r=0,i=2,o=!0;for(;i<arguments.length;)n[r++]=arguments[i++];return new Promise(function(i,s){n[r]=function(t){if(o)if(o=!1,t)s(t);else{for(var e=new Array(arguments.length-1),n=0;n<e.length;)e[n++]=arguments[n];i.apply(null,e)}};try{t.apply(e||null,n)}catch(t){o&&(o=!1,s(t))}})};var J=W(function(t,e){var n=e;n.length=function(t){var e=t.length;if(!e)return 0;for(var n=0;--e%4>1&&"="===t.charAt(e);)++n;return Math.ceil(3*t.length)/4-n};for(var r=new Array(64),i=new Array(123),o=0;o<64;)i[r[o]=o<26?o+65:o<52?o+71:o<62?o-4:o-59|43]=o++;n.encode=function(t,e,n){for(var i,o=null,s=[],a=0,u=0;e<n;){var c=t[e++];switch(u){case 0:s[a++]=r[c>>2],i=(3&c)<<4,u=1;break;case 1:s[a++]=r[i|c>>4],i=(15&c)<<2,u=2;break;case 2:s[a++]=r[i|c>>6],s[a++]=r[63&c],u=0}a>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,s)),a=0)}return u&&(s[a++]=r[i],s[a++]=61,1===u&&(s[a++]=61)),o?(a&&o.push(String.fromCharCode.apply(String,s.slice(0,a))),o.join("")):String.fromCharCode.apply(String,s.slice(0,a))};n.decode=function(t,e,n){for(var r,o=n,s=0,a=0;a<t.length;){var u=t.charCodeAt(a++);if(61===u&&s>1)break;if(void 0===(u=i[u]))throw Error("invalid encoding");switch(s){case 0:r=u,s=1;break;case 1:e[n++]=r<<2|(48&u)>>4,r=u,s=2;break;case 2:e[n++]=(15&r)<<4|(60&u)>>2,r=u,s=3;break;case 3:e[n++]=(3&r)<<6|u,s=0}}if(1===s)throw Error("invalid encoding");return n-o},n.test=function(t){return/^(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/.test(t)}}),Z=X;function X(){this._listeners={}}X.prototype.on=function(t,e,n){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:e,ctx:n||this}),this},X.prototype.off=function(t,e){if(void 0===t)this._listeners={};else if(void 0===e)this._listeners[t]=[];else for(var n=this._listeners[t],r=0;r<n.length;)n[r].fn===e?n.splice(r,1):++r;return this},X.prototype.emit=function(t){var e=this._listeners[t];if(e){for(var n=[],r=1;r<arguments.length;)n.push(arguments[r++]);for(r=0;r<e.length;)e[r].fn.apply(e[r++].ctx,n)}return this};var Y=Q(Q);function Q(t){return"undefined"!=typeof Float32Array?function(){var e=new Float32Array([-0]),n=new Uint8Array(e.buffer),r=128===n[3];function i(t,r,i){e[0]=t,r[i]=n[0],r[i+1]=n[1],r[i+2]=n[2],r[i+3]=n[3]}function o(t,r,i){e[0]=t,r[i]=n[3],r[i+1]=n[2],r[i+2]=n[1],r[i+3]=n[0]}function s(t,r){return n[0]=t[r],n[1]=t[r+1],n[2]=t[r+2],n[3]=t[r+3],e[0]}function a(t,r){return n[3]=t[r],n[2]=t[r+1],n[1]=t[r+2],n[0]=t[r+3],e[0]}t.writeFloatLE=r?i:o,t.writeFloatBE=r?o:i,t.readFloatLE=r?s:a,t.readFloatBE=r?a:s}():function(){function e(t,e,n,r){var i=e<0?1:0;if(i&&(e=-e),0===e)t(1/e>0?0:2147483648,n,r);else if(isNaN(e))t(2143289344,n,r);else if(e>3.4028234663852886e38)t((i<<31|2139095040)>>>0,n,r);else if(e<1.1754943508222875e-38)t((i<<31|Math.round(e/1.401298464324817e-45))>>>0,n,r);else{var o=Math.floor(Math.log(e)/Math.LN2);t((i<<31|o+127<<23|8388607&Math.round(e*Math.pow(2,-o)*8388608))>>>0,n,r)}}function n(t,e,n){var r=t(e,n),i=2*(r>>31)+1,o=r>>>23&255,s=8388607&r;return 255===o?s?NaN:i*(1/0):0===o?1.401298464324817e-45*i*s:i*Math.pow(2,o-150)*(s+8388608)}t.writeFloatLE=e.bind(null,tt),t.writeFloatBE=e.bind(null,et),t.readFloatLE=n.bind(null,nt),t.readFloatBE=n.bind(null,rt)}(),"undefined"!=typeof Float64Array?function(){var e=new Float64Array([-0]),n=new Uint8Array(e.buffer),r=128===n[7];function i(t,r,i){e[0]=t,r[i]=n[0],r[i+1]=n[1],r[i+2]=n[2],r[i+3]=n[3],r[i+4]=n[4],r[i+5]=n[5],r[i+6]=n[6],r[i+7]=n[7]}function o(t,r,i){e[0]=t,r[i]=n[7],r[i+1]=n[6],r[i+2]=n[5],r[i+3]=n[4],r[i+4]=n[3],r[i+5]=n[2],r[i+6]=n[1],r[i+7]=n[0]}function s(t,r){return n[0]=t[r],n[1]=t[r+1],n[2]=t[r+2],n[3]=t[r+3],n[4]=t[r+4],n[5]=t[r+5],n[6]=t[r+6],n[7]=t[r+7],e[0]}function a(t,r){return n[7]=t[r],n[6]=t[r+1],n[5]=t[r+2],n[4]=t[r+3],n[3]=t[r+4],n[2]=t[r+5],n[1]=t[r+6],n[0]=t[r+7],e[0]}t.writeDoubleLE=r?i:o,t.writeDoubleBE=r?o:i,t.readDoubleLE=r?s:a,t.readDoubleBE=r?a:s}():function(){function e(t,e,n,r,i,o){var s=r<0?1:0;if(s&&(r=-r),0===r)t(0,i,o+e),t(1/r>0?0:2147483648,i,o+n);else if(isNaN(r))t(0,i,o+e),t(2146959360,i,o+n);else if(r>1.7976931348623157e308)t(0,i,o+e),t((s<<31|2146435072)>>>0,i,o+n);else{var a;if(r<2.2250738585072014e-308)t((a=r/5e-324)>>>0,i,o+e),t((s<<31|a/4294967296)>>>0,i,o+n);else{var u=Math.floor(Math.log(r)/Math.LN2);1024===u&&(u=1023),t(4503599627370496*(a=r*Math.pow(2,-u))>>>0,i,o+e),t((s<<31|u+1023<<20|1048576*a&1048575)>>>0,i,o+n)}}}function n(t,e,n,r,i){var o=t(r,i+e),s=t(r,i+n),a=2*(s>>31)+1,u=s>>>20&2047,c=4294967296*(1048575&s)+o;return 2047===u?c?NaN:a*(1/0):0===u?5e-324*a*c:a*Math.pow(2,u-1075)*(c+4503599627370496)}t.writeDoubleLE=e.bind(null,tt,0,4),t.writeDoubleBE=e.bind(null,et,4,0),t.readDoubleLE=n.bind(null,nt,0,4),t.readDoubleBE=n.bind(null,rt,4,0)}(),t}function tt(t,e,n){e[n]=255&t,e[n+1]=t>>>8&255,e[n+2]=t>>>16&255,e[n+3]=t>>>24}function et(t,e,n){e[n]=t>>>24,e[n+1]=t>>>16&255,e[n+2]=t>>>8&255,e[n+3]=255&t}function nt(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0}function rt(t,e){return(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}var it=function(t){return null};var ot=W(function(t,e){var n=e;n.length=function(t){for(var e=0,n=0,r=0;r<t.length;++r)(n=t.charCodeAt(r))<128?e+=1:n<2048?e+=2:55296==(64512&n)&&56320==(64512&t.charCodeAt(r+1))?(++r,e+=4):e+=3;return e},n.read=function(t,e,n){if(n-e<1)return"";for(var r,i=null,o=[],s=0;e<n;)(r=t[e++])<128?o[s++]=r:r>191&&r<224?o[s++]=(31&r)<<6|63&t[e++]:r>239&&r<365?(r=((7&r)<<18|(63&t[e++])<<12|(63&t[e++])<<6|63&t[e++])-65536,o[s++]=55296+(r>>10),o[s++]=56320+(1023&r)):o[s++]=(15&r)<<12|(63&t[e++])<<6|63&t[e++],s>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),s=0);return i?(s&&i.push(String.fromCharCode.apply(String,o.slice(0,s))),i.join("")):String.fromCharCode.apply(String,o.slice(0,s))},n.write=function(t,e,n){for(var r,i,o=n,s=0;s<t.length;++s)(r=t.charCodeAt(s))<128?e[n++]=r:r<2048?(e[n++]=r>>6|192,e[n++]=63&r|128):55296==(64512&r)&&56320==(64512&(i=t.charCodeAt(s+1)))?(r=65536+((1023&r)<<10)+(1023&i),++s,e[n++]=r>>18|240,e[n++]=r>>12&63|128,e[n++]=r>>6&63|128,e[n++]=63&r|128):(e[n++]=r>>12|224,e[n++]=r>>6&63|128,e[n++]=63&r|128);return n-o}}),st=function(t,e,n){var r=n||8192,i=r>>>1,o=null,s=r;return function(n){if(n<1||n>i)return t(n);s+n>r&&(o=t(r),s=0);var a=e.call(o,s,s+=n);return 7&s&&(s=1+(7|s)),a}};var at=ut;function ut(t,e){this.lo=t>>>0,this.hi=e>>>0}var ct=ut.zero=new ut(0,0);ct.toNumber=function(){return 0},ct.zzEncode=ct.zzDecode=function(){return this},ct.length=function(){return 1};var ht=ut.zeroHash="\0\0\0\0\0\0\0\0";ut.fromNumber=function(t){if(0===t)return ct;var e=t<0;e&&(t=-t);var n=t>>>0,r=(t-n)/4294967296>>>0;return e&&(r=~r>>>0,n=~n>>>0,++n>4294967295&&(n=0,++r>4294967295&&(r=0))),new ut(n,r)},ut.from=function(t){if("number"==typeof t)return ut.fromNumber(t);if(pt.isString(t)){if(!pt.Long)return ut.fromNumber(parseInt(t,10));t=pt.Long.fromString(t)}return t.low||t.high?new ut(t.low>>>0,t.high>>>0):ct},ut.prototype.toNumber=function(t){if(!t&&this.hi>>>31){var e=1+~this.lo>>>0,n=~this.hi>>>0;return e||(n=n+1>>>0),-(e+4294967296*n)}return this.lo+4294967296*this.hi},ut.prototype.toLong=function(t){return pt.Long?new pt.Long(0|this.lo,0|this.hi,Boolean(t)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(t)}};var lt=String.prototype.charCodeAt;ut.fromHash=function(t){return t===ht?ct:new ut((lt.call(t,0)|lt.call(t,1)<<8|lt.call(t,2)<<16|lt.call(t,3)<<24)>>>0,(lt.call(t,4)|lt.call(t,5)<<8|lt.call(t,6)<<16|lt.call(t,7)<<24)>>>0)},ut.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},ut.prototype.zzEncode=function(){var t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this},ut.prototype.zzDecode=function(){var t=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this},ut.prototype.length=function(){var t=this.lo,e=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===e?t<16384?t<128?1:2:t<2097152?3:4:e<16384?e<128?5:6:e<2097152?7:8:n<128?9:10};var ft,pt=W(function(t,e){var n=e;function r(t,e,n){for(var r=Object.keys(e),i=0;i<r.length;++i)void 0!==t[r[i]]&&n||(t[r[i]]=e[r[i]]);return t}function i(t){function e(t,n){if(!(this instanceof e))return new e(t,n);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&r(this,n)}return(e.prototype=Object.create(Error.prototype)).constructor=e,Object.defineProperty(e.prototype,"name",{get:function(){return t}}),e.prototype.toString=function(){return this.name+": "+this.message},e}n.asPromise=H,n.base64=J,n.EventEmitter=Z,n.float=Y,n.inquire=it,n.utf8=ot,n.pool=st,n.LongBits=at,n.global="undefined"!=typeof window&&window||void 0!==V&&V||"undefined"!=typeof self&&self||V,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isNode=Boolean(n.global.process&&n.global.process.versions&&n.global.process.versions.node),n.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},n.isString=function(t){return"string"==typeof t||t instanceof String},n.isObject=function(t){return t&&"object"==typeof t},n.isset=n.isSet=function(t,e){var n=t[e];return!(null==n||!t.hasOwnProperty(e))&&("object"!=typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},n.Buffer=function(){try{var t=n.inquire("buffer").Buffer;return t.prototype.utf8Write?t:null}catch(t){return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(t){return"number"==typeof t?n.Buffer?n._Buffer_allocUnsafe(t):new n.Array(t):n.Buffer?n._Buffer_from(t):"undefined"==typeof Uint8Array?t:new Uint8Array(t)},n.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(t){return t?n.LongBits.from(t).toHash():n.LongBits.zeroHash},n.longFromHash=function(t,e){var r=n.LongBits.fromHash(t);return n.Long?n.Long.fromBits(r.lo,r.hi,e):r.toNumber(Boolean(e))},n.merge=r,n.lcFirst=function(t){return t.charAt(0).toLowerCase()+t.substring(1)},n.newError=i,n.ProtocolError=i("ProtocolError"),n.oneOfGetter=function(t){for(var e={},n=0;n<t.length;++n)e[t[n]]=1;return function(){for(var t=Object.keys(this),n=t.length-1;n>-1;--n)if(1===e[t[n]]&&void 0!==this[t[n]]&&null!==this[t[n]])return t[n]}},n.oneOfSetter=function(t){return function(e){for(var n=0;n<t.length;++n)t[n]!==e&&delete this[t[n]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){var t=n.Buffer;t?(n._Buffer_from=t.from!==Uint8Array.from&&t.from||function(e,n){return new t(e,n)},n._Buffer_allocUnsafe=t.allocUnsafe||function(e){return new t(e)}):n._Buffer_from=n._Buffer_allocUnsafe=null}}),dt=St,yt=pt.LongBits,bt=pt.base64,gt=pt.utf8;function mt(t,e,n){this.fn=t,this.len=e,this.next=void 0,this.val=n}function vt(){}function wt(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function St(){this.len=0,this.head=new mt(vt,0,0),this.tail=this.head,this.states=null}function Ot(t,e,n){e[n]=255&t}function Mt(t,e){this.len=t,this.next=void 0,this.val=e}function It(t,e,n){for(;t.hi;)e[n++]=127&t.lo|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;for(;t.lo>127;)e[n++]=127&t.lo|128,t.lo=t.lo>>>7;e[n++]=t.lo}function _t(t,e,n){e[n]=255&t,e[n+1]=t>>>8&255,e[n+2]=t>>>16&255,e[n+3]=t>>>24}St.create=pt.Buffer?function(){return(St.create=function(){return new ft})()}:function(){return new St},St.alloc=function(t){return new pt.Array(t)},pt.Array!==Array&&(St.alloc=pt.pool(St.alloc,pt.Array.prototype.subarray)),St.prototype._push=function(t,e,n){return this.tail=this.tail.next=new mt(t,e,n),this.len+=e,this},Mt.prototype=Object.create(mt.prototype),Mt.prototype.fn=function(t,e,n){for(;t>127;)e[n++]=127&t|128,t>>>=7;e[n]=t},St.prototype.uint32=function(t){return this.len+=(this.tail=this.tail.next=new Mt((t>>>=0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this},St.prototype.int32=function(t){return t<0?this._push(It,10,yt.fromNumber(t)):this.uint32(t)},St.prototype.sint32=function(t){return this.uint32((t<<1^t>>31)>>>0)},St.prototype.uint64=function(t){var e=yt.from(t);return this._push(It,e.length(),e)},St.prototype.int64=St.prototype.uint64,St.prototype.sint64=function(t){var e=yt.from(t).zzEncode();return this._push(It,e.length(),e)},St.prototype.bool=function(t){return this._push(Ot,1,t?1:0)},St.prototype.fixed32=function(t){return this._push(_t,4,t>>>0)},St.prototype.sfixed32=St.prototype.fixed32,St.prototype.fixed64=function(t){var e=yt.from(t);return this._push(_t,4,e.lo)._push(_t,4,e.hi)},St.prototype.sfixed64=St.prototype.fixed64,St.prototype.float=function(t){return this._push(pt.float.writeFloatLE,4,t)},St.prototype.double=function(t){return this._push(pt.float.writeDoubleLE,8,t)};var xt=pt.Array.prototype.set?function(t,e,n){e.set(t,n)}:function(t,e,n){for(var r=0;r<t.length;++r)e[n+r]=t[r]};St.prototype.bytes=function(t){var e=t.length>>>0;if(!e)return this._push(Ot,1,0);if(pt.isString(t)){var n=St.alloc(e=bt.length(t));bt.decode(t,n,0),t=n}return this.uint32(e)._push(xt,e,t)},St.prototype.string=function(t){var e=gt.length(t);return e?this.uint32(e)._push(gt.write,e,t):this._push(Ot,1,0)},St.prototype.fork=function(){return this.states=new wt(this),this.head=this.tail=new mt(vt,0,0),this.len=0,this},St.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new mt(vt,0,0),this.len=0),this},St.prototype.ldelim=function(){var t=this.head,e=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=t.next,this.tail=e,this.len+=n),this},St.prototype.finish=function(){for(var t=this.head.next,e=this.constructor.alloc(this.len),n=0;t;)t.fn(t.val,e,n),n+=t.len,t=t.next;return e},St._configure=function(t){ft=t};var Et=Tt;(Tt.prototype=Object.create(dt.prototype)).constructor=Tt;var kt=pt.Buffer;function Tt(){dt.call(this)}Tt.alloc=function(t){return(Tt.alloc=pt._Buffer_allocUnsafe)(t)};var Ct=kt&&kt.prototype instanceof Uint8Array&&"set"===kt.prototype.set.name?function(t,e,n){e.set(t,n)}:function(t,e,n){if(t.copy)t.copy(e,n,0,t.length);else for(var r=0;r<t.length;)e[n++]=t[r++]};function jt(t,e,n){t.length<40?pt.utf8.write(t,e,n):e.utf8Write(t,n)}Tt.prototype.bytes=function(t){pt.isString(t)&&(t=pt._Buffer_from(t,"base64"));var e=t.length>>>0;return this.uint32(e),e&&this._push(Ct,e,t),this},Tt.prototype.string=function(t){var e=kt.byteLength(t);return this.uint32(e),e&&this._push(jt,e,t),this};var At,Nt=Lt,Pt=pt.LongBits,Rt=pt.utf8;function Bt(t,e){return RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)}function Lt(t){this.buf=t,this.pos=0,this.len=t.length}var Dt,Ft="undefined"!=typeof Uint8Array?function(t){if(t instanceof Uint8Array||Array.isArray(t))return new Lt(t);throw Error("illegal buffer")}:function(t){if(Array.isArray(t))return new Lt(t);throw Error("illegal buffer")};function Ut(){var t=new Pt(0,0),e=0;if(!(this.len-this.pos>4)){for(;e<3;++e){if(this.pos>=this.len)throw Bt(this);if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(127&this.buf[this.pos++])<<7*e)>>>0,t}for(;e<4;++e)if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(127&this.buf[this.pos])<<28)>>>0,t.hi=(t.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return t;if(e=0,this.len-this.pos>4){for(;e<5;++e)if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}else for(;e<5;++e){if(this.pos>=this.len)throw Bt(this);if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}function qt(t,e){return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0}function zt(){if(this.pos+8>this.len)throw Bt(this,8);return new Pt(qt(this.buf,this.pos+=4),qt(this.buf,this.pos+=4))}Lt.create=pt.Buffer?function(t){return(Lt.create=function(t){return pt.Buffer.isBuffer(t)?new At(t):Ft(t)})(t)}:Ft,Lt.prototype._slice=pt.Array.prototype.subarray||pt.Array.prototype.slice,Lt.prototype.uint32=(Dt=4294967295,function(){if(Dt=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return Dt;if(Dt=(Dt|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return Dt;if(Dt=(Dt|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return Dt;if(Dt=(Dt|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return Dt;if(Dt=(Dt|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return Dt;if((this.pos+=5)>this.len)throw this.pos=this.len,Bt(this,10);return Dt}),Lt.prototype.int32=function(){return 0|this.uint32()},Lt.prototype.sint32=function(){var t=this.uint32();return t>>>1^-(1&t)|0},Lt.prototype.bool=function(){return 0!==this.uint32()},Lt.prototype.fixed32=function(){if(this.pos+4>this.len)throw Bt(this,4);return qt(this.buf,this.pos+=4)},Lt.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Bt(this,4);return 0|qt(this.buf,this.pos+=4)},Lt.prototype.float=function(){if(this.pos+4>this.len)throw Bt(this,4);var t=pt.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t},Lt.prototype.double=function(){if(this.pos+8>this.len)throw Bt(this,4);var t=pt.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t},Lt.prototype.bytes=function(){var t=this.uint32(),e=this.pos,n=this.pos+t;if(n>this.len)throw Bt(this,t);return this.pos+=t,Array.isArray(this.buf)?this.buf.slice(e,n):e===n?new this.buf.constructor(0):this._slice.call(this.buf,e,n)},Lt.prototype.string=function(){var t=this.bytes();return Rt.read(t,0,t.length)},Lt.prototype.skip=function(t){if("number"==typeof t){if(this.pos+t>this.len)throw Bt(this,t);this.pos+=t}else do{if(this.pos>=this.len)throw Bt(this)}while(128&this.buf[this.pos++]);return this},Lt.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(t=7&this.uint32());)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this},Lt._configure=function(t){At=t;var e=pt.Long?"toLong":"toNumber";pt.merge(Lt.prototype,{int64:function(){return Ut.call(this)[e](!1)},uint64:function(){return Ut.call(this)[e](!0)},sint64:function(){return Ut.call(this).zzDecode()[e](!1)},fixed64:function(){return zt.call(this)[e](!0)},sfixed64:function(){return zt.call(this)[e](!1)}})};var $t=Gt;function Gt(t){Nt.call(this,t)}(Gt.prototype=Object.create(Nt.prototype)).constructor=Gt,pt.Buffer&&(Gt.prototype._slice=pt.Buffer.prototype.slice),Gt.prototype.string=function(){var t=this.uint32();return this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len))};var Kt=Vt;function Vt(t,e,n){if("function"!=typeof t)throw TypeError("rpcImpl must be a function");pt.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=Boolean(e),this.responseDelimited=Boolean(n)}(Vt.prototype=Object.create(pt.EventEmitter.prototype)).constructor=Vt,Vt.prototype.rpcCall=function t(e,n,r,i,o){if(!i)throw TypeError("request must be specified");var s=this;if(!o)return pt.asPromise(t,s,e,n,r,i);if(s.rpcImpl)try{return s.rpcImpl(e,n[s.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(t,n){if(t)return s.emit("error",t,e),o(t);if(null!==n){if(!(n instanceof r))try{n=r[s.responseDelimited?"decodeDelimited":"decode"](n)}catch(t){return s.emit("error",t,e),o(t)}return s.emit("data",n,e),o(null,n)}s.end(!0)})}catch(t){return s.emit("error",t,e),void setTimeout(function(){o(t)},0)}else setTimeout(function(){o(Error("already ended"))},0)},Vt.prototype.end=function(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};var Wt,Ht=W(function(t,e){e.Service=Kt}),Jt={},Zt=W(function(t,e){var n=e;function r(){n.Reader._configure(n.BufferReader),n.util._configure()}n.build="minimal",n.Writer=dt,n.BufferWriter=Et,n.Reader=Nt,n.BufferReader=$t,n.util=pt,n.rpc=Ht,n.roots=Jt,n.configure=r,n.Writer._configure(n.BufferWriter),r()}),Xt=Zt.Reader,Yt=Zt.Writer,Qt=Zt.util,te=Zt.roots,ee=Xt,ne=Yt,re=Qt,ie=te.default||(te.default={}),oe=ie.Message=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.senderId=0,t.prototype.recipientId=0,t.prototype.serviceId=0,t.prototype.content=re.newBuffer([]),t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=ne.create()),null!=t.senderId&&t.hasOwnProperty("senderId")&&e.uint32(8).uint32(t.senderId),null!=t.recipientId&&t.hasOwnProperty("recipientId")&&e.uint32(16).uint32(t.recipientId),null!=t.serviceId&&t.hasOwnProperty("serviceId")&&e.uint32(24).uint32(t.serviceId),null!=t.content&&t.hasOwnProperty("content")&&e.uint32(34).bytes(t.content),e},t.decode=function(t,e){t instanceof ee||(t=ee.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new ie.Message;t.pos<n;){var i=t.uint32();switch(i>>>3){case 1:r.senderId=t.uint32();break;case 2:r.recipientId=t.uint32();break;case 3:r.serviceId=t.uint32();break;case 4:r.content=t.bytes();break;default:t.skipType(7&i)}}return r},t}(),se=ie.userMessage=function(){var t={};return t.Message=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}var e,n,r;return t.prototype.length=0,t.prototype.type=0,t.prototype.full=re.newBuffer([]),t.prototype.chunk=null,Object.defineProperty(t.prototype,"contentType",{get:re.oneOfGetter(e=["full","chunk"]),set:re.oneOfSetter(e)}),t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=ne.create()),null!=t.length&&t.hasOwnProperty("length")&&e.uint32(8).uint32(t.length),null!=t.type&&t.hasOwnProperty("type")&&e.uint32(16).int32(t.type),null!=t.full&&t.hasOwnProperty("full")&&e.uint32(26).bytes(t.full),null!=t.chunk&&t.hasOwnProperty("chunk")&&ie.userMessage.Message.Chunk.encode(t.chunk,e.uint32(34).fork()).ldelim(),e},t.decode=function(t,e){t instanceof ee||(t=ee.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new ie.userMessage.Message;t.pos<n;){var i=t.uint32();switch(i>>>3){case 1:r.length=t.uint32();break;case 2:r.type=t.int32();break;case 3:r.full=t.bytes();break;case 4:r.chunk=ie.userMessage.Message.Chunk.decode(t,t.uint32());break;default:t.skipType(7&i)}}return r},t.Chunk=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.id=0,t.prototype.nb=0,t.prototype.content=re.newBuffer([]),t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=ne.create()),null!=t.id&&t.hasOwnProperty("id")&&e.uint32(8).uint32(t.id),null!=t.nb&&t.hasOwnProperty("nb")&&e.uint32(16).uint32(t.nb),null!=t.content&&t.hasOwnProperty("content")&&e.uint32(34).bytes(t.content),e},t.decode=function(t,e){t instanceof ee||(t=ee.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new ie.userMessage.Message.Chunk;t.pos<n;){var i=t.uint32();switch(i>>>3){case 1:r.id=t.uint32();break;case 2:r.nb=t.uint32();break;case 4:r.content=t.bytes();break;default:t.skipType(7&i)}}return r},t}(),t.Type=(n={},(r=Object.create(n))[n[0]="STRING"]=0,r[n[1]="U_INT_8_ARRAY"]=1,r),t}(),t}(),ae=ie.channelBuilder=function(){var t={};return t.Message=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}var e;return t.prototype.negotiation=null,t.prototype.connectionRequest=re.newBuffer([]),t.prototype.connectionResponse=!1,Object.defineProperty(t.prototype,"type",{get:re.oneOfGetter(e=["negotiation","connectionRequest","connectionResponse"]),set:re.oneOfSetter(e)}),t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=ne.create()),null!=t.negotiation&&t.hasOwnProperty("negotiation")&&ie.channelBuilder.Negotiation.encode(t.negotiation,e.uint32(10).fork()).ldelim(),null!=t.connectionRequest&&t.hasOwnProperty("connectionRequest")&&e.uint32(18).bytes(t.connectionRequest),null!=t.connectionResponse&&t.hasOwnProperty("connectionResponse")&&e.uint32(24).bool(t.connectionResponse),e},t.decode=function(t,e){t instanceof ee||(t=ee.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new ie.channelBuilder.Message;t.pos<n;){var i=t.uint32();switch(i>>>3){case 1:r.negotiation=ie.channelBuilder.Negotiation.decode(t,t.uint32());break;case 2:r.connectionRequest=t.bytes();break;case 3:r.connectionResponse=t.bool();break;default:t.skipType(7&i)}}return r},t}(),t.Negotiation=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.initiator=null,t.prototype.passive=null,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=ne.create()),null!=t.initiator&&t.hasOwnProperty("initiator")&&ie.channelBuilder.Info.encode(t.initiator,e.uint32(10).fork()).ldelim(),null!=t.passive&&t.hasOwnProperty("passive")&&ie.channelBuilder.Info.encode(t.passive,e.uint32(18).fork()).ldelim(),e},t.decode=function(t,e){t instanceof ee||(t=ee.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new ie.channelBuilder.Negotiation;t.pos<n;){var i=t.uint32();switch(i>>>3){case 1:r.initiator=ie.channelBuilder.Info.decode(t,t.uint32());break;case 2:r.passive=ie.channelBuilder.Info.decode(t,t.uint32());break;default:t.skipType(7&i)}}return r},t}(),t.Info=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.id=0,t.prototype.wss="",t.prototype.wcId=0,t.prototype.wsSupported=!1,t.prototype.wsTried=!1,t.prototype.dcSupported=!1,t.prototype.dcTried=!1,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=ne.create()),null!=t.id&&t.hasOwnProperty("id")&&e.uint32(8).uint32(t.id),null!=t.wss&&t.hasOwnProperty("wss")&&e.uint32(18).string(t.wss),null!=t.wcId&&t.hasOwnProperty("wcId")&&e.uint32(24).uint32(t.wcId),null!=t.wsSupported&&t.hasOwnProperty("wsSupported")&&e.uint32(32).bool(t.wsSupported),null!=t.wsTried&&t.hasOwnProperty("wsTried")&&e.uint32(40).bool(t.wsTried),null!=t.dcSupported&&t.hasOwnProperty("dcSupported")&&e.uint32(48).bool(t.dcSupported),null!=t.dcTried&&t.hasOwnProperty("dcTried")&&e.uint32(56).bool(t.dcTried),e},t.decode=function(t,e){t instanceof ee||(t=ee.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new ie.channelBuilder.Info;t.pos<n;){var i=t.uint32();switch(i>>>3){case 1:r.id=t.uint32();break;case 2:r.wss=t.string();break;case 3:r.wcId=t.uint32();break;case 4:r.wsSupported=t.bool();break;case 5:r.wsTried=t.bool();break;case 6:r.dcSupported=t.bool();break;case 7:r.dcTried=t.bool();break;default:t.skipType(7&i)}}return r},t}(),t}(),ue=ie.fullMesh=function(){var t={};return t.Message=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}var e;return t.prototype.members=null,t.prototype.adjacentMembers=null,t.prototype.heartbeat=!1,Object.defineProperty(t.prototype,"type",{get:re.oneOfGetter(e=["members","adjacentMembers","heartbeat"]),set:re.oneOfSetter(e)}),t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=ne.create()),null!=t.members&&t.hasOwnProperty("members")&&ie.fullMesh.Peers.encode(t.members,e.uint32(10).fork()).ldelim(),null!=t.adjacentMembers&&t.hasOwnProperty("adjacentMembers")&&ie.fullMesh.Peers.encode(t.adjacentMembers,e.uint32(26).fork()).ldelim(),null!=t.heartbeat&&t.hasOwnProperty("heartbeat")&&e.uint32(32).bool(t.heartbeat),e},t.decode=function(t,e){t instanceof ee||(t=ee.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new ie.fullMesh.Message;t.pos<n;){var i=t.uint32();switch(i>>>3){case 1:r.members=ie.fullMesh.Peers.decode(t,t.uint32());break;case 3:r.adjacentMembers=ie.fullMesh.Peers.decode(t,t.uint32());break;case 4:r.heartbeat=t.bool();break;default:t.skipType(7&i)}}return r},t}(),t.Peers=function(){function t(t){if(this.ids=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.ids=re.emptyArray,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=ne.create()),null!=t.ids&&t.ids.length){e.uint32(10).fork();for(var n=0;n<t.ids.length;++n)e.uint32(t.ids[n]);e.ldelim()}return e},t.decode=function(t,e){t instanceof ee||(t=ee.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new ie.fullMesh.Peers;t.pos<n;){var i=t.uint32();switch(i>>>3){case 1:if(r.ids&&r.ids.length||(r.ids=[]),2==(7&i))for(var o=t.uint32()+t.pos;t.pos<o;)r.ids.push(t.uint32());else r.ids.push(t.uint32());break;default:t.skipType(7&i)}}return r},t}(),t.ConnectionRequest=function(){function t(t){if(this.adjacentIds=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.id=0,t.prototype.adjacentIds=re.emptyArray,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=ne.create()),null!=t.id&&t.hasOwnProperty("id")&&e.uint32(8).uint32(t.id),null!=t.adjacentIds&&t.adjacentIds.length){e.uint32(18).fork();for(var n=0;n<t.adjacentIds.length;++n)e.uint32(t.adjacentIds[n]);e.ldelim()}return e},t.decode=function(t,e){t instanceof ee||(t=ee.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new ie.fullMesh.ConnectionRequest;t.pos<n;){var i=t.uint32();switch(i>>>3){case 1:r.id=t.uint32();break;case 2:if(r.adjacentIds&&r.adjacentIds.length||(r.adjacentIds=[]),2==(7&i))for(var o=t.uint32()+t.pos;t.pos<o;)r.adjacentIds.push(t.uint32());else r.adjacentIds.push(t.uint32());break;default:t.skipType(7&i)}}return r},t}(),t}(),ce=ie.dataChannelBuilder=function(){var t={};return t.Message=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}var e;return t.prototype.offer="",t.prototype.answer="",t.prototype.candidate=null,Object.defineProperty(t.prototype,"type",{get:re.oneOfGetter(e=["offer","answer","candidate"]),set:re.oneOfSetter(e)}),t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=ne.create()),null!=t.offer&&t.hasOwnProperty("offer")&&e.uint32(10).string(t.offer),null!=t.answer&&t.hasOwnProperty("answer")&&e.uint32(18).string(t.answer),null!=t.candidate&&t.hasOwnProperty("candidate")&&ie.dataChannelBuilder.IceCandidate.encode(t.candidate,e.uint32(26).fork()).ldelim(),e},t.decode=function(t,e){t instanceof ee||(t=ee.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new ie.dataChannelBuilder.Message;t.pos<n;){var i=t.uint32();switch(i>>>3){case 1:r.offer=t.string();break;case 2:r.answer=t.string();break;case 3:r.candidate=ie.dataChannelBuilder.IceCandidate.decode(t,t.uint32());break;default:t.skipType(7&i)}}return r},t}(),t.IceCandidate=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.candidate="",t.prototype.sdpMid="",t.prototype.sdpMLineIndex=0,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=ne.create()),null!=t.candidate&&t.hasOwnProperty("candidate")&&e.uint32(10).string(t.candidate),null!=t.sdpMid&&t.hasOwnProperty("sdpMid")&&e.uint32(18).string(t.sdpMid),null!=t.sdpMLineIndex&&t.hasOwnProperty("sdpMLineIndex")&&e.uint32(24).uint32(t.sdpMLineIndex),e},t.decode=function(t,e){t instanceof ee||(t=ee.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new ie.dataChannelBuilder.IceCandidate;t.pos<n;){var i=t.uint32();switch(i>>>3){case 1:r.candidate=t.string();break;case 2:r.sdpMid=t.string();break;case 3:r.sdpMLineIndex=t.uint32();break;default:t.skipType(7&i)}}return r},t}(),t}(),he=ie.channel=function(){var t={};return t.Message=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}var e;return t.prototype.initPing=null,t.prototype.initPong=0,Object.defineProperty(t.prototype,"type",{get:re.oneOfGetter(e=["initPing","initPong"]),set:re.oneOfSetter(e)}),t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=ne.create()),null!=t.initPing&&t.hasOwnProperty("initPing")&&ie.channel.Data.encode(t.initPing,e.uint32(10).fork()).ldelim(),null!=t.initPong&&t.hasOwnProperty("initPong")&&e.uint32(16).uint32(t.initPong),e},t.decode=function(t,e){t instanceof ee||(t=ee.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new ie.channel.Message;t.pos<n;){var i=t.uint32();switch(i>>>3){case 1:r.initPing=ie.channel.Data.decode(t,t.uint32());break;case 2:r.initPong=t.uint32();break;default:t.skipType(7&i)}}return r},t}(),t.Data=function(){function t(t){if(this.members=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.topology=0,t.prototype.wcId=0,t.prototype.senderId=0,t.prototype.members=re.emptyArray,t.prototype.key="",t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=ne.create()),null!=t.topology&&t.hasOwnProperty("topology")&&e.uint32(8).uint32(t.topology),null!=t.wcId&&t.hasOwnProperty("wcId")&&e.uint32(16).uint32(t.wcId),null!=t.senderId&&t.hasOwnProperty("senderId")&&e.uint32(24).uint32(t.senderId),null!=t.members&&t.members.length){e.uint32(34).fork();for(var n=0;n<t.members.length;++n)e.uint32(t.members[n]);e.ldelim()}return null!=t.key&&t.hasOwnProperty("key")&&e.uint32(42).string(t.key),e},t.decode=function(t,e){t instanceof ee||(t=ee.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new ie.channel.Data;t.pos<n;){var i=t.uint32();switch(i>>>3){case 1:r.topology=t.uint32();break;case 2:r.wcId=t.uint32();break;case 3:r.senderId=t.uint32();break;case 4:if(r.members&&r.members.length||(r.members=[]),2==(7&i))for(var o=t.uint32()+t.pos;t.pos<o;)r.members.push(t.uint32());else r.members.push(t.uint32());break;case 5:r.key=t.string();break;default:t.skipType(7&i)}}return r},t}(),t}(),le=ie.signaling=function(){var t={};return t.Message=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}var e;return t.prototype.heartbeat=!1,t.prototype.content=null,t.prototype.connect=null,t.prototype.connected=!1,Object.defineProperty(t.prototype,"type",{get:re.oneOfGetter(e=["heartbeat","content","connect","connected"]),set:re.oneOfSetter(e)}),t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=ne.create()),null!=t.heartbeat&&t.hasOwnProperty("heartbeat")&&e.uint32(8).bool(t.heartbeat),null!=t.content&&t.hasOwnProperty("content")&&ie.signaling.Content.encode(t.content,e.uint32(18).fork()).ldelim(),null!=t.connect&&t.hasOwnProperty("connect")&&ie.signaling.GroupData.encode(t.connect,e.uint32(26).fork()).ldelim(),null!=t.connected&&t.hasOwnProperty("connected")&&e.uint32(32).bool(t.connected),e},t.decode=function(t,e){t instanceof ee||(t=ee.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new ie.signaling.Message;t.pos<n;){var i=t.uint32();switch(i>>>3){case 1:r.heartbeat=t.bool();break;case 2:r.content=ie.signaling.Content.decode(t,t.uint32());break;case 3:r.connect=ie.signaling.GroupData.decode(t,t.uint32());break;case 4:r.connected=t.bool();break;default:t.skipType(7&i)}}return r},t}(),t.Content=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.senderId=0,t.prototype.recipientId=0,t.prototype.lastData=!1,t.prototype.data=re.newBuffer([]),t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=ne.create()),null!=t.senderId&&t.hasOwnProperty("senderId")&&e.uint32(8).uint32(t.senderId),null!=t.recipientId&&t.hasOwnProperty("recipientId")&&e.uint32(16).uint32(t.recipientId),null!=t.lastData&&t.hasOwnProperty("lastData")&&e.uint32(24).bool(t.lastData),null!=t.data&&t.hasOwnProperty("data")&&e.uint32(34).bytes(t.data),e},t.decode=function(t,e){t instanceof ee||(t=ee.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new ie.signaling.Content;t.pos<n;){var i=t.uint32();switch(i>>>3){case 1:r.senderId=t.uint32();break;case 2:r.recipientId=t.uint32();break;case 3:r.lastData=t.bool();break;case 4:r.data=t.bytes();break;default:t.skipType(7&i)}}return r},t}(),t.GroupData=function(){function t(t){if(this.members=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.id=0,t.prototype.members=re.emptyArray,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=ne.create()),null!=t.id&&t.hasOwnProperty("id")&&e.uint32(8).uint32(t.id),null!=t.members&&t.members.length){e.uint32(18).fork();for(var n=0;n<t.members.length;++n)e.uint32(t.members[n]);e.ldelim()}return e},t.decode=function(t,e){t instanceof ee||(t=ee.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new ie.signaling.GroupData;t.pos<n;){var i=t.uint32();switch(i>>>3){case 1:r.id=t.uint32();break;case 2:if(r.members&&r.members.length||(r.members=[]),2==(7&i))for(var o=t.uint32()+t.pos;t.pos<o;)r.members.push(t.uint32());else r.members.push(t.uint32());break;default:t.skipType(7&i)}}return r},t}(),t}(),fe=le.Message.encode(le.Message.create({heartbeat:!0})).finish();!function(t){t[t.CONNECTING=0]="CONNECTING",t[t.OPEN=1]="OPEN",t[t.CHECKING=2]="CHECKING",t[t.CHECKED=4]="CHECKED",t[t.CLOSED=3]="CLOSED"}(Wt||(Wt={}));var pe,de=function(){function t(t,e){this.STREAM_ID=1,this.wc=t,this.url=e,this.state=Wt.CLOSED,this.connected=!1,this.missedHeartbeat=0,this.streamSubject=new s.Subject,this.stateSubject=new s.Subject}return Object.defineProperty(t.prototype,"messageFromStream",{get:function(){return this.streamSubject.asObservable()},enumerable:!0,configurable:!0}),t.prototype.sendOverStream=function(t){T.signaling(this.wc.myId+" Forward message",t),this.send({content:{recipientId:t.recipientId,senderId:t.senderId,lastData:void 0===t.content,data:oe.encode(oe.create(t)).finish()}})},Object.defineProperty(t.prototype,"onState",{get:function(){return this.stateSubject.asObservable()},enumerable:!0,configurable:!0}),t.prototype.check=function(){var t=this;this.state!==Wt.CHECKED&&this.state!==Wt.OPEN||(this.setState(Wt.CHECKING),this.send({connect:{id:this.wc.myId,members:this.wc.members.filter(function(e){return e!==t.wc.myId})}}))},t.prototype.connect=function(t){var e=this;if(!q())throw new Error("Failed to join over Signaling: WebSocket is not supported by your environment");this.setState(Wt.CONNECTING),this.ws=new c.WebSocket(this.fullUrl(t)),this.ws.binaryType="arraybuffer",this.connectionTimeout=setTimeout(function(){e.ws&&e.ws.readyState!==e.ws.OPEN&&(T.signaling("Failed to connect to Signaling server "+e.url+": connection timeout"),e.close())},1e4),this.ws.onopen=function(){e.setState(Wt.OPEN),e.connectionTimeout&&clearTimeout(e.connectionTimeout),e.startHeartbeat()},this.ws.onerror=function(t){return T.signaling("WebSocket ERROR",t)},this.ws.onclose=function(t){e.clean(),e.setState(Wt.CLOSED)},this.ws.onmessage=function(t){var n=t.data;return e.handleMessage(n)}},t.prototype.close=function(){this.state!==Wt.CLOSED&&(this.ws&&(this.ws.onmessage=function(){},this.ws.onclose=function(){},this.ws.onerror=function(){},this.ws.close(1e3)),this.clean(),this.setState(Wt.CLOSED))},t.prototype.clean=function(){this.connectionTimeout&&clearTimeout(this.connectionTimeout),this.heartbeatInterval&&clearInterval(this.heartbeatInterval),this.ws=void 0},t.prototype.handleMessage=function(t){var e=this;try{var n=le.Message.decode(new Uint8Array(t));switch(n.type){case"heartbeat":this.missedHeartbeat=0;break;case"connected":this.connected=n.connected,this.setState(Wt.CHECKED),n.connected||this.wc.channelBuilder.connectOverSignaling().catch(function(){return e.check()});break;case"content":var r=n.content,i=r.data,o=r.senderId,s=r.recipientId,a=oe.decode(i);a.senderId=o,a.recipientId=s,T.signaling("StreamMessage RECEIVED: ",a),this.streamSubject.next(a)}}catch(t){T.warn("Decode Signaling message error: ",t)}},t.prototype.setState=function(t){this.state!==t&&(this.state=t,this.stateSubject.next(t))},t.prototype.startHeartbeat=function(){var t=this;this.missedHeartbeat=0,this.heartbeatInterval=setInterval(function(){try{if(t.missedHeartbeat++,t.missedHeartbeat>=3)throw new Error("Too many missed heartbeats");t.heartbeat()}catch(e){t.close()}},5e3)},t.prototype.send=function(t){if(this.ws&&this.ws.readyState===c.WebSocket.OPEN)try{this.ws.send(le.Message.encode(le.Message.create(t)).finish())}catch(t){T.signaling("Failed send to Signaling",t)}},t.prototype.heartbeat=function(){if(this.ws&&this.ws.readyState===c.WebSocket.OPEN)try{this.ws.send(fe)}catch(t){T.signaling("Failed send to Signaling: "+t.message)}},t.prototype.fullUrl=function(t){var e=this.url.endsWith("/")?this.url+t:this.url+"/"+t;return N?e:e+"?favored"},t}();!function(t){t[t.JOINING=0]="JOINING",t[t.JOINED=1]="JOINED",t[t.LEFT=2]="LEFT"}(pe||(pe={}));var ye,be=new c.TextEncoder,ge=new c.TextDecoder,me=function(t){function e(){var n=t.call(this,e.SERVICE_ID,se.Message)||this;return n.buffers=new Map,n}return l(e,t),e.prototype.clean=function(){this.buffers.clear()},e.prototype.encodeUserMessage=function(e){var n=this.userDataToType(e),r=n.type,i=n.bytes,o={length:i.length,type:r};if(i.length<=15e3)return o.full=i,[t.prototype.encode.call(this,o)];o.chunk={id:Math.ceil(65535*Math.random())};for(var s=Math.ceil(i.length/15e3),a=new Array(s),u=0;u<s;u++){var c=15e3*u,h=c+Math.min(15e3,i.length-15e3*u);o.chunk.nb=u,o.chunk.content=new Uint8Array(i.slice(c,h)),a[u]=t.prototype.encode.call(this,o)}return a},e.prototype.decodeUserMessage=function(e,n){try{var r=t.prototype.decode.call(this,e),i=r.length,o=r.type,s=r.contentType,a=r.full,u=r.chunk,c=void 0;switch(s){case"full":c=a;break;case"chunk":var h=this.getBuffer(n,u.id);void 0===h?(h=new ve(i,u.content,u.nb),this.setBuffer(n,u.id,h),c=void 0):c=h.append(u.content,u.nb);break;default:throw new Error("Unknown message integrity")}if(void 0!==c)switch(o){case se.Message.Type.U_INT_8_ARRAY:return c;case se.Message.Type.STRING:return ge.decode(c);default:throw new Error("Unknown message type")}return c}catch(t){return void T.warn("Decode user message error: ",t)}},e.prototype.userDataToType=function(t){if(t instanceof Uint8Array)return{type:se.Message.Type.U_INT_8_ARRAY,bytes:t};if("string"==typeof t)return{type:se.Message.Type.STRING,bytes:be.encode(t)};if(t instanceof String)return{type:se.Message.Type.STRING,bytes:be.encode(""+t)};throw new Error("Message neigther a string type or a Uint8Array type")},e.prototype.getBuffer=function(t,e){var n=this.buffers.get(t);if(void 0!==n)return n.get(e)},e.prototype.setBuffer=function(t,e,n){var r=this.buffers.get(t);void 0===r&&(r=new Map),r.set(e,n),this.buffers.set(t,r)},e.SERVICE_ID=743,e}(G),ve=function(){function t(t,e,n){this.fullData=new Uint8Array(t),this.currentLength=0,this.append(e,n)}return t.prototype.append=function(t,e){var n,r,i=15e3*e;this.currentLength+=t.length;try{for(var o=y(t),s=o.next();!s.done;s=o.next()){var a=s.value;this.fullData[i++]=a}}catch(t){n={error:t}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return this.currentLength===this.fullData.length?this.fullData:void 0},t}(),we=function(){function t(e,n,r,i,o){var s=this;T.channel("New Channel "+r+": Me: "+e.myId+" with "+i),this.wc=e,this.wsOrDc=n,this.type=r,this.pc=o,this.missedHeartbeat=0,this.heartbeatMsg=new Uint8Array(0),this.resolveInit=function(){},N?(n.binaryType="arraybuffer",this.send=this.sendInBrowser):this.pc?(n.binaryType="arraybuffer",this.send=this.sendInNodeOverDataChannel):this.send=this.sendInNodeOverWebSocket,r===t.WITH_INTERNAL?(this.id=i,this.heartbeatMsg=this.createHeartbeatMsg(),this.init=Promise.resolve(),this.initHandlers()):(this.id=A,r===t.WITH_JOINING&&this.sendInitPing(),this.init=new Promise(function(t,e){return s.resolveInit=function(){s.heartbeatMsg=s.createHeartbeatMsg(),t()}}),this.wsOrDc.onmessage=function(t){var e=t.data;try{var n=he.Message.decode(new Uint8Array(e));s.handleInitMessage(n)}catch(t){T.warn("Decode inner Channel message error: ",t)}})}return t.remoteType=function(e){return e===t.WITH_INTERNAL?t.WITH_INTERNAL:e===t.WITH_JOINING?t.WITH_MEMBER:t.WITH_JOINING},Object.defineProperty(t.prototype,"url",{get:function(){return this.pc?"":this.wsOrDc.url},enumerable:!0,configurable:!0}),t.prototype.encodeAndSend=function(t){var e=void 0===t?{}:t,n=e.senderId,r=void 0===n?this.wc.myId:n,i=e.recipientId,o=void 0===i?0:i,s=e.serviceId,a=e.content;this.send(oe.encode(oe.create({senderId:r,recipientId:o,serviceId:s,content:a})).finish())},t.prototype.close=function(){this.wsOrDc.onmessage=void 0,this.wsOrDc.onclose=void 0,this.wsOrDc.onerror=void 0,this.pc?(this.pc.oniceconnectionstatechange=function(){},this.pc.close()):this.wsOrDc.close(1e3)},t.prototype.sendHeartbeat=function(){this.missedHeartbeat++,this.missedHeartbeat>=3?(T.channel(this.id+" channel closed: too many missed heartbeats"),this.wc.topology.onChannelClose(this),this.close()):this.send(this.heartbeatMsg)},t.prototype.sendInBrowser=function(t){try{this.wsOrDc.send(t)}catch(t){T.channel("Channel sendInBrowser ERROR",t)}},t.prototype.sendInNodeOverWebSocket=function(t){try{this.wsOrDc.send(t,{binary:!0})}catch(t){T.channel("Channel sendInNodeOverWebSocket ERROR",t)}},t.prototype.sendInNodeOverDataChannel=function(t){this.sendInBrowser(t.slice(0))},t.prototype.handleInitMessage=function(t){switch(t.type){case"initPing":T.channel(this.wc.myId+" received InitPing");var e=t.initPing,n=e.topology,r=e.wcId,i=e.senderId,o=e.members,s=e.key;this.wc.topologyEnum!==n?T.channel("Different topology. This message should never be shown: something is wrong"):o.includes(this.id)&&this.wc.id,this.wc.id=r,this.wc.key=s,this.id=i,T.channel(this.wc.myId+" send InitPong"),this.send(he.Message.encode(he.Message.create({initPong:this.wc.myId})).finish()),this.initData={members:o},this.initHandlers(),this.resolveInit();break;case"initPong":T.channel(this.wc.myId+" received InitPong"),this.id=t.initPong,this.initHandlers(),this.resolveInit();break;default:T.channel('Unknown message type: "'+t.type+'". This message should never be shown: something went wrong')}},t.prototype.initHandlers=function(){var t=this;this.wsOrDc.onmessage=function(e){var n=e.data;try{var r=oe.decode(new Uint8Array(n));if(0===r.recipientId||r.recipientId===t.wc.myId)if(r.serviceId===me.SERVICE_ID){var i=t.wc.userMsg.decodeUserMessage(r.content,r.senderId);i&&t.wc.onMessage(r.senderId,i)}else 0===r.serviceId?t.missedHeartbeat=0:t.wc.streamSubject.next(f({channel:t},r));r.recipientId!==t.wc.myId&&t.wc.topology.forward(r)}catch(t){T.warn("Decode general Channel message error: ",t)}},this.wsOrDc.onclose=function(e){T.channel("Connection with "+t.id+" has closed",e),t.pc&&(t.pc.oniceconnectionstatechange=function(){}),t.wc.topology.onChannelClose(t)},this.pc&&(this.pc.oniceconnectionstatechange=function(){t.pc&&"failed"===t.pc.iceConnectionState&&(t.close(),t.wc.topology.onChannelClose(t))}),this.wsOrDc.onerror=function(t){return T.channel("Channel error: ",t)}},t.prototype.createHeartbeatMsg=function(){return oe.encode(oe.create({serviceId:0,senderId:this.wc.myId,recipientId:this.id})).finish()},t.prototype.sendInitPing=function(){T.channel("initialize..."),this.send(he.Message.encode(he.Message.create({initPing:{topology:this.wc.topologyEnum,wcId:this.wc.id,senderId:this.wc.myId,members:this.wc.members,key:this.wc.key}})).finish())},t.WITH_INTERNAL=0,t.WITH_JOINING=1,t.WITH_MEMBER=2,t}(),Se=function(){function t(t){this.wc=t,this.channelsSubject=new s.Subject}return Object.defineProperty(t.prototype,"channels",{get:function(){return this.channelsSubject.asObservable()},enumerable:!0,configurable:!0}),t.prototype.newWebSocket=function(t,e,n){this.channelsSubject.next({id:e,channel:new we(this.wc,t,n,e)})},t.prototype.connect=function(t,e,n,r,i){return p(this,void 0,void 0,function(){var o,s,a,u=this;return d(this,function(h){switch(h.label){case 0:return B(t),o=this.composeUrl(t,we.remoteType(e),i,r),s=new c.WebSocket(o),[4,new Promise(function(r,i){var o=setTimeout(function(){s.readyState!==s.OPEN&&(s.close(),i(new Error("WebSocket 4000ms connection timeout with '"+t+"'")))},4e3);s.onopen=function(){clearTimeout(o),r(new we(u.wc,s,e,n))},s.onerror=function(t){return i(t)},s.onclose=function(e){i(new Error("WebSocket with '"+t+"' closed "+e.code+": "+e.reason))}})];case 1:return a=h.sent(),this.channelsSubject.next({id:n,channel:a}),[2]}})})},t.prototype.composeUrl=function(t,e,n,r){var i=t+"/?type="+e+"&wcId="+n+"&senderId="+r;return e!==we.WITH_INTERNAL&&(i+="&key="+this.wc.key),i},t.listenUrl=new s.BehaviorSubject(""),t}(),Oe=function(){function t(t,e,n,r,i){var o=this;this.finalMessageReceived=!1,this.finalMessageSent=!1,this.id=t,this.pc=e,this.send=n,this._onError=function(){},this.candidates=new s.ReplaySubject,this.remotes=r,this.isSDPSent=!1,this.remotes.set(t,this),this.timer=setTimeout(function(){"connected"!==o.pc.iceConnectionState&&"completed"!==o.pc.iceConnectionState&&o._onError(new Error(i+"ms connection timeout"))},i),e.oniceconnectionstatechange=function(){T.webrtc("LOCAL ICE CONNECTION STATE",e.iceConnectionState),"failed"===e.iceConnectionState&&o._onError(new Error("Ice Connection State is FAILED"))},e.onicecandidate=function(t){null!==t.candidate?(T.webrtc("LOCAL ICE CANDIDATE",t.candidate.candidate),o.send({candidate:{candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex}})):(o.pc.onicecandidate=function(){},o.isSDPSent&&o.sendFinalMessage())}}return Object.defineProperty(t.prototype,"onError",{get:function(){return this._onError},set:function(t){var e=this;this._onError=function(n){T.webrtc("ERROR: ",n.message),e.clean("clean"!==n.message),t(n)}},enumerable:!0,configurable:!0}),t.prototype.sdpIsSent=function(){this.isSDPSent=!0,"complete"===this.pc.iceGatheringState&&this.sendFinalMessage()},t.prototype.clean=function(t){void 0===t&&(t=!0),T.webrtc("CLEAN REMOTE"),this.pc.oniceconnectionstatechange=function(){},this.pc.onicecandidate=function(){},this.pc.ondatachannel=function(){},this._onError=function(){},this.candidates.complete(),this.remotes.delete(this.id),clearTimeout(this.timer),this.pc.close(),t&&this.sendFinalMessage()},t.prototype.dataChannelOpen=function(t){T.webrtc("DATA CHANNEL with "+this.id+" OPEN"),this.finalMessageReceived&&this.finalMessageSent&&this.remotes.delete(this.id),this.pc.oniceconnectionstatechange=function(){},t.onopen=function(){},this.pc.ondatachannel=function(){},this._onError=function(){}},t.prototype.handleMessage=function(t){var e=this;if(t.type)switch(t.type){case"offer":T.webrtc("REMOTE OFFER",{offer:t.offer}),this.pc.setRemoteDescription({type:"offer",sdp:t.offer}).then(function(){return e.candidates.subscribe(function(t){return e.pc.addIceCandidate(t).catch(function(t){return T.webrtc("Failed to addIceCandidate",t)})})}).then(function(){return e.pc.createAnswer()}).then(function(t){return e.pc.setLocalDescription(t)}).then(function(){var t=e.pc.localDescription.sdp;T.webrtc("Send LOCAL ANSWER",{answer:t}),e.send({answer:t}),e.sdpIsSent()}).catch(function(t){return e._onError(t)});break;case"answer":T.webrtc("REMOTE ANSWER is received",{answer:t.answer}),this.pc.setRemoteDescription({type:"answer",sdp:t.answer}).then(function(){e.candidates.subscribe(function(t){return e.pc.addIceCandidate(t).catch(function(t){return T.webrtc(e.id+": Failed to add REMOTE Ice Candidate",t)})})}).catch(function(t){return e._onError(t)});break;case"candidate":T.webrtc("REMOTE ICE CANDIDATE is received",t.candidate),this.candidates.next(new c.RTCIceCandidate(t.candidate));break;default:this._onError(new Error("Buffer Protocol unknown message from the remote peer"))}else T.webrtc("REMOTE FINAL MESSAGE received"),this.finalMessageReceived=!0,this.candidates.complete(),this.finalMessageSent&&this.remotes.delete(this.id)},t.prototype.sendFinalMessage=function(){this.finalMessageSent||(this.finalMessageSent=!0,this.send({}),this.finalMessageReceived&&this.remotes.delete(this.id))},t}(),Me=function(t){function e(n,r){var i=t.call(this,e.SERVICE_ID,ce.Message)||this;return i.wc=n,i.allStreams=t.prototype.useAllStreams.call(i,n,n.signaling),i.rtcConfiguration=r,i.channelsSubject=new s.Subject,i.remotes=new Map,i.allStreams.message.subscribe(function(t){var e=t.streamId,n=t.senderId,r=t.recipientId,o=t.msg,s=i.remotes.get(n);if(s&&s.finalMessageReceived&&(s.clean(!1),s=void 0),!s){if(!o.type||"offer"!==o.type&&"candidate"!==o.type)return;try{s=i.createRemote(e,n,r,!0)}catch(t){return}}s.handleMessage(o)}),i}return l(e,t),Object.defineProperty(e.prototype,"channels",{get:function(){return this.channelsSubject.asObservable()},enumerable:!0,configurable:!0}),e.prototype.connect=function(t,e,n){return p(this,void 0,void 0,function(){var r,i,o,s,a,u,c,h=this;return d(this,function(l){switch(l.label){case 0:return T.webrtc("connectWith call",{targetId:t,myId:e,type:n}),r=n===we.WITH_INTERNAL?this.wc.STREAM_ID:this.wc.signaling.STREAM_ID,(i=this.remotes.get(t))?i.clean():i=this.createRemote(r,t,e),o=we.remoteType(n),s=i.pc.createDataChannel('{"id":'+this.wc.myId+',"type":'+o+"}"),[4,i.pc.createOffer()];case 1:return a=l.sent(),[4,i.pc.setLocalDescription(a)];case 2:return l.sent(),u=i.pc.localDescription.sdp,this.allStreams.sendOver(r,{offer:u},t,e),i.sdpIsSent(),[4,new Promise(function(e,r){i.onError=function(t){return r(t)},s.onopen=function(){i.dataChannelOpen(s),e(new we(h.wc,s,n,t,i.pc))}})];case 3:return c=l.sent(),this.channelsSubject.next({id:t,channel:c}),[2]}})})},e.prototype.clean=function(t){if(t){var e=this.remotes.get(t);e&&e.clean(!1)}else this.remotes.forEach(function(t){return t.onError(new Error("clean"))})},e.prototype.createRemote=function(t,e,n,r){var i=this;void 0===r&&(r=!1);var o=new Oe(e,new c.RTCPeerConnection(this.rtcConfiguration),function(r){return i.allStreams.sendOver(t,r,e,n)},this.remotes,9e3);r?(T.webrtc("create a new remote object with "+e+" - PASSIVE"),o.pc.ondatachannel=function(t){var n=t.channel,r=JSON.parse(n.label),s=r.id,a=r.type;n.onopen=function(){o.dataChannelOpen(n);var t=new we(i.wc,n,a,s,o.pc);i.channelsSubject.next({id:e,channel:t})}}):T.webrtc("create a new remote object with "+e+" - INITIATOR");return o},e.SERVICE_ID=7431,e}(G);!function(t){t.RESPONSE_TIMEOUT="Response timeout: remote peer is not responding",t.CONNECTION_TIMEOUT="Connection timeout: unable to establish a channel within a specified time",t.DENIED="Connection denied: remote peer refused the connection request",t.CLEAN="Clean: all connections in progress must be stopped",t.IN_PROGRESS="Connection setup is already in progress",t.NEGOTIATION_ERROR="All connection possibilities have been tried and none of them worked"}(ye||(ye={}));var Ie,_e=function(){function t(){this.connections=new Map}return t.prototype.create=function(t,e,n,r){var i=this,o={};return o.promise=new Promise(function(s,a){var u=setTimeout(function(){return o.reject(new Error(ye.RESPONSE_TIMEOUT))},n);o.resolve=function(){clearTimeout(u),s(),o.promise=new Promise(function(n,s){var a=setTimeout(function(){T.channelBuilder("on Connection timeout callback"),r(),o.reject(new Error(ye.CONNECTION_TIMEOUT))},e);o.resolve=function(){clearTimeout(a),i.connections.delete(t),n()},o.reject=function(e){o.promise.catch(function(){}),clearTimeout(a),i.connections.delete(t),s(e)}})},o.reject=function(e){o.promise.catch(function(){}),clearTimeout(u),i.connections.delete(t),a(e)},i.connections.set(t,o)}),o},t.prototype.get=function(t){return this.connections.get(t)},t.prototype.has=function(t,e){return this.connections.has(e)},t.prototype.clean=function(){this.connections.forEach(function(t){return t.reject(new Error(ye.CLEAN))}),this.connections.clear()},t}(),xe=Math.max(9e3,4e3)+5e3,Ee=function(t){function e(n){var r=t.call(this,e.SERVICE_ID,ae.Message)||this;return r.wc=n,r.allStreams=t.prototype.useAllStreams.call(r,n,n.signaling),r.connectsInProgress=new _e,r.channelsSubject=new s.Subject,r.onConnectionRequest=function(){return!0},r.dataChannelBuilder=new Me(r.wc,r.wc.rtcConfiguration),r.myInfo={wsTried:!1,wsSupported:q(),dcTried:!1,dcSupported:!!c.RTCPeerConnection&&"createDataChannel"in c.RTCPeerConnection.prototype},r.negotiationEncoded=t.prototype.encode.call(r,{negotiation:{initiator:r.myInfo}}),e.connectResTrueEncoded||e.connectResFalseEncoded||(e.connectResTrueEncoded=t.prototype.encode.call(r,{connectionResponse:!0}),e.connectResFalseEncoded=t.prototype.encode.call(r,{connectionResponse:!1})),r.allStreams.message.subscribe(function(t){var e=t.streamId,n=t.senderId,i=t.recipientId,o=t.msg;r.handleMessage(e,n,i,o)}),r.subscribeToChannels(),r.subscribeToURLandIDChange(),r}return l(e,t),e.prototype.clean=function(){T.channelBuilder("CLEAN call"),this.dataChannelBuilder.clean(),this.connectsInProgress.clean()},Object.defineProperty(e.prototype,"onChannel",{get:function(){return this.channelsSubject.asObservable()},enumerable:!0,configurable:!0}),e.prototype.connectOverWebChannel=function(t,e,n){return void 0===e&&(e=function(){}),void 0===n&&(n=new Uint8Array),p(this,void 0,void 0,function(){return d(this,function(r){return[2,this.connectOver(this.wc.STREAM_ID,t,e,n)]})})},e.prototype.connectOverSignaling=function(t,e){return void 0===t&&(t=function(){}),void 0===e&&(e=new Uint8Array),p(this,void 0,void 0,function(){return d(this,function(n){return[2,this.connectOver(this.wc.signaling.STREAM_ID,0,t,e)]})})},e.prototype.connectOver=function(t,e,n,r){return p(this,void 0,void 0,function(){var i,o=this;return d(this,function(s){switch(s.label){case 0:return(i=this.connectsInProgress.get(e))?[3,2]:(this.allStreams.sendOver(t,{connectionRequest:r},e,this.wc.myId),[4,(i=this.connectsInProgress.create(e,xe,2e3,function(){return o.dataChannelBuilder.clean(e)})).promise]);case 1:return s.sent(),n(),[2,i.promise];case 2:throw new Error(ye.IN_PROGRESS)}})})},e.prototype.handleMessage=function(t,n,r,i){var o=this;switch(i.type){case"connectionRequest":if(T.channelBuilder("connection Request from ",n),s=this.connectsInProgress.get(n)){if(!(n<this.wc.myId))return;s.reject(new Error(ye.IN_PROGRESS))}this.onConnectionRequest(t,i.connectionRequest)?((s=this.connectsInProgress.create(n,xe,2e3,function(){return o.dataChannelBuilder.clean(n)})).resolve(),T.channelBuilder("connection Response POSITIVE to ",n),this.allStreams.sendOver(t,e.connectResTrueEncoded,n,r)):(T.channelBuilder("connection Response NEGATIVE to ",n),this.allStreams.sendOver(t,e.connectResFalseEncoded,n,r));break;case"connectionResponse":var s;T.channelBuilder("connection Response from ",n),(s=this.connectsInProgress.get(n))&&(i.connectionResponse?(s.resolve(),T.channelBuilder("Send first negotiation message to ",n),this.allStreams.sendOver(t,this.negotiationEncoded,n,r)):s.reject(new Error(ye.DENIED)));break;case"negotiation":if(this.connectsInProgress.has(t,n)){var a=i.negotiation,u=a.initiator,c=a.passive;c||(u.id=n,(c=f({},this.myInfo)).id=r),T.channelBuilder("NEGOTIATION message to proceed from "+n+": ",JSON.stringify({isIamInitiatore:c.id===n,passive:c,initiator:u,senderId:n,recipientId:r})),this.isNagotiable(u,c)?this.proceedNegotiation(t,u,c,c.id===n).catch(function(e){o.rejectConnection(t,n,e),T.channelBuilder("NEGOTIATION with "+n+" FIALED: ",{passive:c,initiator:u}),o.allStreams.sendOver(t,{negotiation:{initiator:u,passive:c}},n,r)}):this.rejectConnection(t,n,new Error(ye.NEGOTIATION_ERROR))}}},e.prototype.proceedNegotiation=function(t,e,n,r){return p(this,void 0,void 0,function(){var i,o,s,a,u;return d(this,function(c){switch(c.label){case 0:return i=b(r?[e,n]:[n,e],2),o=i[0],s=i[1],(a=s.wss&&!o.wsTried)?[4,this.tryWs(t,o,s,r)]:[3,2];case 1:a=c.sent(),c.label=2;case 2:return a?[2]:o.wss&&!s.wsTried?(T.channelBuilder("Prompt the other to connect over WebSocket"),this.allStreams.sendOver(t,{negotiation:{initiator:e,passive:n}},s.id,o.id),[2]):o.dcSupported&&s.dcSupported?(u=!o.dcTried)?[4,this.tryDc(t,o,s,r)]:[3,4]:[3,5];case 3:u=c.sent(),c.label=4;case 4:if(u)return[2];if(!s.dcTried)return T.channelBuilder("Prompt the other to connect over RTCDataChannel"),this.allStreams.sendOver(t,{negotiation:{initiator:e,passive:n}},s.id,o.id),[2];c.label=5;case 5:throw new Error(ye.NEGOTIATION_ERROR)}})})},e.prototype.tryWs=function(t,e,n,r){return p(this,void 0,void 0,function(){var i,o,s;return d(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),i=this.getType(t,r),o=i===we.WITH_MEMBER?n.wcId:this.wc.myId,[4,this.wc.webSocketBuilder.connect(n.wss,i,n.id,e.id,o)];case 1:return a.sent(),T.channelBuilder("New WebSocket connection with "+n.id),[2,!0];case 2:return"clean"!==(s=a.sent()).message?(T.channelBuilder("WebSocket failed with "+n.id,s),e.wsTried=!0,[2,!1]):[2,!0];case 3:return[2]}})})},e.prototype.tryDc=function(t,e,n,r){return p(this,void 0,void 0,function(){var i,o;return d(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),i=this.getType(t,r),[4,this.dataChannelBuilder.connect(n.id,e.id,i)];case 1:return s.sent(),T.channelBuilder("New RTCDataChannel with "+n.id),[2,!0];case 2:return"clean"!==(o=s.sent()).message?(T.channelBuilder("RTCDataChannel failed with "+n.id,o),e.dcTried=!0,[2,!1]):[2,!0];case 3:return[2]}})})},e.prototype.getType=function(t,e){return t===this.wc.STREAM_ID?we.WITH_INTERNAL:e?we.WITH_MEMBER:we.WITH_JOINING},e.prototype.isNagotiable=function(t,e){return t.wss&&!e.wsTried||e.wss&&!t.wsTried||t.dcSupported&&e.dcSupported&&(!t.dcTried||!e.dcTried)},e.prototype.subscribeToChannels=function(){var t=this;Object(s.merge)(this.dataChannelBuilder.channels,this.wc.webSocketBuilder.channels).subscribe(function(e){var n=e.id,r=e.channel;r.init.then(function(){T.channelBuilder("NEW Channel from ",JSON.stringify({type:r.type,id:n}));var e=t.connectsInProgress.get(n);e?(T.channelBuilder("RESOLVE this NEW Channel"),e.resolve()):T.channelBuilder("this NEW Channel NOT FOUND"),t.channelsSubject.next(r)})})},e.prototype.subscribeToURLandIDChange=function(){var e=this;Se.listenUrl.subscribe(function(n){n&&(e.myInfo.wss=n,e.negotiationEncoded=t.prototype.encode.call(e,{negotiation:{initiator:e.myInfo}}))}),this.wc.onIdChange.subscribe(function(n){e.myInfo.wcId=e.wc.id,e.negotiationEncoded=t.prototype.encode.call(e,{negotiation:{initiator:e.myInfo}})})},e.prototype.rejectConnection=function(t,e,n){var r=this.connectsInProgress.get(e);r&&r.reject(n)},e.SERVICE_ID=74,e}(G),ke=function(t){function e(n){var r=t.call(this,n,e.SERVICE_ID,ue.Message)||this;return r.adjacentMembers=new Map,r.distantMembers=new Map,r.antecedentId=0,r.delayedMembers=new Set,r.delayedMembersTimers=new Set,r.adjacentBots=new Set,r.heartbeatMsg=t.prototype.encode.call(r,{heartbeat:!0}),r.wcStream.message.subscribe(function(t){var e=t.channel,n=t.senderId,i=t.msg;return r.handleServiceMessage(e,n,i)}),r.wc.channelBuilder.onConnectionRequest=function(t,e){try{var n=ue.ConnectionRequest.decode(e),i=n.id,o=n.adjacentIds;return t!==r.wc.STREAM_ID||(T.topology("CONNECTION REQUEST from "+i+", where adjacent members are: ",o),r.createOrUpdateDistantMember(i,o))}catch(t){return T.warn("Decode Fullmesh onConnectionRequest message error: ",t),!1}},r.wc.channelBuilder.onChannel.subscribe(function(e){T.topology("New adjacent member: "+e.id),r.distantMembers.delete(e.id),r.delayedMembers.delete(e.id);var n=r.adjacentMembers.get(e.id);if(n&&(T.topology("Replacing the same channel"),n.close()),r.adjacentMembers.set(e.id,e),e.url&&r.adjacentBots.add(e),r.notifyDistantMembers(),r.heartbeatInterval||r.startHeartbeatInterval(),e.type===we.WITH_MEMBER){t.prototype.setState.call(r,$.CONSTRUCTING);var i=e.initData.members;r.connectToMembers(i,e.id).then(function(){t.prototype.setState.call(r,$.CONSTRUCTED),r.startMembersCheckIntervals()})}else r.startMembersCheckIntervals();r.wc.onMemberJoinProxy(e.id),r.updateAntecedentId()}),N&&(window.fullmesh=function(){T.topology("Fullmesh info:",{myId:r.wc.myId,antecedentId:r.antecedentId,signalingState:r.wc.signaling.state,webGroupState:r.wc.state,topologyState:$[r.state],adjacentBots:Array.from(r.adjacentBots).map(function(t){return t.id}),adjacentMembers:Array.from(r.adjacentMembers.keys()).toString(),distantMembers:Array.from(r.distantMembers.keys()).toString(),distantMembersDETAILS:Array.from(r.distantMembers.keys()).map(function(t){var e=r.distantMembers.get(t);return{id:t,adjacentMembers:e?e.adjacentIds:[]}})})}),r}return l(e,t),e.prototype.send=function(t){var e=this;this.adjacentMembers.forEach(function(e){return e.encodeAndSend(t)}),this.distantMembers.forEach(function(n,r){e.sendToDistantPeer(n,f({},t,{recipientId:r}))})},e.prototype.sendTo=function(t){var e=this.adjacentMembers.get(t.recipientId);e?e.encodeAndSend(t):this.sendToDistantPeer(this.distantMembers.get(t.recipientId),t)},e.prototype.forward=function(t){this.sendTo(t)},e.prototype.leave=function(){this.state!==$.IDLE&&(T.topology("LEAVE"),this.clean(),this.adjacentMembers.forEach(function(t){return t.close()}),this.wc.onAdjacentMembersLeaveProxy(Array.from(this.adjacentMembers.keys())),this.adjacentMembers.clear(),t.prototype.setState.call(this,$.IDLE))},e.prototype.onChannelClose=function(t){this.adjacentMembers.delete(t.id)&&(this.adjacentBots.delete(t),this.delayedMembers.delete(t.id),this.wc.onAdjacentMembersLeaveProxy([t.id]),0===this.adjacentMembers.size?this.clean():(this.notifyDistantMembers(),this.updateAntecedentId()),T.topology("Channel closed with "+t.id))},Object.defineProperty(e.prototype,"neighbors",{get:function(){return Array.from(this.adjacentMembers.values())},enumerable:!0,configurable:!0}),e.prototype.clean=function(){T.topology("CLEAN"),this.wc.onDistantMembersLeaveProxy(Array.from(this.distantMembers.keys())),this.distantMembers.clear(),this.antecedentId=0,clearInterval(this.heartbeatInterval),this.heartbeatInterval=void 0,clearInterval(this.membersCheckInterval),this.membersCheckInterval=void 0,this.delayedMembers.clear(),this.delayedMembersTimers.forEach(function(t){return clearTimeout(t)}),this.delayedMembersTimers.clear(),this.adjacentBots.clear()},e.prototype.handleServiceMessage=function(t,e,n){switch(n.type){case"members":this.connectToMembers(n.members.ids,e);break;case"adjacentMembers":T.topology("adjacent members received from "+e,n.adjacentMembers.ids);var r=n.adjacentMembers.ids;this.createOrUpdateDistantMember(e,r);break;case"heartbeat":var i=this.distantMembers.get(e);i&&(i.missedHeartbeat=0)}},e.prototype.connectToMembers=function(t,e){var n,r,i=this,o=t.filter(function(t){return!i.adjacentMembers.has(t)&&t!==i.wc.myId});if(0!==o.length){T.topology("TRY TO CONNECT to members",o);var s=[],a=ue.ConnectionRequest.encode(ue.ConnectionRequest.create({id:this.wc.myId,adjacentIds:Array.from(this.adjacentMembers.keys())})).finish(),u=function(t){c.distantMembers.has(t)||(c.distantMembers.set(t,{adjacentIds:[e],missedHeartbeat:0}),T.topology("NEW distant member = "+t+"; BIS",e),c.updateAntecedentId()),c.delayedMembers.has(t)||(s[s.length]=c.wc.channelBuilder.connectOverWebChannel(t,function(){i.wc.onMemberJoinProxy(t),i.updateAntecedentId()},a).catch(function(e){if(T.topology("FAILED to connect to "+t+", because: "+e.message),e.message===ye.CONNECTION_TIMEOUT||e.message===ye.NEGOTIATION_ERROR||e.message===ye.IN_PROGRESS){i.delayedMembers.add(t);var n=setTimeout(function(){i.delayedMembers.delete(t),i.delayedMembersTimers.delete(n)},3e5);i.delayedMembersTimers.add(n)}}))},c=this;try{for(var h=y(o),l=h.next();!l.done;l=h.next()){u(l.value)}}catch(t){n={error:t}}finally{try{l&&!l.done&&(r=h.return)&&r.call(h)}finally{if(n)throw n.error}}return Promise.all(s)}return Promise.resolve()},e.prototype.notifyDistantMembers=function(){var e=this;if(0!==this.distantMembers.size){var n=t.prototype.encode.call(this,{adjacentMembers:{ids:Array.from(this.adjacentMembers.keys())}});this.distantMembers.forEach(function(t,r){return e.wcStream.send(n,r)})}},e.prototype.startMembersCheckIntervals=function(){var t=this;this.membersCheckInterval||(this.membersCheckInterval=setInterval(function(){t.antecedentId&&t.wcStream.send({members:{ids:t.wc.members}},t.antecedentId)},2e4))},e.prototype.startHeartbeatInterval=function(){var t=this;this.heartbeatInterval=setInterval(function(){t.adjacentMembers.forEach(function(t){return t.sendHeartbeat()}),t.distantMembers.forEach(function(e,n){e.missedHeartbeat++,e.missedHeartbeat>=4&&(T.topology("Distant peer "+n+" stopped to responding: too many missed heartbeats"),t.distantMembers.delete(n)&&(t.delayedMembers.delete(n),t.wc.onDistantMembersLeaveProxy([n]),t.updateAntecedentId())),t.wcStream.send(t.heartbeatMsg,n)})},3e3)},e.prototype.sendToDistantPeer=function(t,e){for(var n=1;n<=3;n++){var r=this.findRoutedChannel(t,n);if(r)return void r.encodeAndSend(e)}},e.prototype.findRoutedChannel=function(t,e){var n,r,i,o,s,a;if(t){try{for(var u=y(this.adjacentBots),c=u.next();!c.done;c=u.next()){var h=c.value;if(t.adjacentIds.includes(h.id))return h}}catch(t){n={error:t}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}try{for(var l=y(this.adjacentMembers),f=l.next();!f.done;f=l.next()){var p=b(f.value,2),d=p[0];h=p[1];if(t.adjacentIds.includes(d))return h}}catch(t){i={error:t}}finally{try{f&&!f.done&&(o=l.return)&&o.call(l)}finally{if(i)throw i.error}}if(0!==e)try{for(var g=y(t.adjacentIds),m=g.next();!m.done;m=g.next()){var v=m.value;if(h=this.findRoutedChannel(this.distantMembers.get(v),e-1))return h}}catch(t){s={error:t}}finally{try{m&&!m.done&&(a=g.return)&&a.call(g)}finally{if(s)throw s.error}}}},e.prototype.createOrUpdateDistantMember=function(t,e){if(!this.adjacentMembers.has(t)){var n=this.distantMembers.get(t);return n?(n.adjacentIds=e,T.topology("UPDATE distant member = "+t,n.adjacentIds)):(this.distantMembers.set(t,{adjacentIds:e,missedHeartbeat:0}),this.wc.onMemberJoinProxy(t),T.topology("NEW distant member = "+t,e),this.updateAntecedentId()),!0}return T.topology("ABNORMAL update or create a distant member "+t+", but he is also an adjacent member"),!1},e.prototype.updateAntecedentId=function(){var t,e;if(this.adjacentMembers.size>0){var n=-1,r=-1;try{for(var i=y(this.wc.members),o=i.next();!o.done;o=i.next()){var s=o.value;s!==this.wc.myId&&(s<this.wc.myId&&s>r&&(r=s),n<s&&(n=s))}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}this.antecedentId=-1!==r?r:n}else this.antecedentId=0;T.topology("UPDATE, antecedentId = "+this.antecedentId+", members = ",JSON.stringify(this.wc.members))},e.SERVICE_ID=74315,e}(K),Te={topology:z.FULL_MESH,signalingServer:"wss://signaling.netflux.coedit.re",rtcConfiguration:{iceServers:[{urls:"stun:stun3.l.google.com:19302"}]},autoRejoin:!0},Ce=function(){function t(t){this.STREAM_ID=2;var e=f({},Te,t),n=e.topology,r=e.autoRejoin,i=e.rtcConfiguration,o=e.signalingServer;this.streamSubject=new s.Subject,this.idSubject=new s.Subject,this.topologyEnum=n,this.autoRejoin=r,this.rtcConfiguration=i,this.members=[],this._id=0,this.key="",this.myId=0,this.state=pe.LEFT,this.rejoinEnabled=!1,this.rejoinTimer=void 0,this.topology={},this._onAlone=function(){},this.onMemberJoin=function(){},this.onMemberLeave=function(){},this.onMessage=function(){},this.onMyId=function(){},this.onStateChange=function(){},this.onSignalingStateChange=function(){},this.userMsg=new me,this.signaling=new de(this,o),this.subscribeToSignalingState(),this.webSocketBuilder=new Se(this),this.channelBuilder=new Ee(this),this.setTopology(n),N&&this.subscribeToBrowserEvents()}return Object.defineProperty(t.prototype,"onIdChange",{get:function(){return this.idSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},set:function(t){this._id=t,this.idSubject.next(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"messageFromStream",{get:function(){return this.streamSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onAlone",{set:function(t){this._onAlone=t},enumerable:!0,configurable:!0}),t.prototype.sendOverStream=function(t){this.topology.sendTo(t)},t.prototype.join=function(t){void 0===t&&(t=function(){for(var t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",e=U(42),n="",r=0;r<42;r++)n+=t[e[r]%t.length];return n}()),function(t){if("string"!=typeof t)throw new Error('The key type "'+typeof t+'" is not a "string"');if(""===t)throw new Error("The key is an empty string");if(t.length>D)throw new Error("The key length of "+t.length+" exceeds the maximum of "+D+" characters")}(t),this.state===pe.LEFT&&this.startJoin(t)},t.prototype.invite=function(t){var e,n;B(t);var r=F(t);try{for(var i=y(this.topology.neighbors),o=i.next();!o.done;o=i.next()){if(r===F(o.value.url))return}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}this.webSocketBuilder.connect(t,we.WITH_JOINING,-1,-1,this.id).catch(function(e){return T.webgroup("Failed to invite the bot "+t+": "+e.message)})},t.prototype.leave=function(){this.state!==pe.LEFT&&(this.key="",this.internalLeave())},t.prototype.send=function(t){var e,n;if(1!==this.members.length)try{for(var r=y(this.userMsg.encodeUserMessage(t)),i=r.next();!i.done;i=r.next()){var o=i.value;this.topology.send({senderId:this.myId,recipientId:0,serviceId:me.SERVICE_ID,content:o})}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}},t.prototype.sendTo=function(t,e){var n,r;if(1!==this.members.length)try{for(var i=y(this.userMsg.encodeUserMessage(e)),o=i.next();!o.done;o=i.next()){var s=o.value;this.topology.sendTo({senderId:this.myId,recipientId:t,serviceId:me.SERVICE_ID,content:s})}}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},t.prototype.onMemberJoinProxy=function(t){this.members.includes(t)||(this.members[this.members.length]=t,this.onMemberJoin(t))},t.prototype.onAdjacentMembersLeaveProxy=function(t){this.onMemberLeaveProxy(t)&&(1===this.members.length?(this._onAlone(),this.topology.leave()):this.signaling.state===Wt.CHECKED&&this.topology.state===$.CONSTRUCTED&&this.signaling.check())},t.prototype.onDistantMembersLeaveProxy=function(t){this.onMemberLeaveProxy(t)},t.prototype.init=function(t,e){void 0===e&&(e=L()),T.webgroup("INIT"),this.id=e,this.myId=L(),this.members=[this.myId],this.key=t,this.rejoinEnabled=this.autoRejoin,this.onMyId(this.myId),this.rejoinTimer&&(clearTimeout(this.rejoinTimer),this.rejoinTimer=void 0),this.setState(pe.JOINING)},t.prototype.clean=function(){T.webgroup("CLEAN"),this.rejoinTimer&&(clearTimeout(this.rejoinTimer),this.rejoinTimer=void 0),this.members=[],this.id=0,this.myId=0},t.prototype.setState=function(t){this.state!==t&&(T.webGroupState(pe[t],this.myId),this.state=t,this.onStateChange(t))},t.prototype.setTopology=function(t){var e=this;this.topologyEnum=t,this.topology=new ke(this),this.topology.onState.subscribe(function(t){switch(T.webgroup("Topology state: ",$[t]),t){case $.CONSTRUCTING:e.setState(pe.JOINING);break;case $.CONSTRUCTED:e.signaling.state===Wt.OPEN?e.signaling.check():e.signaling.state===Wt.CHECKED?(e.setState(pe.JOINED),e.signaling.check()):e.signaling.state===Wt.CLOSED&&e.signaling.connect(e.key);break;case $.IDLE:switch(e.channelBuilder.clean(),e.userMsg.clean(),e.signaling.state){case Wt.CLOSED:e.rejoinEnabled?e.rejoin():e.internalLeave();break;case Wt.CONNECTING:e.setState(pe.JOINING);break;case Wt.OPEN:e.setState(pe.JOINING),e.signaling.check();break;case Wt.CHECKING:e.setState(pe.JOINING);break;case Wt.CHECKED:e.signaling.check()}}})},t.prototype.subscribeToSignalingState=function(){var t=this;this.signaling.onState.subscribe(function(e){switch(T.signalingState(Wt[e],t.myId),t.onSignalingStateChange(e),e){case Wt.CLOSED:t.topology.state===$.IDLE?t.rejoinEnabled?t.rejoin():t.internalLeave():t.topology.state===$.CONSTRUCTED&&(1===t.members.length?t.topology.leave():t.rejoinEnabled&&!t.rejoinTimer&&t.reconnectToSignaling());break;case Wt.OPEN:t.topology.state!==$.CONSTRUCTING&&t.signaling.check();break;case Wt.CHECKED:t.topology.state===$.IDLE?t.signaling.connected&&t.topology.setJoinedState():t.topology.state===$.CONSTRUCTED&&t.setState(pe.JOINED)}})},t.prototype.subscribeToBrowserEvents=function(){var t=this;window.addEventListener("online",function(){return t.onBrowserBack()}),window.addEventListener("visibilitychange",function(){return t.onBrowserBack()}),window.addEventListener("beforeunload",function(){return t.leave()})},t.prototype.startJoin=function(t){void 0===t&&(t=this.key),T.webgroup("start join..."),this.init(t),this.signaling.connect(t)},t.prototype.rejoin=function(){var t=this;this.setState(pe.JOINING),R()&&P()?(this.clean(),T.webgroup("rejoin in 3000ms"),this.rejoinTimer=setTimeout(function(){t.signaling.state===Wt.CLOSED&&R()&&P()&&t.rejoinEnabled?t.startJoin():(T.webgroup("abandon rejoin because: ",{isVisible:R(),isOnline:P(),signalingState:Wt[t.signaling.state],rejoinEnabled:t.rejoinEnabled}),t.internalLeave()),t.rejoinTimer=void 0},3e3)):this.internalLeave()},t.prototype.reconnectToSignaling=function(){var t=this;1!==this.members.length||R()&&P()?(T.webgroup("reconnect to Signaling server in 3000ms"),this.setState(pe.JOINING),this.rejoinTimer=setTimeout(function(){t.signaling.state===Wt.CLOSED&&(R()&&P()?t.rejoinEnabled&&t.signaling.connect(t.key):1===t.members.length&&t.internalLeave()),t.rejoinTimer=void 0},3e3)):this.internalLeave()},t.prototype.onBrowserBack=function(){R()&&P()&&(T.webgroup("onBrowserBack",{isVisible:R(),isOnline:P()}),this.rejoinEnabled=this.autoRejoin,this.rejoinEnabled&&(this.state===pe.LEFT?this.startJoin():this.signaling.state===Wt.CLOSED&&this.signaling.connect(this.key)))},t.prototype.onMemberLeaveProxy=function(t){var e=this,n=!1;return t.forEach(function(t){e.members.includes(t)&&(e.members.splice(e.members.indexOf(t),1),n=!0,e.onMemberLeave(t))}),n},t.prototype.internalLeave=function(){T.webgroup("internal leave"),this.rejoinEnabled=!1,this.signaling.close(),this.topology.leave(),this.clean(),this.setState(pe.LEFT)},t}(),je=new WeakMap,Ae=function(){function t(t){void 0===t&&(t={});var e=new Ce(t);je.set(this,e),this.id=void 0,Reflect.defineProperty(this,"id",{configurable:!1,enumerable:!0,get:function(){return e.id}}),this.myId=void 0,Reflect.defineProperty(this,"myId",{configurable:!1,enumerable:!0,get:function(){return e.myId}}),this.key=void 0,Reflect.defineProperty(this,"key",{configurable:!1,enumerable:!0,get:function(){return e.key}}),this.members=void 0,Reflect.defineProperty(this,"members",{configurable:!1,enumerable:!0,get:function(){return e.members}}),this.neighbors=void 0,Reflect.defineProperty(this,"neighbors",{configurable:!1,enumerable:!0,get:function(){return e.topology.neighbors.map(function(t){return t.id})}}),this.topology=void 0,Reflect.defineProperty(this,"topology",{configurable:!1,enumerable:!0,get:function(){return e.topologyEnum}}),this.state=void 0,Reflect.defineProperty(this,"state",{configurable:!1,enumerable:!0,get:function(){return e.state}}),this.signalingState=void 0,Reflect.defineProperty(this,"signalingState",{configurable:!1,enumerable:!0,get:function(){return e.signaling.state}}),this.signalingServer=void 0,Reflect.defineProperty(this,"signalingServer",{configurable:!1,enumerable:!0,get:function(){return e.signaling.url}}),this.autoRejoin=void 0,Reflect.defineProperty(this,"autoRejoin",{configurable:!1,enumerable:!0,get:function(){return e.autoRejoin},set:function(t){return e.autoRejoin=t}}),this.onMessage=void 0,Reflect.defineProperty(this,"onMessage",{configurable:!0,enumerable:!0,get:function(){return"none"===e.onMessage.name?void 0:e.onMessage},set:function(t){e.onMessage="function"!=typeof t?function(){}:t}}),this.onMyId=void 0,Reflect.defineProperty(this,"onMyId",{configurable:!0,enumerable:!0,get:function(){return"none"===e.onMyId.name?void 0:e.onMyId},set:function(t){e.onMyId="function"!=typeof t?function(){}:t}}),this.onMemberJoin=void 0,Reflect.defineProperty(this,"onMemberJoin",{configurable:!0,enumerable:!0,get:function(){return"none"===e.onMemberJoin.name?void 0:e.onMemberJoin},set:function(t){e.onMemberJoin="function"!=typeof t?function(){}:t}}),this.onMemberLeave=void 0,Reflect.defineProperty(this,"onMemberLeave",{configurable:!0,enumerable:!0,get:function(){return"none"===e.onMemberLeave.name?void 0:e.onMemberLeave},set:function(t){e.onMemberLeave="function"!=typeof t?function(){}:t}}),this.onStateChange=void 0,Reflect.defineProperty(this,"onStateChange",{configurable:!0,enumerable:!0,get:function(){return"none"===e.onStateChange.name?void 0:e.onStateChange},set:function(t){e.onStateChange="function"!=typeof t?function(){}:t}}),this.onSignalingStateChange=void 0,Reflect.defineProperty(this,"onSignalingStateChange",{configurable:!0,enumerable:!0,get:function(){return"none"===e.onSignalingStateChange.name?void 0:e.onSignalingStateChange},set:function(t){e.onSignalingStateChange="function"!=typeof t?function(){}:t}})}return t.prototype.join=function(t){var e=je.get(this);if(e)return e.join(t);throw new Error("WebChannel is undefined")},t.prototype.invite=function(t){var e=je.get(this);if(e)return e.invite(t);throw new Error("WebChannel is undefined")},t.prototype.leave=function(){var t=je.get(this);if(t)return t.leave();throw new Error("WebChannel is undefined")},t.prototype.send=function(t){var e=je.get(this);if(e)return e.send(t);throw new Error("WebChannel is undefined")},t.prototype.sendTo=function(t,e){var n=je.get(this);if(n)return n.sendTo(t,e);throw new Error("WebChannel is undefined")},t}(),Ne=(function(){function t(){}Object.defineProperty(t,"CONNECTING",{get:function(){return Wt.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OPEN",{get:function(){return Wt.OPEN},enumerable:!0,configurable:!0}),Object.defineProperty(t,"CLOSED",{get:function(){return Wt.CLOSED},enumerable:!0,configurable:!0}),Object.defineProperty(t,"CHECKING",{get:function(){return Wt.CHECKING},enumerable:!0,configurable:!0}),Object.defineProperty(t,"CHECKED",{get:function(){return Wt.CHECKED},enumerable:!0,configurable:!0})}(),function(){function t(){}return Object.defineProperty(t,"JOINING",{get:function(){return pe.JOINING},enumerable:!0,configurable:!0}),Object.defineProperty(t,"JOINED",{get:function(){return pe.JOINED},enumerable:!0,configurable:!0}),Object.defineProperty(t,"LEFT",{get:function(){return pe.LEFT},enumerable:!0,configurable:!0}),t}()),Pe=(function(){function t(){}Object.defineProperty(t,"FULL_MESH",{get:function(){return z.FULL_MESH},enumerable:!0,configurable:!0})}(),function(){function t(){}Object.defineProperty(t,"DEBUG",{get:function(){return m.DEBUG},enumerable:!0,configurable:!0}),Object.defineProperty(t,"WEB_GROUP",{get:function(){return m.WEB_GROUP},enumerable:!0,configurable:!0}),Object.defineProperty(t,"WEBRTC",{get:function(){return m.WEBRTC},enumerable:!0,configurable:!0}),Object.defineProperty(t,"CHANNEL",{get:function(){return m.CHANNEL},enumerable:!0,configurable:!0}),Object.defineProperty(t,"TOPOLOGY",{get:function(){return m.TOPOLOGY},enumerable:!0,configurable:!0}),Object.defineProperty(t,"SIGNALING",{get:function(){return m.SIGNALING},enumerable:!0,configurable:!0}),Object.defineProperty(t,"CHANNEL_BUILDER",{get:function(){return m.CHANNEL_BUILDER},enumerable:!0,configurable:!0})}(),{url:"",perMessageDeflate:!1,leaveOnceAlone:!0,server:void 0,webGroupOptions:Te}),Re=function(){function t(t){this.wcOptions=f({},Te,t.webGroupOptions);var e=f({},Pe,t),n=e.leaveOnceAlone,r=e.server,i=e.url,o=e.perMessageDeflate;this.leaveOnceAlone=n,this.server=r,this.listenUrl=i,this.perMessageDeflate=o,this.webGroups=new Map,this.onWebGroup=function(){},this.onError=function(){},this.init()}return Object.defineProperty(t.prototype,"url",{get:function(){if(""!==this.listenUrl)return this.listenUrl;var t=this.server.address();return"ws://"+t.address+":"+t.port},enumerable:!0,configurable:!0}),t.prototype.init=function(){var t=this;this.webSocketServer=new o.Server({perMessageDeflate:this.perMessageDeflate,verifyClient:function(e){return t.validateURLQuery(e)},server:this.server}),(this.server||this.webSocketServer).on("listening",function(){return Se.listenUrl.next(t.url)}),this.webSocketServer.on("error",function(e){Se.listenUrl.next(""),t.onError(e)}),this.webSocketServer.on("connection",function(e){var n,r=t.readURLQuery(e.upgradeReq.url),i=r.type,o=r.wcId,s=r.senderId,a=r.key,u=t.webGroups.get(o);if(i!==we.WITH_MEMBER||void 0!==u&&u.state!==Ne.LEFT){if(void 0===u)return void e.close();n=je.get(u).webSocketBuilder}else{u=new Ae(t.wcOptions),t.webGroups.set(o,u);var c=je.get(u);t.leaveOnceAlone&&(c.onAlone=function(){c.leave(),t.webGroups.delete(o)}),c.init(a,o),t.onWebGroup(u),c.onMyId(c.myId),n=c.webSocketBuilder}n.newWebSocket(e,s,i)})},t.prototype.validateURLQuery=function(t){try{var e=this.readURLQuery(t.req.url),n=e.type,r=e.wcId,i=e.key;switch(n){case we.WITH_INTERNAL:return this.webGroups.has(r);case we.WITH_MEMBER:var o=this.webGroups.get(r);return!!i&&(void 0===o||o.state===Ne.LEFT);case we.WITH_JOINING:o=this.webGroups.get(r);return!!i&&void 0!==o&&o.key===i&&o.state!==Ne.LEFT;default:return!1}}catch(t){return T.warn(t.message),!1}},t.prototype.readURLQuery=function(t){var e="Query parse error: ",n=Object(u.parse)(t,!0).query,r=n.type,i=n.wcId,o=n.senderId,s=n.key;if("string"!=typeof r)throw new Error(e+'"type" parameter is not a string ');if("string"!=typeof i)throw new Error(e+'"wcId" parameter is not a string ');if("string"!=typeof o)throw new Error(e+'"senderId" parameter is not a string ');if("string"!=typeof s&&void 0!==s)throw new Error(e+'"type" parameter is not a string ');if(!r)throw new Error(e+'"type" parameter is undefined');if(!i)throw new Error(e+'"wcId" parameter is undefined');if(!o)throw new Error(e+'"senderId" parameter is undefined');return{type:Number.parseInt(r,10),wcId:Number.parseInt(i,10),senderId:Number.parseInt(o,10),key:s}},t}(),Be=function(){return function(t){Ie=new Re(t),this.server=void 0,Reflect.defineProperty(this,"server",{configurable:!1,enumerable:!0,get:function(){return Ie.server}}),this.perMessageDeflate=void 0,Reflect.defineProperty(this,"perMessageDeflate",{configurable:!1,enumerable:!0,get:function(){return Ie.perMessageDeflate}}),this.leaveOnceAlone=void 0,Reflect.defineProperty(this,"leaveOnceAlone",{configurable:!1,enumerable:!0,get:function(){return Ie.leaveOnceAlone}}),this.webGroups=void 0,Reflect.defineProperty(this,"webGroups",{configurable:!1,enumerable:!0,get:function(){return Ie.webGroups}}),this.url=void 0,Reflect.defineProperty(this,"url",{configurable:!1,enumerable:!0,get:function(){return Ie.url}}),this.onWebGroup=void 0,Reflect.defineProperty(this,"onWebGroup",{configurable:!0,enumerable:!0,get:function(){return"none"===Ie.onWebGroup.name?void 0:Ie.onWebGroup},set:function(t){Ie.onWebGroup="function"!=typeof t?function(){}:t}}),this.onError=void 0,Reflect.defineProperty(this,"onError",{configurable:!0,enumerable:!0,get:function(){return"none"===Ie.onError.name?void 0:Ie.onError},set:function(t){Ie.onError="function"!=typeof t?function(){}:t}})}}()},function(t,e){t.exports=require("util")},function(t,e){t.exports=require("url")},function(t,e){t.exports=require("buffer")},function(t,e){t.exports=require("perf_hooks")},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(13),i=n(14),o=n(15),s=n(16),a=n(17),u=n(18),c=n(7),h=n(4),l=n(20),f=n(2),p=n(27);let d;try{d=n(29).version}catch(t){try{d=n(!function(){var t=new Error("Cannot find module './package.json'");throw t.code="MODULE_NOT_FOUND",t}()).version}catch(e){f.log.error(t),d=""}}const y="Repono",b="0.0.0.0",g=2e4,m="ws://localhost:20000",v="ws://localhost:8010",w="",S="",O="mutedocs",M="keyagreement",I=!1,_="info",x="";r.version(d).option("-h, --host <ip or host name>","Host address to bind to.",b).option("-p, --port <number>","Port to use for the server.",g).option("-b, --botURL <number>","Bot public URL.",m).option("-s, --signalingURL <url>","Signaling server url.",v).option("-k, --keyServerURLPrefix <url>","Keyserver url prefix.",w).option("-j, --jwt <jwt>","JSON Web Token for the keyserver API.",S).option("","\n").option("-c --cryptography <string>",'Specify cryptography type. Possible values are: "none", "metadata", "keyagreement"',M).option("--cors","Enable Cross-origin Resource Sharing.",I).option("-n, --name <bot name>","Bot name.",y).option("-d, --database <name>","Database name.",O).option("","\n").option("--key <file path>","Private key for the certificate").option("--cert <file path>","The server certificate").option("--ca <file path>","The additional intermediate certificate or certificates that web browsers will need in order to validate the server certificate.").option("","\n").option("-l, --logLevel <none|trace|debug|info|warn|error|fatal>","Logging level.",/^(none|trace|debug|info|warn|error|fatal)$/i,_).option("-f, --logFolder <path>","Path to where log files would be stored.\n                              If not specified stdout will used.",x).parse(process.argv);const{name:E,host:k,port:T,botURL:C,signalingURL:j,keyServerURLPrefix:A,jwt:N,database:P,cryptography:R,cors:B,key:L,cert:D,ca:F,logLevel:U,logFolder:q}=r;f.createLogger(q,U),"none"!==U&&c.setLogLevel(c.LogLevel.DEBUG),process.on("uncaughtException",t=>{console.error("uncaughtException -> ",t)});const z=new p.MongooseAdapter;function $(t){const e=t.split("/");return t.indexOf("://")>-1?e[2]:e[0]}z.connect("localhost",P).then(()=>{f.log.info("Connected to the database  ");let t=new s;const e=new u;return e.get("/info",t=>{t.body={displayName:E,login:"bot.storage",deviceID:$(C),avatar:l.BotStorage.AVATAR,version:d}}).get("/docs/:login",async t=>{await z.lookupMetadataByLogin(t.params.login).then(e=>t.body=e).catch(e=>{f.log.error("Could not retreive the document list stored in database",e),t.status=500})}).post("/remove",t=>{const{key:e,login:n}=t.request.body;t.request.body&&e&&n?z.removeLogin(e,n).then(()=>{t.body=!0}).catch(e=>{f.log.error(`Failed to remove login ${n}`,e),t.status=500}):t.status=404}),B&&(t=t.use(o())),t.use(a()).use(e.routes()).use(e.allowedMethods())}).then(t=>{if(f.log.info("Configured routes  "),L&&D&&F){const e=n(30);return n(31).createServer({key:e.readFileSync(L),cert:e.readFileSync(D),ca:e.readFileSync(F)},t.callback())}return i.createServer(t.callback())}).then(async t=>{f.log.info("Configured server  "),t.on("clientError",t=>{f.log.error("Client Error",t)});const e=new c.Bot({url:C,server:t,leaveOnceAlone:!1,webGroupOptions:{signalingServer:j}}),n="keyagreement"===R?await async function(){const t=await h.asymmetricCrypto.generateSigningKeyPair(),e=await async function(t){if(void 0===t)throw new Error("Signing key pair is not defined");return{publicKey:JSON.stringify(await h.asymmetricCrypto.exportKey(t.publicKey)),privateKey:JSON.stringify(await h.asymmetricCrypto.exportKey(t.privateKey))}}(t);return f.log.debug("PUBLIC KEY = ",e.publicKey),e}():void 0;return e.onWebGroup=(t=>{const e=new l.BotStorage(E,"bot.storage",$(C),t,z,R,n,A,N);f.log.info("New peer to peer network invitation received for ",e.signalingKey)}),new Promise(e=>t.listen(T,k,e))}).then(()=>{f.log.info(`Successfully started the storage bot server at ${k}:${T} with the following settings`,{name:E,host:k,port:T,botURL:C,signalingURL:j,cryptography:R,keyServerURLPrefix:A,jwt:N,logLevel:U,logFolder:q})}).catch(t=>f.log.fatal(t))},function(t,e){t.exports=require("commander")},function(t,e){t.exports=require("http")},function(t,e){t.exports=require("kcors")},function(t,e){t.exports=require("koa")},function(t,e){t.exports=require("koa-bodyparser")},function(t,e){t.exports=require("koa-router")},function(t,e){t.exports=require("node-webcrypto-ossl")},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(21),i=n(4),o=n(0),s=n(1),a=n(7),u=n(8),c=n(2),h=n(23),l=n(25),f=12e4,p=1e4;class d{constructor(t,e,n,i,s,a,u,l,p){this.crdtStrategy=r.Strategy.LOGOOTSPLIT,this.displayName=t,this.login=e,this.deviceID=n,this.wg=i,this.synchronize=(()=>{}),this.syncDocContentInterval=void 0,this.saveChain=Promise.resolve(),this.mongooseAdapter=s,this.message$=new o.ReplaySubject,this.memberJoin$=new o.ReplaySubject,this.memberLeave$=new o.ReplaySubject,this.state$=new o.ReplaySubject,this.myId$=new o.ReplaySubject,this.subs=[],this.members=new Map,this.signatureErrorHandler=(()=>{}),this.pkRequest=new h.PKRequest(l,p),this.exportedSigningKeyPair=u,this.signingKeyPair=this.importSigningKeyPair(this.exportedSigningKeyPair),c.log.info(this.login,this.deviceID),this.saveInterval=setInterval(()=>{this.mongoDoc&&this.saveContent()},f),this.initMuteCrypto(a),this.initWebGroup(),this.retreiveDocument(i.key).then(t=>{this.mongoDoc=t;const e=t.get("operations").map(t=>r.RichOperationStrategy.fromPlain(this.crdtStrategy,t)),n=r.StateStrategy.emptyState(this.crdtStrategy);n&&(n.remoteOperations=e||[],this.initMuteCore(t,n,a))}).catch(t=>c.log.error(`Failed to initialize document ${i.key}`,t))}get signalingKey(){return this.wg.key}async checkMySigningKeyPair(){if(void 0===this.exportedSigningKeyPair||void 0===this.signingKeyPair)c.log.error("Signing KeyPair","Check my PK, something went wrong here : exportedSigningKeyPair shouldn't be undefined");else{const t=await this.pkRequest.lookup(this.login,this.deviceID);c.log.info("Signing KeyPair",`Check my PK, ${this.login}:${this.deviceID} : ${t}`),""===t?await this.pkRequest.register(this.login,this.deviceID,this.exportedSigningKeyPair.publicKey):void 0!==t&&t!==this.exportedSigningKeyPair.publicKey&&await this.pkRequest.update(this.login,this.deviceID,this.exportedSigningKeyPair.publicKey)}}set onSignatureError(t){this.signatureErrorHandler=t}initWebGroup(){this.wg.onStateChange=(t=>{t===a.WebGroupState.LEFT&&(this.saveContent(),global.clearInterval(this.saveInterval)),this.state$.next(t)}),this.wg.onMemberJoin=(t=>this.memberJoin$.next(t)),this.wg.onMemberLeave=(t=>{this.wg.members.length<2&&this.saveContent(),this.memberLeave$.next(t)}),this.wg.onMyId=(t=>this.myId$.next(t))}async retreiveDocument(t){const e=await this.mongooseAdapter.find(t);return e||await this.mongooseAdapter.create(t)}initMuteCore(t,e,n){const o=r.MuteCoreFactory.createMuteCore({strategy:r.Strategy.LOGOOTSPLIT,profile:{displayName:this.displayName,login:this.login,deviceID:this.deviceID,avatar:d.AVATAR},docContent:e,metaTitle:{title:t.get("title"),titleModified:t.get("titleModified")},metaFixData:{docCreated:t.get("created"),cryptoKey:t.get("cryptoKey")},metaLogs:{share:t.get("shareLogs"),vector:this.mongooseAdapter.getShareVector(t)}});return this.subs[this.subs.length]=o.remoteMetadataUpdate$.subscribe(({type:t,data:e})=>{switch(t){case r.MetaDataType.Title:const{title:n,titleModified:o}=e;this.saveTitle(n,o);break;case r.MetaDataType.FixData:const{docCreated:s,cryptoKey:a}=e;this.saveFixData(s,a),this.crypto instanceof i.Symmetric&&this.crypto.importKey(a);break;case r.MetaDataType.Logs:const{share:c,vector:h}=e;this.saveLogs(c,u.isUndefined(h)?new Map:h)}}),o.messageIn$=this.message$.asObservable(),this.subs[this.subs.length]=o.messageOut$.subscribe(({streamId:t,content:e,recipientId:n})=>{t===r.Streams.DOCUMENT_CONTENT&&this.crypto&&this.crypto.state===i.KeyState.READY?this.crypto.encrypt(e).then(e=>this.send(t,e,n)).catch(t=>c.log.error("Failed to encrypt a message: ",t)):this.send(t,e,n)}),this.subs[this.subs.length]=o.remoteTextOperations$.subscribe(()=>{this.lastReceivedState=o.state}),o.memberJoin$=this.memberJoin$,o.memberLeave$=this.memberLeave$,this.subs[this.subs.length]=o.collabJoin$.subscribe(({id:t,login:e,deviceID:r})=>{if(this.saveLogins(e),void 0!==e&&void 0!==r&&"keyagreement"===n)return this.verifyLoginPK(t,e,r).catch(t=>{c.log.info("COLLAB JOINED","Failed to retrieve Public Key of "+e,", err: ",t)})}),this.subs[this.subs.length]=o.remoteCollabUpdate$.subscribe(({login:t})=>this.saveLogins(t)),this.synchronize=(()=>{this.wg.members.length>1&&(this.crypto?this.crypto.state===i.KeyState.READY&&o.synchronize():o.synchronize())}),o.collabJoin$.subscribe(()=>o.synchronize()),o}async initMuteCrypto(t){switch(c.log.debug("CRYPTOGRAPHY type = ",t),t){case"none":this.crypto=void 0,this.wg.onMessage=((t,e)=>{try{this.message$.next(Object.assign({senderId:t},l.Message.decode(e)))}catch(t){c.log.error("Failed to decode a message: ",t)}});break;case"metadata":this.crypto=new i.Symmetric;const e=this.crypto;this.wg.onMessage=((t,n)=>{try{const{streamId:i,content:o}=l.Message.decode(n);i===r.Streams.DOCUMENT_CONTENT?e.decrypt(o).then(e=>{this.message$.next({senderId:t,streamId:i,content:e})}).catch(t=>c.log.warn("Failed to decrypt document content: ",JSON.stringify(t))):this.message$.next({senderId:t,streamId:i,content:o})}catch(t){c.log.warn("Message from network decode error: ",t.message)}});break;case"keyagreement":i.enableDebug(!0,!1),this.crypto=new i.KeyAgreementBD;const n=this.crypto;this.pkRequest.baseUrl&&this.pkRequest.jwt&&(c.log.info("KEYAGREEMENT","keyserver OK !"),await this.checkMySigningKeyPair(),n.signingKey=this.signingKeyPair.privateKey,this.onSignatureError=(t=>c.log.error("Signature verification error for ",t))),n.onSend=((t,e)=>this.send(e,t)),this.myId$.subscribe(t=>n.setMyId(t)),this.memberJoin$.subscribe(t=>n.addMember(t)),this.memberLeave$.subscribe(t=>n.removeMember(t)),this.state$.subscribe(t=>{console.log("ON STATE CHANGED : ",t),t===a.WebGroupState.JOINED&&n.setReady()}),this.wg.onMessage=((t,e)=>{const{streamId:o,content:s}=l.Message.decode(e);o===i.Streams.KEY_AGREEMENT_BD?this.onBDMessage(t,s):o===r.Streams.DOCUMENT_CONTENT?n.decrypt(s).then(e=>this.message$.next({senderId:t,streamId:o,content:e})).catch(t=>c.log.warn("Failed to decrypt document content: ",JSON.stringify(t))):this.message$.next({senderId:t,streamId:o,content:s})});const u=new o.Subject;this.crypto.onStateChange=(t=>u.next(t)),this.subs[this.subs.length]=o.merge(u.pipe(s.filter(t=>t===i.KeyState.READY)),this.state$.pipe(s.filter(t=>t===a.WebGroupState.JOINED))).pipe(s.auditTime(1e3)).subscribe(()=>this.restartSyncInterval())}}async verifyLoginPK(t,e,n){const r=JSON.parse(await this.pkRequest.lookup(e,n)),o=await i.asymmetricCrypto.importKey(r),s=this.members.get(t);if(s){c.log.info("MEMBER EXISTS AND GET/SAVE PK OF MEMBER"),s.key=o;for(const e of s.buffer)this.crypto.onMessage(t,e,s.key).catch(()=>{this.signatureErrorHandler(t)});s.buffer=[]}else c.log.info("MEMBER DOES NOT EXIST AND GET/SAVE PK OF MEMBER"),this.members.set(t,{key:o,buffer:[]})}onBDMessage(t,e){const n=this.crypto;if(this.pkRequest.baseUrl&&this.pkRequest.jwt){const r=this.members.get(t);r?r.key?n.onMessage(t,e,r.key).catch(()=>{this.signatureErrorHandler(t)}):r.buffer.push(e):this.members.set(t,{buffer:[e]})}else n.onMessage(t,e)}send(t,e,n){const r=l.Message.create({streamId:t,content:e});void 0===n?this.wg.send(l.Message.encode(r).finish()):(n=0===n?this.randomMember():n,this.wg.sendTo(n,l.Message.encode(r).finish()))}randomMember(){const t=this.wg.members.filter(t=>t!==this.wg.myId);return t[Math.ceil(Math.random()*t.length)-1]}saveContent(){try{this.mongoDoc&&this.lastReceivedState&&this.lastReceivedState!==this.lastSavedState&&(this.mongoDoc.set({operations:this.lastReceivedState.remoteOperations.map(t=>({id:t.id,clock:t.clock,operation:t.operation,dependencies:Array.from(t.dependencies)}))}),this.saveDoc(),this.lastSavedState=this.lastReceivedState)}catch(t){c.log.error("Failed save the document content:",t)}}saveLogins(t){if(this.mongoDoc&&t&&"anonymous"!==t){const e=this.mongoDoc.get("logins");e.includes(t)||(e.push(t),this.mongoDoc.set({logins:e}),this.saveDoc())}}saveTitle(t,e){this.mongoDoc&&(this.mongoDoc.set({title:t,titleModified:e}),this.saveDoc())}saveFixData(t,e){this.mongoDoc&&(this.mongoDoc.set({created:t,cryptoKey:e}),this.saveDoc())}saveLogs(t,e){if(this.mongoDoc){const n=new Map;e.forEach((t,e)=>{n.set(e.toString(),t)}),this.mongoDoc.set({shareLogs:t,shareLogsVector:n}),this.saveDoc()}}async saveDoc(){this.saveChain=this.saveChain.then(async()=>{this.mongoDoc&&await this.mongoDoc.save()}).catch(t=>c.log.warn("Could not save the document: ",t))}restartSyncInterval(){this.syncDocContentInterval&&clearInterval(this.syncDocContentInterval),this.synchronize(),this.syncDocContentInterval=setInterval(()=>this.synchronize(),p)}async importSigningKeyPair(t){t&&(this.signingKeyPair={publicKey:await i.asymmetricCrypto.importKey(JSON.parse(t.publicKey)),privateKey:await i.asymmetricCrypto.importKey(JSON.parse(t.privateKey))})}}d.AVATAR="https://www.shareicon.net/data/256x256/2016/01/01/228083_bot_256x256.png",d.ID=9137,e.BotStorage=d},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(5),i=function(){function t(){this.subs=[]}return Object.defineProperty(t.prototype,"newSub",{set:function(t){this.subs[this.subs.length]=t},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this.subs.forEach(function(t){return t.unsubscribe()})},t}(),o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function s(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var a=function(){return(a=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};var u,c={e:{}};function h(){try{return u.apply(this,arguments)}catch(t){return c.e=t,c}}function l(t){return u=t,h}function f(t){return"function"==typeof t}var p=!1,d={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){if(t){var e=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+e.stack)}else p&&console.log("RxJS: Back to a better error behavior. Thank you. <3");p=t},get useDeprecatedSynchronousErrorHandling(){return p}};function y(t){setTimeout(function(){throw t})}var b={closed:!0,next:function(t){},error:function(t){if(d.useDeprecatedSynchronousErrorHandling)throw t;y(t)},complete:function(){}},g=Array.isArray||function(t){return t&&"number"==typeof t.length};function m(t){return null!=t&&"object"==typeof t}function v(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map(function(t,e){return e+1+") "+t.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}v.prototype=Object.create(Error.prototype);var w=v,S=function(){function t(t){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,t&&(this._unsubscribe=t)}var e;return t.prototype.unsubscribe=function(){var t,e=!1;if(!this.closed){var n=this._parent,r=this._parents,i=this._unsubscribe,o=this._subscriptions;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;for(var s=-1,a=r?r.length:0;n;)n.remove(this),n=++s<a&&r[s]||null;if(f(i))l(i).call(this)===c&&(e=!0,t=t||(c.e instanceof w?O(c.e.errors):[c.e]));if(g(o))for(s=-1,a=o.length;++s<a;){var u=o[s];if(m(u))if(l(u.unsubscribe).call(u)===c){e=!0,t=t||[];var h=c.e;h instanceof w?t=t.concat(O(h.errors)):t.push(h)}}if(e)throw new w(t)}},t.prototype.add=function(e){if(!e||e===t.EMPTY)return t.EMPTY;if(e===this)return this;var n=e;switch(typeof e){case"function":n=new t(e);case"object":if(n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if("function"!=typeof n._addParent){var r=n;(n=new t)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}return(this._subscriptions||(this._subscriptions=[])).push(n),n._addParent(this),n},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}},t.prototype._addParent=function(t){var e=this._parent,n=this._parents;e&&e!==t?n?-1===n.indexOf(t)&&n.push(t):this._parents=[t]:this._parent=t},t.EMPTY=((e=new t).closed=!0,e),t}();function O(t){return t.reduce(function(t,e){return t.concat(e instanceof w?e.errors:e)},[])}var M="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),I=function(t){function e(n,r,i){var o=t.call(this)||this;switch(o.syncErrorValue=null,o.syncErrorThrown=!1,o.syncErrorThrowable=!1,o.isStopped=!1,o._parentSubscription=null,arguments.length){case 0:o.destination=b;break;case 1:if(!n){o.destination=b;break}if("object"==typeof n){n instanceof e?(o.syncErrorThrowable=n.syncErrorThrowable,o.destination=n,n.add(o)):(o.syncErrorThrowable=!0,o.destination=new _(o,n));break}default:o.syncErrorThrowable=!0,o.destination=new _(o,n,r,i)}return o}return s(e,t),e.prototype[M]=function(){return this},e.create=function(t,n,r){var i=new e(t,n,r);return i.syncErrorThrowable=!1,i},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype._unsubscribeAndRecycle=function(){var t=this._parent,e=this._parents;return this._parent=null,this._parents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parent=t,this._parents=e,this._parentSubscription=null,this},e}(S),_=function(t){function e(e,n,r,i){var o,s=t.call(this)||this;s._parentSubscriber=e;var a=s;return f(n)?o=n:n&&(o=n.next,r=n.error,i=n.complete,n!==b&&(f((a=Object.create(n)).unsubscribe)&&s.add(a.unsubscribe.bind(a)),a.unsubscribe=s.unsubscribe.bind(s))),s._context=a,s._next=o,s._error=r,s._complete=i,s}return s(e,t),e.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;d.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},e.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,n=d.useDeprecatedSynchronousErrorHandling;if(this._error)n&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)n?(e.syncErrorValue=t,e.syncErrorThrown=!0):y(t),this.unsubscribe();else{if(this.unsubscribe(),n)throw t;y(t)}}},e.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var n=function(){return t._complete.call(t._context)};d.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},e.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(t){if(this.unsubscribe(),d.useDeprecatedSynchronousErrorHandling)throw t;y(t)}},e.prototype.__tryOrSetError=function(t,e,n){if(!d.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,n)}catch(e){return d.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=e,t.syncErrorThrown=!0,!0):(y(e),!0)}return!1},e.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},e}(I),x=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.prototype.notifyNext=function(t,e,n,r,i){this.destination.next(e)},e.prototype.notifyError=function(t,e){this.destination.error(t)},e.prototype.notifyComplete=function(t){this.destination.complete()},e}(I),E=function(t){function e(e,n,r){var i=t.call(this)||this;return i.parent=e,i.outerValue=n,i.outerIndex=r,i.index=0,i}return s(e,t),e.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},e.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},e}(I);var k="function"==typeof Symbol&&Symbol.observable||"@@observable";function T(){}var C=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(t,e,n){var r=this.operator,i=function(t,e,n){if(t){if(t instanceof I)return t;if(t[M])return t[M]()}return t||e||n?new I(t,e,n):new I(b)}(t,e,n);if(r?r.call(i,this.source):i.add(this.source||d.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),d.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){d.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),!function(t){for(;t;){var e=t,n=e.closed,r=e.destination,i=e.isStopped;if(n||i)return!1;t=r&&r instanceof I?r:null}return!0}(t)?console.warn(e):t.error(e)}},t.prototype.forEach=function(t,e){var n=this;return new(e=j(e))(function(e,r){var i;i=n.subscribe(function(e){try{t(e)}catch(t){r(t),i&&i.unsubscribe()}},r,e)})},t.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},t.prototype[k]=function(){return this},t.prototype.pipe=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return 0===e.length?this:((t=e)?1===t.length?t[0]:function(e){return t.reduce(function(t,e){return e(t)},e)}:T)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=j(t))(function(t,n){var r;e.subscribe(function(t){return r=t},function(t){return n(t)},function(){return t(r)})})},t.create=function(e){return new t(e)},t}();function j(t){if(t||(t=d.Promise||Promise),!t)throw new Error("no Promise impl found");return t}var A=function(t){return function(e){for(var n=0,r=t.length;n<r&&!e.closed;n++)e.next(t[n]);e.closed||e.complete()}};var N="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";var P=function(t){if(t instanceof C)return function(e){return t._isScalar?(e.next(t.value),void e.complete()):t.subscribe(e)};if(t&&"function"==typeof t[k])return i=t,function(t){var e=i[k]();if("function"!=typeof e.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return e.subscribe(t)};if((r=t)&&"number"==typeof r.length&&"function"!=typeof r)return A(t);if(function(t){return t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}(t))return n=t,function(t){return n.then(function(e){t.closed||(t.next(e),t.complete())},function(e){return t.error(e)}).then(null,y),t};if(t&&"function"==typeof t[N])return e=t,function(t){for(var n=e[N]();;){var r=n.next();if(r.done){t.complete();break}if(t.next(r.value),t.closed)break}return"function"==typeof n.return&&t.add(function(){n.return&&n.return()}),t};var e,n,r,i,o=m(t)?"an invalid object":"'"+t+"'";throw new TypeError("You provided "+o+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function R(t,e,n,r,i){if(void 0===i&&(i=new E(t,n,r)),!i.closed)return P(e)(i)}!function(t){function e(e,n){var r=t.call(this,e)||this;return r.durationSelector=n,r.hasValue=!1,r}s(e,t),e.prototype._next=function(t){if(this.value=t,this.hasValue=!0,!this.throttled){var e=l(this.durationSelector)(t);if(e===c)this.destination.error(c.e);else{var n=R(this,e);!n||n.closed?this.clearThrottle():this.add(this.throttled=n)}}},e.prototype.clearThrottle=function(){var t=this.value,e=this.hasValue,n=this.throttled;n&&(this.remove(n),this.throttled=null,n.unsubscribe()),e&&(this.value=null,this.hasValue=!1,this.destination.next(t))},e.prototype.notifyNext=function(t,e,n,r){this.clearThrottle()},e.prototype.notifyComplete=function(){this.clearThrottle()}}(x);var B=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.scheduler=e,r.work=n,r.pending=!1,r}return s(e,t),e.prototype.schedule=function(t,e){if(void 0===e&&(e=0),this.closed)return this;this.state=t;var n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(r,this.id,e),this},e.prototype.requestAsyncId=function(t,e,n){return void 0===n&&(n=0),setInterval(t.flush.bind(t,this),n)},e.prototype.recycleAsyncId=function(t,e,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return e;clearInterval(e)},e.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(t,e);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,e){var n=!1,r=void 0;try{this.work(t)}catch(t){n=!0,r=!!t&&t||new Error(t)}if(n)return this.unsubscribe(),r},e.prototype._unsubscribe=function(){var t=this.id,e=this.scheduler,n=e.actions,r=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null},e}(function(t){function e(e,n){return t.call(this)||this}return s(e,t),e.prototype.schedule=function(t,e){return void 0===e&&(e=0),this},e}(S)),L=function(){function t(e,n){void 0===n&&(n=t.now),this.SchedulerAction=e,this.now=n}return t.prototype.schedule=function(t,e,n){return void 0===e&&(e=0),new this.SchedulerAction(this,t).schedule(n,e)},t.now=function(){return Date.now()},t}(),D=function(t){function e(n,r){void 0===r&&(r=L.now);var i=t.call(this,n,function(){return e.delegate&&e.delegate!==i?e.delegate.now():r()})||this;return i.actions=[],i.active=!1,i.scheduled=void 0,i}return s(e,t),e.prototype.schedule=function(n,r,i){return void 0===r&&(r=0),e.delegate&&e.delegate!==this?e.delegate.schedule(n,r,i):t.prototype.schedule.call(this,n,r,i)},e.prototype.flush=function(t){var e=this.actions;if(this.active)e.push(t);else{var n;this.active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,n){for(;t=e.shift();)t.unsubscribe();throw n}}},e}(L);new D(B);(function(t){function e(e,n){var r=t.call(this,e)||this;return r.buffer=[],r.add(R(r,n)),r}s(e,t),e.prototype._next=function(t){this.buffer.push(t)},e.prototype.notifyNext=function(t,e,n,r,i){var o=this.buffer;this.buffer=[],this.destination.next(o)}})(x),function(t){function e(e,n){var r=t.call(this,e)||this;return r.bufferSize=n,r.buffer=[],r}s(e,t),e.prototype._next=function(t){var e=this.buffer;e.push(t),e.length==this.bufferSize&&(this.destination.next(e),this.buffer=[])},e.prototype._complete=function(){var e=this.buffer;e.length>0&&this.destination.next(e),t.prototype._complete.call(this)}}(I),function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.bufferSize=n,i.startBufferEvery=r,i.buffers=[],i.count=0,i}s(e,t),e.prototype._next=function(t){var e=this.bufferSize,n=this.startBufferEvery,r=this.buffers,i=this.count;this.count++,i%n==0&&r.push([]);for(var o=r.length;o--;){var s=r[o];s.push(t),s.length===e&&(r.splice(o,1),this.destination.next(s))}},e.prototype._complete=function(){for(var e=this.buffers,n=this.destination;e.length>0;){var r=e.shift();r.length>0&&n.next(r)}t.prototype._complete.call(this)}}(I);var F=function(){return function(){this.buffer=[]}}();!function(t){function e(e,n,r,i,o){var s=t.call(this,e)||this;s.bufferTimeSpan=n,s.bufferCreationInterval=r,s.maxBufferSize=i,s.scheduler=o,s.contexts=[];var a=s.openContext();if(s.timespanOnly=null==r||r<0,s.timespanOnly){var u={subscriber:s,context:a,bufferTimeSpan:n};s.add(a.closeAction=o.schedule(U,n,u))}else{var c={subscriber:s,context:a},h={bufferTimeSpan:n,bufferCreationInterval:r,subscriber:s,scheduler:o};s.add(a.closeAction=o.schedule(z,n,c)),s.add(o.schedule(q,r,h))}return s}s(e,t),e.prototype._next=function(t){for(var e,n=this.contexts,r=n.length,i=0;i<r;i++){var o=n[i],s=o.buffer;s.push(t),s.length==this.maxBufferSize&&(e=o)}e&&this.onBufferFull(e)},e.prototype._error=function(e){this.contexts.length=0,t.prototype._error.call(this,e)},e.prototype._complete=function(){for(var e=this.contexts,n=this.destination;e.length>0;){var r=e.shift();n.next(r.buffer)}t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){this.contexts=null},e.prototype.onBufferFull=function(t){this.closeContext(t);var e=t.closeAction;if(e.unsubscribe(),this.remove(e),!this.closed&&this.timespanOnly){t=this.openContext();var n=this.bufferTimeSpan,r={subscriber:this,context:t,bufferTimeSpan:n};this.add(t.closeAction=this.scheduler.schedule(U,n,r))}},e.prototype.openContext=function(){var t=new F;return this.contexts.push(t),t},e.prototype.closeContext=function(t){this.destination.next(t.buffer);var e=this.contexts;(e?e.indexOf(t):-1)>=0&&e.splice(e.indexOf(t),1)}}(I);function U(t){var e=t.subscriber,n=t.context;n&&e.closeContext(n),e.closed||(t.context=e.openContext(),t.context.closeAction=this.schedule(t,t.bufferTimeSpan))}function q(t){var e=t.bufferCreationInterval,n=t.bufferTimeSpan,r=t.subscriber,i=t.scheduler,o=r.openContext();r.closed||(r.add(o.closeAction=i.schedule(z,n,{subscriber:r,context:o})),this.schedule(t,e))}function z(t){var e=t.subscriber,n=t.context;e.closeContext(n)}(function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.openings=n,i.closingSelector=r,i.contexts=[],i.add(R(i,n)),i}s(e,t),e.prototype._next=function(t){for(var e=this.contexts,n=e.length,r=0;r<n;r++)e[r].buffer.push(t)},e.prototype._error=function(e){for(var n=this.contexts;n.length>0;){var r=n.shift();r.subscription.unsubscribe(),r.buffer=null,r.subscription=null}this.contexts=null,t.prototype._error.call(this,e)},e.prototype._complete=function(){for(var e=this.contexts;e.length>0;){var n=e.shift();this.destination.next(n.buffer),n.subscription.unsubscribe(),n.buffer=null,n.subscription=null}this.contexts=null,t.prototype._complete.call(this)},e.prototype.notifyNext=function(t,e,n,r,i){t?this.closeBuffer(t):this.openBuffer(e)},e.prototype.notifyComplete=function(t){this.closeBuffer(t.context)},e.prototype.openBuffer=function(t){try{var e=this.closingSelector.call(this,t);e&&this.trySubscribe(e)}catch(t){this._error(t)}},e.prototype.closeBuffer=function(t){var e=this.contexts;if(e&&t){var n=t.buffer,r=t.subscription;this.destination.next(n),e.splice(e.indexOf(t),1),this.remove(r),r.unsubscribe()}},e.prototype.trySubscribe=function(t){var e=this.contexts,n=new S,r={buffer:[],subscription:n};e.push(r);var i=R(this,t,r);!i||i.closed?this.closeBuffer(r):(i.context=r,this.add(i),n.add(i))}})(x),function(t){function e(e,n){var r=t.call(this,e)||this;return r.closingSelector=n,r.subscribing=!1,r.openBuffer(),r}s(e,t),e.prototype._next=function(t){this.buffer.push(t)},e.prototype._complete=function(){var e=this.buffer;e&&this.destination.next(e),t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){this.buffer=null,this.subscribing=!1},e.prototype.notifyNext=function(t,e,n,r,i){this.openBuffer()},e.prototype.notifyComplete=function(){this.subscribing?this.complete():this.openBuffer()},e.prototype.openBuffer=function(){var t=this.closingSubscription;t&&(this.remove(t),t.unsubscribe());var e=this.buffer;this.buffer&&this.destination.next(e),this.buffer=[];var n=l(this.closingSelector)();n===c?this.error(c.e):(t=new S,this.closingSubscription=t,this.add(t),this.subscribing=!0,t.add(R(this,n)),this.subscribing=!1)}}(x),function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.selector=n,i.caught=r,i}s(e,t),e.prototype.error=function(e){if(!this.isStopped){var n=void 0;try{n=this.selector(e,this.caught)}catch(e){return void t.prototype.error.call(this,e)}this._unsubscribeAndRecycle();var r=new E(this,void 0,void 0);this.add(r),R(this,n,void 0,void 0,r)}}}(x);function $(t,e){return new C(e?function(n){var r=new S,i=0;return r.add(e.schedule(function(){i!==t.length?(n.next(t[i++]),n.closed||r.add(this.schedule())):n.complete()})),r}:A(t))}var G={},K=(function(t){function e(e,n){var r=t.call(this,e)||this;return r.resultSelector=n,r.active=0,r.values=[],r.observables=[],r}s(e,t),e.prototype._next=function(t){this.values.push(G),this.observables.push(t)},e.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(var n=0;n<e;n++){var r=t[n];this.add(R(this,r,r,n))}}},e.prototype.notifyComplete=function(t){0==(this.active-=1)&&this.destination.complete()},e.prototype.notifyNext=function(t,e,n,r,i){var o=this.values,s=o[n],a=this.toRespond?s===G?--this.toRespond:this.toRespond:0;o[n]=e,0===a&&(this.resultSelector?this._tryResultSelector(o):this.destination.next(o.slice()))},e.prototype._tryResultSelector=function(t){var e;try{e=this.resultSelector.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)}}(x),new C(function(t){return t.complete()}));function V(t){return t?function(t){return new C(function(e){return t.schedule(function(){return e.complete()})})}(t):K}function W(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n,r=t[t.length-1];switch((n=r)&&"function"==typeof n.schedule?t.pop():r=void 0,t.length){case 0:return V(r);case 1:return r?$(t,r):function(t){var e=new C(function(e){e.next(t),e.complete()});return e._isScalar=!0,e.value=t,e}(t[0]);default:return $(t,r)}}var H=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new J(t,this.project,this.thisArg))},t}(),J=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.project=n,i.count=0,i.thisArg=r||i,i}return s(e,t),e.prototype._next=function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(I);!function(t){function e(e,n,r){void 0===r&&(r=Number.POSITIVE_INFINITY);var i=t.call(this,e)||this;return i.project=n,i.concurrent=r,i.hasCompleted=!1,i.buffer=[],i.active=0,i.index=0,i}s(e,t),e.prototype._next=function(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)},e.prototype._tryNext=function(t){var e,n=this.index++;try{e=this.project(t,n)}catch(t){return void this.destination.error(t)}this.active++,this._innerSub(e,t,n)},e.prototype._innerSub=function(t,e,n){var r=new E(this,void 0,void 0);this.destination.add(r),R(this,t,e,n,r)},e.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(t,e,n,r,i){this.destination.next(e)},e.prototype.notifyComplete=function(t){var e=this.buffer;this.remove(t),this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}(x);function Z(t){return t}(function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.predicate=n,i.source=r,i.count=0,i.index=0,i}s(e,t),e.prototype._next=function(t){this.predicate?this._tryPredicate(t):this.count++},e.prototype._tryPredicate=function(t){var e;try{e=this.predicate(t,this.index++,this.source)}catch(t){return void this.destination.error(t)}e&&this.count++},e.prototype._complete=function(){this.destination.next(this.count),this.destination.complete()}})(I),function(t){function e(e,n){var r=t.call(this,e)||this;return r.durationSelector=n,r.hasValue=!1,r.durationSubscription=null,r}s(e,t),e.prototype._next=function(t){try{var e=this.durationSelector.call(this,t);e&&this._tryNext(t,e)}catch(t){this.destination.error(t)}},e.prototype._complete=function(){this.emitValue(),this.destination.complete()},e.prototype._tryNext=function(t,e){var n=this.durationSubscription;this.value=t,this.hasValue=!0,n&&(n.unsubscribe(),this.remove(n)),(n=R(this,e))&&!n.closed&&this.add(this.durationSubscription=n)},e.prototype.notifyNext=function(t,e,n,r,i){this.emitValue()},e.prototype.notifyComplete=function(){this.emitValue()},e.prototype.emitValue=function(){if(this.hasValue){var e=this.value,n=this.durationSubscription;n&&(this.durationSubscription=null,n.unsubscribe(),this.remove(n)),this.value=null,this.hasValue=!1,t.prototype._next.call(this,e)}}}(x),function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.dueTime=n,i.scheduler=r,i.debouncedSubscription=null,i.lastValue=null,i.hasValue=!1,i}s(e,t),e.prototype._next=function(t){this.clearDebounce(),this.lastValue=t,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(X,this.dueTime,this))},e.prototype._complete=function(){this.debouncedNext(),this.destination.complete()},e.prototype.debouncedNext=function(){if(this.clearDebounce(),this.hasValue){var t=this.lastValue;this.lastValue=null,this.hasValue=!1,this.destination.next(t)}},e.prototype.clearDebounce=function(){var t=this.debouncedSubscription;null!==t&&(this.remove(t),t.unsubscribe(),this.debouncedSubscription=null)}}(I);function X(t){t.debouncedNext()}var Y=function(){function t(t){this.defaultValue=t}return t.prototype.call=function(t,e){return e.subscribe(new Q(t,this.defaultValue))},t}(),Q=function(t){function e(e,n){var r=t.call(this,e)||this;return r.defaultValue=n,r.isEmpty=!0,r}return s(e,t),e.prototype._next=function(t){this.isEmpty=!1,this.destination.next(t)},e.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},e}(I);function tt(t){var e=t.error;t.subscriber.error(e)}var et=function(){function t(t,e,n){this.kind=t,this.value=e,this.error=n,this.hasValue="N"===t}return t.prototype.observe=function(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}},t.prototype.do=function(t,e,n){switch(this.kind){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return n&&n()}},t.prototype.accept=function(t,e,n){return t&&"function"==typeof t.next?this.observe(t):this.do(t,e,n)},t.prototype.toObservable=function(){var t,e;switch(this.kind){case"N":return W(this.value);case"E":return t=this.error,new C(e?function(n){return e.schedule(tt,0,{error:t,subscriber:n})}:function(e){return e.error(t)});case"C":return V()}throw new Error("unexpected notification kind value")},t.createNext=function(e){return void 0!==e?new t("N",e):t.undefinedValueNotification},t.createError=function(e){return new t("E",void 0,e)},t.createComplete=function(){return t.completeNotification},t.completeNotification=new t("C"),t.undefinedValueNotification=new t("N",void 0),t}(),nt=(function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.delay=n,i.scheduler=r,i.queue=[],i.active=!1,i.errored=!1,i}s(e,t),e.dispatch=function(t){for(var e=t.source,n=e.queue,r=t.scheduler,i=t.destination;n.length>0&&n[0].time-r.now()<=0;)n.shift().notification.observe(i);if(n.length>0){var o=Math.max(0,n[0].time-r.now());this.schedule(t,o)}else this.unsubscribe(),e.active=!1},e.prototype._schedule=function(t){this.active=!0,this.destination.add(t.schedule(e.dispatch,this.delay,{source:this,destination:this.destination,scheduler:t}))},e.prototype.scheduleNotification=function(t){if(!0!==this.errored){var e=this.scheduler,n=new nt(e.now()+this.delay,t);this.queue.push(n),!1===this.active&&this._schedule(e)}},e.prototype._next=function(t){this.scheduleNotification(et.createNext(t))},e.prototype._error=function(t){this.errored=!0,this.queue=[],this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.scheduleNotification(et.createComplete()),this.unsubscribe()}}(I),function(){return function(t,e){this.time=t,this.notification=e}}()),rt=(function(t){function e(e,n){var r=t.call(this,e)||this;return r.delayDurationSelector=n,r.completed=!1,r.delayNotifierSubscriptions=[],r.index=0,r}s(e,t),e.prototype.notifyNext=function(t,e,n,r,i){this.destination.next(t),this.removeSubscription(i),this.tryComplete()},e.prototype.notifyError=function(t,e){this._error(t)},e.prototype.notifyComplete=function(t){var e=this.removeSubscription(t);e&&this.destination.next(e),this.tryComplete()},e.prototype._next=function(t){var e=this.index++;try{var n=this.delayDurationSelector(t,e);n&&this.tryDelay(n,t)}catch(t){this.destination.error(t)}},e.prototype._complete=function(){this.completed=!0,this.tryComplete(),this.unsubscribe()},e.prototype.removeSubscription=function(t){t.unsubscribe();var e=this.delayNotifierSubscriptions.indexOf(t);return-1!==e&&this.delayNotifierSubscriptions.splice(e,1),t.outerValue},e.prototype.tryDelay=function(t,e){var n=R(this,t,e);n&&!n.closed&&(this.destination.add(n),this.delayNotifierSubscriptions.push(n))},e.prototype.tryComplete=function(){this.completed&&0===this.delayNotifierSubscriptions.length&&this.destination.complete()}}(x),function(t){function e(e,n){var r=t.call(this)||this;return r.source=e,r.subscriptionDelay=n,r}s(e,t),e.prototype._subscribe=function(t){this.subscriptionDelay.subscribe(new rt(t,this.source))}}(C),function(t){function e(e,n){var r=t.call(this)||this;return r.parent=e,r.source=n,r.sourceSubscribed=!1,r}return s(e,t),e.prototype._next=function(t){this.subscribeToSource()},e.prototype._error=function(t){this.unsubscribe(),this.parent.error(t)},e.prototype._complete=function(){this.unsubscribe(),this.subscribeToSource()},e.prototype.subscribeToSource=function(){this.sourceSubscribed||(this.sourceSubscribed=!0,this.unsubscribe(),this.source.subscribe(this.parent))},e}(I));(function(t){function e(e){return t.call(this,e)||this}s(e,t),e.prototype._next=function(t){t.observe(this.destination)}})(I),function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.keySelector=n,i.values=new Set,r&&i.add(R(i,r)),i}s(e,t),e.prototype.notifyNext=function(t,e,n,r,i){this.values.clear()},e.prototype.notifyError=function(t,e){this._error(t)},e.prototype._next=function(t){this.keySelector?this._useKeySelector(t):this._finalizeNext(t,t)},e.prototype._useKeySelector=function(t){var e,n=this.destination;try{e=this.keySelector(t)}catch(t){return void n.error(t)}this._finalizeNext(e,t)},e.prototype._finalizeNext=function(t,e){var n=this.values;n.has(t)||(n.add(t),this.destination.next(e))}}(x),function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.keySelector=r,i.hasKey=!1,"function"==typeof n&&(i.compare=n),i}s(e,t),e.prototype.compare=function(t,e){return t===e},e.prototype._next=function(t){var e=t;if(this.keySelector&&(e=l(this.keySelector)(t))===c)return this.destination.error(c.e);var n=!1;if(this.hasKey){if((n=l(this.compare)(this.key,e))===c)return this.destination.error(c.e)}else this.hasKey=!0;!1===Boolean(n)&&(this.key=e,this.destination.next(t))}}(I);function it(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}it.prototype=Object.create(Error.prototype);var ot=it;function st(t,e){return function(n){return n.lift(new at(t,e))}}var at=function(){function t(t,e){this.predicate=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new ut(t,this.predicate,this.thisArg))},t}(),ut=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.predicate=n,i.thisArg=r,i.count=0,i}return s(e,t),e.prototype._next=function(t){var e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}e&&this.destination.next(t)},e}(I);var ct=function(){function t(t,e,n){this.nextOrObserver=t,this.error=e,this.complete=n}return t.prototype.call=function(t,e){return e.subscribe(new ht(t,this.nextOrObserver,this.error,this.complete))},t}(),ht=function(t){function e(e,n,r,i){var o=t.call(this,e)||this;return o._tapNext=T,o._tapError=T,o._tapComplete=T,o._tapError=r||T,o._tapComplete=i||T,f(n)?(o._context=o,o._tapNext=n):n&&(o._context=n,o._tapNext=n.next||T,o._tapError=n.error||T,o._tapComplete=n.complete||T),o}return s(e,t),e.prototype._next=function(t){try{this._tapNext.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.next(t)},e.prototype._error=function(t){try{this._tapError.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.error(t)},e.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(t){return void this.destination.error(t)}return this.destination.complete()},e}(I);function lt(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}lt.prototype=Object.create(Error.prototype);var ft=lt,pt=function(t){return void 0===t&&(t=dt),e={hasValue:!1,next:function(){this.hasValue=!0},complete:function(){if(!this.hasValue)throw t()}},function(t){return t.lift(new ct(e,n,r))};var e,n,r};function dt(){return new ft}var yt=function(){function t(t){if(this.total=t,this.total<0)throw new ot}return t.prototype.call=function(t,e){return e.subscribe(new bt(t,this.total))},t}(),bt=function(t){function e(e,n){var r=t.call(this,e)||this;return r.total=n,r.count=0,r}return s(e,t),e.prototype._next=function(t){var e=this.total,n=++this.count;n<=e&&(this.destination.next(t),n===e&&(this.destination.complete(),this.unsubscribe()))},e}(I);(function(t){function e(e,n,r,i){var o=t.call(this,e)||this;return o.predicate=n,o.thisArg=r,o.source=i,o.index=0,o.thisArg=r||o,o}s(e,t),e.prototype.notifyComplete=function(t){this.destination.next(t),this.destination.complete()},e.prototype._next=function(t){var e=!1;try{e=this.predicate.call(this.thisArg,t,this.index++,this.source)}catch(t){return void this.destination.error(t)}e||this.notifyComplete(!1)},e.prototype._complete=function(){this.notifyComplete(!0)}})(I),function(t){function e(e){var n=t.call(this,e)||this;return n.hasCompleted=!1,n.hasSubscription=!1,n}s(e,t),e.prototype._next=function(t){this.hasSubscription||(this.hasSubscription=!0,this.add(R(this,t)))},e.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete()},e.prototype.notifyComplete=function(t){this.remove(t),this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()}}(x),function(t){function e(e,n){var r=t.call(this,e)||this;return r.project=n,r.hasSubscription=!1,r.hasCompleted=!1,r.index=0,r}s(e,t),e.prototype._next=function(t){this.hasSubscription||this.tryNext(t)},e.prototype.tryNext=function(t){var e,n=this.index++;try{e=this.project(t,n)}catch(t){return void this.destination.error(t)}this.hasSubscription=!0,this._innerSub(e,t,n)},e.prototype._innerSub=function(t,e,n){var r=new E(this,void 0,void 0);this.destination.add(r),R(this,t,e,n,r)},e.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(t,e,n,r,i){this.destination.next(e)},e.prototype.notifyError=function(t){this.destination.error(t)},e.prototype.notifyComplete=function(t){this.destination.remove(t),this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()}}(x),function(t){function e(e,n,r,i){var o=t.call(this,e)||this;return o.project=n,o.concurrent=r,o.scheduler=i,o.index=0,o.active=0,o.hasCompleted=!1,r<Number.POSITIVE_INFINITY&&(o.buffer=[]),o}s(e,t),e.dispatch=function(t){var e=t.subscriber,n=t.result,r=t.value,i=t.index;e.subscribeToProjection(n,r,i)},e.prototype._next=function(t){var n=this.destination;if(n.closed)this._complete();else{var r=this.index++;if(this.active<this.concurrent){n.next(t);var i=l(this.project)(t,r);if(i===c)n.error(c.e);else if(this.scheduler){var o={subscriber:this,result:i,value:t,index:r};this.destination.add(this.scheduler.schedule(e.dispatch,0,o))}else this.subscribeToProjection(i,t,r)}else this.buffer.push(t)}},e.prototype.subscribeToProjection=function(t,e,n){this.active++,this.destination.add(R(this,t,e,n))},e.prototype._complete=function(){this.hasCompleted=!0,this.hasCompleted&&0===this.active&&this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(t,e,n,r,i){this._next(e)},e.prototype.notifyComplete=function(t){var e=this.buffer;this.destination.remove(t),this.active--,e&&e.length>0&&this._next(e.shift()),this.hasCompleted&&0===this.active&&this.destination.complete()}}(x),function(t){function e(e,n){var r=t.call(this,e)||this;return r.add(new S(n)),r}s(e,t)}(I),function(t){function e(e,n,r,i,o){var s=t.call(this,e)||this;return s.predicate=n,s.source=r,s.yieldIndex=i,s.thisArg=o,s.index=0,s}s(e,t),e.prototype.notifyComplete=function(t){var e=this.destination;e.next(t),e.complete(),this.unsubscribe()},e.prototype._next=function(t){var e=this.predicate,n=this.thisArg,r=this.index++;try{e.call(n||this,t,r,this.source)&&this.notifyComplete(this.yieldIndex?r:t)}catch(t){this.destination.error(t)}},e.prototype._complete=function(){this.notifyComplete(this.yieldIndex?-1:void 0)}}(I);function gt(t,e){var n=arguments.length>=2;return function(r){return r.pipe(t?st(function(e,n){return t(e,n,r)}):Z,(i=1,function(t){return 0===i?V():t.lift(new yt(i))}),n?function(t){return void 0===t&&(t=null),function(e){return e.lift(new Y(t))}}(e):pt(function(){return new ft}));var i}}function mt(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}mt.prototype=Object.create(Error.prototype);var vt=mt,wt=function(t){function e(e,n){var r=t.call(this)||this;return r.subject=e,r.subscriber=n,r.closed=!1,r}return s(e,t),e.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;if(this.subject=null,e&&0!==e.length&&!t.isStopped&&!t.closed){var n=e.indexOf(this.subscriber);-1!==n&&e.splice(n,1)}}},e}(S),St=function(t){function e(e){var n=t.call(this,e)||this;return n.destination=e,n}return s(e,t),e}(I),Ot=function(t){function e(){var e=t.call(this)||this;return e.observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return s(e,t),e.prototype[M]=function(){return new St(this)},e.prototype.lift=function(t){var e=new Mt(this,this);return e.operator=t,e},e.prototype.next=function(t){if(this.closed)throw new vt;if(!this.isStopped)for(var e=this.observers,n=e.length,r=e.slice(),i=0;i<n;i++)r[i].next(t)},e.prototype.error=function(t){if(this.closed)throw new vt;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var e=this.observers,n=e.length,r=e.slice(),i=0;i<n;i++)r[i].error(t);this.observers.length=0},e.prototype.complete=function(){if(this.closed)throw new vt;this.isStopped=!0;for(var t=this.observers,e=t.length,n=t.slice(),r=0;r<e;r++)n[r].complete();this.observers.length=0},e.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},e.prototype._trySubscribe=function(e){if(this.closed)throw new vt;return t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){if(this.closed)throw new vt;return this.hasError?(t.error(this.thrownError),S.EMPTY):this.isStopped?(t.complete(),S.EMPTY):(this.observers.push(t),new wt(this,t))},e.prototype.asObservable=function(){var t=new C;return t.source=this,t},e.create=function(t,e){return new Mt(t,e)},e}(C),Mt=function(t){function e(e,n){var r=t.call(this)||this;return r.destination=e,r.source=n,r}return s(e,t),e.prototype.next=function(t){var e=this.destination;e&&e.next&&e.next(t)},e.prototype.error=function(t){var e=this.destination;e&&e.error&&this.destination.error(t)},e.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},e.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):S.EMPTY},e}(Ot),It=(function(t){function e(e,n,r,i,o){var s=t.call(this,e)||this;return s.keySelector=n,s.elementSelector=r,s.durationSelector=i,s.subjectSelector=o,s.groups=null,s.attemptedToUnsubscribe=!1,s.count=0,s}s(e,t),e.prototype._next=function(t){var e;try{e=this.keySelector(t)}catch(t){return void this.error(t)}this._group(t,e)},e.prototype._group=function(t,e){var n=this.groups;n||(n=this.groups=new Map);var r,i=n.get(e);if(this.elementSelector)try{r=this.elementSelector(t)}catch(t){this.error(t)}else r=t;if(!i){i=this.subjectSelector?this.subjectSelector():new Ot,n.set(e,i);var o=new _t(e,i,this);if(this.destination.next(o),this.durationSelector){var s=void 0;try{s=this.durationSelector(new _t(e,i))}catch(t){return void this.error(t)}this.add(s.subscribe(new It(e,i,this)))}}i.closed||i.next(r)},e.prototype._error=function(t){var e=this.groups;e&&(e.forEach(function(e,n){e.error(t)}),e.clear()),this.destination.error(t)},e.prototype._complete=function(){var t=this.groups;t&&(t.forEach(function(t,e){t.complete()}),t.clear()),this.destination.complete()},e.prototype.removeGroup=function(t){this.groups.delete(t)},e.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,0===this.count&&t.prototype.unsubscribe.call(this))}}(I),function(t){function e(e,n,r){var i=t.call(this,n)||this;return i.key=e,i.group=n,i.parent=r,i}return s(e,t),e.prototype._next=function(t){this.complete()},e.prototype._unsubscribe=function(){var t=this.parent,e=this.key;this.key=this.parent=null,t&&t.removeGroup(e)},e}(I)),_t=function(t){function e(e,n,r){var i=t.call(this)||this;return i.key=e,i.groupSubject=n,i.refCountSubscription=r,i}return s(e,t),e.prototype._subscribe=function(t){var e=new S,n=this.refCountSubscription,r=this.groupSubject;return n&&!n.closed&&e.add(new xt(n)),e.add(r.subscribe(t)),e},e}(C),xt=function(t){function e(e){var n=t.call(this)||this;return n.parent=e,e.count++,n}return s(e,t),e.prototype.unsubscribe=function(){var e=this.parent;e.closed||this.closed||(t.prototype.unsubscribe.call(this),e.count-=1,0===e.count&&e.attemptedToUnsubscribe&&e.unsubscribe())},e}(S);(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}s(e,t),e.prototype._next=function(t){}})(I),function(t){function e(e){return t.call(this,e)||this}s(e,t),e.prototype.notifyComplete=function(t){var e=this.destination;e.next(t),e.complete()},e.prototype._next=function(t){this.notifyComplete(!1)},e.prototype._complete=function(){this.notifyComplete(!0)}}(I),function(t){function e(e,n){var r=t.call(this,e)||this;return r.total=n,r.ring=new Array,r.count=0,r}s(e,t),e.prototype._next=function(t){var e=this.ring,n=this.total,r=this.count++;e.length<n?e.push(t):e[r%n]=t},e.prototype._complete=function(){var t=this.destination,e=this.count;if(e>0)for(var n=this.count>=this.total?this.total:this.count,r=this.ring,i=0;i<n;i++){var o=e++%n;t.next(r[o])}t.complete()}}(I),function(t){function e(e,n){var r=t.call(this,e)||this;return r.value=n,r}s(e,t),e.prototype._next=function(t){this.destination.next(this.value)}}(I),function(t){function e(e){return t.call(this,e)||this}s(e,t),e.prototype._next=function(t){this.destination.next(et.createNext(t))},e.prototype._error=function(t){var e=this.destination;e.next(et.createError(t)),e.complete()},e.prototype._complete=function(){var t=this.destination;t.next(et.createComplete()),t.complete()}}(I),function(t){function e(e,n,r,i){var o=t.call(this,e)||this;return o.accumulator=n,o._seed=r,o.hasSeed=i,o.index=0,o}s(e,t),Object.defineProperty(e.prototype,"seed",{get:function(){return this._seed},set:function(t){this.hasSeed=!0,this._seed=t},enumerable:!0,configurable:!0}),e.prototype._next=function(t){if(this.hasSeed)return this._tryNext(t);this.seed=t,this.destination.next(t)},e.prototype._tryNext=function(t){var e,n=this.index++;try{e=this.accumulator(this.seed,t,n)}catch(t){this.destination.error(t)}this.seed=e,this.destination.next(e)}}(I),function(t){function e(e,n,r,i){var o=t.call(this,e)||this;return o.accumulator=n,o.acc=r,o.concurrent=i,o.hasValue=!1,o.hasCompleted=!1,o.buffer=[],o.active=0,o.index=0,o}s(e,t),e.prototype._next=function(t){if(this.active<this.concurrent){var e=this.index++,n=l(this.accumulator)(this.acc,t),r=this.destination;n===c?r.error(c.e):(this.active++,this._innerSub(n,t,e))}else this.buffer.push(t)},e.prototype._innerSub=function(t,e,n){var r=new E(this,void 0,void 0);this.destination.add(r),R(this,t,e,n,r)},e.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete()),this.unsubscribe()},e.prototype.notifyNext=function(t,e,n,r,i){var o=this.destination;this.acc=e,this.hasValue=!0,o.next(e)},e.prototype.notifyComplete=function(t){var e=this.buffer;this.destination.remove(t),this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete())}}(x);var Et=function(){function t(t){this.connectable=t}return t.prototype.call=function(t,e){var n=this.connectable;n._refCount++;var r=new kt(t,n),i=e.subscribe(r);return r.closed||(r.connection=n.connect()),i},t}(),kt=function(t){function e(e,n){var r=t.call(this,e)||this;return r.connectable=n,r}return s(e,t),e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._refCount;if(e<=0)this.connection=null;else if(t._refCount=e-1,e>1)this.connection=null;else{var n=this.connection,r=t._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}else this.connection=null},e}(I),Tt=function(t){function e(e,n){var r=t.call(this)||this;return r.source=e,r.subjectFactory=n,r._refCount=0,r._isComplete=!1,r}return s(e,t),e.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},e.prototype.getSubject=function(){var t=this._subject;return t&&!t.isStopped||(this._subject=this.subjectFactory()),this._subject},e.prototype.connect=function(){var t=this._connection;return t||(this._isComplete=!1,(t=this._connection=new S).add(this.source.subscribe(new Ct(this.getSubject(),this))),t.closed?(this._connection=null,t=S.EMPTY):this._connection=t),t},e.prototype.refCount=function(){return(t=this).lift(new Et(t));var t},e}(C).prototype,Ct=(Tt._subscribe,Tt._isComplete,Tt.getSubject,Tt.connect,Tt.refCount,function(t){function e(e,n){var r=t.call(this,e)||this;return r.connectable=n,r}return s(e,t),e.prototype._error=function(e){this._unsubscribe(),t.prototype._error.call(this,e)},e.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._connection;t._refCount=0,t._subject=null,t._connection=null,e&&e.unsubscribe()}},e}(St)),jt=(function(t){function e(e,n){var r=t.call(this,e)||this;return r.connectable=n,r}s(e,t),e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._refCount;if(e<=0)this.connection=null;else if(t._refCount=e-1,e>1)this.connection=null;else{var n=this.connection,r=t._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}else this.connection=null}}(I),function(t){function e(e,n,r){void 0===r&&(r=0);var i=t.call(this,e)||this;return i.scheduler=n,i.delay=r,i}return s(e,t),e.dispatch=function(t){var e=t.notification,n=t.destination;e.observe(n),this.unsubscribe()},e.prototype.scheduleMessage=function(t){this.destination.add(this.scheduler.schedule(e.dispatch,this.delay,new At(t,this.destination)))},e.prototype._next=function(t){this.scheduleMessage(et.createNext(t))},e.prototype._error=function(t){this.scheduleMessage(et.createError(t)),this.unsubscribe()},e.prototype._complete=function(){this.scheduleMessage(et.createComplete()),this.unsubscribe()},e}(I)),At=function(){return function(t,e){this.notification=t,this.destination=e}}(),Nt=(function(t){function e(e,n){var r=t.call(this,e)||this;return r.destination=e,r.nextSources=n,r}s(e,t),e.prototype.notifyError=function(t,e){this.subscribeToNextSource()},e.prototype.notifyComplete=function(t){this.subscribeToNextSource()},e.prototype._error=function(t){this.subscribeToNextSource(),this.unsubscribe()},e.prototype._complete=function(){this.subscribeToNextSource(),this.unsubscribe()},e.prototype.subscribeToNextSource=function(){var t=this.nextSources.shift();if(t){var e=new E(this,void 0,void 0);this.destination.add(e),R(this,t,void 0,void 0,e)}else this.destination.complete()}}(x),function(t){function e(e){var n=t.call(this,e)||this;return n.hasPrev=!1,n}s(e,t),e.prototype._next=function(t){this.hasPrev?this.destination.next([this.prev,t]):this.hasPrev=!0,this.prev=t}}(I),function(t){function e(e){var n=t.call(this)||this;return n._value=e,n}s(e,t),Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),e.prototype._subscribe=function(e){var n=t.prototype._subscribe.call(this,e);return n&&!n.closed&&e.next(this._value),n},e.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new vt;return this._value},e.prototype.next=function(e){t.prototype.next.call(this,this._value=e)}}(Ot),function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.value=null,e.hasNext=!1,e.hasCompleted=!1,e}s(e,t),e.prototype._subscribe=function(e){return this.hasError?(e.error(this.thrownError),S.EMPTY):this.hasCompleted&&this.hasNext?(e.next(this.value),e.complete(),S.EMPTY):t.prototype._subscribe.call(this,e)},e.prototype.next=function(t){this.hasCompleted||(this.value=t,this.hasNext=!0)},e.prototype.error=function(e){this.hasCompleted||t.prototype.error.call(this,e)},e.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&t.prototype.next.call(this,this.value),t.prototype.complete.call(this)}}(Ot),function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.scheduler=e,r.work=n,r}return s(e,t),e.prototype.schedule=function(e,n){return void 0===n&&(n=0),n>0?t.prototype.schedule.call(this,e,n):(this.delay=n,this.state=e,this.scheduler.flush(this),this)},e.prototype.execute=function(e,n){return n>0||this.closed?t.prototype.execute.call(this,e,n):this._execute(e,n)},e.prototype.requestAsyncId=function(e,n,r){return void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0?t.prototype.requestAsyncId.call(this,e,n,r):e.flush(this)},e}(B)),Pt=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e}(D))(Nt),Rt=(function(t){function e(e,n,r){void 0===e&&(e=Number.POSITIVE_INFINITY),void 0===n&&(n=Number.POSITIVE_INFINITY);var i=t.call(this)||this;return i.scheduler=r,i._events=[],i._infiniteTimeWindow=!1,i._bufferSize=e<1?1:e,i._windowTime=n<1?1:n,n===Number.POSITIVE_INFINITY?(i._infiniteTimeWindow=!0,i.next=i.nextInfiniteTimeWindow):i.next=i.nextTimeWindow,i}s(e,t),e.prototype.nextInfiniteTimeWindow=function(e){var n=this._events;n.push(e),n.length>this._bufferSize&&n.shift(),t.prototype.next.call(this,e)},e.prototype.nextTimeWindow=function(e){this._events.push(new Rt(this._getNow(),e)),this._trimBufferThenGetEvents(),t.prototype.next.call(this,e)},e.prototype._subscribe=function(t){var e,n=this._infiniteTimeWindow,r=n?this._events:this._trimBufferThenGetEvents(),i=this.scheduler,o=r.length;if(this.closed)throw new vt;if(this.isStopped||this.hasError?e=S.EMPTY:(this.observers.push(t),e=new wt(this,t)),i&&t.add(t=new jt(t,i)),n)for(var s=0;s<o&&!t.closed;s++)t.next(r[s]);else for(s=0;s<o&&!t.closed;s++)t.next(r[s].value);return this.hasError?t.error(this.thrownError):this.isStopped&&t.complete(),e},e.prototype._getNow=function(){return(this.scheduler||Pt).now()},e.prototype._trimBufferThenGetEvents=function(){for(var t=this._getNow(),e=this._bufferSize,n=this._windowTime,r=this._events,i=r.length,o=0;o<i&&!(t-r[o].time<n);)o++;return i>e&&(o=Math.max(o,i-e)),o>0&&r.splice(0,o),r}}(Ot),function(){return function(t,e){this.time=t,this.value=e}}());(function(t){function e(e){var n=t.call(this,e)||this;return n.hasFirst=!1,n.observables=[],n.subscriptions=[],n}s(e,t),e.prototype._next=function(t){this.observables.push(t)},e.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{for(var n=0;n<e&&!this.hasFirst;n++){var r=t[n],i=R(this,r,r,n);this.subscriptions&&this.subscriptions.push(i),this.add(i)}this.observables=null}},e.prototype.notifyNext=function(t,e,n,r,i){if(!this.hasFirst){this.hasFirst=!0;for(var o=0;o<this.subscriptions.length;o++)if(o!==n){var s=this.subscriptions[o];s.unsubscribe(),this.remove(s)}this.subscriptions=null}this.destination.next(e)}})(x),function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.count=n,i.source=r,i}s(e,t),e.prototype.complete=function(){if(!this.isStopped){var e=this.source,n=this.count;if(0===n)return t.prototype.complete.call(this);n>-1&&(this.count=n-1),e.subscribe(this._unsubscribeAndRecycle())}}}(I),function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.notifier=n,i.source=r,i.sourceIsBeingSubscribedTo=!0,i}s(e,t),e.prototype.notifyNext=function(t,e,n,r,i){this.sourceIsBeingSubscribedTo=!0,this.source.subscribe(this)},e.prototype.notifyComplete=function(e){if(!1===this.sourceIsBeingSubscribedTo)return t.prototype.complete.call(this)},e.prototype.complete=function(){if(this.sourceIsBeingSubscribedTo=!1,!this.isStopped){if(this.retries||this.subscribeToRetries(),!this.retriesSubscription||this.retriesSubscription.closed)return t.prototype.complete.call(this);this._unsubscribeAndRecycle(),this.notifications.next()}},e.prototype._unsubscribe=function(){var t=this.notifications,e=this.retriesSubscription;t&&(t.unsubscribe(),this.notifications=null),e&&(e.unsubscribe(),this.retriesSubscription=null),this.retries=null},e.prototype._unsubscribeAndRecycle=function(){var e=this._unsubscribe;return this._unsubscribe=null,t.prototype._unsubscribeAndRecycle.call(this),this._unsubscribe=e,this},e.prototype.subscribeToRetries=function(){this.notifications=new Ot;var e=l(this.notifier)(this.notifications);if(e===c)return t.prototype.complete.call(this);this.retries=e,this.retriesSubscription=R(this,e)}}(x),function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.count=n,i.source=r,i}s(e,t),e.prototype.error=function(e){if(!this.isStopped){var n=this.source,r=this.count;if(0===r)return t.prototype.error.call(this,e);r>-1&&(this.count=r-1),n.subscribe(this._unsubscribeAndRecycle())}}}(I),function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.notifier=n,i.source=r,i}s(e,t),e.prototype.error=function(e){if(!this.isStopped){var n=this.errors,r=this.retries,i=this.retriesSubscription;if(r)this.errors=null,this.retriesSubscription=null;else{if(n=new Ot,(r=l(this.notifier)(n))===c)return t.prototype.error.call(this,c.e);i=R(this,r)}this._unsubscribeAndRecycle(),this.errors=n,this.retries=r,this.retriesSubscription=i,n.next(e)}},e.prototype._unsubscribe=function(){var t=this.errors,e=this.retriesSubscription;t&&(t.unsubscribe(),this.errors=null),e&&(e.unsubscribe(),this.retriesSubscription=null),this.retries=null},e.prototype.notifyNext=function(t,e,n,r,i){var o=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=o,this.source.subscribe(this)}}(x),function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hasValue=!1,e}s(e,t),e.prototype._next=function(t){this.value=t,this.hasValue=!0},e.prototype.notifyNext=function(t,e,n,r,i){this.emitValue()},e.prototype.notifyComplete=function(){this.emitValue()},e.prototype.emitValue=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.value))}}(x),function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.period=n,i.scheduler=r,i.hasValue=!1,i.add(r.schedule(Bt,n,{subscriber:i,period:n})),i}s(e,t),e.prototype._next=function(t){this.lastValue=t,this.hasValue=!0},e.prototype.notifyNext=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.lastValue))}}(I);function Bt(t){var e=t.subscriber,n=t.period;e.notifyNext(),this.schedule(t,n)}!function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.compareTo=n,i.comparor=r,i._a=[],i._b=[],i._oneComplete=!1,i.destination.add(n.subscribe(new Lt(e,i))),i}s(e,t),e.prototype._next=function(t){this._oneComplete&&0===this._b.length?this.emit(!1):(this._a.push(t),this.checkValues())},e.prototype._complete=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0,this.unsubscribe()},e.prototype.checkValues=function(){for(var t=this._a,e=this._b,n=this.comparor;t.length>0&&e.length>0;){var r=t.shift(),i=e.shift(),o=!1;n?(o=l(n)(r,i))===c&&this.destination.error(c.e):o=r===i,o||this.emit(!1)}},e.prototype.emit=function(t){var e=this.destination;e.next(t),e.complete()},e.prototype.nextB=function(t){this._oneComplete&&0===this._a.length?this.emit(!1):(this._b.push(t),this.checkValues())},e.prototype.completeB=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0}}(I);var Lt=function(t){function e(e,n){var r=t.call(this,e)||this;return r.parent=n,r}return s(e,t),e.prototype._next=function(t){this.parent.nextB(t)},e.prototype._error=function(t){this.parent.error(t),this.unsubscribe()},e.prototype._complete=function(){this.parent.completeB(),this.unsubscribe()},e}(I),Dt=(function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.predicate=n,i.source=r,i.seenValue=!1,i.index=0,i}s(e,t),e.prototype.applySingleValue=function(t){this.seenValue?this.destination.error("Sequence contains more than one element"):(this.seenValue=!0,this.singleValue=t)},e.prototype._next=function(t){var e=this.index++;this.predicate?this.tryNext(t,e):this.applySingleValue(t)},e.prototype.tryNext=function(t,e){try{this.predicate(t,e,this.source)&&this.applySingleValue(t)}catch(t){this.destination.error(t)}},e.prototype._complete=function(){var t=this.destination;this.index>0?(t.next(this.seenValue?this.singleValue:void 0),t.complete()):t.error(new ft)}}(I),function(t){function e(e,n){var r=t.call(this,e)||this;return r.total=n,r.count=0,r}s(e,t),e.prototype._next=function(t){++this.count>this.total&&this.destination.next(t)}}(I),function(t){function e(e,n){var r=t.call(this,e)||this;return r._skipCount=n,r._count=0,r._ring=new Array(n),r}s(e,t),e.prototype._next=function(t){var e=this._skipCount,n=this._count++;if(n<e)this._ring[n]=t;else{var r=n%e,i=this._ring,o=i[r];i[r]=t,this.destination.next(o)}}}(I),function(t){function e(e,n){var r=t.call(this,e)||this;r.hasValue=!1;var i=new E(r,void 0,void 0);return r.add(i),r.innerSubscription=i,R(r,n,void 0,void 0,i),r}s(e,t),e.prototype._next=function(e){this.hasValue&&t.prototype._next.call(this,e)},e.prototype.notifyNext=function(t,e,n,r,i){this.hasValue=!0,this.innerSubscription&&this.innerSubscription.unsubscribe()},e.prototype.notifyComplete=function(){}}(x),function(t){function e(e,n){var r=t.call(this,e)||this;return r.predicate=n,r.skipping=!0,r.index=0,r}s(e,t),e.prototype._next=function(t){var e=this.destination;this.skipping&&this.tryCallPredicate(t),this.skipping||e.next(t)},e.prototype.tryCallPredicate=function(t){try{var e=this.predicate(t,this.index++);this.skipping=Boolean(e)}catch(t){this.destination.error(t)}}}(I),1),Ft={};var Ut=function(t){var e=Dt++;return Ft[e]=t,Promise.resolve().then(function(){return function(t){var e=Ft[t];e&&e()}(e)}),e},qt=function(t){delete Ft[t]},zt=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.scheduler=e,r.work=n,r}return s(e,t),e.prototype.requestAsyncId=function(e,n,r){return void 0===r&&(r=0),null!==r&&r>0?t.prototype.requestAsyncId.call(this,e,n,r):(e.actions.push(this),e.scheduled||(e.scheduled=Ut(e.flush.bind(e,null))))},e.prototype.recycleAsyncId=function(e,n,r){if(void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0)return t.prototype.recycleAsyncId.call(this,e,n,r);0===e.actions.length&&(qt(n),e.scheduled=void 0)},e}(B),$t=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.prototype.flush=function(t){this.active=!0,this.scheduled=void 0;var e,n=this.actions,r=-1,i=n.length;t=t||n.shift();do{if(e=t.execute(t.state,t.delay))break}while(++r<i&&(t=n.shift()));if(this.active=!1,e){for(;++r<i&&(t=n.shift());)t.unsubscribe();throw e}},e}(D))(zt);(function(t){function e(e,n,r){void 0===n&&(n=0),void 0===r&&(r=$t);var i,o=t.call(this)||this;return o.source=e,o.delayTime=n,o.scheduler=r,(g(i=n)||!(i-parseFloat(i)+1>=0)||n<0)&&(o.delayTime=0),r&&"function"==typeof r.schedule||(o.scheduler=$t),o}s(e,t),e.create=function(t,n,r){return void 0===n&&(n=0),void 0===r&&(r=$t),new e(t,n,r)},e.dispatch=function(t){var e=t.source,n=t.subscriber;return this.add(e.subscribe(n))},e.prototype._subscribe=function(t){var n=this.delayTime,r=this.source;return this.scheduler.schedule(e.dispatch,n,{source:r,subscriber:t})}})(C),function(t){function e(e,n){var r=t.call(this,e)||this;return r.project=n,r.index=0,r}s(e,t),e.prototype._next=function(t){var e,n=this.index++;try{e=this.project(t,n)}catch(t){return void this.destination.error(t)}this._innerSub(e,t,n)},e.prototype._innerSub=function(t,e,n){var r=this.innerSubscription;r&&r.unsubscribe();var i=new E(this,void 0,void 0);this.destination.add(i),this.innerSubscription=R(this,t,e,n,i)},e.prototype._complete=function(){var e=this.innerSubscription;e&&!e.closed||t.prototype._complete.call(this),this.unsubscribe()},e.prototype._unsubscribe=function(){this.innerSubscription=null},e.prototype.notifyComplete=function(e){this.destination.remove(e),this.innerSubscription=null,this.isStopped&&t.prototype._complete.call(this)},e.prototype.notifyNext=function(t,e,n,r,i){this.destination.next(e)}}(x),function(t){function e(e){var n=t.call(this,e)||this;return n.seenValue=!1,n}s(e,t),e.prototype.notifyNext=function(t,e,n,r,i){this.seenValue=!0,this.complete()},e.prototype.notifyComplete=function(){}}(x),function(t){function e(e,n){var r=t.call(this,e)||this;return r.predicate=n,r.index=0,r}s(e,t),e.prototype._next=function(t){var e,n=this.destination;try{e=this.predicate(t,this.index++)}catch(t){return void n.error(t)}this.nextOrComplete(t,e)},e.prototype.nextOrComplete=function(t,e){var n=this.destination;Boolean(e)?n.next(t):n.complete()}}(I),function(t){function e(e,n,r,i){var o=t.call(this,e)||this;return o.destination=e,o.durationSelector=n,o._leading=r,o._trailing=i,o._hasValue=!1,o}s(e,t),e.prototype._next=function(t){this._hasValue=!0,this._sendValue=t,this._throttled||(this._leading?this.send():this.throttle(t))},e.prototype.send=function(){var t=this._hasValue,e=this._sendValue;t&&(this.destination.next(e),this.throttle(e)),this._hasValue=!1,this._sendValue=null},e.prototype.throttle=function(t){var e=this.tryDurationSelector(t);e&&this.add(this._throttled=R(this,e))},e.prototype.tryDurationSelector=function(t){try{return this.durationSelector(t)}catch(t){return this.destination.error(t),null}},e.prototype.throttlingDone=function(){var t=this._throttled,e=this._trailing;t&&t.unsubscribe(),this._throttled=null,e&&this.send()},e.prototype.notifyNext=function(t,e,n,r,i){this.throttlingDone()},e.prototype.notifyComplete=function(){this.throttlingDone()}}(x),function(t){function e(e,n,r,i,o){var s=t.call(this,e)||this;return s.duration=n,s.scheduler=r,s.leading=i,s.trailing=o,s._hasTrailingValue=!1,s._trailingValue=null,s}s(e,t),e.prototype._next=function(t){this.throttled?this.trailing&&(this._trailingValue=t,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(Gt,this.duration,{subscriber:this})),this.leading&&this.destination.next(t))},e.prototype._complete=function(){this._hasTrailingValue?(this.destination.next(this._trailingValue),this.destination.complete()):this.destination.complete()},e.prototype.clearThrottle=function(){var t=this.throttled;t&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),t.unsubscribe(),this.remove(t),this.throttled=null)}}(I);function Gt(t){t.subscriber.clearThrottle()}(function(t){function e(e,n,r,i,o){var s=t.call(this,e)||this;return s.absoluteTimeout=n,s.waitFor=r,s.withObservable=i,s.scheduler=o,s.action=null,s.scheduleTimeout(),s}s(e,t),e.dispatchTimeout=function(t){var e=t.withObservable;t._unsubscribeAndRecycle(),t.add(R(t,e))},e.prototype.scheduleTimeout=function(){var t=this.action;t?this.action=t.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(e.dispatchTimeout,this.waitFor,this))},e.prototype._next=function(e){this.absoluteTimeout||this.scheduleTimeout(),t.prototype._next.call(this,e)},e.prototype._unsubscribe=function(){this.action=null,this.scheduler=null,this.withObservable=null}})(x),function(t){function e(e){var n=t.call(this,e)||this;return n.window=new Ot,e.next(n.window),n}s(e,t),e.prototype.notifyNext=function(t,e,n,r,i){this.openWindow()},e.prototype.notifyError=function(t,e){this._error(t)},e.prototype.notifyComplete=function(t){this._complete()},e.prototype._next=function(t){this.window.next(t)},e.prototype._error=function(t){this.window.error(t),this.destination.error(t)},e.prototype._complete=function(){this.window.complete(),this.destination.complete()},e.prototype._unsubscribe=function(){this.window=null},e.prototype.openWindow=function(){var t=this.window;t&&t.complete();var e=this.destination,n=this.window=new Ot;e.next(n)}}(x),function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.destination=e,i.windowSize=n,i.startWindowEvery=r,i.windows=[new Ot],i.count=0,e.next(i.windows[0]),i}s(e,t),e.prototype._next=function(t){for(var e=this.startWindowEvery>0?this.startWindowEvery:this.windowSize,n=this.destination,r=this.windowSize,i=this.windows,o=i.length,s=0;s<o&&!this.closed;s++)i[s].next(t);var a=this.count-r+1;if(a>=0&&a%e==0&&!this.closed&&i.shift().complete(),++this.count%e==0&&!this.closed){var u=new Ot;i.push(u),n.next(u)}},e.prototype._error=function(t){var e=this.windows;if(e)for(;e.length>0&&!this.closed;)e.shift().error(t);this.destination.error(t)},e.prototype._complete=function(){var t=this.windows;if(t)for(;t.length>0&&!this.closed;)t.shift().complete();this.destination.complete()},e.prototype._unsubscribe=function(){this.count=0,this.windows=null}}(I);var Kt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._numberOfNextedValues=0,e}return s(e,t),e.prototype.next=function(e){this._numberOfNextedValues++,t.prototype.next.call(this,e)},Object.defineProperty(e.prototype,"numberOfNextedValues",{get:function(){return this._numberOfNextedValues},enumerable:!0,configurable:!0}),e}(Ot);!function(t){function e(e,n,r,i,o){var s=t.call(this,e)||this;s.destination=e,s.windowTimeSpan=n,s.windowCreationInterval=r,s.maxWindowSize=i,s.scheduler=o,s.windows=[];var a=s.openWindow();if(null!==r&&r>=0){var u={subscriber:s,window:a,context:null},c={windowTimeSpan:n,windowCreationInterval:r,subscriber:s,scheduler:o};s.add(o.schedule(Ht,n,u)),s.add(o.schedule(Wt,r,c))}else{var h={subscriber:s,window:a,windowTimeSpan:n};s.add(o.schedule(Vt,n,h))}return s}s(e,t),e.prototype._next=function(t){for(var e=this.windows,n=e.length,r=0;r<n;r++){var i=e[r];i.closed||(i.next(t),i.numberOfNextedValues>=this.maxWindowSize&&this.closeWindow(i))}},e.prototype._error=function(t){for(var e=this.windows;e.length>0;)e.shift().error(t);this.destination.error(t)},e.prototype._complete=function(){for(var t=this.windows;t.length>0;){var e=t.shift();e.closed||e.complete()}this.destination.complete()},e.prototype.openWindow=function(){var t=new Kt;return this.windows.push(t),this.destination.next(t),t},e.prototype.closeWindow=function(t){t.complete();var e=this.windows;e.splice(e.indexOf(t),1)}}(I);function Vt(t){var e=t.subscriber,n=t.windowTimeSpan,r=t.window;r&&e.closeWindow(r),t.window=e.openWindow(),this.schedule(t,n)}function Wt(t){var e=t.windowTimeSpan,n=t.subscriber,r=t.scheduler,i=t.windowCreationInterval,o=n.openWindow(),s={action:this,subscription:null},a={subscriber:n,window:o,context:s};s.subscription=r.schedule(Ht,e,a),this.add(s.subscription),this.schedule(t,i)}function Ht(t){var e=t.subscriber,n=t.window,r=t.context;r&&r.action&&r.subscription&&r.action.remove(r.subscription),e.closeWindow(n)}(function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.openings=n,i.closingSelector=r,i.contexts=[],i.add(i.openSubscription=R(i,n,n)),i}s(e,t),e.prototype._next=function(t){var e=this.contexts;if(e)for(var n=e.length,r=0;r<n;r++)e[r].window.next(t)},e.prototype._error=function(e){var n=this.contexts;if(this.contexts=null,n)for(var r=n.length,i=-1;++i<r;){var o=n[i];o.window.error(e),o.subscription.unsubscribe()}t.prototype._error.call(this,e)},e.prototype._complete=function(){var e=this.contexts;if(this.contexts=null,e)for(var n=e.length,r=-1;++r<n;){var i=e[r];i.window.complete(),i.subscription.unsubscribe()}t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){var t=this.contexts;if(this.contexts=null,t)for(var e=t.length,n=-1;++n<e;){var r=t[n];r.window.unsubscribe(),r.subscription.unsubscribe()}},e.prototype.notifyNext=function(t,e,n,r,i){if(t===this.openings){var o=l(this.closingSelector)(e);if(o===c)return this.error(c.e);var s=new Ot,a=new S,u={window:s,subscription:a};this.contexts.push(u);var h=R(this,o,u);h.closed?this.closeWindow(this.contexts.length-1):(h.context=u,a.add(h)),this.destination.next(s)}else this.closeWindow(this.contexts.indexOf(t))},e.prototype.notifyError=function(t){this.error(t)},e.prototype.notifyComplete=function(t){t!==this.openSubscription&&this.closeWindow(this.contexts.indexOf(t.context))},e.prototype.closeWindow=function(t){if(-1!==t){var e=this.contexts,n=e[t],r=n.window,i=n.subscription;e.splice(t,1),r.complete(),i.unsubscribe()}}})(x),function(t){function e(e,n){var r=t.call(this,e)||this;return r.destination=e,r.closingSelector=n,r.openWindow(),r}s(e,t),e.prototype.notifyNext=function(t,e,n,r,i){this.openWindow(i)},e.prototype.notifyError=function(t,e){this._error(t)},e.prototype.notifyComplete=function(t){this.openWindow(t)},e.prototype._next=function(t){this.window.next(t)},e.prototype._error=function(t){this.window.error(t),this.destination.error(t),this.unsubscribeClosingNotification()},e.prototype._complete=function(){this.window.complete(),this.destination.complete(),this.unsubscribeClosingNotification()},e.prototype.unsubscribeClosingNotification=function(){this.closingNotification&&this.closingNotification.unsubscribe()},e.prototype.openWindow=function(t){void 0===t&&(t=null),t&&(this.remove(t),t.unsubscribe());var e=this.window;e&&e.complete();var n=this.window=new Ot;this.destination.next(n);var r=l(this.closingSelector)();if(r===c){var i=c.e;this.destination.error(i),this.window.error(i)}else this.add(this.closingNotification=R(this,r))}}(x),function(t){function e(e,n,r){var i=t.call(this,e)||this;i.observables=n,i.project=r,i.toRespond=[];var o=n.length;i.values=new Array(o);for(var s=0;s<o;s++)i.toRespond.push(s);for(s=0;s<o;s++){var a=n[s];i.add(R(i,a,a,s))}return i}s(e,t),e.prototype.notifyNext=function(t,e,n,r,i){this.values[n]=e;var o=this.toRespond;if(o.length>0){var s=o.indexOf(n);-1!==s&&o.splice(s,1)}},e.prototype.notifyComplete=function(){},e.prototype._next=function(t){if(0===this.toRespond.length){var e=[t].concat(this.values);this.project?this._tryProject(e):this.destination.next(e)}},e.prototype._tryProject=function(t){var e;try{e=this.project.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)}}(x);function Jt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t[t.length-1];return"function"==typeof n&&t.pop(),$(t,void 0).lift(new Zt(n))}var Zt=function(){function t(t){this.resultSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new Xt(t,this.resultSelector))},t}(),Xt=function(t){function e(e,n,r){void 0===r&&(r=Object.create(null));var i=t.call(this,e)||this;return i.iterators=[],i.active=0,i.resultSelector="function"==typeof n?n:null,i.values=r,i}return s(e,t),e.prototype._next=function(t){var e=this.iterators;g(t)?e.push(new Qt(t)):"function"==typeof t[N]?e.push(new Yt(t[N]())):e.push(new te(this.destination,this,t))},e.prototype._complete=function(){var t=this.iterators,e=t.length;if(this.unsubscribe(),0!==e){this.active=e;for(var n=0;n<e;n++){var r=t[n];if(r.stillUnsubscribed)this.destination.add(r.subscribe(r,n));else this.active--}}else this.destination.complete()},e.prototype.notifyInactive=function(){this.active--,0===this.active&&this.destination.complete()},e.prototype.checkIterators=function(){for(var t=this.iterators,e=t.length,n=this.destination,r=0;r<e;r++){if("function"==typeof(s=t[r]).hasValue&&!s.hasValue())return}var i=!1,o=[];for(r=0;r<e;r++){var s,a=(s=t[r]).next();if(s.hasCompleted()&&(i=!0),a.done)return void n.complete();o.push(a.value)}this.resultSelector?this._tryresultSelector(o):n.next(o),i&&n.complete()},e.prototype._tryresultSelector=function(t){var e;try{e=this.resultSelector.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(I),Yt=function(){function t(t){this.iterator=t,this.nextResult=t.next()}return t.prototype.hasValue=function(){return!0},t.prototype.next=function(){var t=this.nextResult;return this.nextResult=this.iterator.next(),t},t.prototype.hasCompleted=function(){var t=this.nextResult;return t&&t.done},t}(),Qt=function(){function t(t){this.array=t,this.index=0,this.length=0,this.length=t.length}return t.prototype[N]=function(){return this},t.prototype.next=function(t){var e=this.index++,n=this.array;return e<this.length?{value:n[e],done:!1}:{value:null,done:!0}},t.prototype.hasValue=function(){return this.array.length>this.index},t.prototype.hasCompleted=function(){return this.array.length===this.index},t}(),te=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.parent=n,i.observable=r,i.stillUnsubscribed=!0,i.buffer=[],i.isComplete=!1,i}return s(e,t),e.prototype[N]=function(){return this},e.prototype.next=function(){var t=this.buffer;return 0===t.length&&this.isComplete?{value:null,done:!0}:{value:t.shift(),done:!1}},e.prototype.hasValue=function(){return this.buffer.length>0},e.prototype.hasCompleted=function(){return 0===this.buffer.length&&this.isComplete},e.prototype.notifyComplete=function(){this.buffer.length>0?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},e.prototype.notifyNext=function(t,e,n,r,i){this.buffer.push(e),this.parent.checkIterators()},e.prototype.subscribe=function(t,e){return R(this,this.observable,this,e)},e}(x),ee=function(t){function e(e,n,r,i){var o,s,a=t.call(this)||this;return a.proto=i,a.messageIn$=e.pipe(st(function(t){return t.streamId===r}),(o=function(t){var e=t.senderId,n=t.content;return{senderId:e,msg:i.decode(n)}},function(t){if("function"!=typeof o)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return t.lift(new H(o,s))})),a.messageOut$=n,a.streamId=r,a}return s(e,t),e.prototype.send=function(t,e){this.messageOut$.next({streamId:this.streamId,recipientId:e,content:this.proto.encode(this.proto.create(t)).finish()})},e}(i),ne={};function re(){return"getRandomValues"in ne.crypto?ne.crypto.getRandomValues(new Int32Array(1))[0]:ne.crypto.randomBytes(4).readInt32BE(0,!0)}var ie=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.scheduler=e,r.work=n,r}return s(e,t),e.prototype.requestAsyncId=function(e,n,r){return void 0===r&&(r=0),null!==r&&r>0?t.prototype.requestAsyncId.call(this,e,n,r):(e.actions.push(this),e.scheduled||(e.scheduled=requestAnimationFrame(function(){return e.flush(null)})))},e.prototype.recycleAsyncId=function(e,n,r){if(void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0)return t.prototype.recycleAsyncId.call(this,e,n,r);0===e.actions.length&&(cancelAnimationFrame(n),e.scheduled=void 0)},e}(B),oe=(new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.prototype.flush=function(t){this.active=!0,this.scheduled=void 0;var e,n=this.actions,r=-1,i=n.length;t=t||n.shift();do{if(e=t.execute(t.state,t.delay))break}while(++r<i&&(t=n.shift()));if(this.active=!1,e){for(;++r<i&&(t=n.shift());)t.unsubscribe();throw e}},e}(D))(ie),function(t){function e(e,n){void 0===e&&(e=oe),void 0===n&&(n=Number.POSITIVE_INFINITY);var r=t.call(this,e,function(){return r.frame})||this;return r.maxFrames=n,r.frame=0,r.index=-1,r}s(e,t),e.prototype.flush=function(){for(var t,e,n=this.actions,r=this.maxFrames;(e=n.shift())&&(this.frame=e.delay)<=r&&!(t=e.execute(e.state,e.delay)););if(t){for(;e=n.shift();)e.unsubscribe();throw t}},e.frameTimeFactor=10}(D),function(t){function e(e,n,r){void 0===r&&(r=e.index+=1);var i=t.call(this,e,n)||this;return i.scheduler=e,i.work=n,i.index=r,i.active=!0,i.index=e.index=r,i}return s(e,t),e.prototype.schedule=function(n,r){if(void 0===r&&(r=0),!this.id)return t.prototype.schedule.call(this,n,r);this.active=!1;var i=new e(this.scheduler,this.work);return this.add(i),i.schedule(n,r)},e.prototype.requestAsyncId=function(t,n,r){void 0===r&&(r=0),this.delay=t.frame+r;var i=t.actions;return i.push(this),i.sort(e.sortActions),!0},e.prototype.recycleAsyncId=function(t,e,n){void 0===n&&(n=0)},e.prototype._execute=function(e,n){if(!0===this.active)return t.prototype._execute.call(this,e,n)},e.sortActions=function(t,e){return t.delay===e.delay?t.index===e.index?0:t.index>e.index?1:-1:t.delay>e.delay?1:-1},e}(B)),se=(function(t){function e(e,n){var r=t.call(this,e)||this;r.sources=n,r.completed=0,r.haveValues=0;var i=n.length;r.values=new Array(i);for(var o=0;o<i;o++){var s=R(r,n[o],null,o);s&&r.add(s)}return r}s(e,t),e.prototype.notifyNext=function(t,e,n,r,i){this.values[n]=e,i._hasValue||(i._hasValue=!0,this.haveValues++)},e.prototype.notifyComplete=function(t){var e=this.destination,n=this.haveValues,r=this.values,i=r.length;t._hasValue?(this.completed++,this.completed===i&&(n===i&&e.next(r),e.complete())):e.complete()}}(x),new C(T),"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{});function ae(t,e){return t(e={exports:{}},e.exports),e.exports}var ue=function(t,e){var n=new Array(arguments.length-1),r=0,i=2,o=!0;for(;i<arguments.length;)n[r++]=arguments[i++];return new Promise(function(i,s){n[r]=function(t){if(o)if(o=!1,t)s(t);else{for(var e=new Array(arguments.length-1),n=0;n<e.length;)e[n++]=arguments[n];i.apply(null,e)}};try{t.apply(e||null,n)}catch(t){o&&(o=!1,s(t))}})};var ce=ae(function(t,e){var n=e;n.length=function(t){var e=t.length;if(!e)return 0;for(var n=0;--e%4>1&&"="===t.charAt(e);)++n;return Math.ceil(3*t.length)/4-n};for(var r=new Array(64),i=new Array(123),o=0;o<64;)i[r[o]=o<26?o+65:o<52?o+71:o<62?o-4:o-59|43]=o++;n.encode=function(t,e,n){for(var i,o=null,s=[],a=0,u=0;e<n;){var c=t[e++];switch(u){case 0:s[a++]=r[c>>2],i=(3&c)<<4,u=1;break;case 1:s[a++]=r[i|c>>4],i=(15&c)<<2,u=2;break;case 2:s[a++]=r[i|c>>6],s[a++]=r[63&c],u=0}a>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,s)),a=0)}return u&&(s[a++]=r[i],s[a++]=61,1===u&&(s[a++]=61)),o?(a&&o.push(String.fromCharCode.apply(String,s.slice(0,a))),o.join("")):String.fromCharCode.apply(String,s.slice(0,a))};n.decode=function(t,e,n){for(var r,o=n,s=0,a=0;a<t.length;){var u=t.charCodeAt(a++);if(61===u&&s>1)break;if(void 0===(u=i[u]))throw Error("invalid encoding");switch(s){case 0:r=u,s=1;break;case 1:e[n++]=r<<2|(48&u)>>4,r=u,s=2;break;case 2:e[n++]=(15&r)<<4|(60&u)>>2,r=u,s=3;break;case 3:e[n++]=(3&r)<<6|u,s=0}}if(1===s)throw Error("invalid encoding");return n-o},n.test=function(t){return/^(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/.test(t)}}),he=le;function le(){this._listeners={}}le.prototype.on=function(t,e,n){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:e,ctx:n||this}),this},le.prototype.off=function(t,e){if(void 0===t)this._listeners={};else if(void 0===e)this._listeners[t]=[];else for(var n=this._listeners[t],r=0;r<n.length;)n[r].fn===e?n.splice(r,1):++r;return this},le.prototype.emit=function(t){var e=this._listeners[t];if(e){for(var n=[],r=1;r<arguments.length;)n.push(arguments[r++]);for(r=0;r<e.length;)e[r].fn.apply(e[r++].ctx,n)}return this};var fe=pe(pe);function pe(t){return"undefined"!=typeof Float32Array?function(){var e=new Float32Array([-0]),n=new Uint8Array(e.buffer),r=128===n[3];function i(t,r,i){e[0]=t,r[i]=n[0],r[i+1]=n[1],r[i+2]=n[2],r[i+3]=n[3]}function o(t,r,i){e[0]=t,r[i]=n[3],r[i+1]=n[2],r[i+2]=n[1],r[i+3]=n[0]}function s(t,r){return n[0]=t[r],n[1]=t[r+1],n[2]=t[r+2],n[3]=t[r+3],e[0]}function a(t,r){return n[3]=t[r],n[2]=t[r+1],n[1]=t[r+2],n[0]=t[r+3],e[0]}t.writeFloatLE=r?i:o,t.writeFloatBE=r?o:i,t.readFloatLE=r?s:a,t.readFloatBE=r?a:s}():function(){function e(t,e,n,r){var i=e<0?1:0;if(i&&(e=-e),0===e)t(1/e>0?0:2147483648,n,r);else if(isNaN(e))t(2143289344,n,r);else if(e>3.4028234663852886e38)t((i<<31|2139095040)>>>0,n,r);else if(e<1.1754943508222875e-38)t((i<<31|Math.round(e/1.401298464324817e-45))>>>0,n,r);else{var o=Math.floor(Math.log(e)/Math.LN2);t((i<<31|o+127<<23|8388607&Math.round(e*Math.pow(2,-o)*8388608))>>>0,n,r)}}function n(t,e,n){var r=t(e,n),i=2*(r>>31)+1,o=r>>>23&255,s=8388607&r;return 255===o?s?NaN:i*(1/0):0===o?1.401298464324817e-45*i*s:i*Math.pow(2,o-150)*(s+8388608)}t.writeFloatLE=e.bind(null,de),t.writeFloatBE=e.bind(null,ye),t.readFloatLE=n.bind(null,be),t.readFloatBE=n.bind(null,ge)}(),"undefined"!=typeof Float64Array?function(){var e=new Float64Array([-0]),n=new Uint8Array(e.buffer),r=128===n[7];function i(t,r,i){e[0]=t,r[i]=n[0],r[i+1]=n[1],r[i+2]=n[2],r[i+3]=n[3],r[i+4]=n[4],r[i+5]=n[5],r[i+6]=n[6],r[i+7]=n[7]}function o(t,r,i){e[0]=t,r[i]=n[7],r[i+1]=n[6],r[i+2]=n[5],r[i+3]=n[4],r[i+4]=n[3],r[i+5]=n[2],r[i+6]=n[1],r[i+7]=n[0]}function s(t,r){return n[0]=t[r],n[1]=t[r+1],n[2]=t[r+2],n[3]=t[r+3],n[4]=t[r+4],n[5]=t[r+5],n[6]=t[r+6],n[7]=t[r+7],e[0]}function a(t,r){return n[7]=t[r],n[6]=t[r+1],n[5]=t[r+2],n[4]=t[r+3],n[3]=t[r+4],n[2]=t[r+5],n[1]=t[r+6],n[0]=t[r+7],e[0]}t.writeDoubleLE=r?i:o,t.writeDoubleBE=r?o:i,t.readDoubleLE=r?s:a,t.readDoubleBE=r?a:s}():function(){function e(t,e,n,r,i,o){var s=r<0?1:0;if(s&&(r=-r),0===r)t(0,i,o+e),t(1/r>0?0:2147483648,i,o+n);else if(isNaN(r))t(0,i,o+e),t(2146959360,i,o+n);else if(r>1.7976931348623157e308)t(0,i,o+e),t((s<<31|2146435072)>>>0,i,o+n);else{var a;if(r<2.2250738585072014e-308)t((a=r/5e-324)>>>0,i,o+e),t((s<<31|a/4294967296)>>>0,i,o+n);else{var u=Math.floor(Math.log(r)/Math.LN2);1024===u&&(u=1023),t(4503599627370496*(a=r*Math.pow(2,-u))>>>0,i,o+e),t((s<<31|u+1023<<20|1048576*a&1048575)>>>0,i,o+n)}}}function n(t,e,n,r,i){var o=t(r,i+e),s=t(r,i+n),a=2*(s>>31)+1,u=s>>>20&2047,c=4294967296*(1048575&s)+o;return 2047===u?c?NaN:a*(1/0):0===u?5e-324*a*c:a*Math.pow(2,u-1075)*(c+4503599627370496)}t.writeDoubleLE=e.bind(null,de,0,4),t.writeDoubleBE=e.bind(null,ye,4,0),t.readDoubleLE=n.bind(null,be,0,4),t.readDoubleBE=n.bind(null,ge,4,0)}(),t}function de(t,e,n){e[n]=255&t,e[n+1]=t>>>8&255,e[n+2]=t>>>16&255,e[n+3]=t>>>24}function ye(t,e,n){e[n]=t>>>24,e[n+1]=t>>>16&255,e[n+2]=t>>>8&255,e[n+3]=255&t}function be(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0}function ge(t,e){return(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}var me=function(t){return null};var ve=ae(function(t,e){var n=e;n.length=function(t){for(var e=0,n=0,r=0;r<t.length;++r)(n=t.charCodeAt(r))<128?e+=1:n<2048?e+=2:55296==(64512&n)&&56320==(64512&t.charCodeAt(r+1))?(++r,e+=4):e+=3;return e},n.read=function(t,e,n){if(n-e<1)return"";for(var r,i=null,o=[],s=0;e<n;)(r=t[e++])<128?o[s++]=r:r>191&&r<224?o[s++]=(31&r)<<6|63&t[e++]:r>239&&r<365?(r=((7&r)<<18|(63&t[e++])<<12|(63&t[e++])<<6|63&t[e++])-65536,o[s++]=55296+(r>>10),o[s++]=56320+(1023&r)):o[s++]=(15&r)<<12|(63&t[e++])<<6|63&t[e++],s>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),s=0);return i?(s&&i.push(String.fromCharCode.apply(String,o.slice(0,s))),i.join("")):String.fromCharCode.apply(String,o.slice(0,s))},n.write=function(t,e,n){for(var r,i,o=n,s=0;s<t.length;++s)(r=t.charCodeAt(s))<128?e[n++]=r:r<2048?(e[n++]=r>>6|192,e[n++]=63&r|128):55296==(64512&r)&&56320==(64512&(i=t.charCodeAt(s+1)))?(r=65536+((1023&r)<<10)+(1023&i),++s,e[n++]=r>>18|240,e[n++]=r>>12&63|128,e[n++]=r>>6&63|128,e[n++]=63&r|128):(e[n++]=r>>12|224,e[n++]=r>>6&63|128,e[n++]=63&r|128);return n-o}}),we=function(t,e,n){var r=n||8192,i=r>>>1,o=null,s=r;return function(n){if(n<1||n>i)return t(n);s+n>r&&(o=t(r),s=0);var a=e.call(o,s,s+=n);return 7&s&&(s=1+(7|s)),a}};var Se=Oe;function Oe(t,e){this.lo=t>>>0,this.hi=e>>>0}var Me=Oe.zero=new Oe(0,0);Me.toNumber=function(){return 0},Me.zzEncode=Me.zzDecode=function(){return this},Me.length=function(){return 1};var Ie=Oe.zeroHash="\0\0\0\0\0\0\0\0";Oe.fromNumber=function(t){if(0===t)return Me;var e=t<0;e&&(t=-t);var n=t>>>0,r=(t-n)/4294967296>>>0;return e&&(r=~r>>>0,n=~n>>>0,++n>4294967295&&(n=0,++r>4294967295&&(r=0))),new Oe(n,r)},Oe.from=function(t){if("number"==typeof t)return Oe.fromNumber(t);if(Ee.isString(t)){if(!Ee.Long)return Oe.fromNumber(parseInt(t,10));t=Ee.Long.fromString(t)}return t.low||t.high?new Oe(t.low>>>0,t.high>>>0):Me},Oe.prototype.toNumber=function(t){if(!t&&this.hi>>>31){var e=1+~this.lo>>>0,n=~this.hi>>>0;return e||(n=n+1>>>0),-(e+4294967296*n)}return this.lo+4294967296*this.hi},Oe.prototype.toLong=function(t){return Ee.Long?new Ee.Long(0|this.lo,0|this.hi,Boolean(t)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(t)}};var _e=String.prototype.charCodeAt;Oe.fromHash=function(t){return t===Ie?Me:new Oe((_e.call(t,0)|_e.call(t,1)<<8|_e.call(t,2)<<16|_e.call(t,3)<<24)>>>0,(_e.call(t,4)|_e.call(t,5)<<8|_e.call(t,6)<<16|_e.call(t,7)<<24)>>>0)},Oe.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},Oe.prototype.zzEncode=function(){var t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this},Oe.prototype.zzDecode=function(){var t=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this},Oe.prototype.length=function(){var t=this.lo,e=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===e?t<16384?t<128?1:2:t<2097152?3:4:e<16384?e<128?5:6:e<2097152?7:8:n<128?9:10};var xe,Ee=ae(function(t,e){var n=e;function r(t,e,n){for(var r=Object.keys(e),i=0;i<r.length;++i)void 0!==t[r[i]]&&n||(t[r[i]]=e[r[i]]);return t}function i(t){function e(t,n){if(!(this instanceof e))return new e(t,n);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&r(this,n)}return(e.prototype=Object.create(Error.prototype)).constructor=e,Object.defineProperty(e.prototype,"name",{get:function(){return t}}),e.prototype.toString=function(){return this.name+": "+this.message},e}n.asPromise=ue,n.base64=ce,n.EventEmitter=he,n.float=fe,n.inquire=me,n.utf8=ve,n.pool=we,n.LongBits=Se,n.global="undefined"!=typeof window&&window||void 0!==se&&se||"undefined"!=typeof self&&self||se,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isNode=Boolean(n.global.process&&n.global.process.versions&&n.global.process.versions.node),n.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},n.isString=function(t){return"string"==typeof t||t instanceof String},n.isObject=function(t){return t&&"object"==typeof t},n.isset=n.isSet=function(t,e){var n=t[e];return!(null==n||!t.hasOwnProperty(e))&&("object"!=typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},n.Buffer=function(){try{var t=n.inquire("buffer").Buffer;return t.prototype.utf8Write?t:null}catch(t){return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(t){return"number"==typeof t?n.Buffer?n._Buffer_allocUnsafe(t):new n.Array(t):n.Buffer?n._Buffer_from(t):"undefined"==typeof Uint8Array?t:new Uint8Array(t)},n.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(t){return t?n.LongBits.from(t).toHash():n.LongBits.zeroHash},n.longFromHash=function(t,e){var r=n.LongBits.fromHash(t);return n.Long?n.Long.fromBits(r.lo,r.hi,e):r.toNumber(Boolean(e))},n.merge=r,n.lcFirst=function(t){return t.charAt(0).toLowerCase()+t.substring(1)},n.newError=i,n.ProtocolError=i("ProtocolError"),n.oneOfGetter=function(t){for(var e={},n=0;n<t.length;++n)e[t[n]]=1;return function(){for(var t=Object.keys(this),n=t.length-1;n>-1;--n)if(1===e[t[n]]&&void 0!==this[t[n]]&&null!==this[t[n]])return t[n]}},n.oneOfSetter=function(t){return function(e){for(var n=0;n<t.length;++n)t[n]!==e&&delete this[t[n]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){var t=n.Buffer;t?(n._Buffer_from=t.from!==Uint8Array.from&&t.from||function(e,n){return new t(e,n)},n._Buffer_allocUnsafe=t.allocUnsafe||function(e){return new t(e)}):n._Buffer_from=n._Buffer_allocUnsafe=null}}),ke=Re,Te=Ee.LongBits,Ce=Ee.base64,je=Ee.utf8;function Ae(t,e,n){this.fn=t,this.len=e,this.next=void 0,this.val=n}function Ne(){}function Pe(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function Re(){this.len=0,this.head=new Ae(Ne,0,0),this.tail=this.head,this.states=null}function Be(t,e,n){e[n]=255&t}function Le(t,e){this.len=t,this.next=void 0,this.val=e}function De(t,e,n){for(;t.hi;)e[n++]=127&t.lo|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;for(;t.lo>127;)e[n++]=127&t.lo|128,t.lo=t.lo>>>7;e[n++]=t.lo}function Fe(t,e,n){e[n]=255&t,e[n+1]=t>>>8&255,e[n+2]=t>>>16&255,e[n+3]=t>>>24}Re.create=Ee.Buffer?function(){return(Re.create=function(){return new xe})()}:function(){return new Re},Re.alloc=function(t){return new Ee.Array(t)},Ee.Array!==Array&&(Re.alloc=Ee.pool(Re.alloc,Ee.Array.prototype.subarray)),Re.prototype._push=function(t,e,n){return this.tail=this.tail.next=new Ae(t,e,n),this.len+=e,this},Le.prototype=Object.create(Ae.prototype),Le.prototype.fn=function(t,e,n){for(;t>127;)e[n++]=127&t|128,t>>>=7;e[n]=t},Re.prototype.uint32=function(t){return this.len+=(this.tail=this.tail.next=new Le((t>>>=0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this},Re.prototype.int32=function(t){return t<0?this._push(De,10,Te.fromNumber(t)):this.uint32(t)},Re.prototype.sint32=function(t){return this.uint32((t<<1^t>>31)>>>0)},Re.prototype.uint64=function(t){var e=Te.from(t);return this._push(De,e.length(),e)},Re.prototype.int64=Re.prototype.uint64,Re.prototype.sint64=function(t){var e=Te.from(t).zzEncode();return this._push(De,e.length(),e)},Re.prototype.bool=function(t){return this._push(Be,1,t?1:0)},Re.prototype.fixed32=function(t){return this._push(Fe,4,t>>>0)},Re.prototype.sfixed32=Re.prototype.fixed32,Re.prototype.fixed64=function(t){var e=Te.from(t);return this._push(Fe,4,e.lo)._push(Fe,4,e.hi)},Re.prototype.sfixed64=Re.prototype.fixed64,Re.prototype.float=function(t){return this._push(Ee.float.writeFloatLE,4,t)},Re.prototype.double=function(t){return this._push(Ee.float.writeDoubleLE,8,t)};var Ue=Ee.Array.prototype.set?function(t,e,n){e.set(t,n)}:function(t,e,n){for(var r=0;r<t.length;++r)e[n+r]=t[r]};Re.prototype.bytes=function(t){var e=t.length>>>0;if(!e)return this._push(Be,1,0);if(Ee.isString(t)){var n=Re.alloc(e=Ce.length(t));Ce.decode(t,n,0),t=n}return this.uint32(e)._push(Ue,e,t)},Re.prototype.string=function(t){var e=je.length(t);return e?this.uint32(e)._push(je.write,e,t):this._push(Be,1,0)},Re.prototype.fork=function(){return this.states=new Pe(this),this.head=this.tail=new Ae(Ne,0,0),this.len=0,this},Re.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Ae(Ne,0,0),this.len=0),this},Re.prototype.ldelim=function(){var t=this.head,e=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=t.next,this.tail=e,this.len+=n),this},Re.prototype.finish=function(){for(var t=this.head.next,e=this.constructor.alloc(this.len),n=0;t;)t.fn(t.val,e,n),n+=t.len,t=t.next;return e},Re._configure=function(t){xe=t};var qe=$e;($e.prototype=Object.create(ke.prototype)).constructor=$e;var ze=Ee.Buffer;function $e(){ke.call(this)}$e.alloc=function(t){return($e.alloc=Ee._Buffer_allocUnsafe)(t)};var Ge=ze&&ze.prototype instanceof Uint8Array&&"set"===ze.prototype.set.name?function(t,e,n){e.set(t,n)}:function(t,e,n){if(t.copy)t.copy(e,n,0,t.length);else for(var r=0;r<t.length;)e[n++]=t[r++]};function Ke(t,e,n){t.length<40?Ee.utf8.write(t,e,n):e.utf8Write(t,n)}$e.prototype.bytes=function(t){Ee.isString(t)&&(t=Ee._Buffer_from(t,"base64"));var e=t.length>>>0;return this.uint32(e),e&&this._push(Ge,e,t),this},$e.prototype.string=function(t){var e=ze.byteLength(t);return this.uint32(e),e&&this._push(Ke,e,t),this};var Ve,We=Xe,He=Ee.LongBits,Je=Ee.utf8;function Ze(t,e){return RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)}function Xe(t){this.buf=t,this.pos=0,this.len=t.length}var Ye,Qe="undefined"!=typeof Uint8Array?function(t){if(t instanceof Uint8Array||Array.isArray(t))return new Xe(t);throw Error("illegal buffer")}:function(t){if(Array.isArray(t))return new Xe(t);throw Error("illegal buffer")};function tn(){var t=new He(0,0),e=0;if(!(this.len-this.pos>4)){for(;e<3;++e){if(this.pos>=this.len)throw Ze(this);if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(127&this.buf[this.pos++])<<7*e)>>>0,t}for(;e<4;++e)if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(127&this.buf[this.pos])<<28)>>>0,t.hi=(t.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return t;if(e=0,this.len-this.pos>4){for(;e<5;++e)if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}else for(;e<5;++e){if(this.pos>=this.len)throw Ze(this);if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}function en(t,e){return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0}function nn(){if(this.pos+8>this.len)throw Ze(this,8);return new He(en(this.buf,this.pos+=4),en(this.buf,this.pos+=4))}Xe.create=Ee.Buffer?function(t){return(Xe.create=function(t){return Ee.Buffer.isBuffer(t)?new Ve(t):Qe(t)})(t)}:Qe,Xe.prototype._slice=Ee.Array.prototype.subarray||Ee.Array.prototype.slice,Xe.prototype.uint32=(Ye=4294967295,function(){if(Ye=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return Ye;if(Ye=(Ye|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return Ye;if(Ye=(Ye|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return Ye;if(Ye=(Ye|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return Ye;if(Ye=(Ye|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return Ye;if((this.pos+=5)>this.len)throw this.pos=this.len,Ze(this,10);return Ye}),Xe.prototype.int32=function(){return 0|this.uint32()},Xe.prototype.sint32=function(){var t=this.uint32();return t>>>1^-(1&t)|0},Xe.prototype.bool=function(){return 0!==this.uint32()},Xe.prototype.fixed32=function(){if(this.pos+4>this.len)throw Ze(this,4);return en(this.buf,this.pos+=4)},Xe.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Ze(this,4);return 0|en(this.buf,this.pos+=4)},Xe.prototype.float=function(){if(this.pos+4>this.len)throw Ze(this,4);var t=Ee.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t},Xe.prototype.double=function(){if(this.pos+8>this.len)throw Ze(this,4);var t=Ee.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t},Xe.prototype.bytes=function(){var t=this.uint32(),e=this.pos,n=this.pos+t;if(n>this.len)throw Ze(this,t);return this.pos+=t,Array.isArray(this.buf)?this.buf.slice(e,n):e===n?new this.buf.constructor(0):this._slice.call(this.buf,e,n)},Xe.prototype.string=function(){var t=this.bytes();return Je.read(t,0,t.length)},Xe.prototype.skip=function(t){if("number"==typeof t){if(this.pos+t>this.len)throw Ze(this,t);this.pos+=t}else do{if(this.pos>=this.len)throw Ze(this)}while(128&this.buf[this.pos++]);return this},Xe.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(t=7&this.uint32());)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this},Xe._configure=function(t){Ve=t;var e=Ee.Long?"toLong":"toNumber";Ee.merge(Xe.prototype,{int64:function(){return tn.call(this)[e](!1)},uint64:function(){return tn.call(this)[e](!0)},sint64:function(){return tn.call(this).zzDecode()[e](!1)},fixed64:function(){return nn.call(this)[e](!0)},sfixed64:function(){return nn.call(this)[e](!1)}})};var rn=on;function on(t){We.call(this,t)}(on.prototype=Object.create(We.prototype)).constructor=on,Ee.Buffer&&(on.prototype._slice=Ee.Buffer.prototype.slice),on.prototype.string=function(){var t=this.uint32();return this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len))};var sn=an;function an(t,e,n){if("function"!=typeof t)throw TypeError("rpcImpl must be a function");Ee.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=Boolean(e),this.responseDelimited=Boolean(n)}(an.prototype=Object.create(Ee.EventEmitter.prototype)).constructor=an,an.prototype.rpcCall=function t(e,n,r,i,o){if(!i)throw TypeError("request must be specified");var s=this;if(!o)return Ee.asPromise(t,s,e,n,r,i);if(s.rpcImpl)try{return s.rpcImpl(e,n[s.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(t,n){if(t)return s.emit("error",t,e),o(t);if(null!==n){if(!(n instanceof r))try{n=r[s.responseDelimited?"decodeDelimited":"decode"](n)}catch(t){return s.emit("error",t,e),o(t)}return s.emit("data",n,e),o(null,n)}s.end(!0)})}catch(t){return s.emit("error",t,e),void setTimeout(function(){o(t)},0)}else setTimeout(function(){o(Error("already ended"))},0)},an.prototype.end=function(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};var un,cn=ae(function(t,e){e.Service=sn}),hn={},ln=ae(function(t,e){var n=e;function r(){n.Reader._configure(n.BufferReader),n.util._configure()}n.build="minimal",n.Writer=ke,n.BufferWriter=qe,n.Reader=We,n.BufferReader=rn,n.util=Ee,n.rpc=cn,n.roots=hn,n.configure=r,n.Writer._configure(n.BufferWriter),r()}),fn=ln.Reader,pn=ln.Writer,dn=ln.util,yn=ln.roots,bn=fn,gn=pn,mn=dn,vn=yn.default||(yn.default={}),wn=vn.sync=function(){var t={};return t.RichOperationMsg=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}var e;return t.prototype.richLogootSOpsMsg=null,Object.defineProperty(t.prototype,"type",{get:mn.oneOfGetter(e=["richLogootSOpsMsg"]),set:mn.oneOfSetter(e)}),t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=gn.create()),null!=t.richLogootSOpsMsg&&t.hasOwnProperty("richLogootSOpsMsg")&&vn.sync.RichLogootSOperationMsg.encode(t.richLogootSOpsMsg,e.uint32(10).fork()).ldelim(),e},t.decode=function(t,e){t instanceof bn||(t=bn.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new vn.sync.RichOperationMsg;t.pos<n;){var i=t.uint32();switch(i>>>3){case 1:r.richLogootSOpsMsg=vn.sync.RichLogootSOperationMsg.decode(t,t.uint32());break;default:t.skipType(7&i)}}return r},t}(),t.SyncMsg=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}var e;return t.prototype.richOpMsg=null,t.prototype.querySync=null,t.prototype.replySync=null,Object.defineProperty(t.prototype,"type",{get:mn.oneOfGetter(e=["richOpMsg","querySync","replySync"]),set:mn.oneOfSetter(e)}),t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=gn.create()),null!=t.richOpMsg&&t.hasOwnProperty("richOpMsg")&&vn.sync.RichOperationMsg.encode(t.richOpMsg,e.uint32(10).fork()).ldelim(),null!=t.querySync&&t.hasOwnProperty("querySync")&&vn.sync.QuerySyncMsg.encode(t.querySync,e.uint32(18).fork()).ldelim(),null!=t.replySync&&t.hasOwnProperty("replySync")&&vn.sync.ReplySyncMsg.encode(t.replySync,e.uint32(26).fork()).ldelim(),e},t.decode=function(t,e){t instanceof bn||(t=bn.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new vn.sync.SyncMsg;t.pos<n;){var i=t.uint32();switch(i>>>3){case 1:r.richOpMsg=vn.sync.RichOperationMsg.decode(t,t.uint32());break;case 2:r.querySync=vn.sync.QuerySyncMsg.decode(t,t.uint32());break;case 3:r.replySync=vn.sync.ReplySyncMsg.decode(t,t.uint32());break;default:t.skipType(7&i)}}return r},t}(),t.QuerySyncMsg=function(){function t(t){if(this.vector={},t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.vector=mn.emptyObject,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=gn.create()),null!=t.vector&&t.hasOwnProperty("vector"))for(var n=Object.keys(t.vector),r=0;r<n.length;++r)e.uint32(10).fork().uint32(8).int32(n[r]).uint32(16).int32(t.vector[n[r]]).ldelim();return e},t.decode=function(t,e){t instanceof bn||(t=bn.create(t));for(var n,r=void 0===e?t.len:t.pos+e,i=new vn.sync.QuerySyncMsg;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:t.skip().pos++,i.vector===mn.emptyObject&&(i.vector={}),n=t.int32(),t.pos++,i.vector[n]=t.int32();break;default:t.skipType(7&o)}}return i},t}(),t.ReplySyncMsg=function(){function t(t){if(this.richOpsMsg=[],this.intervals=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.richOpsMsg=mn.emptyArray,t.prototype.intervals=mn.emptyArray,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=gn.create()),null!=t.richOpsMsg&&t.richOpsMsg.length)for(var n=0;n<t.richOpsMsg.length;++n)vn.sync.RichOperationMsg.encode(t.richOpsMsg[n],e.uint32(10).fork()).ldelim();if(null!=t.intervals&&t.intervals.length)for(n=0;n<t.intervals.length;++n)vn.sync.IntervalMsg.encode(t.intervals[n],e.uint32(18).fork()).ldelim();return e},t.decode=function(t,e){t instanceof bn||(t=bn.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new vn.sync.ReplySyncMsg;t.pos<n;){var i=t.uint32();switch(i>>>3){case 1:r.richOpsMsg&&r.richOpsMsg.length||(r.richOpsMsg=[]),r.richOpsMsg.push(vn.sync.RichOperationMsg.decode(t,t.uint32()));break;case 2:r.intervals&&r.intervals.length||(r.intervals=[]),r.intervals.push(vn.sync.IntervalMsg.decode(t,t.uint32()));break;default:t.skipType(7&i)}}return r},t}(),t.IdentifierMsg=function(){function t(t){if(this.tuples=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.tuples=mn.emptyArray,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=gn.create()),null!=t.tuples&&t.tuples.length)for(var n=0;n<t.tuples.length;++n)vn.sync.IdentifierTupleMsg.encode(t.tuples[n],e.uint32(10).fork()).ldelim();return e},t.decode=function(t,e){t instanceof bn||(t=bn.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new vn.sync.IdentifierMsg;t.pos<n;){var i=t.uint32();switch(i>>>3){case 1:r.tuples&&r.tuples.length||(r.tuples=[]),r.tuples.push(vn.sync.IdentifierTupleMsg.decode(t,t.uint32()));break;default:t.skipType(7&i)}}return r},t}(),t.IdentifierTupleMsg=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.random=0,t.prototype.replicaNumber=0,t.prototype.clock=0,t.prototype.offset=0,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=gn.create()),null!=t.random&&t.hasOwnProperty("random")&&e.uint32(8).int32(t.random),null!=t.replicaNumber&&t.hasOwnProperty("replicaNumber")&&e.uint32(16).int32(t.replicaNumber),null!=t.clock&&t.hasOwnProperty("clock")&&e.uint32(24).int32(t.clock),null!=t.offset&&t.hasOwnProperty("offset")&&e.uint32(32).int32(t.offset),e},t.decode=function(t,e){t instanceof bn||(t=bn.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new vn.sync.IdentifierTupleMsg;t.pos<n;){var i=t.uint32();switch(i>>>3){case 1:r.random=t.int32();break;case 2:r.replicaNumber=t.int32();break;case 3:r.clock=t.int32();break;case 4:r.offset=t.int32();break;default:t.skipType(7&i)}}return r},t}(),t.IdentifierIntervalMsg=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.idBegin=null,t.prototype.end=0,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=gn.create()),null!=t.idBegin&&t.hasOwnProperty("idBegin")&&vn.sync.IdentifierMsg.encode(t.idBegin,e.uint32(10).fork()).ldelim(),null!=t.end&&t.hasOwnProperty("end")&&e.uint32(16).int32(t.end),e},t.decode=function(t,e){t instanceof bn||(t=bn.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new vn.sync.IdentifierIntervalMsg;t.pos<n;){var i=t.uint32();switch(i>>>3){case 1:r.idBegin=vn.sync.IdentifierMsg.decode(t,t.uint32());break;case 2:r.end=t.int32();break;default:t.skipType(7&i)}}return r},t}(),t.IntervalMsg=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.id=0,t.prototype.begin=0,t.prototype.end=0,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=gn.create()),null!=t.id&&t.hasOwnProperty("id")&&e.uint32(8).int32(t.id),null!=t.begin&&t.hasOwnProperty("begin")&&e.uint32(16).int32(t.begin),null!=t.end&&t.hasOwnProperty("end")&&e.uint32(24).int32(t.end),e},t.decode=function(t,e){t instanceof bn||(t=bn.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new vn.sync.IntervalMsg;t.pos<n;){var i=t.uint32();switch(i>>>3){case 1:r.id=t.int32();break;case 2:r.begin=t.int32();break;case 3:r.end=t.int32();break;default:t.skipType(7&i)}}return r},t}(),t.RichLogootSOperationMsg=function(){function t(t){if(this.dependencies={},t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}var e;return t.prototype.id=0,t.prototype.clock=0,t.prototype.logootSAddMsg=null,t.prototype.logootSDelMsg=null,t.prototype.dependencies=mn.emptyObject,Object.defineProperty(t.prototype,"type",{get:mn.oneOfGetter(e=["logootSAddMsg","logootSDelMsg"]),set:mn.oneOfSetter(e)}),t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=gn.create()),null!=t.id&&t.hasOwnProperty("id")&&e.uint32(8).int32(t.id),null!=t.clock&&t.hasOwnProperty("clock")&&e.uint32(16).int32(t.clock),null!=t.logootSAddMsg&&t.hasOwnProperty("logootSAddMsg")&&vn.sync.LogootSAddMsg.encode(t.logootSAddMsg,e.uint32(26).fork()).ldelim(),null!=t.logootSDelMsg&&t.hasOwnProperty("logootSDelMsg")&&vn.sync.LogootSDelMsg.encode(t.logootSDelMsg,e.uint32(34).fork()).ldelim(),null!=t.dependencies&&t.hasOwnProperty("dependencies"))for(var n=Object.keys(t.dependencies),r=0;r<n.length;++r)e.uint32(42).fork().uint32(8).int32(n[r]).uint32(16).int32(t.dependencies[n[r]]).ldelim();return e},t.decode=function(t,e){t instanceof bn||(t=bn.create(t));for(var n,r=void 0===e?t.len:t.pos+e,i=new vn.sync.RichLogootSOperationMsg;t.pos<r;){var o=t.uint32();switch(o>>>3){case 1:i.id=t.int32();break;case 2:i.clock=t.int32();break;case 3:i.logootSAddMsg=vn.sync.LogootSAddMsg.decode(t,t.uint32());break;case 4:i.logootSDelMsg=vn.sync.LogootSDelMsg.decode(t,t.uint32());break;case 5:t.skip().pos++,i.dependencies===mn.emptyObject&&(i.dependencies={}),n=t.int32(),t.pos++,i.dependencies[n]=t.int32();break;default:t.skipType(7&o)}}return i},t}(),t.LogootSAddMsg=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.id=null,t.prototype.content="",t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=gn.create()),null!=t.id&&t.hasOwnProperty("id")&&vn.sync.IdentifierMsg.encode(t.id,e.uint32(10).fork()).ldelim(),null!=t.content&&t.hasOwnProperty("content")&&e.uint32(18).string(t.content),e},t.decode=function(t,e){t instanceof bn||(t=bn.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new vn.sync.LogootSAddMsg;t.pos<n;){var i=t.uint32();switch(i>>>3){case 1:r.id=vn.sync.IdentifierMsg.decode(t,t.uint32());break;case 2:r.content=t.string();break;default:t.skipType(7&i)}}return r},t}(),t.LogootSDelMsg=function(){function t(t){if(this.lid=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.lid=mn.emptyArray,t.prototype.author=0,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=gn.create()),null!=t.lid&&t.lid.length)for(var n=0;n<t.lid.length;++n)vn.sync.IdentifierIntervalMsg.encode(t.lid[n],e.uint32(10).fork()).ldelim();return null!=t.author&&t.hasOwnProperty("author")&&e.uint32(16).int32(t.author),e},t.decode=function(t,e){t instanceof bn||(t=bn.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new vn.sync.LogootSDelMsg;t.pos<n;){var i=t.uint32();switch(i>>>3){case 1:r.lid&&r.lid.length||(r.lid=[]),r.lid.push(vn.sync.IdentifierIntervalMsg.decode(t,t.uint32()));break;case 2:r.author=t.int32();break;default:t.skipType(7&i)}}return r},t}(),t}(),Sn=vn.collaborator=function(){var t={};return t.Collaborator=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.muteCoreId=0,t.prototype.displayName="",t.prototype.login="",t.prototype.email="",t.prototype.avatar="",t.prototype.deviceID="",t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=gn.create()),null!=t.muteCoreId&&t.hasOwnProperty("muteCoreId")&&e.uint32(8).sint32(t.muteCoreId),null!=t.displayName&&t.hasOwnProperty("displayName")&&e.uint32(18).string(t.displayName),null!=t.login&&t.hasOwnProperty("login")&&e.uint32(26).string(t.login),null!=t.email&&t.hasOwnProperty("email")&&e.uint32(34).string(t.email),null!=t.avatar&&t.hasOwnProperty("avatar")&&e.uint32(42).string(t.avatar),null!=t.deviceID&&t.hasOwnProperty("deviceID")&&e.uint32(50).string(t.deviceID),e},t.decode=function(t,e){t instanceof bn||(t=bn.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new vn.collaborator.Collaborator;t.pos<n;){var i=t.uint32();switch(i>>>3){case 1:r.muteCoreId=t.sint32();break;case 2:r.displayName=t.string();break;case 3:r.login=t.string();break;case 4:r.email=t.string();break;case 5:r.avatar=t.string();break;case 6:r.deviceID=t.string();break;default:t.skipType(7&i)}}return r},t}(),t}(),On=vn.metadata=function(){var t={};return t.MetaData=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.type=0,t.prototype.data="",t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=gn.create()),null!=t.type&&t.hasOwnProperty("type")&&e.uint32(0).int32(t.type),null!=t.data&&t.hasOwnProperty("data")&&e.uint32(10).string(t.data),e},t.decode=function(t,e){t instanceof bn||(t=bn.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new vn.metadata.MetaData;t.pos<n;){var i=t.uint32();switch(i>>>3){case 0:r.type=t.int32();break;case 1:r.data=t.string();break;default:t.skipType(7&i)}}return r},t}(),t}();(un=e.Streams||(e.Streams={}))[un.COLLABORATORS=400]="COLLABORATORS",un[un.METADATA=401]="METADATA",un[un.DOCUMENT_CONTENT=402]="DOCUMENT_CONTENT";var Mn,In=function(){function t(t){this._state=t}return t.merge=function(t,e){var n=t.docCreated<e.docCreated?t:e;return{docCreated:n.docCreated,cryptoKey:n.cryptoKey}},t.prototype.handleRemoteFixDataState=function(e){return this._state=t.merge(this._state,e),this._state},Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),t}(),_n=function(t){function e(e,n,r,i,o){var s=t.call(this)||this;s.id=e,s.collaboratorService=n,s.document=r,s.sync=i,s.syncMsg=o,s._localOperationForLog$=new Ot,s._remoteOperationForLog=new Ot,s.document.remoteOperations$=s.sync.remoteOperations$,s.sync.localOperations$=s.document.localOperations$,s.sync.remoteQuerySync$=s.syncMsg.remoteQuerySync$,s.sync.remoteReplySync$=s.syncMsg.remoteReplySync$,s.sync.remoteRichOperations$=s.syncMsg.remoteRichOperations$,s.syncMsg.localRichOperations$=s.sync.localRichOperations$,s.syncMsg.querySync$=s.sync.querySync$,s.syncMsg.replySync$=s.sync.replySync$,s.newSub=s.document.localOperationLog$.subscribe(function(t){s.logLocalOperation(s.id,t.textop,t.operation)});var a=Jt(s.document.remoteOperationLog$,s.sync.logsRemoteRichOperations$,function(t,e){return{v1:t,v2:e}});return s.newSub=a.subscribe(function(t){var e=t.v1,n=t.v2;s.logRemoteOperation(s.id,e.textop,e.operation,n.clock,n.author)}),s}return s(e,t),e.prototype.synchronize=function(){this.sync.sync()},e.prototype.indexFromId=function(t){return this.document.indexFromId(t)},e.prototype.positionFromIndex=function(t){return this.document.positionFromIndex(t)},Object.defineProperty(e.prototype,"localTextOperations$",{set:function(t){this.document.localTextOperations$=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"remoteTextOperations$",{get:function(){return this.document.remoteTextOperations$},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"localOperationForLog$",{get:function(){return this._localOperationForLog$.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"remoteOperationForLog$",{get:function(){return this._remoteOperationForLog.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"digestUpdate$",{get:function(){return this.document.digest$},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._localOperationForLog$.complete(),this._remoteOperationForLog.complete(),t.prototype.dispose.call(this)},e}(i),xn=function(t){function e(e){var n=t.call(this)||this;return n._doc=e,n.localOperationSubject=new Ot,n.remoteTextOperationSubject=new Ot,n.localOperationLogsSubject=new Ot,n.remoteOperationLogsSubject=new Ot,n.digestSubject=new Ot,n.updateSubject=new Ot,n}return s(e,t),e.prototype.dispose=function(){this.localOperationSubject.complete(),this.remoteTextOperationSubject.complete(),this.digestSubject.complete(),this.updateSubject.complete(),t.prototype.dispose.call(this)},Object.defineProperty(e.prototype,"doc",{get:function(){return this._doc},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"localTextOperations$",{set:function(t){var e=this;this.newSub=t.subscribe(function(t){e.handleLocalOperation(t),e.updateSubject.next()})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"remoteTextOperations$",{get:function(){return this.remoteTextOperationSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"remoteOperations$",{set:function(t){var e=this;this.newSub=t.subscribe(function(t){var n=t.collaborator,r=t.operations.map(function(t){return e.handleRemoteOperation(t)}).reduce(function(t,e){return t.concat(e)},[]);e.remoteTextOperationSubject.next({collaborator:n,operations:r}),e.updateSubject.next()})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"localOperations$",{get:function(){return this.localOperationSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"localOperationLog$",{get:function(){return this.localOperationLogsSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"remoteOperationLog$",{get:function(){return this.remoteOperationLogsSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"digest$",{get:function(){return this.digestSubject.asObservable()},enumerable:!0,configurable:!0}),e}(i),En=function(){function t(t,e){this.richOps=t,this.intervals=e}return t.prototype.equals=function(t){return this.richOps.length===t.richOps.length&&this.intervals.length===t.intervals.length&&this.richOps.every(function(e,n){return e.equals(t.richOps[n])})&&this.intervals.every(function(e,n){return e.equals(t.intervals[n])})},t}(),kn=function(){function t(t,e,n,r){void 0===r&&(r=new Map),this.id=t,this.clock=e,this.operation=n,this.dependencies=r}return t.prototype.equals=function(t){var e=this.id===t.id&&this.clock===t.clock,n=!0;return this.dependencies.forEach(function(e,r){t.dependencies.has(r)&&t.dependencies.get(r)===e||(n=!1)}),e&&n},t.prototype.toJson=function(){return JSON.stringify({id:this.id,clock:this.clock,operation:this.operation,dependencies:Array.from(this.dependencies)})},t}(),Tn=function(){function t(t,e,n){this.id=t,this.begin=e,this.end=n}return t.prototype.equals=function(t){return this.id===t.id&&this.begin===t.begin&&this.end===t.end},t}();!function(t){t[t.SUPERIOR=1]="SUPERIOR",t[t.INFERIOR=-1]="INFERIOR",t[t.EQUAL=2]="EQUAL",t[t.CONCURRENT=0]="CONCURRENT"}(Mn||(Mn={}));var Cn,jn=function(){function t(t){t&&t.forEach(function(t){console.assert(t>=0,"Each value of a state vector must be positive")}),this.vector=new Map(t)}return t.prototype.get=function(t){return this.vector.get(t)},t.prototype.set=function(t,e){console.assert(e>=0,"clock must be positive"),console.assert(this.isDeliverable(t,e)),this.vector.set(t,e)},t.prototype.clear=function(){this.vector.clear()},Object.defineProperty(t.prototype,"size",{get:function(){return this.vector.size},enumerable:!0,configurable:!0}),t.prototype.isAlreadyDelivered=function(t,e){var n=this.get(t);return void 0!==n&&n>=e},t.prototype.isDeliverable=function(t,e){if(this.isAlreadyDelivered(t,e))return!1;var n=this.get(t);return void 0===n?0===e:e===n+1},t.prototype.forEach=function(t){this.vector.forEach(t)},t.prototype.asMap=function(){return new Map(this.vector)},t.prototype.computeMissingIntervals=function(t){var e=this,n=[];return t.vector.forEach(function(t,r){var i=e.get(r);void 0===i?n.push(new Tn(r,0,t)):i<t&&n.push(new Tn(r,i+1,t))}),n},t.prototype.compareTo=function(t){var e=this;if(t.size<this.size)return-t.compareTo(this);var n=this.size<t.size?Mn.INFERIOR:Mn.EQUAL;return this.forEach(function(r,i){var o=t.get(i);void 0===o&&e.size===t.size?n=Mn.CONCURRENT:void 0===o?n=n===Mn.INFERIOR?Mn.CONCURRENT:Mn.SUPERIOR:r<o?n=n===Mn.SUPERIOR?Mn.CONCURRENT:Mn.INFERIOR:r>o&&(n=n===Mn.INFERIOR?Mn.CONCURRENT:Mn.SUPERIOR),Mn.CONCURRENT}),n},t.prototype.maxPairwise=function(t){var e=new Map,n=[];this.vector.forEach(function(r,i){n.push(i);var o=t.vector.get(i);o?e.set(i,Math.max(r,o)):e.set(i,r)}),t.vector.forEach(function(t,r){n.includes(r)||e.set(r,t)}),this.vector=e},t}(),An=function(t){function e(e,n,r,i,o){var s=t.call(this)||this;return s.id=e,s.clock=0,s.vector=new jn,s.querySyncSubject=new Ot,s.replySyncSubject=new Ot,s.collabsService=o,s.appliedOperationsSubject=new Ot,s.localRichOperationsSubject=new Ot,s.remoteOperationsSubject=new Ot,s.logsRemoteRichOperationsSubject=new Ot,s.richOperations=i,s.vector=new jn(r),s.clock=n,s}return s(e,t),e.prototype.sync=function(){this.querySyncSubject.next(this.vector)},Object.defineProperty(e.prototype,"querySync$",{get:function(){return this.querySyncSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"replySync$",{get:function(){return this.replySyncSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"localRichOperations$",{get:function(){return this.localRichOperationsSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"remoteOperations$",{get:function(){return this.remoteOperationsSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"logsRemoteRichOperations$",{get:function(){return this.logsRemoteRichOperationsSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stateElements",{get:function(){return{networkClock:this.clock,vector:this.vector.asMap(),richOperations:this.richOperations}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"remoteQuerySync$",{set:function(t){var e=this;this.newSub=t.subscribe(function(t){var n=e.computeMissingOps(t),r=e.vector.computeMissingIntervals(t);e.replySyncSubject.next(new En(n,r))})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"remoteReplySync$",{set:function(t){var e=this;this.newSub=t.subscribe(function(t){var n=t.richOps,r=t.intervals;n.length>0&&e.applyRichOperations(n),r.forEach(function(t){var n=t.id,r=t.begin,i=t.end;e.richOperations.filter(function(t){var e=t.id,o=t.clock;return n===e&&r<=o&&o<=i}).forEach(function(t){return e.localRichOperationsSubject.next(t)})})})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"localOperations$",{set:function(t){var e=this;this.newSub=t.subscribe(function(t){var n=e.computeDependencies(t),r=new kn(e.id,e.clock,t,n);e.updateState(r),e.localRichOperationsSubject.next(r),e.clock++})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"remoteRichOperations$",{set:function(t){var e=this;this.newSub=t.subscribe(function(t){return e.applyRichOperations([t])})},enumerable:!0,configurable:!0}),e.prototype.computeMissingOps=function(t){return this.richOperations.filter(function(e){var n=e.id,r=e.clock,i=t.get(n);return void 0===i||i<r})},e.prototype.dispose=function(){this.querySyncSubject.complete(),this.replySyncSubject.complete(),this.appliedOperationsSubject.complete(),this.localRichOperationsSubject.complete(),this.remoteOperationsSubject.complete(),this.logsRemoteRichOperationsSubject.complete(),t.prototype.dispose.call(this)},e.prototype.applyRichOperations=function(t){var e=this;setTimeout(function(){var n=t.filter(function(t){var n=t.id,r=t.clock;return!e.vector.isAlreadyDelivered(n,r)});if(n.length>0){var r=[];n.forEach(function(t){if(e.isDeliverable(t)){var n=t.operation;e.updateState(t),r.push(n),e.logsRemoteRichOperationsSubject.next({clock:t.clock,author:t.id,operation:t.operation})}else e.bufferOperation(t)}),r.length>0&&(e.remoteOperationsSubject.next({collaborator:e.collabsService.getCollaborator(n[0].id),operations:r}),e.appliedOperationsSubject.next())}})},e.prototype.bufferOperation=function(t){var e=this;this.appliedOperationsSubject.pipe(gt(function(){return e.isDeliverable(t)})).subscribe(function(){e.vector.isAlreadyDelivered(t.id,t.clock)||e.applyRichOperations([t])})},e.prototype.updateState=function(t){console.assert(this.isDeliverable(t));var e=t.id,n=t.clock;this.vector.set(e,n),this.richOperations.push(t)},e.prototype.isDeliverable=function(t){var e=t.id,n=t.clock,r=t.dependencies;return this.vector.isDeliverable(e,n)&&this.hasDeliveredDependencies(r)},e.prototype.hasDeliveredDependencies=function(t){var e=this,n=!0;return t.forEach(function(t,r){var i=e.vector.get(r);(void 0===i||t>i)&&(n=!1)}),n},e}(i),Nn=function(t){function n(n,r){var i=t.call(this,n,r,e.Streams.DOCUMENT_CONTENT,wn.SyncMsg)||this;return i.remoteQuerySyncSubject=new Ot,i.remoteQuerySyncIdSubject=new Ot,i.remoteRichOperationSubject=new Ot,i.remoteReplySyncSubject=new Ot,i.newSub=i.messageIn$.subscribe(function(t){var e=t.senderId,n=t.msg;switch(n.type){case"richOpMsg":i.handleRichOpMsg(n.richOpMsg);break;case"querySync":i.remoteQuerySyncIdSubject.next(e),i.handleQuerySyncMsg(n.querySync);break;case"replySync":i.handleReplySyncMsg(n.replySync)}}),i}return s(n,t),Object.defineProperty(n.prototype,"remoteRichOperations$",{get:function(){return this.remoteRichOperationSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"remoteQuerySync$",{get:function(){return this.remoteQuerySyncSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"remoteReplySync$",{get:function(){return this.remoteReplySyncSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"localRichOperations$",{set:function(e){var n=this;this.newSub=e.subscribe(function(e){t.prototype.send.call(n,{richOpMsg:n.serializeRichOperation(e)})})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"querySync$",{set:function(e){var n=this;this.newSub=e.subscribe(function(e){var r=wn.QuerySyncMsg.create();e.forEach(function(t,e){void 0!==e&&void 0!==t&&(r.vector[e]=t)}),t.prototype.send.call(n,{querySync:r})})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"replySync$",{set:function(e){var n=this;this.newSub=Jt(e,this.remoteQuerySyncIdSubject.asObservable(),function(t,e){return{id:e,replySyncEvent:t}}).subscribe(function(e){var r=e.id,i=e.replySyncEvent,o=i.richOps,s=i.intervals,a=wn.ReplySyncMsg.create();a.richOpsMsg=o.map(function(t){return n.serializeRichOperation(t)}),a.intervals=s.map(function(t){var e=t.id,n=t.begin,r=t.end;return wn.IntervalMsg.create({id:e,begin:n,end:r})}),t.prototype.send.call(n,{replySync:a},r)})},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){this.remoteQuerySyncSubject.complete(),this.remoteQuerySyncIdSubject.complete(),this.remoteRichOperationSubject.complete(),this.remoteReplySyncSubject.complete(),t.prototype.dispose.call(this)},n.prototype.handleRichOpMsg=function(t){this.remoteRichOperationSubject.next(this.deserializeRichOperation(t))},n.prototype.handleQuerySyncMsg=function(t){var e=new Map;Object.keys(t.vector).forEach(function(n){e.set(parseInt(n,10),t.vector[n])}),this.remoteQuerySyncSubject.next(new jn(e))},n.prototype.handleReplySyncMsg=function(t){var e=this,n=t.richOpsMsg,r=t.intervals,i=n.map(function(t){return e.deserializeRichOperation(t)});this.remoteReplySyncSubject.next(new En(i,r.map(function(t){var e=t.id,n=t.begin,r=t.end;return new Tn(e,n,r)})))},n}(ee),Pn=function(){function t(t,e,n,r,i){this._id=t,this._sequenceCRDT=e,this._remoteOperations=n,this._vector=r,this._networkClock=i}return t.isArray=function(t){var e=!0;return t instanceof Array?t.forEach(function(t){t instanceof Array&&2===t.length&&"number"==typeof t[0]&&"number"==typeof t[1]||(e=!1)}):e=!1,e},t.prototype.toJSON=function(){return JSON.stringify({vector:Array.from(this._vector),remoteOperations:this._remoteOperations.map(function(t){return t.toJson()}),sequenceCRDT:this._sequenceCRDT,networkClock:this._networkClock,id:this._id})},Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"remoteOperations",{get:function(){return this._remoteOperations},set:function(t){this._remoteOperations=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sequenceCRDT",{get:function(){return this._sequenceCRDT},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"networkClock",{get:function(){return this._networkClock},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vector",{get:function(){return this._vector},enumerable:!0,configurable:!0}),t}(),Rn=function(){function t(t,e,n){this.id=t,this.share=e,this.state=new jn(n)}return t.prototype.merge=function(t){var e=this.state.compareTo(t.state);e===Mn.INFERIOR?(this.share=t.share,this.state=t.state):e===Mn.CONCURRENT&&(this.share=this.share&&t.share,this.state.maxPairwise(t.state))},t.prototype.setShare=function(t){this.share=t;var e=this.state.get(this.id);void 0!==e?this.state.set(this.id,e+1):this.state.set(this.id,0)},t.prototype.getState=function(){return{share:this.share,vector:this.state.asMap(),id:this.id}},Object.defineProperty(t.prototype,"isShared",{get:function(){return this.share},enumerable:!0,configurable:!0}),t}(),Bn=function(){function t(t,e){this._id=t,this.crdt=new Rn(t,e.share,e.vector)}return t.prototype.handleLocalLogState=function(t){this.crdt.setShare(t)},t.prototype.handleRemoteLogState=function(t,e){var n=new Rn(t,e.share,e.vector);return this.crdt.merge(n),this.state},Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this.crdt.getState()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stateWithVectorAsArray",{get:function(){var t=this.state,e=t.vector||new Map,n=Array.from(e);return{share:t.share,vector:n}},enumerable:!0,configurable:!0}),t}(),Ln=function(){function t(t){this._state=t}return t.merge=function(t,e){var n=t.titleModified>e.titleModified?t:e;return{title:n.title,titleModified:n.titleModified}},t.prototype.handleLocalState=function(e){this._state=t.merge(this._state,e)},t.prototype.handleRemoteState=function(e){return this._state=t.merge(this._state,e),this._state},Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),t}();(Cn=e.MetaDataType||(e.MetaDataType={}))[Cn.Title=0]="Title",Cn[Cn.FixData=1]="FixData",Cn[Cn.Logs=2]="Logs";var Dn,Fn=function(t){function n(n,r,i,o,s,a){var u=t.call(this,n,r,e.Streams.METADATA,On.MetaData)||this;return u.title=new Ln(i),u.fixData=new In(o),u.logs=new Bn(a,s),u.localUpdateSubject=new Ot,u.remoteUpdateSubject=new Ot,u.newSub=u.messageIn$.subscribe(function(t){var n=t.msg,r=n.type,i=n.data,o=JSON.parse(i);switch(r){case e.MetaDataType.Title:u.remoteUpdateSubject.next({type:e.MetaDataType.Title,data:u.title.handleRemoteState(o)});break;case e.MetaDataType.FixData:u.remoteUpdateSubject.next({type:e.MetaDataType.FixData,data:u.fixData.handleRemoteFixDataState(o)});break;case e.MetaDataType.Logs:o.vector=new Map(o.vector),u.remoteUpdateSubject.next({type:e.MetaDataType.Logs,data:u.logs.handleRemoteLogState(o.id,{share:o.share,vector:o.vector})});break;default:console.error("No MetaDataType for type "+r)}}),u}return s(n,t),n.mergeTitle=function(t,e){return Ln.merge(t,e)},n.mergeFixData=function(t,e){return In.merge(t,e)},Object.defineProperty(n.prototype,"localUpdate$",{set:function(n){var r=this;this.newSub=n.subscribe(function(n){var i=n.type,o=n.data;switch(i){case e.MetaDataType.Title:var s=o,a=s.title,u=s.titleModified;r.title.handleLocalState({title:a,titleModified:u}),t.prototype.send.call(r,{type:e.MetaDataType.Title,data:JSON.stringify(r.title.state)});break;case e.MetaDataType.FixData:break;case e.MetaDataType.Logs:var c=o.share;r.logs.handleLocalLogState(c),r.remoteUpdateSubject.next({type:e.MetaDataType.Logs,data:r.logs.state});var h=r.logs.state;t.prototype.send.call(r,{type:e.MetaDataType.Logs,data:JSON.stringify({id:r.logs.id,share:h.share,vector:Array.from(h.vector||new Map)})});break;default:console.error("No MetaDataType for type "+i)}})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"memberJoin$",{set:function(n){var r=this;this.newSub=n.subscribe(function(n){t.prototype.send.call(r,{type:e.MetaDataType.FixData,data:JSON.stringify(r.fixData.state)},n),t.prototype.send.call(r,{type:e.MetaDataType.Title,data:JSON.stringify(r.title.state)},n);var i=r.logs.stateWithVectorAsArray;t.prototype.send.call(r,{type:e.MetaDataType.Logs,data:JSON.stringify({share:i.share,vector:i.vector})},n)})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"remoteUpdate$",{get:function(){return this.remoteUpdateSubject.asObservable()},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){this.localUpdateSubject.complete(),this.remoteUpdateSubject.complete()},n}(ee),Un=function(t){function n(n,r,i){var o=t.call(this,n,r,e.Streams.COLLABORATORS,Sn.Collaborator)||this;return o.me=i,o.collaborators=new Map,o.updateSubject=new Ot,o.joinSubject=new Ot,o.leaveSubject=new Ot,o.newSub=o.messageIn$.subscribe(function(t){var e=t.senderId,n=t.msg,r=a({id:e},n),i=o.collaborators.get(e);i?(i.muteCoreId=r.muteCoreId||i.muteCoreId,i.displayName=r.displayName||i.displayName,i.login=r.login||i.login,i.email=r.email||i.email,i.avatar=r.avatar||i.avatar,i.deviceID=r.deviceID||i.deviceID,o.updateSubject.next(i)):(o.collaborators.set(r.id,r),o.joinSubject.next(r))}),o}return s(n,t),n.prototype.getCollaborator=function(t){var e,n;try{for(var r=function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}(this.collaborators.values()),i=r.next();!i.done;i=r.next()){var o=i.value;if(o.muteCoreId===t)return o}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}},Object.defineProperty(n.prototype,"remoteUpdate$",{get:function(){return this.updateSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"join$",{get:function(){return this.joinSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"leave$",{get:function(){return this.leaveSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"memberJoin$",{set:function(t){var e=this;this.newSub=t.subscribe(function(t){return e.emitUpdate(t)})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"memberLeave$",{set:function(t){var e=this;this.newSub=t.subscribe(function(t){var n=e.collaborators.get(t);n&&e.leaveSubject.next(n),e.collaborators.delete(t)})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"localUpdate",{set:function(t){var e=this;this.newSub=t.subscribe(function(t){Object.assign(e.me,t),e.emitUpdate()})},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){this.updateSubject.complete(),this.joinSubject.complete(),this.leaveSubject.complete(),t.prototype.dispose.call(this)},n.prototype.emitUpdate=function(e){var n=this.me,r=(n.id,function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&(n[r[i]]=t[r[i]])}return n}(n,["id"]));t.prototype.send.call(this,r,e)},n}(ee);(Dn=e.Strategy||(e.Strategy={}))[Dn.LOGOOTSPLIT=100]="LOGOOTSPLIT";var qn="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function zn(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function $n(t,e){return t(e={exports:{}},e.exports),e.exports}var Gn=$n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.isDot=function(t){return"object"==typeof t&&null!==t&&"number"==typeof t.replicaNumber&&Number.isInteger(t.replicaNumber)&&"number"==typeof t.clock&&Number.isInteger(t.clock)}});zn(Gn);Gn.isDot;var Kn=$n(function(t,e){function n(t){return Number.isSafeInteger(t)&&e.INT32_BOTTOM<=t&&t<=e.INT32_TOP}Object.defineProperty(e,"__esModule",{value:!0}),e.INT32_BOTTOM=-2147483648,e.INT32_TOP=2147483647,e.isInt32=n,e.randomInt32=function(t,e){console.assert(n(t),"l must be an int32"),console.assert(n(e),"u must be an int32"),console.assert(t<e,"u is greater than l");var r=Math.random()*(e-t)+t,i=Math.floor(r);return console.assert(n(i)&&t<=i&&i<e,"result is an integer 32 in [l, u["),i}});zn(Kn);Kn.INT32_BOTTOM,Kn.INT32_TOP,Kn.isInt32,Kn.randomInt32;var Vn=$n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,n,r){console.assert([t,e,n,r].every(Kn.isInt32),"each value  int32"),this.random=t,this.replicaNumber=e,this.clock=n,this.offset=r}return t.fromPlain=function(e){return"object"==typeof e&&null!==e&&"number"==typeof e.random&&Kn.isInt32(e.random)&&"number"==typeof e.replicaNumber&&Kn.isInt32(e.replicaNumber)&&"number"==typeof e.clock&&Kn.isInt32(e.clock)&&"number"==typeof e.offset&&Kn.isInt32(e.offset)?new t(e.random,e.replicaNumber,e.clock,e.offset):null},t.fromBase=function(e,n){return console.assert(Kn.isInt32(n),"offset  int32"),new t(e.random,e.replicaNumber,e.clock,n)},t.prototype.compareTo=function(t){for(var e=this.asArray(),n=t.asArray(),r=0;r<e.length&&e[r]===n[r];)r++;return r===e.length?0:e[r]<n[r]?-1:1},t.prototype.equals=function(t){return this.equalsBase(t)&&this.offset===t.offset},t.prototype.equalsBase=function(t){return this.random===t.random&&this.replicaNumber===t.replicaNumber&&this.clock===t.clock},t.prototype.asArray=function(){return[this.random,this.replicaNumber,this.clock,this.offset]},t.prototype.digest=function(){return this.asArray().reduce(function(t,e){return 17*t+e|0},0)},t.prototype.toString=function(){return this.random+","+this.replicaNumber+","+this.clock+","+this.offset},t}();e.IdentifierTuple=n});zn(Vn);Vn.IdentifierTuple;var Wn=$n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){console.assert(t.length>0,"tuples must not be empty");var e=t[t.length-1].random;console.assert(e>Kn.INT32_BOTTOM),this.tuples=t}return t.fromPlain=function(e){if("object"==typeof e&&null!==e){var n=e.tuples;if(n instanceof Array&&n.length>0){var r=n.map(Vn.IdentifierTuple.fromPlain).filter(function(t){return null!==t});if(n.length===r.length)return new t(r)}}return null},t.fromBase=function(e,n){return console.assert(Kn.isInt32(n),"offset  int32"),new t(e.tuples.map(function(t,r){return r===e.length-1?Vn.IdentifierTuple.fromBase(t,n):t}))},Object.defineProperty(t.prototype,"generator",{get:function(){return this.tuples[this.tuples.length-1].replicaNumber},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this.tuples.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"replicaNumber",{get:function(){return this.tuples[this.length-1].replicaNumber},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"clock",{get:function(){return this.tuples[this.length-1].clock},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dot",{get:function(){return{replicaNumber:this.replicaNumber,clock:this.clock}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastOffset",{get:function(){return this.tuples[this.length-1].offset},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"base",{get:function(){var t=this.tuples.reduce(function(t,e){return t.concat(e.asArray())},[]);return t.pop(),t},enumerable:!0,configurable:!0}),t.prototype.longestCommonPrefix=function(t){for(var e=[],n=Math.min(this.tuples.length,t.tuples.length),r=0;r<n&&this.tuples[r].equals(t.tuples[r]);)e.push(this.tuples[r]),r++;return e},t.prototype.longestCommonBase=function(t){for(var e=[],n=Math.min(this.tuples.length,t.tuples.length),r=0,i=!1;!i&&r<n;){var o=this.tuples[r],s=t.tuples[r];o.equals(s)?e.push(o):(i=!0,o.equalsBase(s)&&e.push(o)),r++}return e},t.prototype.isPrefix=function(t){return this.isBasePrefix(t)&&this.lastOffset===t.tuples[this.length-1].offset},t.prototype.isBasePrefix=function(t){var e=this;return this.length<=t.length&&this.tuples.every(function(n,r){var i=t.tuples[r];return r===e.tuples.length-1?n.equalsBase(i):n.equals(i)})},t.prototype.commonPrefixLength=function(t){for(var e=Math.min(this.tuples.length,t.tuples.length),n=0;n<e&&this.tuples[n].equals(t.tuples[n]);)n++;return n},t.prototype.equals=function(t){return this.equalsBase(t)&&this.lastOffset===t.lastOffset},t.prototype.equalsBase=function(t){var e=this;return this.length===t.length&&this.tuples.every(function(n,r){var i=t.tuples[r];return r<e.length-1?n.equals(i):n.equalsBase(i)})},t.prototype.compareTo=function(t){if(this.equals(t))return 0;if(this.isPrefix(t))return-1;if(t.isPrefix(this))return 1;var e=this.commonPrefixLength(t);return this.tuples[e].compareTo(t.tuples[e])},t.prototype.hasPlaceAfter=function(t){return console.assert(Kn.isInt32(t),"length  int32"),console.assert(t>0,"length > 0 "),this.lastOffset<=Kn.INT32_TOP-t},t.prototype.hasPlaceBefore=function(t){return console.assert(Kn.isInt32(t),"length  int32"),console.assert(t>0,"length > 0 "),this.lastOffset>=Kn.INT32_BOTTOM+t},t.prototype.maxOffsetBeforeNext=function(t,e){if(console.assert(Kn.isInt32(e),"max  int32"),console.assert(-1===this.compareTo(t),"this must be less than next"),this.equalsBase(t))return console.assert(e<t.lastOffset,"max must be less than next.lastOffset"),e;if(this.isBasePrefix(t)){var n=t.tuples[this.length-1].offset;return Math.min(n,e)}return e},t.prototype.minOffsetAfterPrev=function(t,e){if(console.assert(Kn.isInt32(e),"min  int32"),this.equalsBase(t))return console.assert(e>t.lastOffset,"min must be greater than prev.lastOffset"),e;if(this.isBasePrefix(t)){var n=t.tuples[this.length-1].offset;return Math.max(n+1,e)}return e},t.prototype.digest=function(){return this.tuples.reduce(function(t,e){return 17*t+e.digest()|0},0)},t.prototype.toString=function(){return"Id["+this.tuples.join(",")+"]"},t}();e.Identifier=n});zn(Wn);Wn.Identifier;var Hn=$n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){console.assert(Kn.isInt32(e),"end  int32"),console.assert(t.lastOffset<=e,"idBegin must be less than or equal to idEnd"),this.idBegin=t,this.end=e}return t.fromPlain=function(e){if("object"==typeof e&&null!==e){var n=Wn.Identifier.fromPlain(e.idBegin);if(null!==n&&"number"==typeof e.end&&Kn.isInt32(e.end)&&n.lastOffset<=e.end)return new t(n,e.end)}return null},Object.defineProperty(t.prototype,"begin",{get:function(){return this.idBegin.lastOffset},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"idEnd",{get:function(){return this.getBaseId(this.end)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this.end-this.begin+1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"base",{get:function(){return this.idBegin.base},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dot",{get:function(){return this.idBegin.dot},enumerable:!0,configurable:!0}),t.prototype.equals=function(t){return this.idBegin.equals(t.idBegin)&&this.begin===t.begin&&this.end===t.end},t.prototype.union=function(e,n){console.assert(Kn.isInt32(e),"aBegin  int32"),console.assert(Kn.isInt32(n),"aEnd  int32");var r=Math.min(this.begin,e),i=Math.max(this.end,n);return new t(Wn.Identifier.fromBase(this.idBegin,r),i)},t.prototype.containsId=function(t){return-1===this.idBegin.compareTo(t)&&1===this.idEnd.compareTo(t)},t.prototype.getBaseId=function(t){return console.assert(Kn.isInt32(t),"offset  int32"),console.assert(this.begin<=t&&t<=this.end,"offset must be included in the interval"),Wn.Identifier.fromBase(this.idBegin,t)},t.prototype.digest=function(){return 17*this.idBegin.digest()+this.end|0},t.prototype.toString=function(){return"IdInterval["+this.idBegin.tuples.join(",")+" .. "+this.end+"]"},t}();e.IdentifierInterval=n});zn(Hn);Hn.IdentifierInterval;var Jn=$n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){console.assert(Kn.isInt32(e)&&e>=0,"nbElt must be a non-negative integer"),this.idInterval=t,this.nbElement=e}return t.fromPlain=function(e){if("object"==typeof e&&null!==e){var n=e.idInterval,r=e.nbElement;if(n instanceof Object&&"number"==typeof r&&Kn.isInt32(r)&&r>=0){var i=Hn.IdentifierInterval.fromPlain(n);if(null!==i)return new t(i,r)}}return null},t.prototype.isMine=function(t){return this.idInterval.idBegin.generator===t},t.prototype.addBlock=function(t,e){console.assert(Kn.isInt32(e)&&e>0,"length must be a positive int32"),this.nbElement+=e,this.idInterval=this.idInterval.union(t,t+e-1)},t.prototype.delBlock=function(t){console.assert(Kn.isInt32(t)&&t>0,"nbElt must be a positive int32"),this.nbElement-=t},t.prototype.toString=function(){return"{"+this.nbElement+","+this.idInterval.toString()+"}"},t}();e.LogootSBlock=n});zn(Jn);Jn.LogootSBlock;var Zn=$n(function(t,e){var n=qn&&qn.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(e,"__esModule",{value:!0});var r=new Vn.IdentifierTuple(Kn.INT32_BOTTOM,0,0,0),i=new Vn.IdentifierTuple(Kn.INT32_TOP,0,0,0);function o(t,e){var r,i;return n(this,function(n){switch(n.label){case 0:r=0,i=t,n.label=1;case 1:return r<i.length?[4,i[r]]:[3,4];case 2:n.sent(),n.label=3;case 3:return r++,[3,1];case 4:return[4,e];case 5:return n.sent(),[3,4];case 6:return[2]}})}function s(t){return null!==t?t.tuples:[]}e.createBetweenPosition=function(t,e,n,a){console.assert(null===t||null===e||-1===t.compareTo(e),"id1 < id2"),console.assert(Kn.isInt32(n),"replicaNumber is an int32"),console.assert(Kn.isInt32(a),"clock is an int32");for(var u=o(s(t),r),c=o(s(e),i),h=[],l=u.next().value,f=c.next().value;f.random-l.random<2;)h.push(l),l=u.next().value,f=c.next().value;var p=Kn.randomInt32(l.random+1,f.random);return h.push(new Vn.IdentifierTuple(p,n,a,0)),new Wn.Identifier(h)}});zn(Zn);Zn.createBetweenPosition;var Xn=$n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.compareBase=function(t,e){var n=t.idBegin,r=t.begin,i=t.end,o=e.idBegin,s=e.begin,a=e.end;return n.equalsBase(o)?r===s&&i===a?6:i+1===s?4:r===a+1?5:i<s?1:a<r?0:(console.warn("Trying to duplicate existing identifiers: ",t,e),6):function(t,e){var n=t.idBegin,r=e.idBegin;return console.assert(!n.equalsBase(r),"the bases of the ids must be different"),t.containsId(r)?3:e.containsId(n)?2:-1===n.compareTo(r)?1:0}(t,e)}});zn(Xn);Xn.compareBase;var Yn=$n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){return function(){}}();e.LogootSOperation=n});zn(Yn);Yn.LogootSOperation;var Qn=$n(function(t,e){var n,r=qn&&qn.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var i=Array.prototype.concat,o=function(){function t(){}return t.fromPlain=function(t){if("object"==typeof t&&null!==t){var e=t.lid;if(e instanceof Array&&e.length>0){for(var n=!0,r=0,i=[];n&&r<e.length;){var o=Hn.IdentifierInterval.fromPlain(e[r]);null!==o?i.push(o):n=!1,r++}if(n)return new s(i,-1)}}return null},t}(),s=function(t){function e(e,n){var r=this;return console.assert(e.length>0,"lid must not be empty"),console.assert(Kn.isInt32(n),"author  int32"),(r=t.call(this)||this).lid=e,r.author=n,r}return r(e,t),e.fromPlain=function(t){if("object"==typeof t&&null!==t){var n=t.lid,r=t.author;if(!(n instanceof Array&&n.length>0&&"number"==typeof r&&Kn.isInt32(r)))return o.fromPlain(t);for(var i=!0,s=0,a=[];i&&s<n.length;){var u=Hn.IdentifierInterval.fromPlain(n[s]);null!==u?a.push(u):i=!1,s++}if(i)return new e(a,r)}return null},e.prototype.equals=function(t){return this.lid.length===t.lid.length&&this.lid.every(function(e,n){var r=t.lid[n];return e.equals(r)})},e.prototype.execute=function(t){var e=this;return i.apply([],this.lid.map(function(n){return t.delBlock(n,e.author)}))},e}(Yn.LogootSOperation);e.LogootSDel=s});zn(Qn);Qn.LogootSDel;var tr=$n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){return function(t,e){this.index=t,this.author=e}}();e.TextOperation=n});zn(tr);tr.TextOperation;var er=$n(function(t,e){var n,r=qn&&qn.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(e,n,r){var i=this;return console.assert(Kn.isInt32(e),"index   int32"),console.assert(Kn.isInt32(n),"length   int32"),console.assert(n>0,"length > 0"),console.assert(Kn.isInt32(r),"author  int32"),(i=t.call(this,e,r)||this).length=n,i}return r(e,t),e.prototype.equals=function(t){return this.index===t.index&&this.length===t.length},e.prototype.applyTo=function(t){return t.delLocal(this.index,this.index+this.length-1)},e}(tr.TextOperation);e.TextDelete=i});zn(er);er.TextDelete;var nr=$n(function(t,e){var n,r=qn&&qn.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.fromPlain=function(t){if("object"==typeof t&&null!==t){var e=t.l;if("string"==typeof e&&e.length>0){var n=t.id,r=Wn.Identifier.fromPlain(n);if(null!==r)return new o(r,e)}}return null},t}(),o=function(t){function e(e,n){var r=this;return console.assert(n.length>0,"content must not be empty"),(r=t.call(this)||this).id=e,r.content=n,r}return r(e,t),e.fromPlain=function(t){if("object"==typeof t&&null!==t){var n=t.content;if(!("string"==typeof n&&n.length>0))return i.fromPlain(t);var r=t.id,o=Wn.Identifier.fromPlain(r);if(null!==o)return new e(o,n)}return null},Object.defineProperty(e.prototype,"author",{get:function(){return this.id.replicaNumber},enumerable:!0,configurable:!0}),e.prototype.equals=function(t){return this.id.equals(t.id)&&this.content===t.content},e.prototype.execute=function(t){return t.addBlock(this.content,this.id)},e}(Yn.LogootSOperation);e.LogootSAdd=o});zn(nr);nr.LogootSAdd;var rr=$n(function(t,e){var n,r=qn&&qn.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(e,n,r){var i=this;return console.assert(Kn.isInt32(e),"index  int32"),console.assert(Kn.isInt32(r),"author  int32"),(i=t.call(this,e,r)||this).content=n,i}return r(e,t),e.prototype.equals=function(t){return this.index===t.index&&this.content===t.content},e.prototype.applyTo=function(t){return t.insertLocal(this.index,this.content)},e}(tr.TextOperation);e.TextInsert=i});zn(rr);rr.TextInsert;var ir=$n(function(t,e){function n(t){return null!==t?t.height:0}function r(t){return null!==t?t.sizeNodeAndChildren:0}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e,i,o,s){console.assert(Kn.isInt32(e),"actualBegin  int32"),console.assert(t.idInterval.begin<=e,"actualBegin must be greater than or equal to idInterval.begin"),this.block=t,this.actualBegin=e,this.length=i,this.left=o,this.right=s,this.height=Math.max(n(o),n(s))+1,this.sizeNodeAndChildren=i+r(o)+r(s)}return t.fromPlain=function(e){if("object"==typeof e&&null!==e){var n=e.block,r=e.actualBegin,i=e.length,o=e.left,s=e.right;if(n instanceof Object&&"number"==typeof r&&Kn.isInt32(r)&&"number"==typeof i&&Kn.isInt32(i)&&i>=0){var a=Jn.LogootSBlock.fromPlain(n),u=t.fromPlain(s),c=t.fromPlain(o);if(null!==a&&a.idInterval.begin<=r&&a.idInterval.end-a.idInterval.begin>=i-1)return new t(a,r,i,c,u)}}return null},t.leaf=function(e,n,r){return console.assert(Kn.isInt32(n),"aOffset  int32"),console.assert(Kn.isInt32(r),"lenth  int32"),console.assert(r>0,"lenth > 0"),e.addBlock(n,r),new t(e,n,r,null,null)},Object.defineProperty(t.prototype,"actualEnd",{get:function(){return this.actualBegin+this.length-1},enumerable:!0,configurable:!0}),t.prototype.getIdBegin=function(){return this.block.idInterval.getBaseId(this.actualBegin)},t.prototype.getIdEnd=function(){return this.block.idInterval.getBaseId(this.actualEnd)},t.prototype.addString=function(t){console.assert(Kn.isInt32(t),"length   int32"),this.sizeNodeAndChildren+=t},t.prototype.appendEnd=function(t){console.assert(Kn.isInt32(t),"length   int32"),console.assert(t>0,""+t," > 0");var e=this.actualEnd+1;return this.length+=t,this.block.addBlock(e,t),this.block.idInterval.getBaseId(e)},t.prototype.appendBegin=function(t){return console.assert(Kn.isInt32(t),"length   int32"),console.assert(t>0,""+t," > 0"),this.actualBegin-=t,this.length+=t,this.block.addBlock(this.actualBegin,t),this.getIdBegin()},t.prototype.deleteOffsets=function(t,e){console.assert(Kn.isInt32(t),"begin   int32"),console.assert(Kn.isInt32(e),"end   int32"),console.assert(t<=e,"begin <= end: "+t," <= "+e),console.assert(this.block.idInterval.begin<=t,"this.block.idInterval.begin <= to begin: "+this.block.idInterval.begin," <= "+t),console.assert(e<=this.block.idInterval.end,"end <= this.block.idInterval.end: "+e," <= "+this.block.idInterval.end);var n=null,r=Math.max(this.actualBegin,t),i=Math.min(this.actualEnd,e);if(r<=i){var o=i-r+1;this.block.delBlock(o),o!==this.length&&(r===this.actualBegin?this.actualBegin=i+1:i!==this.actualEnd&&(n=this.split(i-this.actualBegin+1,null))),this.length=this.length-o}return n},t.prototype.split=function(e,n){var r=new t(this.block,this.actualBegin+e,this.length-e,n,this.right);return this.length=e,this.right=r,this.height=Math.max(this.height,r.height),r},t.prototype.leftSubtreeSize=function(){return r(this.left)},t.prototype.rightSubtreeSize=function(){return r(this.right)},t.prototype.sumDirectChildren=function(){this.height=Math.max(n(this.left),n(this.right))+1,this.sizeNodeAndChildren=this.leftSubtreeSize()+this.rightSubtreeSize()+this.length},t.prototype.replaceChildren=function(t,e){this.left===t?this.left=e:this.right===t&&(this.right=e)},t.prototype.balanceScore=function(){return n(this.right)-n(this.left)},t.prototype.become=function(t){this.sizeNodeAndChildren=-this.length+t.length,this.length=t.length,this.actualBegin=t.actualBegin,this.block=t.block},t.prototype.isAppendableAfter=function(t,e){return this.block.isMine(t)&&this.block.idInterval.end===this.actualEnd&&this.block.idInterval.idEnd.hasPlaceAfter(e)},t.prototype.isAppendableBefore=function(t,e){return this.block.isMine(t)&&this.block.idInterval.begin===this.actualBegin&&this.block.idInterval.idBegin.hasPlaceBefore(e)},t.prototype.toString=function(){var t=this.getIdentifierInterval().toString(),e=null!==this.left?this.left.toString():"\t#";return(null!==this.right?this.right.toString():"\t#").replace(/(\t+)/g,"\t$1")+"\n\t"+t+"\n"+e.replace(/(\t+)/g,"\t$1")},t.prototype.toList=function(){var t=this.getIdentifierInterval(),e=null!==this.left?this.left.toList():[],n=null!==this.right?this.right.toList():[];return e.concat(t,n)},t.prototype.getIdentifierInterval=function(){return new Hn.IdentifierInterval(this.getIdBegin(),this.actualEnd)},t.prototype.getBlocks=function(){var t=[this.block],e=this.left;null!==e&&(t=t.concat(e.getBlocks()));var n=this.right;return null!==n&&(t=t.concat(n.getBlocks())),t},t}();e.RopesNodes=i});zn(ir);ir.RopesNodes;var or=$n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.insert=function(t,e,n){console.assert(Number.isSafeInteger(e),"index  safe integer");var r=Math.max(0,e);return t.slice(0,r)+n+t.slice(r)},e.del=function(t,e,n){return console.assert(Number.isSafeInteger(e),"begin  safe integer"),console.assert(Number.isSafeInteger(n),"end  safe integer"),t.slice(0,e)+t.slice(n+1)},e.occurrences=function(t,e){for(var n=0,r=e.length,i=t.indexOf(e);-1!==i;)n++,i=t.indexOf(e,i+r);return n}});zn(or);or.insert,or.del,or.occurrences;var sr=$n(function(t,e){function n(t){return t.left}function r(t){return t.right}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e,n,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=null),void 0===r&&(r=""),console.assert(Kn.isInt32(t),"replica  int32"),console.assert(Kn.isInt32(e),"clock  int32"),this.replicaNumber=t,this.clock=e,this.root=n,this.str=r;var i={};if(null!==n){console.assert(r.length===n.sizeNodeAndChildren,"str length must match the number of elements in the model");for(var o=0,s=n.getBlocks();o<s.length;o++){var a=s[o];i[a.idInterval.base.join(",")]=a}}else console.assert(0===r.length,"str must be empty when no root is provided");this.mapBaseToBlock=i}return t.empty=function(){return new t(0,0)},t.fromPlain=function(e,n,r){if(console.assert(Kn.isInt32(e),"replica  int32"),console.assert(Kn.isInt32(n),"clock  int32"),"object"==typeof r&&null!==r){var i=r.str,o=r.root;if("string"==typeof i){var s=ir.RopesNodes.fromPlain(o);if(null!==s&&i.length===s.sizeNodeAndChildren)return new t(e,n,s,i)}}return null},Object.defineProperty(t.prototype,"height",{get:function(){return this.root?this.root.height:0},enumerable:!0,configurable:!0}),t.prototype.getBlock=function(t){var e,n=this.mapBaseToBlock,r=t.base.join(",");return n.hasOwnProperty(r)?e=n[r]:(e=new Jn.LogootSBlock(t,0),this.mapBaseToBlock[r]=e),e},t.prototype.addBlockFrom=function(t,e,n,r){var i=this,o=this.addBlockFromRec(t,e,n,r);return o.forEach(function(t){i.applyTextInsert(t)}),o},t.prototype.addBlockFromRec=function(t,e,n,r){for(var i=e.idBegin.replicaNumber,o=[],s=[],a=!0,u=r;a;)switch(o.push(n),Xn.compareBase(e,n.getIdentifierInterval())){case 0:null===n.right?(n.right=ir.RopesNodes.leaf(this.getBlock(e),e.begin,t.length),u=u+n.leftSubtreeSize()+n.length,s.push(new rr.TextInsert(u,t,i)),a=!1):(u=u+n.leftSubtreeSize()+n.length,n=n.right);break;case 1:null===n.left?(n.left=ir.RopesNodes.leaf(this.getBlock(e),e.begin,t.length),s.push(new rr.TextInsert(u,t,i)),a=!1):n=n.left;break;case 2:var c=n.getIdBegin().length-1,h=e.idBegin.tuples[c].offset,l=ir.RopesNodes.leaf(this.getBlock(e),e.begin,t.length);o.push(n.split(h-n.actualBegin+1,l)),u+=n.leftSubtreeSize(),s.push(new rr.TextInsert(u+h-n.actualBegin+1,t,i)),a=!1;break;case 3:c=e.idBegin.length-1,h=n.getIdBegin().tuples[c].offset;var f=t.substr(0,h+1-e.begin),p=new Hn.IdentifierInterval(e.idBegin,h);null===n.left?(n.left=ir.RopesNodes.leaf(this.getBlock(p),p.begin,f.length),s.push(new rr.TextInsert(u,f,i))):Array.prototype.push.apply(s,this.addBlockFromRec(f,p,n.left,u)),f=t.substr(h+1-e.begin,t.length);var d=Wn.Identifier.fromBase(e.idBegin,h+1);p=new Hn.IdentifierInterval(d,e.end),u=u+n.leftSubtreeSize()+n.length,null===n.right?(n.right=ir.RopesNodes.leaf(this.getBlock(p),p.begin,f.length),s.push(new rr.TextInsert(u,f,i))):Array.prototype.push.apply(s,this.addBlockFromRec(f,p,n.right,u)),a=!1;break;case 4:if(null!==n.left){var y=n.getIdBegin().minOffsetAfterPrev(n.left.getIdEnd(),e.begin);(b=t.substr(y-e.begin,t.length)).length>0&&(n.appendBegin(b.length),s.push(new rr.TextInsert(u+n.leftSubtreeSize(),b,i)),this.ascendentUpdate(o,b.length)),y-1>=e.begin?(t=t.substr(0,y-e.begin),e=new Hn.IdentifierInterval(e.idBegin,y-1),n=n.left):a=!1}else s.push(new rr.TextInsert(u,t,i)),n.appendBegin(t.length),this.ascendentUpdate(o,t.length),a=!1;break;case 5:if(null!==n.right){y=n.getIdEnd().maxOffsetBeforeNext(n.right.getIdBegin(),e.end);var b=t.substr(0,y+1-e.begin);if(u=u+n.leftSubtreeSize()+n.length,b.length>0&&(n.appendEnd(b.length),s.push(new rr.TextInsert(u,b,i)),this.ascendentUpdate(o,b.length)),e.end>=y+1){t=t.substr(y+1-e.begin,t.length);d=Wn.Identifier.fromBase(e.idBegin,y+1);e=new Hn.IdentifierInterval(d,e.end),n=n.right,u+=b.length}else a=!1}else u=u+n.leftSubtreeSize()+n.length,s.push(new rr.TextInsert(u,t,i)),n.appendEnd(t.length),this.ascendentUpdate(o,t.length),a=!1;break;case 6:a=!1}return this.balance(o),s},t.prototype.applyTextInsert=function(t){this.str=or.insert(this.str,t.index,t.content)},t.prototype.applyTextDelete=function(t){var e=t.index+t.length-1;this.str=or.del(this.str,t.index,e)},t.prototype.addBlock=function(t,e){var n=e.replicaNumber,r=new Hn.IdentifierInterval(e,e.lastOffset+t.length-1);if(null===this.root){var i=new Jn.LogootSBlock(r,0);this.mapBaseToBlock[i.idInterval.base.join(",")]=i,this.root=ir.RopesNodes.leaf(i,e.lastOffset,t.length);var o=new rr.TextInsert(0,t,n);return this.applyTextInsert(o),[o]}return this.addBlockFrom(t,r,this.root,0)},t.prototype.mkNode=function(t,e,n){console.assert(Kn.isInt32(n)&&n>0,"length  int32"),console.assert(n>0,"length > 0");var r=Zn.createBetweenPosition(t,e,this.replicaNumber,this.clock++),i=new Hn.IdentifierInterval(r,n-1),o=new Jn.LogootSBlock(i,0);return this.mapBaseToBlock[i.base.join(",")]=o,ir.RopesNodes.leaf(o,0,n)},t.prototype.insertLocal=function(t,e){if(console.assert(Kn.isInt32(t),"pos  int32"),null===this.root)return this.root=this.mkNode(null,null,e.length),this.str=or.insert(this.str,t,e),new nr.LogootSAdd(this.root.getIdBegin(),e);var i=void 0,o=this.str.length;this.str=or.insert(this.str,t,e);var s=void 0;if(0===t){if((s=[]).push(this.root),(u=this.getXest(n,s)).isAppendableBefore(this.replicaNumber,e.length)){var a=u.appendBegin(e.length);return this.ascendentUpdate(s,e.length),new nr.LogootSAdd(a,e)}i=this.mkNode(null,u.getIdBegin(),e.length),u.left=i}else if(t>=o){var u;if((s=[]).push(this.root),(u=this.getXest(r,s)).isAppendableAfter(this.replicaNumber,e.length)){var c=u.appendEnd(e.length);return this.ascendentUpdate(s,e.length),new nr.LogootSAdd(c,e)}i=this.mkNode(u.getIdEnd(),null,e.length),u.right=i}else{var h=this.searchNode(t);if(h.i>0){var l=h.node.block.idInterval.getBaseId(h.node.actualBegin+h.i-1),f=h.node.block.idInterval.getBaseId(h.node.actualBegin+h.i);i=this.mkNode(l,f,e.length),(s=h.path).push(h.node.split(h.i,i))}else{var p=this.searchNode(t-1);if(h.node.isAppendableBefore(this.replicaNumber,e.length)){var d=h.node.appendBegin(e.length);return this.ascendentUpdate(h.path,e.length),new nr.LogootSAdd(d,e)}if(p.node.isAppendableAfter(this.replicaNumber,e.length)){var y=p.node.appendEnd(e.length);return this.ascendentUpdate(p.path,e.length),new nr.LogootSAdd(y,e)}(i=this.mkNode(p.node.getIdEnd(),h.node.getIdBegin(),e.length)).right=p.node.right,p.node.right=i,(s=p.path).push(i)}}return this.balance(s),new nr.LogootSAdd(i.getIdBegin(),e)},t.prototype.getXest=function(t,e){for(var n=e[e.length-1],r=t(n);null!==r;)n=r,e[e.length]=r,r=t(r);return n},t.prototype.searchPos=function(t,e){for(var n=0,r=this.root;null!==r;)if(e.push(r),-1===t.compareTo(r.getIdBegin()))r=r.left;else if(1===t.compareTo(r.getIdEnd()))n=n+r.leftSubtreeSize()+r.length,r=r.right;else{if(t.equalsBase(r.getIdBegin()))return n+r.leftSubtreeSize();r=null}return-1},t.prototype.searchNode=function(t){console.assert(Kn.isInt32(t),"pos  int32");for(var e=this.root,n=[];null!==e;){n.push(e);var r=e.leftSubtreeSize();if(t<r)e=e.left;else{if(t<r+e.length)return{i:t-r,node:e,path:n};t-=r+e.length,e=e.right}}return null},t.prototype.ascendentUpdate=function(t,e){console.assert(Kn.isInt32(e),"length  int32");for(var n=0,r=t;n<r.length;n++){r[n].addString(e)}},t.prototype.delBlock=function(t,e){for(var n,r=this,i=[];;){var o=[];if(-1===(n=this.searchPos(t.idBegin,o))){if(!(t.begin<t.end))break;var s=Wn.Identifier.fromBase(t.idBegin,t.begin+1);t=new Hn.IdentifierInterval(s,t.end)}else{var a=o[o.length-1],u=Math.min(t.end,a.actualEnd),c=n+t.begin-a.actualBegin,h=u-t.begin+1;i.push(new er.TextDelete(c,h,e));var l=a.deleteOffsets(t.begin,u);if(0===a.length?this.delNode(o):null!==l?(o.push(l),this.balance(o)):this.ascendentUpdate(o,t.begin-u-1),u===t.end)break;s=Wn.Identifier.fromBase(t.idBegin,u);t=new Hn.IdentifierInterval(s,t.end)}}return i.forEach(function(t){r.applyTextDelete(t)}),i},t.prototype.delLocal=function(t,e){console.assert(Kn.isInt32(t),"begin  int32"),console.assert(Kn.isInt32(e),"end  int32"),console.assert(t<=e,""+t," <= "+e),this.str=or.del(this.str,t,e);var n=e-t+1,r=[];do{var i=this.searchNode(t);if(null!==i){var o=i.node.actualBegin+i.i,s=Math.min(o+n-1,i.node.actualEnd),a=i.node.getIdBegin(),u=Wn.Identifier.fromBase(a,o);r.push(new Hn.IdentifierInterval(u,s));var c=i.node.deleteOffsets(o,s);n-=s-o+1,0===i.node.length?this.delNode(i.path):null!==c?(i.path.push(c),this.balance(i.path)):this.ascendentUpdate(i.path,o-s-1)}else n=0}while(n>0);return new Qn.LogootSDel(r,this.replicaNumber)},t.prototype.delNode=function(t){var e=t[t.length-1];if(0===e.block.nbElement&&delete this.mapBaseToBlock[e.block.idInterval.base.join(",")],null===e.right)e===this.root?this.root=e.left:(t.pop(),t[t.length-1].replaceChildren(e,e.left));else if(null===e.left)e===this.root?this.root=e.right:(t.pop(),t[t.length-1].replaceChildren(e,e.right));else{t.push(e.right);var n=this.getMinPath(t);e.become(n),t.pop(),t[t.length-1].replaceChildren(n,n.right)}this.balance(t)},t.prototype.getMinPath=function(t){console.assert(0!==t.length,"path has at least one item");for(var e=t[t.length-1];null!==e.left;)e=e.left,t.push(e);return e},t.prototype.balance=function(t){for(;t.length>0;){var e=t.pop(),n=0===t.length?null:t[t.length-1];e.sumDirectChildren();for(var r=e.balanceScore();Math.abs(r)>=2;)n=r>=2?null!==e.right&&e.right.balanceScore()<=-1?this.rotateRL(e,n):this.rotateLeft(e,n):null!==e.left&&e.left.balanceScore()>=1?this.rotateLR(e,n):this.rotateRight(e,n),t.push(n),r=e.balanceScore()}},t.prototype.rotateLeft=function(t,e){console.assert(null!==t.right,"There exists a right node"),console.assert(t===this.root==(null===e),"The father is null when we are rotating left the root");var n=t.right;return t===this.root?this.root=n:e.replaceChildren(t,n),t.right=n.left,n.left=t,t.sumDirectChildren(),n.sumDirectChildren(),n},t.prototype.rotateRight=function(t,e){console.assert(null!==t.left,"There exists a left node"),console.assert(t===this.root==(null===e),"The father is null when we are rotating right the root");var n=t.left;return t===this.root?this.root=n:e.replaceChildren(t,n),t.left=n.right,n.right=t,t.sumDirectChildren(),n.sumDirectChildren(),n},t.prototype.rotateRL=function(t,e){console.assert(null!==t.right,"There exists a right node");var n=t.right;return console.assert(null!==n.left,"There exists a left node of the right node"),this.rotateRight(n,t),this.rotateLeft(t,e)},t.prototype.rotateLR=function(t,e){console.assert(null!==t.left,"There exists a left node");var n=t.left;return console.assert(null!==n.right,"There exists a right node of the left node"),this.rotateLeft(n,t),this.rotateRight(t,e)},t.prototype.getNext=function(t){var e=t[t.length-1];if(null===e.right){if(t.length>1)if(t[t.length-2].left===e)return t.pop(),!0;return!1}return t.push(e.right),this.getXest(n,t),!0},t.prototype.digest=function(){var t=0,e=this.root;if(null!==e)for(var n=0,r=e.toList();n<r.length;n++){t=17*t+r[n].digest()|0}return t},t}();e.LogootSRopes=i});zn(sr);sr.LogootSRopes;var ar=$n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.documentLength=t.str.length,this.treeHeight=t.height,this.nodeNumber=0,this.nodeLengths=[],this.identifierLengths=[],this.nodesStats={max:0,min:-1,mean:0,median:0,lengthRepartition:new Map},this.identifiersStats={max:0,min:-1,mean:0,median:0,lengthRepartition:new Map},this.compute(t)}return Object.defineProperty(t.prototype,"numberOfNodes",{get:function(){return this.nodeNumber},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxNodeLength",{get:function(){return this.nodesStats.max},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minNodeLength",{get:function(){return this.nodesStats.min},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"meanNodeLength",{get:function(){return this.nodesStats.mean},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"medianNodeLength",{get:function(){return this.nodesStats.median},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"repartitionNodeLength",{get:function(){return this.nodesStats.lengthRepartition},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"repartitionNodeLengthString",{get:function(){var t=Array.from(this.nodesStats.lengthRepartition);t.sort(function(t,e){return t[0]-e[0]});var e="";return t.forEach(function(t){e+="("+t[0]+", "+t[1]+"), "}),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxIdentifierLength",{get:function(){return this.identifiersStats.max},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minIdentifierLength",{get:function(){return this.identifiersStats.min},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"meanIdentifierLength",{get:function(){return this.identifiersStats.mean},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"medianIdentifierLength",{get:function(){return this.identifiersStats.median},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"repartitionIdentifierLength",{get:function(){return this.identifiersStats.lengthRepartition},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"repartitionIdentifierLengthString",{get:function(){var t=Array.from(this.identifiersStats.lengthRepartition);t.sort(function(t,e){return t[0]-e[0]});var e="";return t.forEach(function(t){e+="("+t[0]+", "+t[1]+"), "}),e},enumerable:!0,configurable:!0}),t.prototype.toString=function(){var t="";return t+="Document stats : \n",t+="\t Document length : "+this.documentLength+"\n",t+="\t Number of nodes : "+this.numberOfNodes+"\n",t+="\t Height of the tree : "+this.treeHeight+"\n",t+="\t Nodes : \n",t+="\t\tMax length : "+this.maxNodeLength+"\n",t+="\t\tMin length : "+this.minNodeLength+"\n",t+="\t\tMean length : "+this.meanNodeLength+"\n",t+="\t\tMedian length : "+this.medianNodeLength+"\n",t+="\t\tLength repartition : "+this.repartitionNodeLengthString+"\n",t+="\t Identifier : \n",t+="\t\tMax length : "+this.maxIdentifierLength+"\n",t+="\t\tMin length : "+this.minIdentifierLength+"\n",t+="\t\tMean length : "+this.meanIdentifierLength+"\n",t+="\t\tMedian length : "+this.medianIdentifierLength+"\n",t+="\t\tLength repartition : "+this.repartitionIdentifierLengthString+"\n"},t.prototype.compute=function(t){this.nodeNumber=this.recCompute(t.root),this.nodeLengths=this.nodeLengths.sort(function(t,e){return t-e}),this.identifierLengths=this.identifierLengths.sort(function(t,e){return t-e}),this.nodesStats.mean/=this.nodeNumber;var e=this.nodeLengths.length;this.nodesStats.median=e%2==0?(this.nodeLengths[e/2]+this.nodeLengths[e/2+1])/2:this.nodeLengths[Math.ceil(e/2)],this.identifiersStats.mean/=this.nodeNumber;var n=this.identifierLengths.length;this.identifiersStats.median=n%2==0?(this.identifierLengths[n/2]+this.identifierLengths[n/2+1])/2:this.identifierLengths[Math.ceil(n/2)]},t.prototype.recCompute=function(t){if(!t)return 0;var e=t.length;(this.nodeLengths.push(e),this.nodesStats.max=this.nodesStats.max<e?e:this.nodesStats.max,this.nodesStats.min=-1===this.nodesStats.min?e:this.nodesStats.min>e?e:this.nodesStats.min,this.nodesStats.mean+=e,this.nodesStats.lengthRepartition.has(e))?(n=this.nodesStats.lengthRepartition.get(e))&&this.nodesStats.lengthRepartition.set(e,n+1):this.nodesStats.lengthRepartition.set(e,1);var n,r=t.getIdBegin().length;(this.identifierLengths.push(r),this.identifiersStats.max=this.identifiersStats.max<r?r:this.identifiersStats.max,this.identifiersStats.min=-1===this.identifiersStats.min?r:this.identifiersStats.min>r?r:this.identifiersStats.min,this.identifiersStats.mean+=r,this.identifiersStats.lengthRepartition.has(r)&&this.identifiersStats.lengthRepartition)?(n=this.identifiersStats.lengthRepartition.get(r))&&this.identifiersStats.lengthRepartition.set(r,n+1):this.identifiersStats.lengthRepartition.set(r,1);return this.recCompute(t.left)+1+this.recCompute(t.right)},t}();e.Stats=n});zn(ar);ar.Stats;var ur=$n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.isDot=Gn.isDot,e.IdentifierTuple=Vn.IdentifierTuple,e.Identifier=Wn.Identifier,e.IdentifierInterval=Hn.IdentifierInterval,e.LogootSBlock=Jn.LogootSBlock,e.LogootSRopes=sr.LogootSRopes,e.RopesNodes=ir.RopesNodes,e.LogootSDel=Qn.LogootSDel,e.TextDelete=er.TextDelete,e.LogootSAdd=nr.LogootSAdd,e.TextInsert=rr.TextInsert,e.LogootSOperation=Yn.LogootSOperation,e.TextOperation=tr.TextOperation,e.Stats=ar.Stats,e.insert=or.insert,e.del=or.del,e.occurrences=or.occurrences});zn(ur);ur.isDot,ur.IdentifierTuple;var cr=ur.Identifier,hr=(ur.IdentifierInterval,ur.LogootSBlock,ur.LogootSRopes),lr=(ur.RopesNodes,ur.LogootSDel),fr=ur.TextDelete,pr=ur.LogootSAdd,dr=ur.TextInsert,yr=(ur.LogootSOperation,ur.TextOperation,ur.Stats,ur.insert,ur.del,ur.occurrences,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.fromPlain=function(t){if("object"==typeof t&&null!==t&&"number"==typeof t.id&&Number.isInteger(t.id)&&"number"==typeof t.clock&&Number.isInteger(t.clock)){var e=pr.fromPlain(t.logootSOp);if(e instanceof pr)return new br(t.id,t.clock,e);var n=lr.fromPlain(t.logootSOp);if(n instanceof lr)return t.dependencies instanceof Array&&t.dependencies.length>0?new br(t.id,t.clock,n,new Map(t.dependencies)):t.dependencies instanceof Map&&t.dependencies.size>0?new br(t.id,t.clock,n,t.dependencies):new br(t.id,t.clock,n,new Map)}return null},e}(kn)),br=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.fromPlain=function(t){if("object"==typeof t&&null!==t&&"number"==typeof t.id&&Number.isInteger(t.id)&&"number"==typeof t.clock&&Number.isInteger(t.clock)){var n=pr.fromPlain(t.operation);if(n instanceof pr)return new e(t.id,t.clock,n);var r=lr.fromPlain(t.operation);if(r instanceof lr)return t.dependencies instanceof Array&&t.dependencies.length>0?new e(t.id,t.clock,r,new Map(t.dependencies)):t.dependencies instanceof Map&&t.dependencies.size>0?new e(t.id,t.clock,r,t.dependencies):new e(t.id,t.clock,r,new Map)}return yr.fromPlain(t)},e.prototype.equals=function(e){var n=!1;return this.operation instanceof pr&&e.operation instanceof pr?n=this.operation.equals(e.operation):this.operation instanceof lr&&e.operation instanceof lr&&(n=this.operation.equals(e.operation)),t.prototype.equals.call(this,e)&&n},e}(kn),gr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.emptyState=function(){var t=re();return new e(t,new hr(t),[],new Map,0)},e.fromPlain=function(t){if(null!==t&&"object"==typeof t&&t.remoteOperations instanceof Array){var n=t.remoteOperations.map(function(t){return br.fromPlain(t)});if(n.filter(function(t){return null===t}).length>0)return null;if(this.isArray(t.vector)&&t.sequenceCRDT&&"object"==typeof t.sequenceCRDT&&"number"==typeof t.sequenceCRDT.replicaNumber&&Number.isInteger(t.sequenceCRDT.replicaNumber)&&"number"==typeof t.sequenceCRDT.clock){var r=new Map(t.vector),i=hr.fromPlain(t.sequenceCRDT.replicaNumber,t.sequenceCRDT.clock,t.sequenceCRDT);if(!i)return null;var o=void 0;if("number"!=typeof t.networkClock||!Number.isInteger(t.networkClock))return null;o=t.networkClock;return"number"==typeof t.id&&Number.isInteger(t.id)?new e(t.id,i,n,r,o):null}var s=new e(0,new hr,[],new Map,0);return n.forEach(function(t){s.vector.set(t.id,t.clock),t.operation.execute(s._sequenceCRDT)}),s}return null},e}(Pn);var mr=function(){function t(){}return t.fromPlain=function(t,n){var r;switch(t){case e.Strategy.LOGOOTSPLIT:r=function(t,e){return t.fromPlain(e)}(gr,n);break;default:r=null}return r},t.emptyState=function(t){var n;switch(t){case e.Strategy.LOGOOTSPLIT:n=gr.emptyState();break;default:n=null}return n},t.getStr=function(t){return t instanceof gr?t.sequenceCRDT.str:void 0},t}(),vr=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}s(e,t),e.prototype.computeDependencies=function(t){return new Map}}(An),function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.prototype.computeDependencies=function(t){var e=this,n=new Map;return t instanceof lr&&t.lid.forEach(function(t){var r=t.idBegin.replicaNumber;n.set(r,e.vector.get(r))}),n},e}(An)),wr=function(t){function e(e,n,r,i,o){return t.call(this,e,n,r,i,o)||this}return s(e,t),e.prototype.logLocalOperation=function(t,e,n){if(n instanceof pr){var r=n,i=e;this._localOperationForLog$.next({type:"localInsertion",siteId:t,clock:this.sync.stateElements.networkClock,position:i.index,content:i.content,length:i.content.length,operation:r,context:this.sync.stateElements.vector})}else if(n instanceof lr){r=n,i=e;this._localOperationForLog$.next({type:"localDeletion",siteId:t,clock:this.sync.stateElements.networkClock,position:i.index,length:i.length,operation:r,context:this.sync.stateElements.vector})}},e.prototype.logRemoteOperation=function(t,e,n,r,i){if(n instanceof pr){var o=n;this._remoteOperationForLog.next({type:"remoteInsertion",siteId:t,remoteSiteId:i,remoteClock:r,textOperation:e,operation:o,context:this.sync.stateElements.vector})}else if(n instanceof lr){o=n;this._remoteOperationForLog.next({type:"remoteDeletion",siteId:t,remoteSiteId:i,remoteClock:r,textOperation:e,operation:o,context:this.sync.stateElements.vector})}},Object.defineProperty(e.prototype,"state",{get:function(){var t=this.sync.stateElements,e=t.vector,n=t.richOperations,r=t.networkClock;return new gr(this.id,this.document.doc,n,e,r)},enumerable:!0,configurable:!0}),e}(_n),Sr=function(t){function e(e){var n=t.call(this,e)||this;return n._doc=e,n}return s(e,t),e.prototype.handleLocalOperation=function(t){var e=this;t.forEach(function(t){var n=t.applyTo(e.doc);e.localOperationLogsSubject.next({textop:t,operation:n}),e.localOperationSubject.next(n)})},e.prototype.handleRemoteOperation=function(t){var e=t.execute(this.doc);return this.remoteOperationLogsSubject.next({textop:e,operation:t}),e},e.prototype.positionFromIndex=function(t){var e=this.doc.searchNode(t);if(null!==e){var n=e.node.actualBegin+e.i;return{id:cr.fromBase(e.node.getIdBegin(),n),index:e.i}}},e.prototype.indexFromId=function(t){return this.doc.searchPos(cr.fromPlain(t),new Array)},e}(xn),Or=function(t){function e(e,n){return t.call(this,e,n)||this}return s(e,t),e.prototype.serializeRichOperation=function(t){var e=t.id,n=t.clock,r=t.operation,i=t.dependencies,o=Array.from(i).reduce(function(t,e){var n=e[0]+"",r=Object.create({});return r[n]=e[1],a({},t,r)},{}),s=wn.RichLogootSOperationMsg.create({id:e,clock:n,dependencies:o}),u=wn.RichOperationMsg.create({richLogootSOpsMsg:s});return u.richLogootSOpsMsg&&(r instanceof lr?u.richLogootSOpsMsg.logootSDelMsg=wn.LogootSDelMsg.create(r):r instanceof pr&&(u.richLogootSOpsMsg.logootSAddMsg=wn.LogootSAddMsg.create(r))),u},e.prototype.deserializeRichOperation=function(t){if(t.richLogootSOpsMsg){var e=pr.fromPlain(t.richLogootSOpsMsg.logootSAddMsg),n=lr.fromPlain(t.richLogootSOpsMsg.logootSDelMsg),r=new Map,i=t.richLogootSOpsMsg.dependencies;i&&"object"==typeof i&&Object.entries(i).forEach(function(t){r.set(parseInt(t[0],10),t[1])});var o=br.fromPlain({id:t.richLogootSOpsMsg.id,clock:t.richLogootSOpsMsg.clock,operation:e||n,dependencies:r});if(o)return o;throw new Error("Error in fromPlain")}throw new Error("Can't deserialize the RichOperation message : "+t)},e}(Nn),Mr=function(){function t(){}return t.createDocService=function(t,n,r,i,o,s){switch(t){case e.Strategy.LOGOOTSPLIT:if(o instanceof gr){var a=new Sr(o.sequenceCRDT),u=new vr(i,o.networkClock,o.vector,o.remoteOperations,s),c=new Or(n,r);return new wr(i,s,a,u,c)}throw new Error("State is not an instanceof LSState");default:throw new Error("This strategy doesn't exist")}},t}();var Ir=function(){function t(){}return t.fromPlain=function(t,n){var r;switch(t){case e.Strategy.LOGOOTSPLIT:r=function(t,e){return t.fromPlain(e)}(br,n);break;default:r=null}return r},t}(),_r=function(t){function e(e,n){var r,i=e.profile,o=e.strategy,s=e.docContent,u=e.metaTitle,c=e.metaFixData,h=e.metaLogs,l=t.call(this)||this;return 0!==s.id?(r=s.id,i.muteCoreId=r):(r=i.muteCoreId||re(),i.muteCoreId||(i.muteCoreId=r)),l._messageOut$=new Ot,l._messageIn$=new Ot,l.collaboratorsService=new Un(l._messageIn$,l._messageOut$,a({id:0},i)),l.metaDataService=new Fn(l._messageIn$,l._messageOut$,u,c,h,r),l.docService=n(o,l._messageIn$,l._messageOut$,r,s,l.collaboratorsService),l}return s(e,t),e.mergeTitle=function(t,e){return Fn.mergeTitle(t,e)},e.mergeFixData=function(t,e){return Fn.mergeFixData(t,e)},Object.defineProperty(e.prototype,"myMuteCoreId",{get:function(){return this.collaboratorsService.me.muteCoreId||0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this.docService.state},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"messageIn$",{set:function(t){var e=this;this.newSub=t.subscribe(function(t){return e._messageIn$.next(t)})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"messageOut$",{get:function(){return this._messageOut$.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"localOperationForLog$",{get:function(){return this.docService.localOperationForLog$},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"remoteOperationForLog",{get:function(){return this.docService.remoteOperationForLog$},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"localTextOperations$",{set:function(t){this.docService.localTextOperations$=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"remoteTextOperations$",{get:function(){return this.docService.remoteTextOperations$},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"digestUpdate$",{get:function(){return this.docService.digestUpdate$},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"remoteCollabUpdate$",{get:function(){return this.collaboratorsService.remoteUpdate$},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"localCollabUpdate$",{set:function(t){this.collaboratorsService.localUpdate=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"collabJoin$",{get:function(){return this.collaboratorsService.join$},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"collabLeave$",{get:function(){return this.collaboratorsService.leave$},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"memberJoin$",{set:function(t){this.collaboratorsService.memberJoin$=t,this.metaDataService.memberJoin$=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"memberLeave$",{set:function(t){this.collaboratorsService.memberLeave$=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"remoteMetadataUpdate$",{get:function(){return this.metaDataService.remoteUpdate$},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"localMetadataUpdate$",{set:function(t){this.metaDataService.localUpdate$=t},enumerable:!0,configurable:!0}),e.prototype.synchronize=function(){this.docService.synchronize()},e.prototype.indexFromId=function(t){return this.docService.indexFromId(t)},e.prototype.positionFromIndex=function(t){return this.docService.positionFromIndex(t)},e}(i),xr=function(){function t(){}return t.createMuteCore=function(t){switch(t.strategy){case e.Strategy.LOGOOTSPLIT:if(t.docContent instanceof gr)return new _r(t,Mr.createDocService);throw new Error("")}},t}();try{ne.crypto=r}catch(t){console.error(t.message)}e.MuteCore=_r,e.MuteCoreFactory=xr,e.TextInsert=dr,e.TextDelete=fr,e.RichOperation=kn,e.State=Pn,e.StateStrategy=mr,e.RichOperationStrategy=Ir},function(t,e){t.exports=require("bunyan")},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(24),i=n(2);e.PKRequest=class{constructor(t,e){this._baseUrl=t,this._jwt=e,r.default.defaults.baseURL=this.baseUrl,r.default.defaults.headers.common.Authorization=`Bearer ${this.jwt}`,r.default.defaults.headers.post["Content-Type"]="application/json",r.default.defaults.headers.put["Content-Type"]="application/json"}register(t,e,n){return new Promise((o,s)=>{r.default.post("",{login:t,deviceID:e,pk:n}).then(t=>{i.log.info("Signing KeyPair",`Public Key REGISTERED Successfully for ${t.data.login}:${t.data.deviceID}`,t.data.pk),o()}).catch(n=>{i.log.error("Signing KeyPair",`Public Key REGISTERATION ERROR for ${t}:${e} : ${n.response.data}`),s(n)})})}lookup(t,e){return new Promise(n=>{r.default.get(`${t}/${e}`).then(r=>{i.log.info("Signing KeyPair",`LOOKUP ${t}:${e} FOUND`,r.data.pk),n(r.data.pk)}).catch(r=>{i.log.error("Signing KeyPair",`For ${t}:${e}, HTTP code ${r.response.status}, `+`body was: ${r.response.data}`),n("")})})}update(t,e,n){return new Promise((o,s)=>{r.default.put(`${t}/${e}`,{pk:n}).then(()=>{i.log.info("Signing KeyPair",`Public Key UPDATED in keyserver for ${t}:${e}`),o()}).catch(n=>{i.log.info("Signing KeyPair",`Public Key NOT UPDATED in keyserver for ${t}:${e} : ${n.response.data.body}`),s(n)})})}get baseUrl(){return this._baseUrl}get jwt(){return this._jwt}}},function(t,e){t.exports=require("axios")},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.Message=void 0;var r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(26));var i=r.Reader,o=r.Writer,s=r.util,a=r.roots.default||(r.roots.default={});e.Message=a.Message=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.streamId=0,t.prototype.content=s.newBuffer([]),t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=o.create()),null!=t.streamId&&t.hasOwnProperty("streamId")&&e.uint32(8).uint32(t.streamId),null!=t.content&&t.hasOwnProperty("content")&&e.uint32(18).bytes(t.content),e},t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new a.Message;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.streamId=t.uint32();break;case 2:r.content=t.bytes();break;default:t.skipType(7&o)}}return r},t}();e.default=a},function(t,e){t.exports=require("protobufjs/minimal")},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(4),i=n(28),o=n(8),s=n(2),a="Untitled Document";e.MongooseAdapter=class{constructor(){this.DocModel=i.model("Doc",new i.Schema({key:String,signalingKey:{type:String,require:!0},cryptoKey:{type:String,default:""},title:{type:String,default:a},titleModified:{type:Number,default:0},created:Number,logins:[],operations:Array,shareLogs:Boolean,shareLogsVector:{type:Map,of:Number}}))}connect(t,e){return i.connection.on("close",()=>s.log.warn("Connection to the database has been closed")),i.connect(`mongodb://${t}:27017/${e}`,{useNewUrlParser:!0})}async find(t){const e=await this.DocModel.findOne({signalingKey:t}).exec();if(e){const t=e.get("key");t&&(e.set({key:void 0,signalingKey:t,cryptoKey:await r.Symmetric.generateKey()}),await e.save())}return e}async lookupMetadataByLogin(t){const e=await this.DocModel.find({logins:t},"-operations -logins").exec(),n=[];for(const t of e){const e=t.get("key");e&&(t.set({key:void 0,signalingKey:e,cryptoKey:await r.Symmetric.generateKey()}),await t.save());const i=t.get("signalingKey"),o=t.get("cryptoKey"),s=t.get("title"),a=t.get("titleModified"),u=t.get("created"),c=t.get("shareLogs"),h=this.getShareVector(t);n.push({signalingKey:i,cryptoKey:o,title:s,titleModified:a,created:u,shareLogs:c,shareLogsVector:h})}return n}async removeLogin(t,e){const n=await this.find(t);if(n){const t=n.get("logins");for(let n=0;n<t.length;n++)if(t[n]===e){t.splice(n);break}n.set("logins",t),await n.save()}}async create(t){const e=await r.Symmetric.generateKey();return this.DocModel.create({signalingKey:t,created:Date.now(),cryptoKey:e})}getShareVector(t){const e=t.get("shareLogsVector");if(o.isUndefined(e))return new Map;const n=new Map;for(const t of e.keys()){const r=parseInt(t,10);n.set(r,e.get(t))}return n}}},function(t,e){t.exports=require("mongoose")},function(t){t.exports={name:"mute-bot-storage",version:"2.3.0",description:"",main:"index.js",scripts:{start:"node server.js",dev:"nodemon --watch src -e js,ts --exec 'npm run build && chmod +x dist/server.js && node dist/server.js --cors --logLevel trace | bunyan'",build:"webpack",lint:"tslint --fix -p tsconfig.json 'src/**/*.ts' -e 'src/**/*.proto' -e 'src/**/*.d.ts' && prettier --write --list-different 'src/**/*.ts' './*.{ts,js,json,md}'  && markdownlint ./*.md -i 'CHANGELOG.md'",proto:"pbjs -t static-module -w es6 --no-verify --no-delimited --no-convert src/proto/index.proto -o src/proto/index.es6.js && pbts src/proto/index.es6.js -o src/proto/index.d.ts",postproto:"babel --presets env -o src/proto/index.js src/proto/index.es6.js && rm src/proto/index.es6.js",cz:"git-cz",precommit:"lint-staged && npm run build && git add dist/*",commitmsg:"commitlint -e $GIT_PARAMS",prerelease:"npm run build && git add dist/*",release:"standard-version --no-verify"},files:["dist/server.js"],keywords:["bot","storage","peer-network"],author:"",engines:{node:">=8.1.4"},license:"AGPL-3.0",dependencies:{"@coast-team/mute-core":"^9.1.2","@coast-team/mute-crypto":"^0.4.1",axios:"^0.18.0",bunyan:"^1.8.12",commander:"^2.18.0",kcors:"^2.2.2",koa:"^2.5.2","koa-bodyparser":"^4.2.1","koa-router":"^7.4.0",mongoose:"^5.2.13",netflux:"^4.3.1","node-webcrypto-ossl":"^1.0.38",protobufjs:"^6.8.8",rxjs:"^6.3.3","text-encoding":"^0.6.4",uws:"10.148.1"},devDependencies:{"@commitlint/cli":"^7.1.2","@commitlint/config-conventional":"^7.1.2","@types/bunyan":"^1.8.4","@types/commander":"^2.12.2","@types/kcors":"^2.2.3","@types/koa":"^2.0.46","@types/koa-bodyparser":"^5.0.1","@types/koa-router":"^7.0.31","@types/mongoose":"^5.2.11","@types/node":"^8.10.29","babel-cli":"^6.26.0","babel-preset-env":"^1.7.0",commitizen:"^2.10.1","cz-conventional-changelog":"^2.1.0",husky:"^0.14.3","lint-staged":"^7.2.2","markdownlint-cli":"^0.13.0",nodemon:"^1.18.4",prettier:"^1.14.2","standard-version":"^4.4.0","ts-loader":"^5.0.0",tslint:"^5.11.0","tslint-config-prettier":"^1.15.0",typescript:"^3.0.3","validate-commit-msg":"^2.11.1",webpack:"^4.17.2","webpack-cli":"^3.1.0","webpack-node-externals":"^1.7.2"},commitlint:{extends:["@commitlint/config-conventional"]},config:{commitizen:{path:"node_modules/cz-conventional-changelog"}},"lint-staged":{linters:{"*.md":["prettier --write --list-different","git add","markdownlint -i 'CHANGELOG.md'"],"*.ts":["tslint --fix -p tsconfig.json -e src/proto/* -e 'src/**/*.d.ts'","git add"],"*.{ts,json,scss,css}":["prettier --write --list-different -e *proto*","git add"]},concurrent:!1}}},function(t,e){t.exports=require("fs")},function(t,e){t.exports=require("https")}]);